"use strict";(self.webpackChunkrspamd_docs=self.webpackChunkrspamd_docs||[]).push([[3770],{28453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>d});var i=s(96540);const r={},l=i.createContext(r);function t(e){const n=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),i.createElement(l.Provider,{value:n},e.children)}},29022:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>d,default:()=>h,frontMatter:()=>t,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"getting-started/understanding-rspamd","title":"Understanding Rspamd","description":"Before diving into installation and configuration, it\'s essential to understand what Rspamd is, how it works, and what you can configure. This foundation will help you make informed decisions and avoid common pitfalls.","source":"@site/docs/getting-started/understanding-rspamd.md","sourceDirName":"getting-started","slug":"/getting-started/understanding-rspamd","permalink":"/docs.rspamd.com/branches/master/getting-started/understanding-rspamd","draft":false,"unlisted":false,"editUrl":"https://github.com/rspamd/docs.rspamd.com/edit/master/docs/getting-started/understanding-rspamd.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"title":"Understanding Rspamd","sidebar_position":1},"sidebar":"docs","previous":{"title":"Getting Started with Rspamd","permalink":"/docs.rspamd.com/branches/master/getting-started/"},"next":{"title":"Installation Guide","permalink":"/docs.rspamd.com/branches/master/getting-started/installation"}}');var r=s(74848),l=s(28453);const t={title:"Understanding Rspamd",sidebar_position:1},d="Understanding Rspamd",o={},c=[{value:"What is Rspamd?",id:"what-is-rspamd",level:2},{value:"Key Characteristics",id:"key-characteristics",level:3},{value:"How Rspamd Works: The Processing Pipeline",id:"how-rspamd-works-the-processing-pipeline",level:2},{value:"Stage-by-Stage Breakdown",id:"stage-by-stage-breakdown",level:3},{value:"1. Message Reception",id:"1-message-reception",level:4},{value:"2. MIME Parsing",id:"2-mime-parsing",level:4},{value:"3. Pre-filters: Early Decisions",id:"3-pre-filters-early-decisions",level:4},{value:"4. Main Filters: Core Analysis",id:"4-main-filters-core-analysis",level:4},{value:"5. Post-filters: Final Adjustments",id:"5-post-filters-final-adjustments",level:4},{value:"6. Score Calculation and Action Selection",id:"6-score-calculation-and-action-selection",level:4},{value:"7. Response to MTA",id:"7-response-to-mta",level:4},{value:"Core Concepts in Detail",id:"core-concepts-in-detail",level:2},{value:"Modules: Functional Units",id:"modules-functional-units",level:3},{value:"Symbols: Test Results with Scores",id:"symbols-test-results-with-scores",level:3},{value:"Scores: Weighting System",id:"scores-weighting-system",level:3},{value:"Actions: What to Do with Messages",id:"actions-what-to-do-with-messages",level:3},{value:"Groups: Symbol Organization",id:"groups-symbol-organization",level:3},{value:"Workers: Process Types",id:"workers-process-types",level:3},{value:"Normal Worker",id:"normal-worker",level:4},{value:"Controller Worker",id:"controller-worker",level:4},{value:"Proxy Worker",id:"proxy-worker",level:4},{value:"Fuzzy Storage Worker",id:"fuzzy-storage-worker",level:4},{value:"Configuration Overview",id:"configuration-overview",level:2},{value:"The Configuration Hierarchy",id:"the-configuration-hierarchy",level:3},{value:"What You Can Configure",id:"what-you-can-configure",level:3},{value:"1. Action Thresholds (Most Common)",id:"1-action-thresholds-most-common",level:4},{value:"2. Symbol Scores (Fine-Tuning)",id:"2-symbol-scores-fine-tuning",level:4},{value:"3. Module Settings (Feature Control)",id:"3-module-settings-feature-control",level:4},{value:"4. Worker Configuration (Integration)",id:"4-worker-configuration-integration",level:4},{value:"5. System Options (Advanced)",id:"5-system-options-advanced",level:4},{value:"Configuration Strategies",id:"configuration-strategies",level:2},{value:"Strategy 1: Minimal (Quick Start)",id:"strategy-1-minimal-quick-start",level:3},{value:"Strategy 2: Tuned (Production)",id:"strategy-2-tuned-production",level:3},{value:"Strategy 3: Custom (Enterprise)",id:"strategy-3-custom-enterprise",level:3},{value:"Common Configuration Patterns",id:"common-configuration-patterns",level:2},{value:"Pattern: Reducing False Positives",id:"pattern-reducing-false-positives",level:3},{value:"Pattern: Stricter Spam Filtering",id:"pattern-stricter-spam-filtering",level:3},{value:"Pattern: Per-Domain Settings",id:"pattern-per-domain-settings",level:3},{value:"Understanding Rspamd Behavior",id:"understanding-rspamd-behavior",level:2},{value:"Why Scores, Not Rules?",id:"why-scores-not-rules",level:3},{value:"Why Multiple Small Checks Beat Few Large Rules?",id:"why-multiple-small-checks-beat-few-large-rules",level:3},{value:"Why Statistical Methods Matter",id:"why-statistical-methods-matter",level:3},{value:"Testing and Validation",id:"testing-and-validation",level:2},{value:"Before Going Live",id:"before-going-live",level:3},{value:"Validation Commands",id:"validation-commands",level:3},{value:"Performance Expectations",id:"performance-expectations",level:2},{value:"Next Steps",id:"next-steps",level:2},{value:"Key Takeaways",id:"key-takeaways",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"understanding-rspamd",children:"Understanding Rspamd"})}),"\n",(0,r.jsx)(n.p,{children:"Before diving into installation and configuration, it's essential to understand what Rspamd is, how it works, and what you can configure. This foundation will help you make informed decisions and avoid common pitfalls."}),"\n",(0,r.jsx)(n.h2,{id:"what-is-rspamd",children:"What is Rspamd?"}),"\n",(0,r.jsxs)(n.p,{children:["Rspamd is a ",(0,r.jsx)(n.strong,{children:"high-performance email processing daemon"})," that analyzes messages and provides classification results to mail transfer agents (MTAs). Unlike simple content filters, Rspamd uses a sophisticated multi-layered approach combining:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Authentication protocols"})," (SPF, DKIM, DMARC, ARC)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Content analysis"})," (regex, heuristics, HTML/text patterns)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Statistical classification"})," (Bayesian filtering, neural networks)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Reputation systems"})," (DNS blacklists, URL reputation, IP scoring)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Fuzzy hashing"})," (near-duplicate detection)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Machine learning"})," (adaptive scoring, pattern recognition)"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"key-characteristics",children:"Key Characteristics"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Event-driven architecture"}),": Rspamd uses non-blocking I/O to handle thousands of concurrent connections efficiently, allowing a single server to process millions of messages per day."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Modular design"}),": Functionality is organized into independent modules that can be enabled, disabled, or configured separately."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Statistical approach"}),": Instead of binary decisions, Rspamd calculates a numerical score based on multiple indicators, allowing for nuanced handling of messages."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"MTA-independent"}),": Communicates via HTTP/JSON protocol, making it compatible with any MTA without tight coupling or MTA-specific code."]}),"\n",(0,r.jsx)(n.h2,{id:"how-rspamd-works-the-processing-pipeline",children:"How Rspamd Works: The Processing Pipeline"}),"\n",(0,r.jsx)(n.p,{children:"When an email arrives, it goes through a multi-stage processing pipeline:"}),"\n",(0,r.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant MTA as Mail Server\n    participant Rspamd as Rspamd Daemon\n    participant Modules as Analysis Modules\n    participant Storage as Redis/Database\n\n    MTA->>Rspamd: Send message via HTTP\n    Rspamd->>Rspamd: Parse MIME structure\n    Rspamd->>Modules: Pre-filters (whitelist, rate limiting)\n\n    alt Message whitelisted\n        Modules->>Rspamd: Skip processing\n        Rspamd->>MTA: Accept (pre-result)\n    else Continue processing\n        Rspamd->>Modules: Main filters (SPF, DKIM, content, etc.)\n        Modules->>Storage: Async lookups (DNS, Redis, HTTP)\n        Storage->>Modules: Results\n        Modules->>Rspamd: Symbols with scores\n        Rspamd->>Modules: Post-filters (composites, actions)\n        Rspamd->>Rspamd: Calculate final score\n        Rspamd->>MTA: JSON response (action + details)\n    end"}),"\n",(0,r.jsx)(n.h3,{id:"stage-by-stage-breakdown",children:"Stage-by-Stage Breakdown"}),"\n",(0,r.jsx)(n.h4,{id:"1-message-reception",children:"1. Message Reception"}),"\n",(0,r.jsx)(n.p,{children:"The MTA sends the message to Rspamd via HTTP POST request:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-http",children:"POST /checkv2 HTTP/1.1\nFrom: sender@example.com\nIP: 203.0.113.42\nHelo: mail.example.com\n\n[raw message content]\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Rspamd receives not just the message, but also ",(0,r.jsx)(n.strong,{children:"envelope data"})," (sender IP, SMTP commands, authentication info) that's crucial for accurate analysis."]}),"\n",(0,r.jsx)(n.h4,{id:"2-mime-parsing",children:"2. MIME Parsing"}),"\n",(0,r.jsx)(n.p,{children:"Rspamd parses the message structure:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Headers (including authentication results)"}),"\n",(0,r.jsx)(n.li,{children:"Text parts (plain text, HTML)"}),"\n",(0,r.jsx)(n.li,{children:"Attachments and embedded content"}),"\n",(0,r.jsx)(n.li,{children:"URLs and email addresses"}),"\n",(0,r.jsx)(n.li,{children:"Metadata (received headers, message-ID)"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["This parsed structure is made available to all modules through the ",(0,r.jsx)(n.strong,{children:"task object"}),"."]}),"\n",(0,r.jsx)(n.h4,{id:"3-pre-filters-early-decisions",children:"3. Pre-filters: Early Decisions"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Pre-filters"})," run before main analysis and can short-circuit processing:"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Use cases:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Whitelisting"}),": Trusted senders bypass spam checks entirely"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Rate limiting"}),": Reject messages exceeding rate limits immediately"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Settings application"}),": Load user-specific or domain-specific configuration"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Example"}),": A whitelisted IP address gets ",(0,r.jsx)(n.code,{children:"no action"})," immediately, saving processing time."]}),"\n",(0,r.jsx)(n.h4,{id:"4-main-filters-core-analysis",children:"4. Main Filters: Core Analysis"}),"\n",(0,r.jsxs)(n.p,{children:["This is where the bulk of spam detection happens. Multiple modules run ",(0,r.jsx)(n.strong,{children:"concurrently"})," (for I/O-bound checks) or sequentially (for CPU-bound checks):"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Authentication checks"})," (SPF, DKIM, DMARC):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Message: From: ceo@company.com\nSPF: FAIL (IP not authorized)\nDKIM: None\n\u2192 Symbols: R_SPF_FAIL, FORGED_SENDER_FORWARD\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Content analysis"})," (regexp, heuristics):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'Subject: "BUY V1AGRA NOW!!!"\nBody: Contains suspicious patterns\n\u2192 Symbols: SUBJ_ALL_CAPS, DRUGS_ERECTILE\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Statistical classification"})," (Bayes, neural networks):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Token analysis: 85% match with spam corpus\nNeural network: 0.92 spam probability\n\u2192 Symbols: BAYES_SPAM, NEURAL_SPAM_LONG\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Reputation checks"})," (RBLs, URL lists):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Sender IP: Listed in zen.spamhaus.org\nURL: example-spam.com listed in SURBL\n\u2192 Symbols: RBL_SPAMHAUS_PBL, SURBL_MULTI\n"})}),"\n",(0,r.jsx)(n.h4,{id:"5-post-filters-final-adjustments",children:"5. Post-filters: Final Adjustments"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Post-filters"})," run after all main filters complete:"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Composites"})," - Combine symbols using boolean logic:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:"-- If both SPF and DKIM fail, it's very suspicious\nSUSPICIOUS_FORGERY = (R_SPF_FAIL | R_SPF_SOFTFAIL) & DKIM_REJECT\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Force actions"})," - Override score-based decisions:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:"-- Always reject if listed in specific RBL\nif symbol('RBL_SPAMCOP') then\n    action = 'reject'\nend\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Metadata export"})," - Send results to external systems (ClickHouse, Elasticsearch)."]}),"\n",(0,r.jsx)(n.h4,{id:"6-score-calculation-and-action-selection",children:"6. Score Calculation and Action Selection"}),"\n",(0,r.jsxs)(n.p,{children:["Rspamd sums all symbol scores to get a ",(0,r.jsx)(n.strong,{children:"total score"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"R_SPF_FAIL:              +1.0\nFORGED_SENDER_FORWARD:   +0.5\nBAYES_SPAM:              +3.5\nNEURAL_SPAM_LONG:        +2.0\nRBL_SPAMHAUS_PBL:        +2.5\n                        ------\nTOTAL:                   +9.5\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Based on configured ",(0,r.jsx)(n.strong,{children:"action thresholds"}),", an action is selected:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Score: 9.5\nThreshold: reject (15.0) - No\nThreshold: add header (6.0) - Yes\n\u2192 Action: add header\n"})}),"\n",(0,r.jsx)(n.h4,{id:"7-response-to-mta",children:"7. Response to MTA"}),"\n",(0,r.jsx)(n.p,{children:"Rspamd returns a JSON response:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n    "action": "add header",\n    "score": 9.5,\n    "required_score": 15.0,\n    "symbols": {\n        "R_SPF_FAIL": {"score": 1.0},\n        "BAYES_SPAM": {"score": 3.5},\n        "NEURAL_SPAM_LONG": {"score": 2.0}\n    },\n    "message-id": "msg-12345",\n    "milter": {\n        "add_headers": {\n            "X-Spam": {"value": "Yes", "order": 1}\n        }\n    }\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"The MTA uses this response to decide what to do with the message."}),"\n",(0,r.jsx)(n.h2,{id:"core-concepts-in-detail",children:"Core Concepts in Detail"}),"\n",(0,r.jsx)(n.h3,{id:"modules-functional-units",children:"Modules: Functional Units"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Modules"})," are independent units of functionality. Each module can:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Register one or more symbols"}),"\n",(0,r.jsx)(n.li,{children:"Perform synchronous or asynchronous checks"}),"\n",(0,r.jsx)(n.li,{children:"Access shared resources (Redis, DNS, HTTP APIs)"}),"\n",(0,r.jsx)(n.li,{children:"Be enabled/disabled independently"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Module types:"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"C modules"})," (compiled into binary):"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"spf"})," - SPF validation"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"dkim"})," - DKIM signature verification"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"regexp"})," - High-performance pattern matching"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"chartable"})," - Character set analysis"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"fuzzy_check"})," - Fuzzy hash checking"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Lua modules"})," (scripts in ",(0,r.jsx)(n.code,{children:"/usr/share/rspamd/"}),"):"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"rbl"})," - DNS blacklist queries"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"multimap"})," - Generic map-based checks"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"phishing"})," - Phishing detection"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"dmarc"})," - DMARC policy checking"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"arc"})," - ARC validation"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Configuration location:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Module defaults: ",(0,r.jsx)(n.code,{children:"/etc/rspamd/modules.d/module_name.conf"})]}),"\n",(0,r.jsxs)(n.li,{children:["Local overrides: ",(0,r.jsx)(n.code,{children:"/etc/rspamd/local.d/module_name.conf"})]}),"\n",(0,r.jsxs)(n.li,{children:["Complete replacement: ",(0,r.jsx)(n.code,{children:"/etc/rspamd/override.d/module_name.conf"})]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"symbols-test-results-with-scores",children:"Symbols: Test Results with Scores"}),"\n",(0,r.jsxs)(n.p,{children:["A ",(0,r.jsx)(n.strong,{children:"symbol"})," represents a specific detection or characteristic found in a message."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Symbol anatomy:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'Symbol name: BAYES_SPAM\nScore: 3.5\nOptions: ["0.95"] (probability)\nDescription: "Bayesian classifier: spam"\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Symbol naming conventions:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"R_"})," prefix: Result symbols from standard checks (e.g., ",(0,r.jsx)(n.code,{children:"R_SPF_ALLOW"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"UPPERCASE_UNDERSCORES"}),": Descriptive names (e.g., ",(0,r.jsx)(n.code,{children:"FORGED_SENDER"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:["Module-specific prefixes: ",(0,r.jsx)(n.code,{children:"BAYES_"}),", ",(0,r.jsx)(n.code,{children:"NEURAL_"}),", ",(0,r.jsx)(n.code,{children:"DKIM_"})]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Symbol properties:"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Property"}),(0,r.jsx)(n.th,{children:"Purpose"}),(0,r.jsx)(n.th,{children:"Example"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Name"})}),(0,r.jsx)(n.td,{children:"Unique identifier"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"R_DKIM_ALLOW"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Score"})}),(0,r.jsx)(n.td,{children:"Weight in score calculation"}),(0,r.jsx)(n.td,{children:"0.0 to 20.0 (typical range)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Group"})}),(0,r.jsx)(n.td,{children:"Organizational grouping"}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"dkim"}),", ",(0,r.jsx)(n.code,{children:"bayes"}),", ",(0,r.jsx)(n.code,{children:"policies"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Description"})}),(0,r.jsx)(n.td,{children:"Human-readable explanation"}),(0,r.jsx)(n.td,{children:'"DKIM signature valid"'})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Options"})}),(0,r.jsx)(n.td,{children:"Additional context"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:'["key=selector1"]'})})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"scores-weighting-system",children:"Scores: Weighting System"}),"\n",(0,r.jsxs)(n.p,{children:["Each symbol has a ",(0,r.jsx)(n.strong,{children:"configured score"})," that represents how much it contributes to the final spam probability."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Score principles:"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Positive scores"})," = Spam indicators:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"BAYES_SPAM: 3.50        # Strong spam signal\nR_SPF_FAIL: 1.00        # Moderate spam signal\nSUBJ_ALL_CAPS: 0.50     # Weak spam signal\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Negative scores"})," = Ham indicators:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"BAYES_HAM: -3.00        # Strong ham signal\nR_SPF_ALLOW: -0.20      # Weak ham signal\nDKIM_SIGNED: -0.10      # Weak ham signal\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Score tuning philosophy:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Start with defaults (years of community tuning)"}),"\n",(0,r.jsxs)(n.li,{children:["Adjust based on ",(0,r.jsx)(n.strong,{children:"observed false positives/negatives"})]}),"\n",(0,r.jsxs)(n.li,{children:["Consider ",(0,r.jsx)(n.strong,{children:"score caps per group"})," to prevent single modules from dominating"]}),"\n",(0,r.jsxs)(n.li,{children:["Use ",(0,r.jsx)(n.strong,{children:"composites"})," for complex scoring logic"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"actions-what-to-do-with-messages",children:"Actions: What to Do with Messages"}),"\n",(0,r.jsxs)(n.p,{children:["Based on the total score, Rspamd recommends an ",(0,r.jsx)(n.strong,{children:"action"}),":"]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Action"}),(0,r.jsx)(n.th,{children:"Default Threshold"}),(0,r.jsx)(n.th,{children:"Behavior"}),(0,r.jsx)(n.th,{children:"Use Case"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"no action"})}),(0,r.jsx)(n.td,{children:"Score < 0"}),(0,r.jsx)(n.td,{children:"Deliver normally"}),(0,r.jsx)(n.td,{children:"Clean messages"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"greylist"})}),(0,r.jsx)(n.td,{children:"0 \u2264 Score < 6"}),(0,r.jsx)(n.td,{children:"Temporary delay"}),(0,r.jsx)(n.td,{children:"Suspicious but uncertain"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"add header"})}),(0,r.jsx)(n.td,{children:"6 \u2264 Score < 15"}),(0,r.jsx)(n.td,{children:"Deliver with spam marking"}),(0,r.jsx)(n.td,{children:"Probable spam (folder filtering)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"rewrite subject"})}),(0,r.jsx)(n.td,{children:"N/A (optional)"}),(0,r.jsx)(n.td,{children:"Modify subject line"}),(0,r.jsx)(n.td,{children:"User-visible spam marking"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"soft reject"})}),(0,r.jsx)(n.td,{children:"N/A (special)"}),(0,r.jsx)(n.td,{children:"Temporary rejection"}),(0,r.jsx)(n.td,{children:"Rate limiting, policy violations"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"reject"})}),(0,r.jsx)(n.td,{children:"Score \u2265 15"}),(0,r.jsx)(n.td,{children:"Refuse message"}),(0,r.jsx)(n.td,{children:"Definite spam"})]})]})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Important notes:"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Recommendations, not commands"}),": Rspamd suggests actions; the MTA decides whether to follow them."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Thresholds are configurable"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-nginx",children:"actions {\n    reject = 15.0;\n    add_header = 6.0;\n    greylist = 4.0;\n}\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Custom actions possible"}),": Via force_actions module or Lua scripts."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Per-user/domain thresholds"}),": Using settings module."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"groups-symbol-organization",children:"Groups: Symbol Organization"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Groups"})," organize related symbols for management and score capping:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-nginx",children:'group "spf" {\n    symbols {\n        "R_SPF_ALLOW" { score = -0.20; }\n        "R_SPF_FAIL" { score = 1.00; }\n        "R_SPF_SOFTFAIL" { score = 0.50; }\n        "R_SPF_NEUTRAL" { score = 0.00; }\n    }\n    max_score = 3.0;  # Cap total contribution from SPF group\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Benefits of groups:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Score limiting"}),": Prevent single authentication method from dominating"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Bulk operations"}),": Enable/disable entire families of checks"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Organization"}),": Logical grouping in WebUI and reports"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"workers-process-types",children:"Workers: Process Types"}),"\n",(0,r.jsxs)(n.p,{children:["Rspamd runs multiple ",(0,r.jsx)(n.strong,{children:"worker"})," processes, each with a specific role:"]}),"\n",(0,r.jsx)(n.h4,{id:"normal-worker",children:"Normal Worker"}),"\n",(0,r.jsx)(n.p,{children:"The main message processing worker:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Accepts HTTP connections on port 11333 (default)"}),"\n",(0,r.jsx)(n.li,{children:"Performs spam/ham classification"}),"\n",(0,r.jsx)(n.li,{children:"Executes all configured modules"}),"\n",(0,r.jsx)(n.li,{children:"Returns results to MTA"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Configuration:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-nginx",children:'worker "normal" {\n    bind_socket = "localhost:11333";\n    count = 4;  # Number of worker processes\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Scaling"}),": Typically 1-4 workers per CPU core."]}),"\n",(0,r.jsx)(n.h4,{id:"controller-worker",children:"Controller Worker"}),"\n",(0,r.jsx)(n.p,{children:"Web interface and management API:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Serves WebUI on port 11334 (default)"}),"\n",(0,r.jsx)(n.li,{children:"Provides REST endpoints for learning, stats, maps"}),"\n",(0,r.jsx)(n.li,{children:"Requires authentication (password or enable_password)"}),"\n",(0,r.jsx)(n.li,{children:"Should be protected (localhost/firewall)"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Configuration:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-nginx",children:'worker "controller" {\n    bind_socket = "localhost:11334";\n    password = "your_password";\n}\n'})}),"\n",(0,r.jsx)(n.h4,{id:"proxy-worker",children:"Proxy Worker"}),"\n",(0,r.jsx)(n.p,{children:"Milter protocol bridge and load balancer:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Accepts Milter connections from MTAs (Postfix, Sendmail)"}),"\n",(0,r.jsx)(n.li,{children:"Translates Milter \u2194 HTTP protocol"}),"\n",(0,r.jsx)(n.li,{children:"Can forward to multiple Rspamd instances"}),"\n",(0,r.jsxs)(n.li,{children:["Supports ",(0,r.jsx)(n.a,{href:"/developers/encryption",children:"HTTPCrypt encryption"})]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Configuration:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-nginx",children:'worker "rspamd_proxy" {\n    bind_socket = "localhost:11332";\n    upstream "local" {\n        default = yes;\n        hosts = "localhost:11333";\n    }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Use case"}),": Postfix integration via ",(0,r.jsx)(n.code,{children:"smtpd_milters = inet:localhost:11332"})]}),"\n",(0,r.jsx)(n.h4,{id:"fuzzy-storage-worker",children:"Fuzzy Storage Worker"}),"\n",(0,r.jsx)(n.p,{children:"Manages fuzzy hash database:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Stores fuzzy hashes for near-duplicate detection"}),"\n",(0,r.jsx)(n.li,{children:"Handles add/check/delete operations"}),"\n",(0,r.jsx)(n.li,{children:"Supports replication and sharding"}),"\n",(0,r.jsx)(n.li,{children:"Uses custom protocol over UDP/TCP"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Use case"}),": Shared spam reputation across multiple servers."]}),"\n",(0,r.jsx)(n.h2,{id:"configuration-overview",children:"Configuration Overview"}),"\n",(0,r.jsx)(n.h3,{id:"the-configuration-hierarchy",children:"The Configuration Hierarchy"}),"\n",(0,r.jsxs)(n.p,{children:["Rspamd uses a ",(0,r.jsx)(n.strong,{children:"layered configuration system"})," with clear precedence:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"/etc/rspamd/rspamd.conf          (main config, rarely edited)\n  \u251c\u2500\u2500 /etc/rspamd/modules.d/     (module defaults)\n  \u2502   \u251c\u2500\u2500 local.d/               (merge with defaults) \u2190 Your changes here\n  \u2502   \u2514\u2500\u2500 override.d/            (replace defaults)    \u2190 Advanced only\n  \u2514\u2500\u2500 /etc/rspamd/local.d/       (global overrides)\n      \u2514\u2500\u2500 actions.conf           (action thresholds)\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Best practice"}),": Use ",(0,r.jsx)(n.code,{children:"local.d/"})," for all customizations. This merges your settings with defaults, surviving updates."]}),"\n",(0,r.jsx)(n.h3,{id:"what-you-can-configure",children:"What You Can Configure"}),"\n",(0,r.jsx)(n.h4,{id:"1-action-thresholds-most-common",children:"1. Action Thresholds (Most Common)"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"File"}),": ",(0,r.jsx)(n.code,{children:"/etc/rspamd/local.d/actions.conf"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-nginx",children:"actions {\n    reject = 15.0;          # Refuse message\n    add_header = 6.0;       # Mark as spam\n    greylist = 4.0;         # Temporary delay\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"When to adjust:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Too much spam getting through: Lower thresholds"}),"\n",(0,r.jsx)(n.li,{children:"Too many false positives: Raise thresholds"}),"\n",(0,r.jsx)(n.li,{children:"Different policies per domain: Use settings module"}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"2-symbol-scores-fine-tuning",children:"2. Symbol Scores (Fine-Tuning)"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"File"}),": ",(0,r.jsx)(n.code,{children:"/etc/rspamd/local.d/groups.conf"})," or module-specific configs"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-nginx",children:'group "content" {\n    symbols {\n        "FORGED_SENDER" {\n            score = 0.5;      # Default: 0.3\n        }\n    }\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"When to adjust:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Specific symbol causing many false positives"}),"\n",(0,r.jsx)(n.li,{children:"Local testing shows different effectiveness"}),"\n",(0,r.jsx)(n.li,{children:"Custom symbols need appropriate weights"}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"3-module-settings-feature-control",children:"3. Module Settings (Feature Control)"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Example"}),": ",(0,r.jsx)(n.code,{children:"/etc/rspamd/local.d/bayes.conf"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-nginx",children:'autolearn = true;         # Learn automatically\nautolearn {\n    spam_threshold = 12.0;  # Score needed to learn as spam\n    ham_threshold = -5.0;   # Score needed to learn as ham\n}\n\nbackend = "redis";\nservers = "localhost:6379";\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"When to configure:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Enable/disable specific features"}),"\n",(0,r.jsx)(n.li,{children:"Tune module behavior for your environment"}),"\n",(0,r.jsx)(n.li,{children:"Connect to external services (Redis, databases)"}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"4-worker-configuration-integration",children:"4. Worker Configuration (Integration)"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Example"}),": ",(0,r.jsx)(n.code,{children:"/etc/rspamd/local.d/worker-proxy.inc"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-nginx",children:'# Enable proxy worker for Postfix milter\nbind_socket = "localhost:11332";\nmilter = yes;\n\nupstream "local" {\n    default = yes;\n    self_scan = yes;\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"When to configure:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"MTA integration setup"}),"\n",(0,r.jsx)(n.li,{children:"Performance optimization"}),"\n",(0,r.jsx)(n.li,{children:"Multi-instance deployments"}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"5-system-options-advanced",children:"5. System Options (Advanced)"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"File"}),": ",(0,r.jsx)(n.code,{children:"/etc/rspamd/local.d/options.inc"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-nginx",children:"dns {\n    timeout = 2s;\n    retransmits = 3;\n}\n\n# Limit message size\nmax_message = 10485760;  # 10MB\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"When to configure:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Network environment requires tuning"}),"\n",(0,r.jsx)(n.li,{children:"Resource limits needed"}),"\n",(0,r.jsx)(n.li,{children:"Debugging and troubleshooting"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"configuration-strategies",children:"Configuration Strategies"}),"\n",(0,r.jsx)(n.h3,{id:"strategy-1-minimal-quick-start",children:"Strategy 1: Minimal (Quick Start)"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Goal"}),": Get working spam filtering ASAP"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Changes:"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Adjust action thresholds only"}),"\n",(0,r.jsx)(n.li,{children:"Configure MTA integration"}),"\n",(0,r.jsx)(n.li,{children:"Use all default modules and scores"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Best for"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Testing and evaluation"}),"\n",(0,r.jsx)(n.li,{children:"Small deployments (<1000 users)"}),"\n",(0,r.jsx)(n.li,{children:"Low customization needs"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Pros"}),": Fast setup, easy to maintain\n",(0,r.jsx)(n.strong,{children:"Cons"}),": May not be optimal for your traffic"]}),"\n",(0,r.jsx)(n.h3,{id:"strategy-2-tuned-production",children:"Strategy 2: Tuned (Production)"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Goal"}),": Optimize for your specific environment"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Changes:"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Baseline with defaults for 1-2 weeks"}),"\n",(0,r.jsx)(n.li,{children:"Analyze false positives via WebUI"}),"\n",(0,r.jsx)(n.li,{children:"Adjust specific symbol scores"}),"\n",(0,r.jsx)(n.li,{children:"Fine-tune module settings"}),"\n",(0,r.jsx)(n.li,{children:"Set appropriate action thresholds"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Best for"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Production deployments"}),"\n",(0,r.jsx)(n.li,{children:"Specific industry requirements (finance, healthcare)"}),"\n",(0,r.jsx)(n.li,{children:"Environments with known patterns"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Pros"}),": Optimized false positive/negative balance\n",(0,r.jsx)(n.strong,{children:"Cons"}),": Requires monitoring and iteration"]}),"\n",(0,r.jsx)(n.h3,{id:"strategy-3-custom-enterprise",children:"Strategy 3: Custom (Enterprise)"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Goal"}),": Maximum control and integration"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Changes:"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:'All from "Tuned" strategy'}),"\n",(0,r.jsx)(n.li,{children:"Custom rules via multimap/regexp modules"}),"\n",(0,r.jsx)(n.li,{children:"External data integration (LDAP, databases)"}),"\n",(0,r.jsx)(n.li,{children:"Per-user/domain settings"}),"\n",(0,r.jsx)(n.li,{children:"Custom Lua modules"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Best for"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Large deployments (10,000+ users)"}),"\n",(0,r.jsx)(n.li,{children:"Complex requirements"}),"\n",(0,r.jsx)(n.li,{children:"Multi-tenant environments"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Pros"}),": Maximum flexibility\n",(0,r.jsx)(n.strong,{children:"Cons"}),": Requires Rspamd expertise"]}),"\n",(0,r.jsx)(n.h2,{id:"common-configuration-patterns",children:"Common Configuration Patterns"}),"\n",(0,r.jsx)(n.h3,{id:"pattern-reducing-false-positives",children:"Pattern: Reducing False Positives"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Problem"}),": Legitimate emails marked as spam"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Solution:"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Identify problematic symbol"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Check WebUI history or logs\n# Look for common symbols in false positives\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Reduce symbol score"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-nginx",children:'# /etc/rspamd/local.d/groups.conf\nsymbol "SUSPICIOUS_SYMBOL" {\n    score = 0.1;  # Was 2.0\n}\n'})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Or whitelist trusted senders"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-nginx",children:'# /etc/rspamd/local.d/multimap.conf\nWHITELIST_IP {\n    type = "ip";\n    map = "/etc/rspamd/whitelist_ip.map";\n    score = -10.0;\n    prefilter = true;\n}\n'})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"pattern-stricter-spam-filtering",children:"Pattern: Stricter Spam Filtering"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Problem"}),": Too much spam getting through"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Solution:"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Lower action threshold"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-nginx",children:"actions {\n    reject = 10.0;  # Was 15.0\n}\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Increase critical symbol scores"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-nginx",children:'symbol "BAYES_SPAM" {\n    score = 5.0;  # Was 3.5\n}\n'})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Enable additional checks"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-nginx",children:'# /etc/rspamd/local.d/rbl.conf\nrbls {\n    spamhaus {\n        rbl = "zen.spamhaus.org";\n        enabled = true;\n    }\n}\n'})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"pattern-per-domain-settings",children:"Pattern: Per-Domain Settings"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Problem"}),": Different spam tolerance per domain"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Solution:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-nginx",children:'# /etc/rspamd/local.d/settings.conf\nsettings {\n    domain_strict {\n        rcpt = "@strict-domain.com";\n        apply {\n            actions {\n                reject = 8.0;  # Stricter than default\n                add_header = 4.0;\n            }\n        }\n    }\n\n    domain_relaxed {\n        rcpt = "@relaxed-domain.com";\n        apply {\n            actions {\n                reject = 20.0;  # More lenient\n                add_header = 10.0;\n            }\n        }\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"understanding-rspamd-behavior",children:"Understanding Rspamd Behavior"}),"\n",(0,r.jsx)(n.h3,{id:"why-scores-not-rules",children:"Why Scores, Not Rules?"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Traditional approach"})," (SpamAssassin-style):"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Each rule has fixed score"}),"\n",(0,r.jsx)(n.li,{children:"Score directly added to total"}),"\n",(0,r.jsx)(n.li,{children:"Binary logic: match or no match"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Rspamd approach"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Symbols can have ",(0,r.jsx)(n.strong,{children:"dynamic scores"})," (Bayes: 0-5, Neural: 0-10)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Composites"})," combine multiple conditions"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Groups"})," can cap total contribution"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Settings"})," can override scores per user/domain"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Advantage"}),": More nuanced decisions, fewer false positives."]}),"\n",(0,r.jsx)(n.h3,{id:"why-multiple-small-checks-beat-few-large-rules",children:"Why Multiple Small Checks Beat Few Large Rules?"}),"\n",(0,r.jsxs)(n.p,{children:["Rspamd philosophy: ",(0,r.jsx)(n.strong,{children:"Many weak learners > Few strong rules"})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example scenario:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Traditional: \"Contains 'viagra' \u2192 +10 points\" (brittle)\n\nRspamd approach:\n- SUBJ_HAS_DRUG_NAME: +0.5\n- BODY_HAS_DRUG_REF: +1.0\n- HTML_OBFUSCATION: +1.5\n- NO_DKIM: +0.3\n- SPF_SOFTFAIL: +0.5\n- BAYES_SPAM: +3.5\nTotal: +7.3 \u2192 add header\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Benefits:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Resistant to evasion techniques"}),"\n",(0,r.jsx)(n.li,{children:"Graceful degradation (one check fails, others still work)"}),"\n",(0,r.jsx)(n.li,{children:"Easier to tune individual components"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"why-statistical-methods-matter",children:"Why Statistical Methods Matter"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Bayesian classifier"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Learns from your specific email patterns"}),"\n",(0,r.jsx)(n.li,{children:"Adapts to evolving spam techniques"}),"\n",(0,r.jsx)(n.li,{children:"Provides probability-based scores"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Neural networks"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Learn from symbol patterns (not content)"}),"\n",(0,r.jsx)(n.li,{children:"Adapt to your unique rule configuration"}),"\n",(0,r.jsx)(n.li,{children:"Provide complementary signal to Bayes"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Together"}),": Strong spam detection without manual rule updates."]}),"\n",(0,r.jsx)(n.h2,{id:"testing-and-validation",children:"Testing and Validation"}),"\n",(0,r.jsx)(n.h3,{id:"before-going-live",children:"Before Going Live"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Test mode"}),": Use ",(0,r.jsx)(n.code,{children:"greylist"})," action for new installs to observe without blocking"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-nginx",children:"actions {\n    reject = 99999.0;  # Effectively disable\n    add_header = 99999.0;\n    greylist = 4.0;     # Only greylist\n}\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Monitor for 1-2 weeks"}),": Check WebUI history for patterns"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Gradually lower thresholds"}),": Based on observed scores"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"validation-commands",children:"Validation Commands"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Test a message file\nrspamc < test_message.eml\n\n# Check configuration\nrspamadm configtest\n\n# Verify module status\nrspamc stat\n\n# Test specific symbol\nrspamadm grep -s SYMBOL_NAME /var/log/rspamd/rspamd.log\n"})}),"\n",(0,r.jsx)(n.h2,{id:"performance-expectations",children:"Performance Expectations"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Typical performance"})," (modern server, default config):"]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Metric"}),(0,r.jsx)(n.th,{children:"Value"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Messages/second"})}),(0,r.jsx)(n.td,{children:"100-500 per worker"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Latency"})}),(0,r.jsx)(n.td,{children:"50-200ms per message"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Memory"})}),(0,r.jsx)(n.td,{children:"256-512MB per worker"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"CPU"})}),(0,r.jsx)(n.td,{children:"1-2 cores (4 workers)"})]})]})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Scaling factors:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Message size"}),": Larger messages take longer"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Enabled modules"}),": More checks = more time"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"External lookups"}),": DNS/Redis latency matters"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Statistical modules"}),": Bayes/Neural add CPU load"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,r.jsx)(n.p,{children:"Now that you understand Rspamd's architecture and capabilities:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.a,{href:"/getting-started/installation",children:"Installation Guide"})})," - Choose your installation method"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.a,{href:"/getting-started/first-setup",children:"First Setup"})})," - Get your first working configuration"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.a,{href:"/guides/configuration/fundamentals",children:"Configuration Fundamentals"})})," - Learn UCL syntax and structure"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.a,{href:"/developers/architecture",children:"Architecture Details"})})," - Deep dive for advanced users"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"key-takeaways",children:"Key Takeaways"}),"\n",(0,r.jsxs)(n.p,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Rspamd is event-driven"}),": Handles high volume efficiently\n\u2705 ",(0,r.jsx)(n.strong,{children:"Modular design"}),": Enable/disable features independently\n\u2705 ",(0,r.jsx)(n.strong,{children:"Score-based decisions"}),": Nuanced handling vs. binary rules\n\u2705 ",(0,r.jsx)(n.strong,{children:"Statistical methods"}),": Adapt to your email patterns\n\u2705 ",(0,r.jsx)(n.strong,{children:"Configuration layers"}),": local.d/ for all customizations\n\u2705 ",(0,r.jsx)(n.strong,{children:"Start simple"}),": Adjust thresholds first, tune scores later\n\u2705 ",(0,r.jsx)(n.strong,{children:"Monitor before blocking"}),": Use greylist to test safely"]}),"\n",(0,r.jsx)(n.p,{children:"Understanding these fundamentals will help you configure Rspamd effectively and troubleshoot issues confidently."})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}}}]);