"use strict";(self.webpackChunkrspamd_docs=self.webpackChunkrspamd_docs||[]).push([[6447],{28453:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>l});var d=s(96540);const c={},r=d.createContext(c);function i(e){const n=d.useContext(r);return d.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:i(e.components),d.createElement(r.Provider,{value:n},e.children)}},32294:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>t,contentTitle:()=>l,default:()=>x,frontMatter:()=>i,metadata:()=>d,toc:()=>o});const d=JSON.parse('{"id":"modules/dcc","title":"DCC module","description":"This module performs DCC (Distributed Checksum Clearinghouses) lookups to determine the bulkiness of a message based on how many recipients have seen similar content.","source":"@site/docs/modules/dcc.md","sourceDirName":"modules","slug":"/modules/dcc","permalink":"/docs.rspamd.com/branches/master/modules/dcc","draft":false,"unlisted":false,"editUrl":"https://github.com/rspamd/docs.rspamd.com/edit/master/docs/modules/dcc.md","tags":[],"version":"current","frontMatter":{"title":"DCC module"},"sidebar":"docs","previous":{"title":"Clickhouse module","permalink":"/docs.rspamd.com/branches/master/modules/clickhouse"},"next":{"title":"DKIM module","permalink":"/docs.rspamd.com/branches/master/modules/dkim"}}');var c=s(74848),r=s(28453);const i={title:"DCC module"},l="DCC module",t={},o=[{value:"Symbols",id:"symbols",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Example configuration",id:"example-configuration",level:2},{value:"Unix socket (local dccifd)",id:"unix-socket-local-dccifd",level:3},{value:"TCP connection (remote or local)",id:"tcp-connection-remote-or-local",level:3},{value:"Custom thresholds",id:"custom-thresholds",level:3},{value:"TCP configuration for dccifd",id:"tcp-configuration-for-dccifd",level:2},{value:"How scoring works",id:"how-scoring-works",level:2},{value:"Using in composites",id:"using-in-composites",level:2}];function h(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.header,{children:(0,c.jsx)(n.h1,{id:"dcc-module",children:"DCC module"})}),"\n",(0,c.jsxs)(n.p,{children:["This module performs ",(0,c.jsx)(n.a,{href:"https://www.dcc-servers.net/dcc/",children:"DCC"})," (Distributed Checksum Clearinghouses) lookups to determine the ",(0,c.jsx)(n.em,{children:"bulkiness"})," of a message based on how many recipients have seen similar content."]}),"\n",(0,c.jsx)(n.p,{children:"DCC uses fuzzy checksums to identify bulk mail. The bulkiness information is useful in composite rules. For example, if a message is from a freemail domain and is reported as bulk by DCC, it is likely spam and can be assigned a higher score."}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.strong,{children:"Important:"})," Before enabling this module, please review the ",(0,c.jsx)(n.a,{href:"https://www.dcc-servers.net/dcc/",children:"DCC License terms"}),"."]}),"\n",(0,c.jsx)(n.h2,{id:"symbols",children:"Symbols"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,c.jsxs)(n.table,{children:[(0,c.jsx)(n.thead,{children:(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.th,{children:"Symbol"}),(0,c.jsx)(n.th,{children:"Score"}),(0,c.jsx)(n.th,{children:"Description"})]})}),(0,c.jsxs)(n.tbody,{children:[(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"DCC_REJECT"})}),(0,c.jsx)(n.td,{children:"(varies)"}),(0,c.jsx)(n.td,{children:"DCC returned reject result"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"DCC_BULK"})}),(0,c.jsx)(n.td,{children:"(varies)"}),(0,c.jsx)(n.td,{children:"Message identified as bulk based on thresholds"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"DCC_FAIL"})}),(0,c.jsx)(n.td,{children:"0.0"}),(0,c.jsx)(n.td,{children:"DCC check failed"})]})]})]}),"\n",(0,c.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,c.jsxs)(n.p,{children:["You must have the ",(0,c.jsx)(n.code,{children:"dccifd"})," daemon installed and running:"]}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:["Download and build the ",(0,c.jsx)(n.a,{href:"https://www.dcc-servers.net/dcc/source/dcc.tar.Z",children:"DCC client"})]}),"\n",(0,c.jsxs)(n.li,{children:["Configure ",(0,c.jsx)(n.code,{children:"/var/dcc/dcc_conf"}),":\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"DCCIFD_ENABLE=on\nDCCM_LOG_AT=NEVER\nDCCM_REJECT_AT=MANY\n"})}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["Start the daemon: ",(0,c.jsx)(n.code,{children:"/var/dcc/libexec/rcDCC start"})]}),"\n"]}),"\n",(0,c.jsxs)(n.p,{children:["By default, ",(0,c.jsx)(n.code,{children:"dccifd"})," listens on Unix socket ",(0,c.jsx)(n.code,{children:"/var/dcc/dccifd"}),"."]}),"\n",(0,c.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,c.jsxs)(n.p,{children:["Settings go in ",(0,c.jsx)(n.code,{children:"/etc/rspamd/local.d/dcc.conf"}),"."]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,c.jsxs)(n.table,{children:[(0,c.jsx)(n.thead,{children:(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.th,{children:"Option"}),(0,c.jsx)(n.th,{children:"Type"}),(0,c.jsx)(n.th,{children:"Default"}),(0,c.jsx)(n.th,{children:"Description"})]})}),(0,c.jsxs)(n.tbody,{children:[(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"enabled"})}),(0,c.jsx)(n.td,{children:"boolean"}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"false"})}),(0,c.jsx)(n.td,{children:"Enable the DCC module"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"servers"})}),(0,c.jsx)(n.td,{children:"string"}),(0,c.jsx)(n.td,{children:"(required)"}),(0,c.jsxs)(n.td,{children:["Socket path or TCP servers (e.g., ",(0,c.jsx)(n.code,{children:"/var/dcc/dccifd"})," or ",(0,c.jsx)(n.code,{children:"127.0.0.1:10045"}),")"]})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"socket"})}),(0,c.jsx)(n.td,{children:"string"}),(0,c.jsx)(n.td,{children:"-"}),(0,c.jsxs)(n.td,{children:["Alias for ",(0,c.jsx)(n.code,{children:"servers"})]})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"timeout"})}),(0,c.jsx)(n.td,{children:"number"}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"5.0"})}),(0,c.jsx)(n.td,{children:"Connection timeout in seconds"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"retransmits"})}),(0,c.jsx)(n.td,{children:"number"}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"2"})}),(0,c.jsx)(n.td,{children:"Number of retry attempts"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"default_port"})}),(0,c.jsx)(n.td,{children:"number"}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"10045"})}),(0,c.jsx)(n.td,{children:"Default TCP port"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"body_max"})}),(0,c.jsx)(n.td,{children:"number"}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"999999"})}),(0,c.jsx)(n.td,{children:"Bulkiness threshold for body checksum"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"fuz1_max"})}),(0,c.jsx)(n.td,{children:"number"}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"999999"})}),(0,c.jsx)(n.td,{children:"Bulkiness threshold for fuz1 checksum"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"fuz2_max"})}),(0,c.jsx)(n.td,{children:"number"}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"999999"})}),(0,c.jsx)(n.td,{children:"Bulkiness threshold for fuz2 checksum"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"default_score"})}),(0,c.jsx)(n.td,{children:"number"}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"1"})}),(0,c.jsx)(n.td,{children:"Base score for bulk detection"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"symbol"})}),(0,c.jsx)(n.td,{children:"string"}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"DCC_REJECT"})}),(0,c.jsx)(n.td,{children:"Symbol for reject result"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"symbol_bulk"})}),(0,c.jsx)(n.td,{children:"string"}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"DCC_BULK"})}),(0,c.jsx)(n.td,{children:"Symbol for bulk detection"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"symbol_fail"})}),(0,c.jsx)(n.td,{children:"string"}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"DCC_FAIL"})}),(0,c.jsx)(n.td,{children:"Symbol for check failure"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"log_clean"})}),(0,c.jsx)(n.td,{children:"boolean"}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"false"})}),(0,c.jsx)(n.td,{children:"Log clean (non-bulk) results"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"client"})}),(0,c.jsx)(n.td,{children:"string"}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"0.0.0.0"})}),(0,c.jsx)(n.td,{children:"Default client IP if not available"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"cache_expire"})}),(0,c.jsx)(n.td,{children:"number"}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"7200"})}),(0,c.jsx)(n.td,{children:"Redis cache expiration (seconds)"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"prefix"})}),(0,c.jsx)(n.td,{children:"string"}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"rs_dcc_"})}),(0,c.jsx)(n.td,{children:"Redis cache key prefix"})]})]})]}),"\n",(0,c.jsx)(n.h2,{id:"example-configuration",children:"Example configuration"}),"\n",(0,c.jsx)(n.h3,{id:"unix-socket-local-dccifd",children:"Unix socket (local dccifd)"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-hcl",children:'# local.d/dcc.conf\n\nenabled = true;\nservers = "/var/dcc/dccifd";\n\n# Thresholds for bulk detection\nbody_max = 999999;\nfuz1_max = 999999;\nfuz2_max = 999999;\n'})}),"\n",(0,c.jsx)(n.h3,{id:"tcp-connection-remote-or-local",children:"TCP connection (remote or local)"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-hcl",children:'# local.d/dcc.conf\n\nenabled = true;\nservers = "127.0.0.1:10045";\ntimeout = 5.0;\nretransmits = 2;\n'})}),"\n",(0,c.jsx)(n.h3,{id:"custom-thresholds",children:"Custom thresholds"}),"\n",(0,c.jsx)(n.p,{children:"Lower thresholds trigger bulk detection more easily:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-hcl",children:'# local.d/dcc.conf\n\nenabled = true;\nservers = "/var/dcc/dccifd";\n\n# Trigger bulk detection at lower counts\nbody_max = 100;\nfuz1_max = 100;\nfuz2_max = 100;\n\n# Custom score\ndefault_score = 2.0;\n'})}),"\n",(0,c.jsx)(n.h2,{id:"tcp-configuration-for-dccifd",children:"TCP configuration for dccifd"}),"\n",(0,c.jsxs)(n.p,{children:["To configure ",(0,c.jsx)(n.code,{children:"dccifd"})," to listen on TCP instead of Unix socket, edit ",(0,c.jsx)(n.code,{children:"/var/dcc/dcc_conf"}),":"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:'DCCIFD_ARGS="-SHELO -Smail_host -SSender -SList-ID -p *,10045,127.0.0.0/8"\n'})}),"\n",(0,c.jsx)(n.p,{children:"This configures dccifd to:"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"Listen on all interfaces, port 10045"}),"\n",(0,c.jsx)(n.li,{children:"Accept connections from 127.0.0.0/8"}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"how-scoring-works",children:"How scoring works"}),"\n",(0,c.jsx)(n.p,{children:"The module calculates a dynamic score based on:"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Reputation (rep)"}),": A percentage indicating message reputation (0-100%)"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Checksum counts"}),": body, fuz1, and fuz2 values"]}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"The score formula uses the reputation to adjust the base score:"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["Score contribution = ",(0,c.jsx)(n.code,{children:"default_score * (rep/100) / 3"})," for each threshold exceeded"]}),"\n"]}),"\n",(0,c.jsxs)(n.p,{children:["The ",(0,c.jsx)(n.code,{children:"DCC_BULK"})," symbol options show which thresholds were exceeded and the reputation value."]}),"\n",(0,c.jsx)(n.h2,{id:"using-in-composites",children:"Using in composites"}),"\n",(0,c.jsx)(n.p,{children:"Example composite rule combining DCC with other checks:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-hcl",children:'# local.d/composites.conf\n\nDCC_FREEMAIL_BULK {\n  expression = "DCC_BULK & FREEMAIL_FROM";\n  score = 5.0;\n  description = "Bulk message from freemail";\n}\n'})})]})}function x(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(h,{...e})}):h(e)}}}]);