"use strict";(self.webpackChunkrspamd_docs=self.webpackChunkrspamd_docs||[]).push([[1695],{1373(e,s,n){n.r(s),n.d(s,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>d,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"tutorials/migrate_sa","title":"Migrating from SpamAssassin","description":"This guide walks you through replacing SpamAssassin (SA) with Rspamd. It covers the key architectural differences, a step-by-step migration path, and practical advice for a safe rollout.","source":"@site/docs/tutorials/migrate_sa.md","sourceDirName":"tutorials","slug":"/tutorials/migrate_sa","permalink":"/docs.rspamd.com/branches/master/tutorials/migrate_sa","draft":false,"unlisted":false,"editUrl":"https://github.com/rspamd/docs.rspamd.com/edit/master/docs/tutorials/migrate_sa.md","tags":[],"version":"current","frontMatter":{"title":"Migrating from SpamAssassin"},"sidebar":"docs","previous":{"title":"Upgrading","permalink":"/docs.rspamd.com/branches/master/tutorials/migration"},"next":{"title":"Scanning outbound mail","permalink":"/docs.rspamd.com/branches/master/tutorials/scanning_outbound"}}');var i=n(4848),t=n(8453);const d={title:"Migrating from SpamAssassin"},a="Migrating from SpamAssassin to Rspamd",l={},c=[{value:"Overview",id:"overview",level:2},{value:"Migration checklist",id:"migration-checklist",level:2},{value:"MTA integration",id:"mta-integration",level:2},{value:"Redis",id:"redis",level:2},{value:"Actions and thresholds",id:"actions-and-thresholds",level:2},{value:"Mapping SA features to Rspamd",id:"mapping-sa-features-to-rspamd",level:2},{value:"Migrating SpamAssassin rules",id:"migrating-spamassassin-rules",level:2},{value:"Statistics and training",id:"statistics-and-training",level:2},{value:"Initial training",id:"initial-training",level:3},{value:"Autolearn",id:"autolearn",level:3},{value:"User feedback via IMAP",id:"user-feedback-via-imap",level:3},{value:"Statistics expiry",id:"statistics-expiry",level:3},{value:"Rollout strategy",id:"rollout-strategy",level:2},{value:"1. Shadow mode",id:"1-shadow-mode",level:3},{value:"2. Tune thresholds",id:"2-tune-thresholds",level:3},{value:"3. Cut over",id:"3-cut-over",level:3},{value:"4. Monitor",id:"4-monitor",level:3},{value:"Common pitfalls",id:"common-pitfalls",level:2},{value:"See also",id:"see-also",level:2}];function o(e){const s={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"migrating-from-spamassassin-to-rspamd",children:"Migrating from SpamAssassin to Rspamd"})}),"\n",(0,i.jsx)(s.p,{children:"This guide walks you through replacing SpamAssassin (SA) with Rspamd. It covers the key architectural differences, a step-by-step migration path, and practical advice for a safe rollout."}),"\n",(0,i.jsx)(s.h2,{id:"overview",children:"Overview"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{}),(0,i.jsx)(s.th,{children:"SpamAssassin"}),(0,i.jsx)(s.th,{children:"Rspamd"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Language"}),(0,i.jsx)(s.td,{children:"Perl"}),(0,i.jsx)(s.td,{children:"C core + Lua plugins"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"I/O model"}),(0,i.jsx)(s.td,{children:"Synchronous, per-message fork/thread"}),(0,i.jsx)(s.td,{children:"Asynchronous event loop, multi-worker"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Configuration"}),(0,i.jsxs)(s.td,{children:["Perl-style ",(0,i.jsx)(s.code,{children:".cf"})," files"]}),(0,i.jsx)(s.td,{children:"UCL (HCL-like) + Lua"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Statistics backend"}),(0,i.jsx)(s.td,{children:"Berkeley DB / SQL / Redis"}),(0,i.jsx)(s.td,{children:"Redis (recommended)"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Verdict model"}),(0,i.jsx)(s.td,{children:"Numeric score; MTA decides"}),(0,i.jsxs)(s.td,{children:["Score + ",(0,i.jsx)(s.strong,{children:"action"})," (",(0,i.jsx)(s.code,{children:"no action"}),", ",(0,i.jsx)(s.code,{children:"greylist"}),", ",(0,i.jsx)(s.code,{children:"add header"}),", ",(0,i.jsx)(s.code,{children:"rewrite subject"}),", ",(0,i.jsx)(s.code,{children:"reject"}),") returned to MTA"]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Web UI"}),(0,i.jsx)(s.td,{children:"None (third-party tools)"}),(0,i.jsx)(s.td,{children:"Built-in controller worker"})]})]})]}),"\n",(0,i.jsx)(s.p,{children:"Rspamd ships with native equivalents for most SA functionality -- DKIM, DMARC, SPF, Bayes, fuzzy hashes, URL blocklists, and more -- enabled by default. In most cases you do not need to port SA rules; Rspamd's built-in modules provide equal or better detection quality with significantly lower resource usage."}),"\n",(0,i.jsx)(s.h2,{id:"migration-checklist",children:"Migration checklist"}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.a,{href:"/downloads",children:"Install Rspamd"})," from official packages."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.a,{href:"#mta-integration",children:"Integrate with your MTA"}),"."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.a,{href:"#redis",children:"Set up Redis"})," for statistics and other modules."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.a,{href:"#actions-and-thresholds",children:"Review action thresholds"})," to match your policy."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.a,{href:"#migrating-spamassassin-rules",children:"Migrate custom SA rules"})," if needed (most users can skip this)."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.a,{href:"#statistics-and-training",children:"Train Bayes statistics"})," from your mail corpora."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.a,{href:"#rollout-strategy",children:"Run in shadow mode"})," alongside SA, then cut over."]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"mta-integration",children:"MTA integration"}),"\n",(0,i.jsxs)(s.p,{children:["See the full ",(0,i.jsx)(s.a,{href:"/tutorials/integration",children:"MTA integration guide"}),". The recommended patterns are:"]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"MTA"}),(0,i.jsx)(s.th,{children:"Method"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Postfix / Sendmail"}),(0,i.jsxs)(s.td,{children:["Milter protocol via Rspamd ",(0,i.jsx)(s.a,{href:"/workers/rspamd_proxy",children:"proxy worker"})," (default on port 11332)"]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Exim"}),(0,i.jsxs)(s.td,{children:["HTTP integration via ",(0,i.jsx)(s.code,{children:"spamd_address"})," with ",(0,i.jsx)(s.code,{children:"variant=rspamd"})]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Any HTTP-capable MTA"}),(0,i.jsxs)(s.td,{children:["POST to ",(0,i.jsx)(s.code,{children:"/checkv2"})," on the ",(0,i.jsx)(s.a,{href:"/workers/normal",children:"normal worker"})," (default on port 11333)"]})]})]})]}),"\n",(0,i.jsxs)(s.p,{children:["If you currently use SA via ",(0,i.jsx)(s.code,{children:"spamc"}),"/",(0,i.jsx)(s.code,{children:"spamd"}),", the closest equivalent is ",(0,i.jsx)(s.code,{children:"rspamc"})," talking to the normal or controller worker over HTTP."]}),"\n",(0,i.jsx)(s.h2,{id:"redis",children:"Redis"}),"\n",(0,i.jsxs)(s.p,{children:["Rspamd relies on Redis for Bayes statistics, greylisting state, rate limits, reply tracking, and several other modules. Ensure a Redis instance is reachable and configure it in ",(0,i.jsx)(s.code,{children:"local.d/redis.conf"}),":"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-hcl",children:'# local.d/redis.conf\nservers = "127.0.0.1";\n'})}),"\n",(0,i.jsxs)(s.p,{children:["For full details see ",(0,i.jsx)(s.a,{href:"/configuration/redis",children:"Redis configuration"}),"."]}),"\n",(0,i.jsx)(s.h2,{id:"actions-and-thresholds",children:"Actions and thresholds"}),"\n",(0,i.jsxs)(s.p,{children:["SA produces a numeric score and leaves the delivery decision to the MTA or a wrapper script. Rspamd returns both a score ",(0,i.jsx)(s.strong,{children:"and"})," an action. The default action thresholds are:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-hcl",children:"# Default actions (configured in local.d/actions.conf or via metrics)\nactions {\n  reject = 15;\n  add_header = 6;\n  greylist = 4;\n}\n"})}),"\n",(0,i.jsxs)(s.p,{children:["If your SA setup marks messages as spam above score 5.0 (the common SA default), consider setting ",(0,i.jsx)(s.code,{children:"add_header"})," to a similar value. You can also define ",(0,i.jsx)(s.code,{children:"rewrite subject"})," if your users rely on subject-line markers:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-hcl",children:"actions {\n  reject = 15;\n  rewrite_subject = 7;\n  add_header = 5;\n  greylist = 4;\n}\n"})}),"\n",(0,i.jsxs)(s.p,{children:["See ",(0,i.jsx)(s.a,{href:"/configuration/metrics",children:"Actions and scores"})," for the full reference."]}),"\n",(0,i.jsx)(s.h2,{id:"mapping-sa-features-to-rspamd",children:"Mapping SA features to Rspamd"}),"\n",(0,i.jsx)(s.p,{children:"The table below maps common SA plugins and features to their Rspamd equivalents:"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"SpamAssassin"}),(0,i.jsx)(s.th,{children:"Rspamd equivalent"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Bayes classifier"}),(0,i.jsxs)(s.td,{children:["Built-in ",(0,i.jsx)(s.a,{href:"/configuration/statistic",children:"Bayes classifier"})," (Redis backend)"]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Network tests (DNS blocklists)"}),(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.a,{href:"/modules/rbl",children:"RBL module"})," (enabled by default)"]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"URIBL / SURBL"}),(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.a,{href:"/modules/rbl",children:"RBL module"})," with URL-specific lists"]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"DKIM verification"}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.a,{href:"/modules/dkim",children:"DKIM module"})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"DKIM signing"}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.a,{href:"/modules/dkim_signing",children:"DKIM signing module"})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"SPF checks"}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.a,{href:"/modules/spf",children:"SPF module"})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"DMARC"}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.a,{href:"/modules/dmarc",children:"DMARC module"})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Razor"}),(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.a,{href:"/modules/external_services",children:"External services module"})," (Razor integration)"]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Pyzor"}),(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.a,{href:"/modules/external_services",children:"External services module"})," (Pyzor integration)"]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"DCC"}),(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.a,{href:"/modules/dcc",children:"DCC module"})," or ",(0,i.jsx)(s.a,{href:"/modules/external_services",children:"External services"})]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Fuzzy hashes"}),(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.a,{href:"/modules/fuzzy_check",children:"Fuzzy check module"})," (Rspamd native fuzzy storage)"]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"AWL (auto-whitelist)"}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.a,{href:"/modules/reputation",children:"Reputation module"})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"TextCat (language)"}),(0,i.jsx)(s.td,{children:"Built-in language detection"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.code,{children:"body"})," / ",(0,i.jsx)(s.code,{children:"rawbody"})," / ",(0,i.jsx)(s.code,{children:"header"})," rules"]}),(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.a,{href:"/modules/regexp",children:"Regexp module"})," or ",(0,i.jsx)(s.a,{href:"/modules/spamassassin",children:"SpamAssassin module"})," for direct import"]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Meta rules"}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.a,{href:"/configuration/composites",children:"Composites"})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"rewrite_header Subject"})}),(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.code,{children:"rewrite subject"})," action with ",(0,i.jsx)(s.code,{children:"subject"})," pattern in ",(0,i.jsx)(s.a,{href:"/configuration/metrics",children:"actions"})]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Per-user preferences"}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.a,{href:"/configuration/settings",children:"Settings module"})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"SA shortcircuit"}),(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.a,{href:"/modules/force_actions",children:"Force actions module"})," or ",(0,i.jsx)(s.code,{children:"want_spam"})," in ",(0,i.jsx)(s.a,{href:"/configuration/settings",children:"settings"})]})]})]})]}),"\n",(0,i.jsx)(s.h2,{id:"migrating-spamassassin-rules",children:"Migrating SpamAssassin rules"}),"\n",(0,i.jsxs)(s.p,{children:["Most SA checks have native Rspamd equivalents that are faster and better maintained. ",(0,i.jsx)(s.strong,{children:"Migrate only custom rules that you have written yourself"})," and that have no Rspamd equivalent. Importing the entire SA ruleset is unnecessary and will degrade performance."]}),"\n",(0,i.jsxs)(s.p,{children:["If you do need to import SA rules, use the ",(0,i.jsx)(s.a,{href:"/modules/spamassassin",children:"SpamAssassin module"}),":"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-hcl",children:'# local.d/spamassassin.conf\nspamassassin {\n  # Your custom rules only\n  ruleset = "/etc/rspamd/sa-rules/local.cf";\n  # Optionally include upstream SA rules as a baseline\n  base_ruleset = "/var/db/spamassassin/3.004002/updates_spamassassin_org/*.cf";\n  # Limit regex match window for performance\n  match_limit = 100k;\n}\n'})}),"\n",(0,i.jsxs)(s.p,{children:["Supported SA features inside the module include: ",(0,i.jsx)(s.code,{children:"body"}),", ",(0,i.jsx)(s.code,{children:"rawbody"}),", ",(0,i.jsx)(s.code,{children:"meta"}),", ",(0,i.jsx)(s.code,{children:"header"}),", ",(0,i.jsx)(s.code,{children:"uri"})," rules, some ",(0,i.jsx)(s.code,{children:"eval"})," functions, and a subset of plugins (",(0,i.jsx)(s.code,{children:"HeaderEval"}),", ",(0,i.jsx)(s.code,{children:"MIMEEval"}),", ",(0,i.jsx)(s.code,{children:"BodyEval"}),", ",(0,i.jsx)(s.code,{children:"FreeMail"}),", ",(0,i.jsx)(s.code,{children:"ReplaceTags"}),", ",(0,i.jsx)(s.code,{children:"RelayEval"}),", ",(0,i.jsx)(s.code,{children:"MIMEHeader"}),"). Network plugins and HTML-specific plugins are ",(0,i.jsx)(s.strong,{children:"not"})," supported -- use Rspamd's native modules instead. See the ",(0,i.jsx)(s.a,{href:"/modules/spamassassin",children:"module documentation"})," for full details."]}),"\n",(0,i.jsx)(s.admonition,{type:"tip",children:(0,i.jsxs)(s.p,{children:["Set ",(0,i.jsx)(s.code,{children:"alpha = 0.1"})," in the ",(0,i.jsx)(s.code,{children:"spamassassin"})," config to promote all SA rules with a score above 0.1 to full Rspamd symbols. This makes them visible in the web UI and logs, which helps during the migration period."]})}),"\n",(0,i.jsx)(s.h2,{id:"statistics-and-training",children:"Statistics and training"}),"\n",(0,i.jsxs)(s.p,{children:["Rspamd uses the OSB (Orthogonal Sparse Bigram) tokenizer with Redis storage. ",(0,i.jsx)(s.strong,{children:"SA Bayes databases cannot be imported"})," -- you must retrain from scratch."]}),"\n",(0,i.jsx)(s.h3,{id:"initial-training",children:"Initial training"}),"\n",(0,i.jsxs)(s.p,{children:["Feed your existing ham and spam corpora to Rspamd using ",(0,i.jsx)(s.code,{children:"rspamc"}),":"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"rspamc learn_ham /path/to/ham/maildir/\nrspamc learn_spam /path/to/spam/maildir/\n"})}),"\n",(0,i.jsxs)(s.p,{children:["Both commands accept individual files, directories (recursed), and mbox files. Rspamd requires a minimum number of learns for both classes before Bayes produces results (default: 200, controlled by ",(0,i.jsx)(s.code,{children:"min_learns"}),"). See ",(0,i.jsx)(s.a,{href:"/configuration/statistic",children:"Statistics settings"})," for all options."]}),"\n",(0,i.jsx)(s.h3,{id:"autolearn",children:"Autolearn"}),"\n",(0,i.jsxs)(s.p,{children:["Rspamd can learn automatically from messages that score clearly above or below configurable thresholds. Enable autolearn in ",(0,i.jsx)(s.code,{children:"local.d/classifier-bayes.conf"}),":"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-hcl",children:"autolearn {\n  spam_threshold = 6.0;\n  ham_threshold = -0.5;\n  check_balance = true;\n  min_balance = 0.9;\n}\n"})}),"\n",(0,i.jsxs)(s.p,{children:["This is equivalent to SA's ",(0,i.jsx)(s.code,{children:"bayes_auto_learn"})," but with finer-grained controls. See the ",(0,i.jsx)(s.a,{href:"/configuration/statistic#autolearn-configuration-reference-314",children:"autolearn reference"})," for all options."]}),"\n",(0,i.jsx)(s.h3,{id:"user-feedback-via-imap",children:"User feedback via IMAP"}),"\n",(0,i.jsxs)(s.p,{children:["For ongoing training from user actions (moving messages to/from Junk), configure ",(0,i.jsx)(s.a,{href:"/tutorials/feedback_from_users_with_IMAPSieve",children:"IMAPSieve with Dovecot"})," to call ",(0,i.jsx)(s.code,{children:"rspamc learn_spam"})," or ",(0,i.jsx)(s.code,{children:"rspamc learn_ham"})," when users reclassify messages."]}),"\n",(0,i.jsx)(s.h3,{id:"statistics-expiry",children:"Statistics expiry"}),"\n",(0,i.jsxs)(s.p,{children:["Unlike SA, Rspamd can automatically expire old statistical tokens to keep the database fresh. Enable the ",(0,i.jsx)(s.a,{href:"/modules/bayes_expiry",children:"bayes_expiry module"})," to prevent unbounded growth."]}),"\n",(0,i.jsx)(s.h2,{id:"rollout-strategy",children:"Rollout strategy"}),"\n",(0,i.jsx)(s.p,{children:"A safe migration follows these stages:"}),"\n",(0,i.jsx)(s.h3,{id:"1-shadow-mode",children:"1. Shadow mode"}),"\n",(0,i.jsxs)(s.p,{children:["Run Rspamd alongside SA without affecting mail delivery. Use the ",(0,i.jsx)(s.a,{href:"/workers/rspamd_proxy#mirroring",children:"proxy worker's mirroring feature"})," to send a copy of traffic to Rspamd while SA remains the production filter:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-hcl",children:'# local.d/worker-proxy.inc\nupstream "production" {\n  default = yes;\n  self_scan = yes;\n}\n'})}),"\n",(0,i.jsxs)(s.p,{children:["Compare Rspamd headers (",(0,i.jsx)(s.code,{children:"X-Spamd-Result"}),") with SA headers to identify threshold differences."]}),"\n",(0,i.jsx)(s.h3,{id:"2-tune-thresholds",children:"2. Tune thresholds"}),"\n",(0,i.jsxs)(s.p,{children:["Adjust action scores in ",(0,i.jsx)(s.code,{children:"local.d/actions.conf"})," until false positive and false negative rates match or improve on your SA setup. Pay special attention to:"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"add_header"})," threshold vs. your SA ",(0,i.jsx)(s.code,{children:"required_score"})]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"reject"})," threshold (SA typically does not reject; set this conservatively)"]}),"\n",(0,i.jsx)(s.li,{children:"Greylisting threshold if you did not use greylisting with SA"}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"3-cut-over",children:"3. Cut over"}),"\n",(0,i.jsx)(s.p,{children:"Switch your MTA content filter from SA to Rspamd. Keep SA installed but disabled for a rollback window."}),"\n",(0,i.jsx)(s.h3,{id:"4-monitor",children:"4. Monitor"}),"\n",(0,i.jsxs)(s.p,{children:["Use the built-in web UI (controller worker, default port 11334) to monitor symbol hits, action rates, and Bayes accuracy. Check ",(0,i.jsx)(s.code,{children:"BAYES_SPAM"})," and ",(0,i.jsx)(s.code,{children:"BAYES_HAM"})," hit rates to verify that autolearn is keeping the corpus balanced."]}),"\n",(0,i.jsx)(s.h2,{id:"common-pitfalls",children:"Common pitfalls"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Problem"}),(0,i.jsx)(s.th,{children:"Solution"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Attempting to import SA Bayes database"}),(0,i.jsxs)(s.td,{children:["Not supported. Retrain using ",(0,i.jsx)(s.code,{children:"rspamc learn_ham"}),"/",(0,i.jsx)(s.code,{children:"learn_spam"})," from corpora."]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Importing the entire SA ruleset"}),(0,i.jsx)(s.td,{children:"Unnecessary and slow. Migrate only your custom rules; disable or remove upstream SA rules."})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Redis not running or unreachable"}),(0,i.jsx)(s.td,{children:"Statistics, greylisting, ratelimiting, and replies all require Redis. Verify connectivity before starting Rspamd."})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Score mismatch after migration"}),(0,i.jsx)(s.td,{children:"SA and Rspamd use different scoring scales. Do not copy SA scores verbatim; tune Rspamd action thresholds independently."})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Missing X-Spam headers for downstream filters"}),(0,i.jsxs)(s.td,{children:["Configure ",(0,i.jsx)(s.a,{href:"/modules/milter_headers",children:"milter_headers module"})," to add ",(0,i.jsx)(s.code,{children:"X-Spamd-Result"}),", ",(0,i.jsx)(s.code,{children:"X-Spam-Status"}),", or custom headers."]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Per-user Bayes with multiple recipients"}),(0,i.jsxs)(s.td,{children:["Enable ",(0,i.jsx)(s.code,{children:"per_user"})," in the classifier config and use LDA-mode delivery so each message is attributed to the correct user. See ",(0,i.jsx)(s.a,{href:"/configuration/statistic",children:"Statistics settings"}),"."]})]})]})]}),"\n",(0,i.jsx)(s.h2,{id:"see-also",children:"See also"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"/tutorials/integration",children:"MTA integration"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"/configuration/metrics",children:"Actions and scores"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"/configuration/statistic",children:"Statistics settings"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"/modules/bayes_expiry",children:"Bayes expiry module"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"/modules/spamassassin",children:"SpamAssassin rules module"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"/modules/external_services",children:"External services (Razor, Pyzor, DCC)"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"/tutorials/feedback_from_users_with_IMAPSieve",children:"IMAPSieve feedback"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"/tutorials/migration",children:"Upgrading Rspamd"})}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},8453(e,s,n){n.d(s,{R:()=>d,x:()=>a});var r=n(6540);const i={},t=r.createContext(i);function d(e){const s=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),r.createElement(t.Provider,{value:s},e.children)}}}]);