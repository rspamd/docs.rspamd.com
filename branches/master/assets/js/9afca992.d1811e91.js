"use strict";(self.webpackChunkrspamd_docs=self.webpackChunkrspamd_docs||[]).push([[407],{1440(e,n,s){s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>d,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"modules/p0f","title":"P0f module","description":"The P0f module performs passive OS fingerprinting by querying a local p0f daemon. This allows Rspamd to identify the operating system of the connecting client based on TCP/IP stack characteristics.","source":"@site/docs/modules/p0f.md","sourceDirName":"modules","slug":"/modules/p0f","permalink":"/docs.rspamd.com/branches/master/modules/p0f","draft":false,"unlisted":false,"editUrl":"https://github.com/rspamd/docs.rspamd.com/edit/master/docs/modules/p0f.md","tags":[],"version":"current","frontMatter":{"title":"P0f module"}}');var i=s(4848),r=s(8453);const d={title:"P0f module"},c="P0f module",l={},o=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Configuration options",id:"configuration-options",level:2},{value:"Pattern matching",id:"pattern-matching",level:2},{value:"Symbols",id:"symbols",level:2},{value:"Redis caching",id:"redis-caching",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"p0f-module",children:"P0f module"})}),"\n",(0,i.jsxs)(n.p,{children:["The P0f module performs passive OS fingerprinting by querying a local ",(0,i.jsx)(n.a,{href:"https://lcamtuf.coredump.cx/p0f3/",children:"p0f"})," daemon. This allows Rspamd to identify the operating system of the connecting client based on TCP/IP stack characteristics."]}),"\n",(0,i.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,i.jsx)(n.p,{children:"You need to have p0f v3 installed and running. The p0f daemon should be configured to listen on a Unix socket that Rspamd can connect to."}),"\n",(0,i.jsx)(n.p,{children:"Example p0f startup:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"p0f -i eth0 -s /var/run/p0f.sock\n"})}),"\n",(0,i.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,i.jsxs)(n.p,{children:["To enable the module, create ",(0,i.jsx)(n.code,{children:"/etc/rspamd/local.d/p0f.conf"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-hcl",children:'# Enable the module\nenabled = true;\n\n# Path to the unix socket that p0f listens on\nsocket = "/var/run/p0f.sock";\n\n# Connection timeout\ntimeout = 5s;\n\n# If defined, insert symbol with lookup results\nsymbol = "P0F";\n\n# Patterns to match against results returned by p0f\n# Symbol will be yielded on OS string, link type or distance matches\npatterns = {\n  WINDOWS = "^Windows.*";\n  LINUX = "^Linux.*";\n  # DSL = "^DSL$";\n  # DISTANCE10 = "^distance:10$";\n}\n\n# Cache lifetime in seconds (default - 2 hours)\nexpire = 7200;\n\n# Cache key prefix for Redis\nprefix = "p0f";\n'})}),"\n",(0,i.jsx)(n.h2,{id:"configuration-options",children:"Configuration options"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Option"}),(0,i.jsx)(n.th,{children:"Default"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"enabled"})}),(0,i.jsx)(n.td,{children:"false"}),(0,i.jsx)(n.td,{children:"Enable the p0f module"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"socket"})}),(0,i.jsx)(n.td,{children:"required"}),(0,i.jsx)(n.td,{children:"Path to the p0f Unix socket"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"timeout"})}),(0,i.jsx)(n.td,{children:"5s"}),(0,i.jsx)(n.td,{children:"Connection timeout"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"symbol"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"P0F"})}),(0,i.jsx)(n.td,{children:"Symbol to insert with OS fingerprint results"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"patterns"})}),(0,i.jsx)(n.td,{children:"{}"}),(0,i.jsx)(n.td,{children:"Map of symbol names to regex patterns for matching p0f results"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"expire"})}),(0,i.jsx)(n.td,{children:"7200"}),(0,i.jsx)(n.td,{children:"Cache lifetime in seconds"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"prefix"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"p0f"})}),(0,i.jsx)(n.td,{children:"Redis cache key prefix"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"pattern-matching",children:"Pattern matching"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"patterns"})," option allows you to define custom symbols that fire when the p0f result matches a specific pattern. Patterns can match against:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Operating system name (e.g., ",(0,i.jsx)(n.code,{children:"Windows"}),", ",(0,i.jsx)(n.code,{children:"Linux"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:["Link type (e.g., ",(0,i.jsx)(n.code,{children:"DSL"}),", ",(0,i.jsx)(n.code,{children:"Ethernet"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:["Network distance (e.g., ",(0,i.jsx)(n.code,{children:"distance:10"}),")"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"symbols",children:"Symbols"}),"\n",(0,i.jsx)(n.p,{children:"The module registers the following symbols:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"P0F_CHECK"})," - callback symbol (internal)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"P0F"})," - virtual symbol containing OS fingerprint (if ",(0,i.jsx)(n.code,{children:"symbol"})," is set)"]}),"\n",(0,i.jsxs)(n.li,{children:["Custom pattern symbols as defined in ",(0,i.jsx)(n.code,{children:"patterns"})," configuration"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"redis-caching",children:"Redis caching"}),"\n",(0,i.jsx)(n.p,{children:"If Redis is configured globally or for this module, p0f results are cached to avoid repeated lookups for the same IP address."})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},8453(e,n,s){s.d(n,{R:()=>d,x:()=>c});var t=s(6540);const i={},r=t.createContext(i);function d(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);