"use strict";(self.webpackChunkrspamd_docs=self.webpackChunkrspamd_docs||[]).push([[6315],{5692(e,n,s){s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"modules/once_received","title":"Once received module","description":"This module is intended to do simple checks for mail with one Received header. The underlying concept is that genuine emails tend to have multiple received headers, whereas spam originating from compromised user devices often exhibit certain negative characteristics, such as the use of dynamic or broadband IP addresses.","source":"@site/docs/modules/once_received.md","sourceDirName":"modules","slug":"/modules/once_received","permalink":"/docs.rspamd.com/branches/master/modules/once_received","draft":false,"unlisted":false,"editUrl":"https://github.com/rspamd/docs.rspamd.com/edit/master/docs/modules/once_received.md","tags":[],"version":"current","frontMatter":{"title":"Once received module"},"sidebar":"docs","previous":{"title":"Neural network module","permalink":"/docs.rspamd.com/branches/master/modules/neural"},"next":{"title":"Phishing module","permalink":"/docs.rspamd.com/branches/master/modules/phishing"}}');var d=s(4848),i=s(8453);const r={title:"Once received module"},o="Once received module",c={},l=[{value:"Configuration",id:"configuration",level:2},{value:"Configuration options",id:"configuration-options",level:3},{value:"Example",id:"example",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,i.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.header,{children:(0,d.jsx)(n.h1,{id:"once-received-module",children:"Once received module"})}),"\n",(0,d.jsxs)(n.p,{children:["This module is intended to do simple checks for mail with one ",(0,d.jsx)(n.code,{children:"Received"})," header. The underlying concept is that genuine emails tend to have multiple received headers, whereas spam originating from compromised user devices often exhibit certain negative characteristics, such as the use of ",(0,d.jsx)(n.code,{children:"dynamic"})," or ",(0,d.jsx)(n.code,{children:"broadband"})," IP addresses."]}),"\n",(0,d.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,d.jsxs)(n.p,{children:["Configuring this module is quite straightforward: you simply need to define a ",(0,d.jsx)(n.code,{children:"symbol"})," for generic emails with only one received header, specify a ",(0,d.jsx)(n.code,{children:"symbol_strict"})," for emails that exhibit negative patterns or have unresolved hostnames, and include ",(0,d.jsx)(n.strong,{children:"good"})," and ",(0,d.jsx)(n.strong,{children:"bad"})," patterns, which can utilise ",(0,d.jsx)(n.a,{href:"http://lua-users.org/wiki/PatternsTutorial",children:"lua patterns"}),". Use ",(0,d.jsx)(n.code,{children:"good_host"})," lines to exclude certain hosts from this module, and ",(0,d.jsx)(n.code,{children:"bad_host"})," lines to identify specific negative patterns. Additionally, you can create a ",(0,d.jsx)(n.code,{children:"whitelist"})," to define a list of networks for which the ",(0,d.jsx)(n.code,{children:"once_received"})," checks should be excluded."]}),"\n",(0,d.jsx)(n.h3,{id:"configuration-options",children:"Configuration options"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Option"}),(0,d.jsx)(n.th,{children:"Default"}),(0,d.jsx)(n.th,{children:"Description"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"symbol"})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"ONCE_RECEIVED"})}),(0,d.jsx)(n.td,{children:"Symbol for messages with only one received header"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"symbol_strict"})}),(0,d.jsx)(n.td,{children:"nil"}),(0,d.jsx)(n.td,{children:"Symbol for messages matching bad patterns or unresolved hostnames"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"symbol_mx"})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"DIRECT_TO_MX"})}),(0,d.jsx)(n.td,{children:"Symbol for direct MUA to MX connections (detected via User-Agent/X-Mailer)"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"good_host"})}),(0,d.jsx)(n.td,{children:"-"}),(0,d.jsx)(n.td,{children:"Lua pattern for hostnames to exclude from checks"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"bad_host"})}),(0,d.jsx)(n.td,{children:"-"}),(0,d.jsx)(n.td,{children:"Lua pattern for hostnames that trigger strict symbol"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"whitelist"})}),(0,d.jsx)(n.td,{children:"nil"}),(0,d.jsx)(n.td,{children:"Map of IP addresses/networks to exclude from checks"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"check_local"})}),(0,d.jsx)(n.td,{children:"false"}),(0,d.jsx)(n.td,{children:"Apply checks to messages from local networks"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"check_authed"})}),(0,d.jsx)(n.td,{children:"false"}),(0,d.jsx)(n.td,{children:"Apply checks to messages from authenticated users"})]})]})]}),"\n",(0,d.jsx)(n.h2,{id:"example",children:"Example"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-hcl",children:'once_received {\n    good_host = "^mail";\n    bad_host = "static";\n    bad_host = "dynamic";\n    symbol_strict = "ONCE_RECEIVED_STRICT";\n    symbol = "ONCE_RECEIVED";\n    whitelist = "/tmp/ip.map";\n}\n'})}),"\n",(0,d.jsxs)(n.p,{children:["As is typical, the IP map can include both IPv4 and IPv6 addresses, as well as networks in CIDR notation. You may also add optional comments to the map, indicated by a ",(0,d.jsx)(n.code,{children:"#"})," symbol."]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(a,{...e})}):a(e)}},8453(e,n,s){s.d(n,{R:()=>r,x:()=>o});var t=s(6540);const d={},i=t.createContext(d);function r(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:r(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);