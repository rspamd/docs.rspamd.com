"use strict";(self.webpackChunkrspamd_docs=self.webpackChunkrspamd_docs||[]).push([[9980],{5091(e,n,r){r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>p,frontMatter:()=>t,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"administration/rspamadm/cryptography","title":"Cryptography & Security","description":"These commands provide cryptographic operations including keypair generation, encryption, decryption, and password management.","source":"@site/docs/administration/rspamadm/cryptography.md","sourceDirName":"administration/rspamadm","slug":"/administration/rspamadm/cryptography","permalink":"/docs.rspamd.com/branches/master/administration/rspamadm/cryptography","draft":false,"unlisted":false,"editUrl":"https://github.com/rspamd/docs.rspamd.com/edit/master/docs/administration/rspamadm/cryptography.md","tags":[],"version":"current","frontMatter":{"title":"Cryptography & Security"},"sidebar":"docs","previous":{"title":"DKIM Key Management","permalink":"/docs.rspamd.com/branches/master/administration/rspamadm/dkim-management"},"next":{"title":"Statistics & Machine Learning","permalink":"/docs.rspamd.com/branches/master/administration/rspamadm/statistics-ml"}}');var a=r(4848),i=r(8453);const t={title:"Cryptography & Security"},c="Cryptography & Security",o={},d=[{value:"keypair",id:"keypair",level:2},{value:"Purpose",id:"purpose",level:3},{value:"Common Scenarios",id:"common-scenarios",level:3},{value:"Generate Encryption Keypair",id:"generate-encryption-keypair",level:4},{value:"Generate Signing Keypair",id:"generate-signing-keypair",level:4},{value:"Use NIST Curves",id:"use-nist-curves",level:4},{value:"Subcommands",id:"subcommands",level:3},{value:"Generate Keypair",id:"generate-keypair",level:4},{value:"Sign Files",id:"sign-files",level:4},{value:"Encrypt Files",id:"encrypt-files",level:4},{value:"Options",id:"options",level:3},{value:"Use Cases",id:"use-cases",level:3},{value:"Example: Secure Controller Setup",id:"example-secure-controller-setup",level:3},{value:"secret_box",id:"secret_box",level:2},{value:"Purpose",id:"purpose-1",level:3},{value:"Common Scenarios",id:"common-scenarios-1",level:3},{value:"Generate Encryption Key",id:"generate-encryption-key",level:4},{value:"Encrypt Text",id:"encrypt-text",level:4},{value:"Decrypt Text",id:"decrypt-text",level:4},{value:"Options",id:"options-1",level:3},{value:"Use Cases",id:"use-cases-1",level:3},{value:"Encrypt Database Passwords",id:"encrypt-database-passwords",level:4},{value:"Encrypt API Keys",id:"encrypt-api-keys",level:4},{value:"Secure Configuration Distribution",id:"secure-configuration-distribution",level:4},{value:"pw",id:"pw",level:2},{value:"Purpose",id:"purpose-2",level:3},{value:"Common Scenarios",id:"common-scenarios-2",level:3},{value:"Generate Password Hash",id:"generate-password-hash",level:4},{value:"Choose Hash Algorithm",id:"choose-hash-algorithm",level:4},{value:"Verify Password",id:"verify-password",level:4},{value:"Options",id:"options-2",level:3},{value:"Available Algorithms",id:"available-algorithms",level:3},{value:"Use Cases",id:"use-cases-2",level:3},{value:"Set Controller Password",id:"set-controller-password",level:4},{value:"Rotate Passwords",id:"rotate-passwords",level:4},{value:"Verify Stored Hash",id:"verify-stored-hash",level:4},{value:"Practical Examples",id:"practical-examples",level:2},{value:"Complete Secure Configuration Setup",id:"complete-secure-configuration-setup",level:3},{value:"Encrypting Multiple Configuration Values",id:"encrypting-multiple-configuration-values",level:3},{value:"Key Rotation Workflow",id:"key-rotation-workflow",level:3},{value:"Interactive Security Setup",id:"interactive-security-setup",level:3},{value:"Tips and Best Practices",id:"tips-and-best-practices",level:2},{value:"Key Management",id:"key-management",level:3},{value:"Password Security",id:"password-security",level:3},{value:"Encryption",id:"encryption",level:3},{value:"Security",id:"security",level:3},{value:"Related Documentation",id:"related-documentation",level:2}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"cryptography--security",children:"Cryptography & Security"})}),"\n",(0,a.jsx)(n.p,{children:"These commands provide cryptographic operations including keypair generation, encryption, decryption, and password management."}),"\n",(0,a.jsx)(n.h2,{id:"keypair",children:"keypair"}),"\n",(0,a.jsx)(n.p,{children:"Manage encryption and signing keypairs."}),"\n",(0,a.jsx)(n.h3,{id:"purpose",children:"Purpose"}),"\n",(0,a.jsx)(n.p,{children:"Generate and use Curve25519 (or NIST) keypairs for encryption and signing operations in Rspamd."}),"\n",(0,a.jsx)(n.h3,{id:"common-scenarios",children:"Common Scenarios"}),"\n",(0,a.jsx)(n.h4,{id:"generate-encryption-keypair",children:"Generate Encryption Keypair"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Generate encryption keypair (default)\nrspamadm keypair\n\n# Output as JSON\nrspamadm keypair -j\n\n# Output as UCL\nrspamadm keypair -u\n\n# Save to file\nrspamadm keypair -o encryption.key\n"})}),"\n",(0,a.jsx)(n.p,{children:"Output includes both public and private keys in a single structure."}),"\n",(0,a.jsx)(n.h4,{id:"generate-signing-keypair",children:"Generate Signing Keypair"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Generate signing keypair\nrspamadm keypair -s\n\n# Save to file\nrspamadm keypair -s -o signing.key\n"})}),"\n",(0,a.jsx)(n.h4,{id:"use-nist-curves",children:"Use NIST Curves"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Generate NIST P-256 keypair\nrspamadm keypair -n\n\n# NIST signing keypair\nrspamadm keypair -s -n\n"})}),"\n",(0,a.jsx)(n.h3,{id:"subcommands",children:"Subcommands"}),"\n",(0,a.jsx)(n.h4,{id:"generate-keypair",children:"Generate Keypair"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Explicit generate command\nrspamadm keypair generate\n\n# Short forms\nrspamadm keypair gen\nrspamadm keypair g\n"})}),"\n",(0,a.jsx)(n.h4,{id:"sign-files",children:"Sign Files"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Sign a file\nrspamadm keypair sign -k keypair.key file.txt\n\n# Verify signature\nrspamadm keypair verify -k keypair.key file.txt file.txt.sig\n"})}),"\n",(0,a.jsx)(n.h4,{id:"encrypt-files",children:"Encrypt Files"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Encrypt with recipient's public key\nrspamadm keypair encrypt -k recipient-pubkey.key file.txt > encrypted.bin\n\n# Decrypt with your private key\nrspamadm keypair decrypt -k your-keypair.key encrypted.bin > decrypted.txt\n"})}),"\n",(0,a.jsx)(n.h3,{id:"options",children:"Options"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"-s, --sign              Generate signing keypair\n-n, --nist              Use NIST P-256 curves\n-j, --json              Output as JSON\n-u, --ucl               Output as UCL\n-o, --output <file>     Write to file\n\nSubcommand options:\n-k, --key <file>        Keypair or public key file\n"})}),"\n",(0,a.jsx)(n.h3,{id:"use-cases",children:"Use Cases"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Controller Authentication"}),": Encrypt controller passwords"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Map Signing"}),": Sign maps for integrity verification"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Secure Configuration"}),": Encrypt sensitive config values"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Inter-Server Communication"}),": Encrypt data exchanged between servers"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"example-secure-controller-setup",children:"Example: Secure Controller Setup"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Generate keypair for controller\nrspamadm keypair -o controller.key\n\n# Extract public key for workers\ngrep 'pubkey' controller.key\n\n# Configure in rspamd.conf\n# controller { \n#   password = \"$2$<encrypted_password>\"; \n# }\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"secret_box",children:"secret_box"}),"\n",(0,a.jsx)(n.p,{children:"Symmetric encryption and decryption utility."}),"\n",(0,a.jsx)(n.h3,{id:"purpose-1",children:"Purpose"}),"\n",(0,a.jsx)(n.p,{children:"Encrypt and decrypt text using symmetric cryptography (NaCl secretbox). Useful for encrypting sensitive configuration values."}),"\n",(0,a.jsx)(n.h3,{id:"common-scenarios-1",children:"Common Scenarios"}),"\n",(0,a.jsx)(n.h4,{id:"generate-encryption-key",children:"Generate Encryption Key"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Generate a new symmetric key\nrspamadm secret_box keygen\n"})}),"\n",(0,a.jsx)(n.p,{children:"Outputs a base64-encoded key like:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"key: rWKukFxPz3p1HPtN3K4xGg==\n"})}),"\n",(0,a.jsx)(n.p,{children:"Store this key securely - you'll need it for encryption/decryption."}),"\n",(0,a.jsx)(n.h4,{id:"encrypt-text",children:"Encrypt Text"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'# Encrypt text (interactive)\nrspamadm secret_box encrypt\n# Paste your text, press Ctrl+D\n# Enter key when prompted\n\n# Encrypt from command line\necho "sensitive-password" | rspamadm secret_box encrypt\n\n# Different output formats\necho "secret" | rspamadm secret_box encrypt --base64  # Base64 (default)\necho "secret" | rspamadm secret_box encrypt --base32  # Base32\necho "secret" | rspamadm secret_box encrypt --hex     # Hexadecimal\n'})}),"\n",(0,a.jsx)(n.p,{children:"Output format:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"nonce: <24-byte nonce>\nencrypted: <ciphertext>\n"})}),"\n",(0,a.jsx)(n.h4,{id:"decrypt-text",children:"Decrypt Text"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'# Decrypt (interactive)\nrspamadm secret_box decrypt\n# Paste nonce and encrypted text\n# Enter key when prompted\n\n# Decrypt from environment\nexport SECRET_KEY="rWKukFxPz3p1HPtN3K4xGg=="\necho "nonce=...; encrypted=..." | rspamadm secret_box decrypt\n'})}),"\n",(0,a.jsx)(n.h3,{id:"options-1",children:"Options"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"-R, --raw               Raw binary format\n-H, --hex               Hexadecimal encoding\n-b, --base32            Base32 encoding\n-B, --base64            Base64 encoding (default)\n"})}),"\n",(0,a.jsx)(n.h3,{id:"use-cases-1",children:"Use Cases"}),"\n",(0,a.jsx)(n.h4,{id:"encrypt-database-passwords",children:"Encrypt Database Passwords"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'# Generate key (save this securely)\nrspamadm secret_box keygen > /etc/rspamd/secret.key\n\n# Encrypt database password\necho "MySecretPassword123" | rspamadm secret_box encrypt -B\n\n# Use in configuration\n# clickhouse {\n#   password = "$SECRET_BOX{nonce=...; encrypted=...}";\n# }\n'})}),"\n",(0,a.jsx)(n.h4,{id:"encrypt-api-keys",children:"Encrypt API Keys"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'# Encrypt API key\necho "sk-1234567890abcdef" | rspamadm secret_box encrypt > api-key.enc\n\n# Store encrypted, decrypt when needed\nrspamadm secret_box decrypt < api-key.enc\n'})}),"\n",(0,a.jsx)(n.h4,{id:"secure-configuration-distribution",children:"Secure Configuration Distribution"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n# Encrypt sensitive config values before committing to git\n\nKEY=$(cat /secure/location/secret.key)\n\n# Encrypt Redis password\nREDIS_PASS=$(echo "redis-password" | \\\n  rspamadm secret_box encrypt -B <<< "$KEY")\n\n# Update config template\nsed -i "s/REDIS_PASSWORD/$REDIS_PASS/" config.template\n'})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"pw",children:"pw"}),"\n",(0,a.jsx)(n.p,{children:"Generate and verify password hashes for Rspamd."}),"\n",(0,a.jsx)(n.h3,{id:"purpose-2",children:"Purpose"}),"\n",(0,a.jsx)(n.p,{children:"Create password hashes for controller authentication and verify existing hashes."}),"\n",(0,a.jsx)(n.h3,{id:"common-scenarios-2",children:"Common Scenarios"}),"\n",(0,a.jsx)(n.h4,{id:"generate-password-hash",children:"Generate Password Hash"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'# Interactive (password hidden)\nrspamadm pw\n\n# From command line (avoid - shows in history)\nrspamadm pw -p "mypassword"\n\n# Quiet mode (only output hash)\nrspamadm pw -q\n'})}),"\n",(0,a.jsx)(n.p,{children:"Output example:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"$2$g6crbhd33hb3jwzh6r6yq9d1ynq4uqkj$8wdq6hjzfbzwq4m7crmzn5k8qyxzg1ygkbqx7dj1y8n\n"})}),"\n",(0,a.jsx)(n.h4,{id:"choose-hash-algorithm",children:"Choose Hash Algorithm"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# List available algorithms\nrspamadm pw -l\n\n# Use specific algorithm\nrspamadm pw -t pbkdf2\n"})}),"\n",(0,a.jsx)(n.h4,{id:"verify-password",children:"Verify Password"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'# Check if password matches hash\nrspamadm pw --check -p "mypassword"\n# Paste the hash when prompted\n\n# Verify from file\nrspamadm pw --check -p "mypassword" < hash.txt\n'})}),"\n",(0,a.jsx)(n.h3,{id:"options-2",children:"Options"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"-e, --encrypt           Encrypt password (default)\n-c, --check             Verify password against hash\n-p, --password <pass>   Specify password (not recommended)\n-t, --type <type>       Hash algorithm\n-l, --list              List available algorithms\n-q, --quiet             Suppress output, only show hash\n"})}),"\n",(0,a.jsx)(n.h3,{id:"available-algorithms",children:"Available Algorithms"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"pbkdf2"})," - PBKDF2-HMAC-SHA256 (default, recommended)"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"catena"})," - Catena (memory-hard)"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"use-cases-2",children:"Use Cases"}),"\n",(0,a.jsx)(n.h4,{id:"set-controller-password",children:"Set Controller Password"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'# Generate hash\nHASH=$(rspamadm pw -q)\n\n# Add to local.d/worker-controller.inc\necho "password = \\"$HASH\\";" >> /etc/rspamd/local.d/worker-controller.inc\n\n# Restart Rspamd\nsystemctl restart rspamd\n'})}),"\n",(0,a.jsx)(n.h4,{id:"rotate-passwords",children:"Rotate Passwords"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n# Script to rotate controller password\n\necho "Enter new password:"\nNEW_HASH=$(rspamadm pw -q)\n\n# Backup config\ncp /etc/rspamd/local.d/worker-controller.inc{,.bak}\n\n# Update config\nsed -i "s|password = \\".*\\";|password = \\"$NEW_HASH\\";|" \\\n  /etc/rspamd/local.d/worker-controller.inc\n\n# Test config\nif rspamadm configtest -q; then\n  systemctl restart rspamd\n  echo "Password updated successfully"\nelse\n  # Restore backup\n  mv /etc/rspamd/local.d/worker-controller.inc{.bak,}\n  echo "Configuration error, password not changed"\nfi\n'})}),"\n",(0,a.jsx)(n.h4,{id:"verify-stored-hash",children:"Verify Stored Hash"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'# Check if current password still works\nSTORED_HASH=$(grep password /etc/rspamd/local.d/worker-controller.inc | \\\n  cut -d\'"\' -f2)\n\necho "$STORED_HASH" | rspamadm pw --check -p "current-password"\n'})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"practical-examples",children:"Practical Examples"}),"\n",(0,a.jsx)(n.h3,{id:"complete-secure-configuration-setup",children:"Complete Secure Configuration Setup"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n# Set up secure configuration with encrypted values\n\n# 1. Generate symmetric key for encrypting secrets\necho "=== Generating encryption key ==="\nrspamadm secret_box keygen > /etc/rspamd/secret.key\nchmod 600 /etc/rspamd/secret.key\nSECRET_KEY=$(cat /etc/rspamd/secret.key | cut -d\' \' -f2)\n\n# 2. Generate controller password\necho "=== Generating controller password ==="\nCONTROLLER_HASH=$(rspamadm pw -q)\n\n# 3. Encrypt Redis password\necho "=== Encrypting Redis password ==="\nread -sp "Enter Redis password: " REDIS_PASS\necho\nREDIS_ENCRYPTED=$(echo "$REDIS_PASS" | rspamadm secret_box encrypt -B <<< "$SECRET_KEY")\n\n# 4. Generate keypair for signing\necho "=== Generating signing keypair ==="\nrspamadm keypair -s -o /etc/rspamd/signing.key\n\n# 5. Update configuration\ncat > /etc/rspamd/local.d/options.inc << EOF\n# Secure configuration\nsecret_key = "$SECRET_KEY";\nEOF\n\ncat > /etc/rspamd/local.d/worker-controller.inc << EOF\npassword = "$CONTROLLER_HASH";\nEOF\n\ncat > /etc/rspamd/local.d/redis.conf << EOF\nservers = "localhost";\npassword = "\\$SECRET_BOX{$REDIS_ENCRYPTED}";\nEOF\n\necho "=== Configuration complete ==="\nrspamadm configtest\n'})}),"\n",(0,a.jsx)(n.h3,{id:"encrypting-multiple-configuration-values",children:"Encrypting Multiple Configuration Values"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n# Encrypt multiple sensitive values\n\nKEY=$(rspamadm secret_box keygen | cut -d\' \' -f2)\necho "Encryption key: $KEY" > encryption-key.txt\n\ndeclare -A secrets=(\n  ["clickhouse_password"]="ch_pass_123"\n  ["redis_password"]="redis_pass_456"\n  ["api_key"]="api_key_789"\n)\n\necho "Encrypted values:"\nfor name in "${!secrets[@]}"; do\n  encrypted=$(echo "${secrets[$name]}" | \\\n    rspamadm secret_box encrypt -B <<< "$KEY")\n  echo "$name = \\$SECRET_BOX{$encrypted}"\ndone\n'})}),"\n",(0,a.jsx)(n.h3,{id:"key-rotation-workflow",children:"Key Rotation Workflow"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n# Rotate encryption keys and re-encrypt all secrets\n\nOLD_KEY=$(cat /etc/rspamd/secret.key | cut -d\' \' -f2)\nNEW_KEY=$(rspamadm secret_box keygen | cut -d\' \' -f2)\n\n# List of encrypted values to rotate\nENCRYPTED_VARS=(\n  "clickhouse_password"\n  "redis_password"\n)\n\nfor var in "${ENCRYPTED_VARS[@]}"; do\n  # Extract encrypted value from config\n  encrypted=$(grep "$var" /etc/rspamd/local.d/*.conf | \\\n    cut -d\'{\' -f2 | cut -d\'}\' -f1)\n  \n  # Decrypt with old key\n  decrypted=$(echo "$encrypted" | \\\n    rspamadm secret_box decrypt <<< "$OLD_KEY")\n  \n  # Re-encrypt with new key\n  new_encrypted=$(echo "$decrypted" | \\\n    rspamadm secret_box encrypt -B <<< "$NEW_KEY")\n  \n  echo "Rotated $var"\n  # Update config files (implementation depends on your setup)\ndone\n\n# Save new key\necho "key: $NEW_KEY" > /etc/rspamd/secret.key.new\n'})}),"\n",(0,a.jsx)(n.h3,{id:"interactive-security-setup",children:"Interactive Security Setup"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n# Interactive setup for Rspamd security\n\necho "=== Rspamd Security Setup ==="\n\n# Controller password\necho -e "\\n1. Controller Password"\necho "Enter password for web interface:"\nCONTROLLER_HASH=$(rspamadm pw -q)\necho "Generated hash: $CONTROLLER_HASH"\n\n# Encryption key\necho -e "\\n2. Encryption Key"\nENCRYPTION_KEY=$(rspamadm secret_box keygen | cut -d\' \' -f2)\necho "Generated key: $ENCRYPTION_KEY"\necho "Save this key securely!"\n\n# Signing keypair\necho -e "\\n3. Signing Keypair"\nrspamadm keypair -s -o /etc/rspamd/signing.key\necho "Signing keypair saved to /etc/rspamd/signing.key"\n\n# Summary\necho -e "\\n=== Configuration Summary ==="\ncat << EOF\n\nAdd these to your configuration:\n\n# local.d/worker-controller.inc\npassword = "$CONTROLLER_HASH";\n\n# local.d/options.inc\nsecret_key = "$ENCRYPTION_KEY";\n\n# For encrypted values in config, use:\n\\$SECRET_BOX{<encrypted_value>}\n\nEOF\n'})}),"\n",(0,a.jsx)(n.h2,{id:"tips-and-best-practices",children:"Tips and Best Practices"}),"\n",(0,a.jsx)(n.h3,{id:"key-management",children:"Key Management"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Secure storage"})," - Store keys with 600 permissions, owned by rspamd"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Backup keys"})," - Keep secure backups of all keys"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Rotate regularly"})," - Change passwords and keys periodically"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Document keys"})," - Maintain a secure record of what each key is for"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Separate keys"})," - Use different keys for different purposes"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"password-security",children:"Password Security"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Use strong passwords"})," - Minimum 16 characters, mix of types"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Use pw quietly"})," - Use ",(0,a.jsx)(n.code,{children:"-q"})," flag and capture output"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Avoid command line"})," - Use interactive mode to avoid shell history"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Regular rotation"})," - Change passwords quarterly"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Verify hashes"})," - Test password after setting"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"encryption",children:"Encryption"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Use secret_box for configs"})," - Built-in support in Rspamd"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Base64 for configs"})," - Most compatible encoding"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Document encrypted values"})," - Comment what each is for"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Test decryption"})," - Verify encrypted values work"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Key rotation"})," - Plan for periodic key rotation"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"security",children:"Security"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Protect private keys"})," - Never commit to version control"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Use environment variables"})," - For sensitive runtime values"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Audit access"})," - Monitor who accesses keys"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Principle of least privilege"})," - Only encrypt what's necessary"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Disaster recovery"})," - Have procedures for key loss"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/docs.rspamd.com/branches/master/administration/rspamadm/dkim-management",children:"DKIM Management"})," - DKIM key generation"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/docs.rspamd.com/branches/master/administration/rspamadm/configuration",children:"Configuration"})," - Using encrypted values in config"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/docs.rspamd.com/branches/master/administration/rspamadm/operations",children:"Operations"})," - Controller commands"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}},8453(e,n,r){r.d(n,{R:()=>t,x:()=>c});var s=r(6540);const a={},i=s.createContext(a);function t(e){const n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:t(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);