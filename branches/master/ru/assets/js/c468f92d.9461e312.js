"use strict";(self.webpackChunkrspamd_docs=self.webpackChunkrspamd_docs||[]).push([[7465],{8102:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>o,contentTitle:()=>d,default:()=>a,frontMatter:()=>c,metadata:()=>r,toc:()=>t});const r=JSON.parse('{"id":"modules/hfilter","title":"Hfilter module","description":"The hfilter module is a collection of lightweight checks targeting common problems and bad patterns in SMTP HELO, reverse DNS/hostname, From, recipients, message-id, and message content (URLs). It is used to add small, explainable signals that often correlate with spammy infrastructure or message formatting issues.","source":"@site/docs/modules/hfilter.md","sourceDirName":"modules","slug":"/modules/hfilter","permalink":"/docs.rspamd.com/branches/master/ru/modules/hfilter","draft":false,"unlisted":false,"editUrl":"https://github.com/rspamd/docs.rspamd.com/edit/master/docs/modules/hfilter.md","tags":[],"version":"current","frontMatter":{"title":"Hfilter module"},"sidebar":"docs","previous":{"title":"Greylisting module","permalink":"/docs.rspamd.com/branches/master/ru/modules/greylisting"},"next":{"title":"Redis history module","permalink":"/docs.rspamd.com/branches/master/ru/modules/history_redis"}}');var i=n(4848),l=n(8453);const c={title:"Hfilter module"},d="Hfilter module",o={},t=[{value:"How it works",id:"how-it-works",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Symbols",id:"symbols",level:2},{value:"Notes",id:"notes",level:2}];function h(e){const s={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"hfilter-module",children:"Hfilter module"})}),"\n",(0,i.jsxs)(s.p,{children:["The hfilter module is a collection of lightweight checks targeting common problems and bad patterns in SMTP ",(0,i.jsx)(s.code,{children:"HELO"}),", reverse DNS/hostname, ",(0,i.jsx)(s.code,{children:"From"}),", recipients, message-id, and message content (URLs). It is used to add small, explainable signals that often correlate with spammy infrastructure or message formatting issues."]}),"\n",(0,i.jsx)(s.h2,{id:"how-it-works",children:"How it works"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"HELO checks"}),": detects bare IPs, reserved/internal IPs, and suspicious tokens (e.g. ",(0,i.jsx)(s.code,{children:"dynamic"}),", ",(0,i.jsx)(s.code,{children:"pppoe"}),", ",(0,i.jsx)(s.code,{children:"dhcp"}),"). Also validates FQDN and basic DNS presence for the ",(0,i.jsx)(s.code,{children:"HELO"})," name. Inserts:"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"HFILTER_HELO_BAREIP"}),", ",(0,i.jsx)(s.code,{children:"HFILTER_HELO_BADIP"})]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"HFILTER_HELO_1..5"})," (severity buckets)"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"HFILTER_HELO_NOT_FQDN"}),", ",(0,i.jsx)(s.code,{children:"HFILTER_HELO_NORES_A_OR_MX"}),", ",(0,i.jsx)(s.code,{children:"HFILTER_HELO_NORESOLVE_MX"}),", ",(0,i.jsx)(s.code,{children:"HFILTER_HELO_IP_A"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Hostname (reverse DNS) checks"}),": similar heuristics applied to the connecting host\u2019s name. Inserts:"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"HFILTER_HOSTNAME_1..5"}),", ",(0,i.jsx)(s.code,{children:"HFILTER_HOSTNAME_UNKNOWN"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"URL density checks"}),": flags messages that consist almost entirely of URLs and/or a single line of content. Inserts:"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"HFILTER_URL_ONLY"}),", ",(0,i.jsx)(s.code,{children:"HFILTER_URL_ONELINE"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"From domain checks"}),": validates the sender domain (FQDN/DNS presence) and bounces. Inserts:"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"HFILTER_FROMHOST_NOT_FQDN"}),", ",(0,i.jsx)(s.code,{children:"HFILTER_FROMHOST_NORES_A_OR_MX"}),", ",(0,i.jsx)(s.code,{children:"HFILTER_FROMHOST_NORESOLVE_MX"}),", ",(0,i.jsx)(s.code,{children:"HFILTER_FROM_BOUNCE"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Recipients checks"}),": when bouncing, flags multiple recipients. Inserts:"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.code,{children:"HFILTER_RCPT_BOUNCEMOREONE"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Message-ID checks"}),": validates domain part in the ",(0,i.jsx)(s.code,{children:"Message-Id"}),". Inserts:"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"HFILTER_MID_NOT_FQDN"}),", ",(0,i.jsx)(s.code,{children:"HFILTER_MID_NORES_A_OR_MX"}),", ",(0,i.jsx)(s.code,{children:"HFILTER_MID_NORESOLVE_MX"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"By default, checks are skipped for authenticated senders and local IPs."}),"\n",(0,i.jsx)(s.h2,{id:"configuration",children:"Configuration"}),"\n",(0,i.jsxs)(s.p,{children:["Enable or disable groups of checks in ",(0,i.jsx)(s.code,{children:"local.d/hfilter.conf"}),":"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-hcl",children:"# /etc/rspamd/local.d/hfilter.conf\nhfilter {\n  helo_enabled = true;      # HELO patterns and DNS/FQDN checks\n  hostname_enabled = true;  # reverse DNS/hostname patterns\n  url_enabled = true;       # URL-only / one-line content\n  from_enabled = true;      # MAIL FROM domain checks and bounce\n  rcpt_enabled = true;      # recipient sanity (e.g. bounces to many rcpts)\n  mid_enabled = false;      # Message-Id domain checks\n}\n"})}),"\n",(0,i.jsx)(s.p,{children:"Assign weights in your metrics as desired. Typical setup uses small positive weights for the granular symbols and relies on the aggregate effect:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-hcl",children:'# /etc/rspamd/local.d/metrics.conf\nsymbol "HFILTER_URL_ONLY" { weight = 0.5; group = "hfilter"; }\nsymbol "HFILTER_HELO_5"   { weight = 1.0; group = "hfilter"; }\nsymbol "HFILTER_HOSTNAME_5" { weight = 1.0; group = "hfilter"; }\n'})}),"\n",(0,i.jsx)(s.h2,{id:"symbols",children:"Symbols"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["HELO: ",(0,i.jsx)(s.code,{children:"HFILTER_HELO_BAREIP"}),", ",(0,i.jsx)(s.code,{children:"HFILTER_HELO_BADIP"}),", ",(0,i.jsx)(s.code,{children:"HFILTER_HELO_1..5"}),", ",(0,i.jsx)(s.code,{children:"HFILTER_HELO_NOT_FQDN"}),", ",(0,i.jsx)(s.code,{children:"HFILTER_HELO_NORES_A_OR_MX"}),", ",(0,i.jsx)(s.code,{children:"HFILTER_HELO_NORESOLVE_MX"}),", ",(0,i.jsx)(s.code,{children:"HFILTER_HELO_IP_A"})]}),"\n",(0,i.jsxs)(s.li,{children:["Hostname: ",(0,i.jsx)(s.code,{children:"HFILTER_HOSTNAME_1..5"}),", ",(0,i.jsx)(s.code,{children:"HFILTER_HOSTNAME_UNKNOWN"})]}),"\n",(0,i.jsxs)(s.li,{children:["URL: ",(0,i.jsx)(s.code,{children:"HFILTER_URL_ONLY"}),", ",(0,i.jsx)(s.code,{children:"HFILTER_URL_ONELINE"})]}),"\n",(0,i.jsxs)(s.li,{children:["From: ",(0,i.jsx)(s.code,{children:"HFILTER_FROMHOST_NOT_FQDN"}),", ",(0,i.jsx)(s.code,{children:"HFILTER_FROMHOST_NORES_A_OR_MX"}),", ",(0,i.jsx)(s.code,{children:"HFILTER_FROMHOST_NORESOLVE_MX"}),", ",(0,i.jsx)(s.code,{children:"HFILTER_FROM_BOUNCE"})]}),"\n",(0,i.jsxs)(s.li,{children:["RCPT: ",(0,i.jsx)(s.code,{children:"HFILTER_RCPT_BOUNCEMOREONE"})]}),"\n",(0,i.jsxs)(s.li,{children:["Message-Id: ",(0,i.jsx)(s.code,{children:"HFILTER_MID_NOT_FQDN"}),", ",(0,i.jsx)(s.code,{children:"HFILTER_MID_NORES_A_OR_MX"}),", ",(0,i.jsx)(s.code,{children:"HFILTER_MID_NORESOLVE_MX"})]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"notes",children:"Notes"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"HELO/hostname/From/MID checks perform DNS lookups; timeouts are bounded and tuned internally."}),"\n",(0,i.jsx)(s.li,{children:"Authenticated users and local networks are ignored by default for these checks."}),"\n",(0,i.jsxs)(s.li,{children:["Symbols are placed in the ",(0,i.jsx)(s.code,{children:"hfilter"})," group in metrics; adjust weights to fit your policy."]}),"\n"]})]})}function a(e={}){const{wrapper:s}={...(0,l.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>c,x:()=>d});var r=n(6540);const i={},l=r.createContext(i);function c(e){const s=r.useContext(l);return r.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function d(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),r.createElement(l.Provider,{value:s},e.children)}}}]);