"use strict";(self.webpackChunkrspamd_docs=self.webpackChunkrspamd_docs||[]).push([[3878],{7793(e,n,s){s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>i,default:()=>u,frontMatter:()=>t,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"administration/rspamadm/development","title":"Development & Testing","description":"These commands support development, testing, and advanced debugging of Rspamd.","source":"@site/docs/administration/rspamadm/development.md","sourceDirName":"administration/rspamadm","slug":"/administration/rspamadm/development","permalink":"/docs.rspamd.com/branches/master/ru/administration/rspamadm/development","draft":false,"unlisted":false,"editUrl":"https://github.com/rspamd/docs.rspamd.com/edit/master/docs/administration/rspamadm/development.md","tags":[],"version":"current","frontMatter":{"title":"Development & Testing"},"sidebar":"docs","previous":{"title":"Configuration Management","permalink":"/docs.rspamd.com/branches/master/ru/administration/rspamadm/configuration"},"next":{"title":"GTUBE-like test patterns","permalink":"/docs.rspamd.com/branches/master/ru/other/gtube_patterns"}}');var l=s(4848),r=s(8453);const t={title:"Development & Testing"},i="Development & Testing",o={},d=[{value:"lua",id:"lua",level:2},{value:"Purpose",id:"purpose",level:3},{value:"Common Scenarios",id:"common-scenarios",level:3},{value:"Interactive REPL",id:"interactive-repl",level:4},{value:"Execute Lua Script",id:"execute-lua-script",level:4},{value:"Execute Lua Code",id:"execute-lua-code",level:4},{value:"Batch Mode",id:"batch-mode",level:4},{value:"Pass Arguments",id:"pass-arguments",level:4},{value:"Custom Lua Paths",id:"custom-lua-paths",level:4},{value:"HTTP Server Mode",id:"http-server-mode",level:4},{value:"Options",id:"options",level:3},{value:"Use Cases",id:"use-cases",level:3},{value:"Test Lua Functions",id:"test-lua-functions",level:4},{value:"Debug Module",id:"debug-module",level:4},{value:"Interactive Development",id:"interactive-development",level:4},{value:"corpustest",id:"corpustest",level:2},{value:"Purpose",id:"purpose-1",level:3},{value:"Common Scenarios",id:"common-scenarios-1",level:3},{value:"Process Email Corpus",id:"process-email-corpus",level:4},{value:"Options",id:"options-1",level:3},{value:"Use Cases",id:"use-cases-1",level:3},{value:"Rule Development",id:"rule-development",level:4},{value:"Benchmarking",id:"benchmarking",level:4},{value:"cookie",id:"cookie",level:2},{value:"Purpose",id:"purpose-2",level:3},{value:"Common Scenarios",id:"common-scenarios-2",level:3},{value:"Generate Message ID",id:"generate-message-id",level:4},{value:"Use Cases",id:"use-cases-2",level:3},{value:"Testing",id:"testing",level:4},{value:"publicsuffix",id:"publicsuffix",level:2},{value:"Purpose",id:"purpose-3",level:3},{value:"Common Scenarios",id:"common-scenarios-3",level:3},{value:"Compile Public Suffix List",id:"compile-public-suffix-list",level:4},{value:"Use Cases",id:"use-cases-3",level:3},{value:"Update Public Suffix List",id:"update-public-suffix-list",level:4},{value:"Practical Examples",id:"practical-examples",level:2},{value:"Lua Development Workflow",id:"lua-development-workflow",level:3},{value:"Interactive Testing Session",id:"interactive-testing-session",level:3},{value:"Module Development Helper",id:"module-development-helper",level:3},{value:"Corpus Analysis Script",id:"corpus-analysis-script",level:3},{value:"Lua HTTP Server Example",id:"lua-http-server-example",level:3},{value:"Rule Testing Framework",id:"rule-testing-framework",level:3},{value:"Tips and Best Practices",id:"tips-and-best-practices",level:2},{value:"Lua Development",id:"lua-development",level:3},{value:"Testing",id:"testing-1",level:3},{value:"Development",id:"development",level:3},{value:"Related Documentation",id:"related-documentation",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"development--testing",children:"Development & Testing"})}),"\n",(0,l.jsx)(n.p,{children:"These commands support development, testing, and advanced debugging of Rspamd."}),"\n",(0,l.jsx)(n.h2,{id:"lua",children:"lua"}),"\n",(0,l.jsx)(n.p,{children:"Interactive Lua REPL with Rspamd API access."}),"\n",(0,l.jsx)(n.h3,{id:"purpose",children:"Purpose"}),"\n",(0,l.jsx)(n.p,{children:"Provides a Lua Read-Eval-Print Loop (REPL) with full access to Rspamd's Lua API, enabling testing of Lua code, functions, and modules."}),"\n",(0,l.jsx)(n.h3,{id:"common-scenarios",children:"Common Scenarios"}),"\n",(0,l.jsx)(n.h4,{id:"interactive-repl",children:"Interactive REPL"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Start interactive Lua shell\nrspamadm lua\n"})}),"\n",(0,l.jsx)(n.p,{children:"This gives you a Lua prompt where you can:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Test Lua expressions"}),"\n",(0,l.jsx)(n.li,{children:"Call Rspamd Lua functions"}),"\n",(0,l.jsx)(n.li,{children:"Load and test modules"}),"\n",(0,l.jsx)(n.li,{children:"Experiment with the API"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Example session:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:'> local rspamd_util = require "rspamd_util"\n> local hash = rspamd_util.get_hostname()\n> print(hash)\nlocalhost\n> return 2 + 2\n4\n'})}),"\n",(0,l.jsx)(n.h4,{id:"execute-lua-script",children:"Execute Lua Script"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Run a Lua script\nrspamadm lua -s script.lua\n\n# Run multiple scripts\nrspamadm lua -s init.lua -s main.lua\n"})}),"\n",(0,l.jsx)(n.h4,{id:"execute-lua-code",children:"Execute Lua Code"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Execute Lua code directly\nrspamadm lua -e 'print(\"Hello from Rspamd Lua\")'\n\n# Execute with API\nrspamadm lua -e 'local util = require \"rspamd_util\"; print(util.get_time())'\n"})}),"\n",(0,l.jsx)(n.h4,{id:"batch-mode",children:"Batch Mode"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Non-interactive batch execution\nrspamadm lua -b -s script.lua\n"})}),"\n",(0,l.jsx)(n.h4,{id:"pass-arguments",children:"Pass Arguments"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Pass arguments to Lua script\nrspamadm lua -s script.lua -a arg1 -a arg2 -a arg3\n\n# In script, access via: arg[1], arg[2], arg[3]\n"})}),"\n",(0,l.jsx)(n.h4,{id:"custom-lua-paths",children:"Custom Lua Paths"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Add custom Lua paths\nrspamadm lua -P /path/to/modules -s script.lua\n"})}),"\n",(0,l.jsx)(n.h4,{id:"http-server-mode",children:"HTTP Server Mode"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Start HTTP server serving Lua\nrspamadm lua -S\n\n# Default: http://localhost:8080\n"})}),"\n",(0,l.jsx)(n.p,{children:"Useful for testing HTTP endpoints and handlers."}),"\n",(0,l.jsx)(n.h3,{id:"options",children:"Options"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"-s, --script <file>         Load and execute script\n-P, --path <path>          Add to Lua search path\n-H, --history-file <file>  Readline history file\n-m, --max-history <N>      Max history entries\n-S, --serve                Start HTTP server\n-b, --batch                Batch mode (non-interactive)\n-e, --exec <code>          Execute Lua code\n-a, --args <arg>           Arguments to pass to script\n"})}),"\n",(0,l.jsx)(n.h3,{id:"use-cases",children:"Use Cases"}),"\n",(0,l.jsx)(n.h4,{id:"test-lua-functions",children:"Test Lua Functions"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:'-- test-function.lua\nlocal rspamd_logger = require "rspamd_logger"\nlocal rspamd_util = require "rspamd_util"\n\n-- Test logging\nrspamd_logger.infox("Testing logger")\n\n-- Test utilities\nlocal hostname = rspamd_util.get_hostname()\nprint("Hostname: " .. hostname)\n\n-- Test parsing\nlocal url = require "rspamd_url"\nlocal parsed = url.create("https://example.com/path")\nif parsed then\n  print("Host: " .. tostring(parsed:get_host()))\n  print("Path: " .. tostring(parsed:get_path()))\nend\n'})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"rspamadm lua -s test-function.lua\n"})}),"\n",(0,l.jsx)(n.h4,{id:"debug-module",children:"Debug Module"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:'-- debug-module.lua\nlocal module_name = arg[1] or "dkim_signing"\n\n-- Load module\nlocal module = require("rspamd_plugins." .. module_name)\n\n-- Inspect module\nprint("Module: " .. module_name)\nprint("Module functions:")\nfor k, v in pairs(module) do\n  if type(v) == "function" then\n    print("  - " .. k)\n  end\nend\n'})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"rspamadm lua -s debug-module.lua -a dkim_signing\n"})}),"\n",(0,l.jsx)(n.h4,{id:"interactive-development",children:"Interactive Development"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# Start REPL with custom paths\nrspamadm lua -P /path/to/dev/modules\n\n# In REPL, test your module\n> local my_module = require "my_custom_module"\n> my_module.test_function()\n'})}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"corpustest",children:"corpustest"}),"\n",(0,l.jsx)(n.p,{children:"Test rules against email corpus."}),"\n",(0,l.jsx)(n.h3,{id:"purpose-1",children:"Purpose"}),"\n",(0,l.jsx)(n.p,{children:"Process a corpus of emails and generate logs, useful for testing rules, debugging, and benchmarking."}),"\n",(0,l.jsx)(n.h3,{id:"common-scenarios-1",children:"Common Scenarios"}),"\n",(0,l.jsx)(n.h4,{id:"process-email-corpus",children:"Process Email Corpus"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Process emails and generate logs\nrspamadm corpustest -i /path/to/corpus/*.eml\n\n# Process with specific config\nrspamadm corpustest -c /path/to/rspamd.conf -i corpus/*.eml\n\n# Output to specific directory\nrspamadm corpustest -i corpus/*.eml -o test-logs/\n"})}),"\n",(0,l.jsx)(n.h3,{id:"options-1",children:"Options"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"-c, --config <file>         Config file\n-i, --input <pattern>       Input files (glob pattern)\n-o, --output <dir>          Output directory for logs\n"})}),"\n",(0,l.jsx)(n.h3,{id:"use-cases-1",children:"Use Cases"}),"\n",(0,l.jsx)(n.h4,{id:"rule-development",children:"Rule Development"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n# Test new rule against corpus\n\nCORPUS="/data/test-corpus"\nOUTPUT="/tmp/rule-test"\n\nmkdir -p "$OUTPUT"\n\n# Test with new rule\nrspamadm corpustest \\\n  -c /etc/rspamd/rspamd.conf \\\n  -i "$CORPUS/spam/*.eml" \\\n  -i "$CORPUS/ham/*.eml" \\\n  -o "$OUTPUT"\n\n# Analyze results\necho "=== Rule Statistics ==="\ngrep "MY_NEW_RULE" "$OUTPUT"/* | wc -l\necho "matches"\n\n# Check false positives\ngrep "MY_NEW_RULE" "$OUTPUT"/ham-* | wc -l\necho "false positives"\n'})}),"\n",(0,l.jsx)(n.h4,{id:"benchmarking",children:"Benchmarking"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# Test performance with different configurations\nfor config in base.conf optimized.conf; do\n  echo "Testing $config..."\n  time rspamadm corpustest -c "$config" -i corpus/*.eml > /dev/null\ndone\n'})}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"cookie",children:"cookie"}),"\n",(0,l.jsx)(n.p,{children:"Generate message IDs and cookies."}),"\n",(0,l.jsx)(n.h3,{id:"purpose-2",children:"Purpose"}),"\n",(0,l.jsx)(n.p,{children:"Create unique message identifiers and cryptographic cookies for Rspamd internal use."}),"\n",(0,l.jsx)(n.h3,{id:"common-scenarios-2",children:"Common Scenarios"}),"\n",(0,l.jsx)(n.h4,{id:"generate-message-id",children:"Generate Message ID"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Generate unique message ID\nrspamadm cookie\n\n# Generate multiple\nfor i in {1..5}; do\n  rspamadm cookie\ndone\n"})}),"\n",(0,l.jsx)(n.h3,{id:"use-cases-2",children:"Use Cases"}),"\n",(0,l.jsx)(n.h4,{id:"testing",children:"Testing"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# Generate test message ID for development\nMSG_ID=$(rspamadm cookie)\necho "Message-ID: <$MSG_ID@example.com>"\n'})}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"publicsuffix",children:"publicsuffix"}),"\n",(0,l.jsx)(n.p,{children:"Manage public suffix list."}),"\n",(0,l.jsx)(n.h3,{id:"purpose-3",children:"Purpose"}),"\n",(0,l.jsx)(n.p,{children:"Compile and update the public suffix list used by Rspamd for domain parsing."}),"\n",(0,l.jsx)(n.h3,{id:"common-scenarios-3",children:"Common Scenarios"}),"\n",(0,l.jsx)(n.h4,{id:"compile-public-suffix-list",children:"Compile Public Suffix List"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Compile if needed\nrspamadm publicsuffix compile\n\n# Force recompile\nrm /var/lib/rspamd/publicsuffix.db\nrspamadm publicsuffix compile\n"})}),"\n",(0,l.jsx)(n.h3,{id:"use-cases-3",children:"Use Cases"}),"\n",(0,l.jsx)(n.h4,{id:"update-public-suffix-list",children:"Update Public Suffix List"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"#!/bin/bash\n# Update public suffix list monthly\n\ncd /var/lib/rspamd\n\n# Download latest list\nwget -O public_suffix_list.dat.new \\\n  https://publicsuffix.org/list/public_suffix_list.dat\n\n# Backup current\nmv public_suffix_list.dat public_suffix_list.dat.bak\n\n# Replace\nmv public_suffix_list.dat.new public_suffix_list.dat\n\n# Compile\nrspamadm publicsuffix compile\n\n# Reload Rspamd\nsystemctl reload rspamd\n"})}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"practical-examples",children:"Practical Examples"}),"\n",(0,l.jsx)(n.h3,{id:"lua-development-workflow",children:"Lua Development Workflow"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:'-- test-url-parser.lua\n-- Test URL parsing functionality\n\nlocal rspamd_url = require "rspamd_url"\nlocal rspamd_logger = require "rspamd_logger"\n\nlocal test_urls = {\n  "http://example.com/path?query=value",\n  "https://user:pass@example.com:8080/path",\n  "ftp://files.example.com/file.txt",\n  "mailto:test@example.com"\n}\n\nprint("Testing URL Parser")\nprint("==================")\n\nfor _, url_str in ipairs(test_urls) do\n  local url = rspamd_url.create(url_str)\n  \n  if url then\n    print(string.format("\\nURL: %s", url_str))\n    print(string.format("  Protocol: %s", url:get_protocol()))\n    print(string.format("  Host: %s", url:get_host()))\n    print(string.format("  Port: %s", url:get_port() or "default"))\n    print(string.format("  Path: %s", url:get_path() or "/"))\n    print(string.format("  Query: %s", url:get_query() or "none"))\n  else\n    rspamd_logger.errx("Failed to parse: %s", url_str)\n  end\nend\n'})}),"\n",(0,l.jsx)(n.p,{children:"Run with:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"rspamadm lua -s test-url-parser.lua\n"})}),"\n",(0,l.jsx)(n.h3,{id:"interactive-testing-session",children:"Interactive Testing Session"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# Start REPL\nrspamadm lua\n\n# Load required modules\n> local rspamd_util = require "rspamd_util"\n> local rspamd_text = require "rspamd_text"\n> local rspamd_cryptobox = require "rspamd_cryptobox"\n\n# Test hashing\n> local text = rspamd_text.fromstring("Hello World")\n> local hash = rspamd_cryptobox.hash_hex(text)\n> print(hash)\n\n# Test time functions\n> local ts = rspamd_util.get_time()\n> print(os.date("%Y-%m-%d %H:%M:%S", ts))\n\n# Test hostname\n> print(rspamd_util.get_hostname())\n\n# Exit\n> os.exit()\n'})}),"\n",(0,l.jsx)(n.h3,{id:"module-development-helper",children:"Module Development Helper"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:'-- module-tester.lua\n-- Test custom Rspamd module\n\nlocal module_path = arg[1]\nif not module_path then\n  print("Usage: rspamadm lua -s module-tester.lua -a /path/to/module.lua")\n  os.exit(1)\nend\n\n-- Load module\nlocal module = dofile(module_path)\n\n-- Test if module has required structure\nlocal required_functions = {\n  "register",\n  "configure"\n}\n\nprint("Testing module: " .. module_path)\nprint("==================")\n\nfor _, func_name in ipairs(required_functions) do\n  if type(module[func_name]) == "function" then\n    print(string.format("\u2713 %s() found", func_name))\n  else\n    print(string.format("\u2717 %s() missing", func_name))\n  end\nend\n\n-- List all functions\nprint("\\nAvailable functions:")\nfor k, v in pairs(module) do\n  if type(v) == "function" then\n    print("  - " .. k)\n  end\nend\n\n-- Test module options\nif module.options then\n  print("\\nModule options:")\n  for k, v in pairs(module.options) do\n    print(string.format("  %s = %s", k, tostring(v)))\n  end\nend\n'})}),"\n",(0,l.jsx)(n.h3,{id:"corpus-analysis-script",children:"Corpus Analysis Script"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n# Analyze corpus with custom rules\n\nCORPUS_DIR="/data/test-corpus"\nCONFIG="/etc/rspamd/rspamd.conf"\nRESULTS="/tmp/corpus-results"\n\nrm -rf "$RESULTS"\nmkdir -p "$RESULTS"\n\necho "Processing corpus..."\n\n# Process spam\necho "=== Spam Analysis ==="\nrspamadm corpustest \\\n  -c "$CONFIG" \\\n  -i "$CORPUS_DIR/spam/*.eml" \\\n  -o "$RESULTS/spam"\n\n# Process ham\necho "=== Ham Analysis ==="\nrspamadm corpustest \\\n  -c "$CONFIG" \\\n  -i "$CORPUS_DIR/ham/*.eml" \\\n  -o "$RESULTS/ham"\n\n# Analyze results\necho ""\necho "=== Summary ==="\necho "Spam messages: $(ls $CORPUS_DIR/spam/*.eml | wc -l)"\necho "Ham messages: $(ls $CORPUS_DIR/ham/*.eml | wc -l)"\n\necho ""\necho "=== Top Symbols in Spam ==="\ngrep -h "symbol=" "$RESULTS/spam"/* | \\\n  grep -o \'symbol=[A-Z_]*\' | \\\n  sort | uniq -c | sort -rn | head -20\n\necho ""\necho "=== Top Symbols in Ham ==="\ngrep -h "symbol=" "$RESULTS/ham"/* | \\\n  grep -o \'symbol=[A-Z_]*\' | \\\n  sort | uniq -c | sort -rn | head -20\n'})}),"\n",(0,l.jsx)(n.h3,{id:"lua-http-server-example",children:"Lua HTTP Server Example"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:'-- http-server.lua\n-- Simple HTTP server using Rspamd Lua\n\nlocal rspamd_http = require "rspamd_http"\nlocal rspamd_logger = require "rspamd_logger"\n\nlocal function handle_request(req, res)\n  rspamd_logger.infox("Request: %s %s", req.method, req.path)\n  \n  if req.path == "/" then\n    res:send_response(200, "Hello from Rspamd Lua!")\n  elseif req.path == "/api/info" then\n    local info = {\n      hostname = require("rspamd_util").get_hostname(),\n      time = os.date("%Y-%m-%d %H:%M:%S"),\n      version = "1.0"\n    }\n    res:send_json(info)\n  else\n    res:send_response(404, "Not Found")\n  end\nend\n\nprint("Starting HTTP server on http://localhost:8080")\nprint("Press Ctrl+C to stop")\n\n-- Note: This is conceptual - actual HTTP server mode\n-- uses rspamadm lua -S\n'})}),"\n",(0,l.jsx)(n.h3,{id:"rule-testing-framework",children:"Rule Testing Framework"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:'-- rule-tester.lua\n-- Framework for testing custom rules\n\nlocal rspamd_logger = require "rspamd_logger"\nlocal rspamd_task = require "rspamd_task"\nlocal rspamd_util = require "rspamd_util"\n\nlocal function test_rule(rule_func, test_cases)\n  local passed = 0\n  local failed = 0\n  \n  for _, test in ipairs(test_cases) do\n    -- Create mock task\n    local task = {\n      from = test.from,\n      rcpt = test.rcpt,\n      subject = test.subject\n    }\n    \n    -- Run rule\n    local result = rule_func(task)\n    local expected = test.expected\n    \n    if result == expected then\n      print(string.format("\u2713 %s", test.name))\n      passed = passed + 1\n    else\n      print(string.format("\u2717 %s (got %s, expected %s)", \n            test.name, tostring(result), tostring(expected)))\n      failed = failed + 1\n    end\n  end\n  \n  print(string.format("\\nResults: %d passed, %d failed", passed, failed))\n  return failed == 0\nend\n\n-- Example usage\nlocal function my_rule(task)\n  if task.from and task.from:match("spam") then\n    return true\n  end\n  return false\nend\n\nlocal tests = {\n  {\n    name = "Spam sender",\n    from = "spam@example.com",\n    expected = true\n  },\n  {\n    name = "Legitimate sender",\n    from = "user@example.com",\n    expected = false\n  }\n}\n\ntest_rule(my_rule, tests)\n'})}),"\n",(0,l.jsx)(n.h2,{id:"tips-and-best-practices",children:"Tips and Best Practices"}),"\n",(0,l.jsx)(n.h3,{id:"lua-development",children:"Lua Development"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Use REPL for quick tests"})," - Fastest way to test Lua code"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Load modules interactively"})," - Test API functions live"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Save history"})," - Use ",(0,l.jsx)(n.code,{children:"-H"})," to save REPL history"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Script complex tests"})," - Use ",(0,l.jsx)(n.code,{children:"-s"})," for reproducible tests"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Check API docs"})," - Reference Lua API documentation"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"testing-1",children:"Testing"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Use representative corpus"})," - Test with real emails"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Test both spam and ham"})," - Check for false positives"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Automate testing"})," - Script your test workflows"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Version test data"})," - Keep corpus in version control"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Measure performance"})," - Use ",(0,l.jsx)(n.code,{children:"time"})," to benchmark"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"development",children:"Development"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Iterate quickly"})," - Use Lua REPL for rapid development"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Test incrementally"})," - Test small pieces as you build"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Log extensively"})," - Use rspamd_logger in development"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Use debug mode"})," - Enable verbose logging"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Follow conventions"})," - Match Rspamd's code style"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"/docs.rspamd.com/branches/master/ru/administration/rspamadm/email-analysis",children:"Email Analysis"})," - Analyze messages programmatically"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"/docs.rspamd.com/branches/master/ru/administration/rspamadm/configuration",children:"Configuration"})," - Test configuration changes"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"/lua/index",children:"Lua API"})," - Complete Lua API reference"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"/developers/writing_rules",children:"Writing Rules"})," - Rule development guide"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(c,{...e})}):c(e)}},8453(e,n,s){s.d(n,{R:()=>t,x:()=>i});var a=s(6540);const l={},r=a.createContext(l);function t(e){const n=a.useContext(r);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:t(e.components),a.createElement(r.Provider,{value:n},e.children)}}}]);