"use strict";(self.webpackChunkrspamd_docs=self.webpackChunkrspamd_docs||[]).push([[5110],{7349:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>u,frontMatter:()=>r,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"modules/force_actions","title":"Force Actions module","description":"The purpose of this module is to force an action to be applied if particular symbols are found/not found and optionally return a specified SMTP message. It is available in version 1.5.0 and greater.","source":"@site/docs/modules/force_actions.md","sourceDirName":"modules","slug":"/modules/force_actions","permalink":"/docs.rspamd.com/branches/master/ru/modules/force_actions","draft":false,"unlisted":false,"editUrl":"https://github.com/rspamd/docs.rspamd.com/edit/master/docs/modules/force_actions.md","tags":[],"version":"current","frontMatter":{"title":"Force Actions module"},"sidebar":"docs","previous":{"title":"External Services module","permalink":"/docs.rspamd.com/branches/master/ru/modules/external_services"},"next":{"title":"Fuzzy check module","permalink":"/docs.rspamd.com/branches/master/ru/modules/fuzzy_check"}}');var i=o(4848),t=o(8453);const r={title:"Force Actions module"},c="Force Actions module",a={},d=[{value:"Configuration",id:"configuration",level:2},{value:"Execution Order",id:"execution-order",level:3},{value:"Examples",id:"examples",level:3}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"force-actions-module",children:"Force Actions module"})}),"\n",(0,i.jsx)(n.p,{children:"The purpose of this module is to force an action to be applied if particular symbols are found/not found and optionally return a specified SMTP message. It is available in version 1.5.0 and greater."}),"\n",(0,i.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,i.jsxs)(n.p,{children:["Configuration should be added to ",(0,i.jsx)(n.code,{children:"/etc/rspamd/local.d/force_actions.conf"})]}),"\n",(0,i.jsx)(n.p,{children:"The following elements are valid in the rules of this module:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"action"}),": action to force if the rule matches"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"expression"}),": a symbol or combination of symbols to match on"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"honor_action"}),": actions in this list should not be overridden"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"message"}),": SMTP message to be used by MTA"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"require_action"}),": override action only if metric action in this list"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"subject"}),": subject to set in metric for ",(0,i.jsx)(n.code,{children:"rewrite subject"})," action"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Only one of ",(0,i.jsx)(n.code,{children:"honor_action"})," or ",(0,i.jsx)(n.code,{children:"require_action"})," should be set on a given rule."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"/configuration/composites#composite-expressions",children:"Composite expressions"})," can be used for ",(0,i.jsx)(n.code,{children:"expression"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"/configuration/selectors",children:"Selectors"})," can be used to generate dynamic ",(0,i.jsx)(n.code,{children:"message"}),". The selector expression must be enclosed in ",(0,i.jsx)(n.code,{children:"${}"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"execution-order",children:"Execution Order"}),"\n",(0,i.jsxs)(n.p,{children:["If neither ",(0,i.jsx)(n.code,{children:"require_action"})," nor ",(0,i.jsx)(n.code,{children:"honor"})," is specified, the respective force action symbol is registered as a normal filter with a dependency on all symbols referenced in ",(0,i.jsx)(n.code,{children:"expression"}),".\nIf at least one of ",(0,i.jsx)(n.code,{children:"require_action"})," or ",(0,i.jsx)(n.code,{children:"honor"})," is specified, the respective force action symbol is registered as a post filter.\nFor example, this is important if you want to revert an action that is decided upon the total score, as the action is only updated once all normal filters are completed."]}),"\n",(0,i.jsx)(n.h3,{id:"examples",children:"Examples"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-hcl",children:'# Rules are defined in the rules {} block\nrules {\n\n  # For each condition we want to force an action on we define a rule\n\n  # Rule is given a descriptive name\n  MY_WHITELIST {\n    # This is the action we want to force\n    action = "no action";\n    # If the following combination of symbols is present:\n    expression = "IS_IN_WHITELIST & !CLAM_VIRUS & !FPROT_VIRUS";\n  }\n\n  WHITELIST_EXCEPTION {\n    action = "reject";\n    expression = "IS_IN_WHITELIST & (CLAM_VIRUS | FPROT_VIRUS)";\n    # message setting sets SMTP message returned by mailer\n    message = "Rejected due to suspicion of virus";\n  }\n\n  REJECT_MIME_BAD { \n    action = "reject";\n    expression = "MIME_BAD";\n    # message can contain selector expressions enclosed in ${}\n    message = "(support-id: ${queueid}) Your mail was rejected because it contains BANNED ATTACHMENTS. Please check https://www.example.com/${languages.first}/allowed-attachments.html for further details!"\n  } \n\n  DCC_BULK {\n    action = "rewrite subject";\n    # Here expression is just one symbol\n    expression = "DCC_BULK";\n    # subject setting sets metric subject for rewrite subject action\n    subject = "[BULK] %s";\n    # honor_action setting define actions we don\'t want to override\n    honor_action = ["reject", "soft reject", "add header"];\n  }\n\n  BAYES_SPAM_UPGRADE {\n    action = "add header";\n    expression = "BAYES_SPAM";\n    # require_action setting defines actions that will be overridden\n    require_action = ["no action", "greylist"];\n  }\n\n}\n'})})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},8453:(e,n,o)=>{o.d(n,{R:()=>r,x:()=>c});var s=o(6540);const i={},t=s.createContext(i);function r(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);