"use strict";(self.webpackChunkrspamd_docs=self.webpackChunkrspamd_docs||[]).push([[3609],{6573:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>r,default:()=>u,frontMatter:()=>o,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"tutorials/scanning_outbound","title":"Scanning outbound mail","description":"Why and how to scan outbound mail","source":"@site/docs/tutorials/scanning_outbound.md","sourceDirName":"tutorials","slug":"/tutorials/scanning_outbound","permalink":"/docs.rspamd.com/branches/master/ru/tutorials/scanning_outbound","draft":false,"unlisted":false,"editUrl":"https://github.com/rspamd/docs.rspamd.com/edit/master/docs/tutorials/scanning_outbound.md","tags":[],"version":"current","frontMatter":{"title":"Scanning outbound mail"},"sidebar":"docs","previous":{"title":"Migrating from SpamAssassin","permalink":"/docs.rspamd.com/branches/master/ru/tutorials/migrate_sa"},"next":{"title":"Usage of fuzzy hashes","permalink":"/docs.rspamd.com/branches/master/ru/tutorials/fuzzy_storage"}}');var a=i(4848),t=i(8453);const o={title:"Scanning outbound mail"},r="Scanning outbound mail",d={},c=[{value:"Why and how to scan outbound mail",id:"why-and-how-to-scan-outbound-mail",level:2},{value:"Scanning outbound with Rspamd",id:"scanning-outbound-with-rspamd",level:2},{value:"MTA with milter support (e.g. Postfix or Sendmail)",id:"mta-with-milter-support-eg-postfix-or-sendmail",level:3},{value:"Exim",id:"exim",level:3},{value:"Haraka",id:"haraka",level:3}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"scanning-outbound-mail",children:"Scanning outbound mail"})}),"\n",(0,a.jsx)(n.h2,{id:"why-and-how-to-scan-outbound-mail",children:"Why and how to scan outbound mail"}),"\n",(0,a.jsx)(n.p,{children:"Sending outbound spam can have severe negative consequences on your system's email delivery capabilities. It is crucial to prevent the occurrence of spam and its associated issues. In the event of an outbreak of outbound spam, it may become necessary to initiate incident response measures, such as changing the passwords of affected accounts. Conducting human analysis to verify the authenticity of the spam may also be beneficial, but it is essential to consider privacy laws and company policies, as this analysis could potentially infringe upon them. To determine the appropriate actions for dealing with suspected outbound spam, it is advisable to seek advice from legal experts and involve relevant stakeholders. Please be aware that this document does not offer specific guidance on handling such emails, although it may be expanded in the future to include illustrative strategies."}),"\n",(0,a.jsx)(n.h2,{id:"scanning-outbound-with-rspamd",children:"Scanning outbound with Rspamd"}),"\n",(0,a.jsxs)(n.p,{children:["Rspamd is specifically designed to facilitate straightforward configuration for outbound scanning. With proper ",(0,a.jsx)(n.a,{href:"/tutorials/integration",children:"integration"})," Rspamd  can identify the authenticated user and IP address that a mail was sent from. If mail was received from an authenticated user or an IP address listed in ",(0,a.jsx)(n.a,{href:"/configuration/options",children:"local_addrs"})," several checks are automatically disabled:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/modules/asn",children:"ASN"}),": checking is disabled for local IPs, unless ",(0,a.jsx)(n.code,{children:"check_local"})," is set to ",(0,a.jsx)(n.code,{children:"true"})]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/modules/dkim",children:"DKIM"}),": checking is disabled; signing is ",(0,a.jsx)(n.strong,{children:"enabled"})," on the contrary if the appropriate key and rule are found"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/modules/dmarc",children:"DMARC"}),": is disabled"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/modules/greylisting",children:"Greylist"}),": is disabled"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/modules/hfilter",children:"HFilter"}),": only URL-checks are applied"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/modules/mx_check",children:"MX Check"}),": is disabled"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/modules/once_received",children:"One Received header policy"}),": is disabled"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/modules/ratelimit",children:"Ratelimit"}),": only ",(0,a.jsx)(n.code,{children:"user"})," ratelimit is applied (to authenticated users - does not deal with ",(0,a.jsx)(n.code,{children:"local_addrs"}),")"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/modules/rbl",children:"RBL"}),": RBLs are disabled according to ",(0,a.jsx)(n.code,{children:"exclude_users"})," and ",(0,a.jsx)(n.code,{children:"exclude_local"})," settings for RBL rules (for example, URL lists should be checked for all directions)"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/modules/replies",children:"Replies"}),": action is not forced"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/modules/spf",children:"SPF"}),": is disabled"]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["Additionally, it is possible to disable/enable checks selectively and/or rescore checks for your authenticated users or relay IPs using ",(0,a.jsx)(n.a,{href:"/configuration/settings",children:"settings module"}),"."]}),"\n",(0,a.jsx)(n.h3,{id:"mta-with-milter-support-eg-postfix-or-sendmail",children:"MTA with milter support (e.g. Postfix or Sendmail)"}),"\n",(0,a.jsxs)(n.p,{children:["To enable Rspamd to scan emails sent directly via ",(0,a.jsx)(n.code,{children:"sendmail"})," or other local delivery agents, you can include the ",(0,a.jsx)(n.code,{children:"non_smtpd_milters"})," setting in the configuration. This will direct the Rspamd proxy worker to perform the scanning. Here is an example configuration for Postfix MTA:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"# postfix/main.cf\nsmtpd_milters=inet:127.0.0.1:11332 # For inbound scan or outbound scan via SMTP\nnon_smtpd_milters=inet:127.0.0.1:11332 # For invocation via LDA\n"})}),"\n",(0,a.jsx)(n.h3,{id:"exim",children:"Exim"}),"\n",(0,a.jsx)(n.p,{children:"Here is an example configuration suitable for filtering outbound email."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'# Global options\nspamd_address = 127.0.0.1 11333 variant=rspamd\nacl_smtp_data = acl_check_data\n\nbegin acl\n\nacl_check_data:\n  # Set default value for a variable\n  warn\n    set acl_m_outspam = 0\n  # Always scan mail\n  warn\n    spam = nobody:true\n  # Honor "reject" action for inbound mail...\n  deny\n    ! authenticated = *\n    condition = ${if eq{$spam_action}{reject}}\n    message = Discarded high-probability spam\n  # If it\'s our user set acl_m_outspam = 1 instead\n  warn\n    authenticated = *\n    condition = ${if eq{$spam_action}{reject}}\n    set acl_m_outspam = 1\n  accept\n\nbegin routers\n\n# Apply special handling to messages with $acl_m_outspam==1\nredirect_outbound_spam:\n  driver = redirect\n  condition = ${if eq{$acl_m_outspam}{1}}\n  data = admin@example.com\n# <rest of configuration>\n'})}),"\n",(0,a.jsxs)(n.p,{children:["See the ",(0,a.jsx)(n.a,{href:"https://www.exim.org/exim-html-current/doc/html/spec_html/",children:"Exim specification"})," for more information."]}),"\n",(0,a.jsx)(n.h3,{id:"haraka",children:"Haraka"}),"\n",(0,a.jsxs)(n.p,{children:["To enable scanning of outbound mail set the following in ",(0,a.jsx)(n.code,{children:"config/rspamd.ini"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"[check]\nauthenticated=true\n"})}),"\n",(0,a.jsxs)(n.p,{children:["If you wish to honor ",(0,a.jsx)(n.code,{children:"reject"})," action for authenticated users set the following:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"[reject]\nauthenticated=true\n"})})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>r});var s=i(6540);const a={},t=s.createContext(a);function o(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);