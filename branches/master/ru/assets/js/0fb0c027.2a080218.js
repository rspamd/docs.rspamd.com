"use strict";(self.webpackChunkrspamd_docs=self.webpackChunkrspamd_docs||[]).push([[6447],{2294:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>l,contentTitle:()=>t,default:()=>h,frontMatter:()=>i,metadata:()=>o,toc:()=>d});const o=JSON.parse('{"id":"modules/dcc","title":"DCC module","description":"This modules performs DCC lookups to determine","source":"@site/docs/modules/dcc.md","sourceDirName":"modules","slug":"/modules/dcc","permalink":"/docs.rspamd.com/branches/master/ru/modules/dcc","draft":false,"unlisted":false,"editUrl":"https://github.com/rspamd/docs.rspamd.com/edit/master/docs/modules/dcc.md","tags":[],"version":"current","frontMatter":{"title":"DCC module"},"sidebar":"docs","previous":{"title":"Clickhouse module","permalink":"/docs.rspamd.com/branches/master/ru/modules/clickhouse"},"next":{"title":"DKIM module","permalink":"/docs.rspamd.com/branches/master/ru/modules/dkim"}}');var c=n(4848),r=n(8453);const i={title:"DCC module"},t="DCC module",l={},d=[{value:"Module configuration",id:"module-configuration",level:2}];function a(e){const s={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(s.header,{children:(0,c.jsx)(s.h1,{id:"dcc-module",children:"DCC module"})}),"\n",(0,c.jsxs)(s.p,{children:["This modules performs ",(0,c.jsx)(s.a,{href:"https://www.dcc-servers.net/dcc/",children:"DCC"})," lookups to determine\nthe ",(0,c.jsx)(s.em,{children:"bulkiness"})," of a message (e.g. how many recipients have seen it)."]}),"\n",(0,c.jsx)(s.p,{children:"This information, which indicates how many recipients have seen the message, is useful for identifying bulk messages in composite rules.\nFor example, if a message is from a freemail domain and is reported as bulk by DCC, it is likely to be spam and can be assigned a higher weight."}),"\n",(0,c.jsx)(s.p,{children:"Before enabling this module, please make sure to review the License terms on the DCC website."}),"\n",(0,c.jsx)(s.h2,{id:"module-configuration",children:"Module configuration"}),"\n",(0,c.jsxs)(s.p,{children:["To use the ",(0,c.jsx)(s.code,{children:"dccifd"})," module, you must have the ",(0,c.jsx)(s.code,{children:"dccifd"})," daemon properly configured, installed, and running. To do this, follow these steps:"]}),"\n",(0,c.jsxs)(s.ol,{children:["\n",(0,c.jsxs)(s.li,{children:["Download and build the latest DCC client from the ",(0,c.jsx)(s.a,{href:"https://www.dcc-servers.net/dcc/source/dcc.tar.Z",children:"latest DCC client"}),"."]}),"\n",(0,c.jsxs)(s.li,{children:["Edit the ",(0,c.jsx)(s.code,{children:"/var/dcc/dcc_conf"})," file, setting ",(0,c.jsx)(s.code,{children:"DCCIFD_ENABLE=on"}),", ",(0,c.jsx)(s.code,{children:"DCCM_LOG_AT=NEVER"})," and\n",(0,c.jsx)(s.code,{children:"DCCM_REJECT_AT=MANY"}),"."]}),"\n",(0,c.jsxs)(s.li,{children:["Start the daemon by running ",(0,c.jsx)(s.code,{children:"/var/dcc/libexec/rcDCC start"}),"."]}),"\n"]}),"\n",(0,c.jsxs)(s.p,{children:["Once the ",(0,c.jsx)(s.code,{children:"dccifd"}),", it will listen on the UNIX domain socket /var/dcc/dccifd.\nTo complete the setup, simply inform rspamd of the location where the ",(0,c.jsx)(s.code,{children:"dccifd"})," is listening:"]}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-hcl",children:"# local.d/dcc.conf\n\nenabled = true; # Required as default is to disable DCC plugin\n\n# Define local socket or TCP servers in upstreams syntax\n# When sockets and servers are defined - servers is used!\n\nservers = \"/var/dcc/dccifd\"; # Unix socket\n#servers = \"127.0.0.1:10045\" # OR TCP upstreams\nbody_max = 999999; # Bulkness threshold for body\nfuz1_max = 999999; # Bulkness threshold for fuz1\nfuz2_max = 999999; # Bulkness threshold for fuz2\nsymbol_fail = 'DCC_FAIL';\nsymbol = 'DCC_REJECT';\nsymbol_bulk = 'DCC_BULK';\ntimeout = 5.0; # Timeout to wait for checks\nlog_clean = false;\nretransmits = 2;\n"})}),"\n",(0,c.jsxs)(s.ol,{children:["\n",(0,c.jsxs)(s.li,{children:[(0,c.jsx)(s.code,{children:"enabled = true;"}),": Enable the DCC plugin (default is disabled)."]}),"\n",(0,c.jsxs)(s.li,{children:[(0,c.jsx)(s.code,{children:"servers"}),": Define local socket or TCP servers in the upstream syntax.\na. ",(0,c.jsx)(s.code,{children:'servers = "/var/dcc/dccifd";'}),": Specify the Unix socket for communication with the DCC server.\nb. ",(0,c.jsx)(s.code,{children:'#servers = "127.0.0.1:10045"'}),": (Commented) Alternative TCP upstream for communication with the DCC server."]}),"\n",(0,c.jsxs)(s.li,{children:[(0,c.jsx)(s.code,{children:"body_max"}),", ",(0,c.jsx)(s.code,{children:"fuz1_max"}),", and ",(0,c.jsx)(s.code,{children:"fuz2_max"}),": Set bulkiness thresholds for body, fuz1, and fuz2, respectively (all set to 999999)."]}),"\n",(0,c.jsxs)(s.li,{children:[(0,c.jsx)(s.code,{children:"symbol_fail = 'DCC_FAIL';"}),": Set symbol for a failed DCC check."]}),"\n",(0,c.jsxs)(s.li,{children:[(0,c.jsx)(s.code,{children:"symbol = 'DCC_REJECT';"}),": Set symbol for a successful DCC check with spam result."]}),"\n",(0,c.jsxs)(s.li,{children:[(0,c.jsx)(s.code,{children:"symbol_bulk = 'DCC_BULK';"}),": Set symbol for a successful DCC check with bulk result."]}),"\n",(0,c.jsxs)(s.li,{children:[(0,c.jsx)(s.code,{children:"timeout = 5.0;"}),": Set timeout for DCC checks (5 seconds)."]}),"\n",(0,c.jsxs)(s.li,{children:[(0,c.jsx)(s.code,{children:"log_clean = false;"}),": Disable logging for clean emails (not spam or bulk) that pass the DCC check."]}),"\n",(0,c.jsxs)(s.li,{children:[(0,c.jsx)(s.code,{children:"retransmits = 2;"}),": Set the number of allowed retransmits for the DCC check."]}),"\n"]}),"\n",(0,c.jsxs)(s.p,{children:["If you prefer, you can configure DCC to listen to a TCP socket on localhost or any remote server. For detailed configuration instructions, refer to the DCC manual. The following configuration line sets up DCCIFD to listen on localhost port 10045 and allows queries from the IP range ",(0,c.jsx)(s.code,{children:"127.0.0.1/8"}),":\n",(0,c.jsx)(s.code,{children:'DCCIFD_ARGS="-SHELO -Smail_host -SSender -SList-ID -p *,10045,127.0.0.0/8"'})]})]})}function h(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,c.jsx)(s,{...e,children:(0,c.jsx)(a,{...e})}):a(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>i,x:()=>t});var o=n(6540);const c={},r=o.createContext(c);function i(e){const s=o.useContext(r);return o.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function t(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:i(e.components),o.createElement(r.Provider,{value:s},e.children)}}}]);