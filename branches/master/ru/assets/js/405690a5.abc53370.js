"use strict";(self.webpackChunkrspamd_docs=self.webpackChunkrspamd_docs||[]).push([[1695],{1373:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"tutorials/migrate_sa","title":"Migrating from SpamAssassin","description":"This guide explains how to migrate an existing SpamAssassin (SA) setup to Rspamd. It focuses on practical steps, key differences, and safe rollout.","source":"@site/docs/tutorials/migrate_sa.md","sourceDirName":"tutorials","slug":"/tutorials/migrate_sa","permalink":"/docs.rspamd.com/branches/master/ru/tutorials/migrate_sa","draft":false,"unlisted":false,"editUrl":"https://github.com/rspamd/docs.rspamd.com/edit/master/docs/tutorials/migrate_sa.md","tags":[],"version":"current","frontMatter":{"title":"Migrating from SpamAssassin"},"sidebar":"docs","previous":{"title":"Upgrading","permalink":"/docs.rspamd.com/branches/master/ru/tutorials/migration"},"next":{"title":"Scanning outbound mail","permalink":"/docs.rspamd.com/branches/master/ru/tutorials/scanning_outbound"}}');var a=n(4848),t=n(8453);const r={title:"Migrating from SpamAssassin"},l="Migrating from SpamAssassin to Rspamd",o={},d=[{value:"At a glance",id:"at-a-glance",level:2},{value:"Migration checklist",id:"migration-checklist",level:2},{value:"Key differences from SpamAssassin",id:"key-differences-from-spamassassin",level:2},{value:"Integrating Rspamd",id:"integrating-rspamd",level:2},{value:"Migrating rules (optional)",id:"migrating-rules-optional",level:2},{value:"Statistics and training",id:"statistics-and-training",level:2},{value:"Learning by email (optional)",id:"learning-by-email-optional",level:3},{value:"Mapping SA concepts to Rspamd",id:"mapping-sa-concepts-to-rspamd",level:2},{value:"Rollout strategy",id:"rollout-strategy",level:2},{value:"Troubleshooting and pitfalls",id:"troubleshooting-and-pitfalls",level:2},{value:"See also",id:"see-also",level:2}];function c(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.header,{children:(0,a.jsx)(s.h1,{id:"migrating-from-spamassassin-to-rspamd",children:"Migrating from SpamAssassin to Rspamd"})}),"\n",(0,a.jsx)(s.p,{children:"This guide explains how to migrate an existing SpamAssassin (SA) setup to Rspamd. It focuses on practical steps, key differences, and safe rollout."}),"\n",(0,a.jsx)(s.h2,{id:"at-a-glance",children:"At a glance"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:"Performance: Rspamd is typically much faster and more resource\u2011efficient than SA."}),"\n",(0,a.jsxs)(s.li,{children:["Rules: Many SA checks exist natively in Rspamd. Optional SA rules import is available via the ",(0,a.jsx)(s.code,{children:"spamassassin"})," module."]}),"\n",(0,a.jsxs)(s.li,{children:["Actions vs. score: Rspamd recommends actions (",(0,a.jsx)(s.code,{children:"no action"})," \u2192 ",(0,a.jsx)(s.code,{children:"greylist"})," \u2192 ",(0,a.jsx)(s.code,{children:"add header"})," \u2192 ",(0,a.jsx)(s.code,{children:"rewrite subject"})," \u2192 ",(0,a.jsx)(s.code,{children:"reject"}),") that your MTA applies."]}),"\n",(0,a.jsx)(s.li,{children:"Stats: SA Bayes data cannot be reused; you must retrain Rspamd statistics."}),"\n"]}),"\n",(0,a.jsx)(s.h2,{id:"migration-checklist",children:"Migration checklist"}),"\n",(0,a.jsxs)(s.ol,{children:["\n",(0,a.jsxs)(s.li,{children:["Install Rspamd using official packages (",(0,a.jsx)(s.code,{children:"/downloads"}),")."]}),"\n",(0,a.jsxs)(s.li,{children:["Integrate with your MTA: see ",(0,a.jsx)(s.a,{href:"/tutorials/integration",children:"MTA integration"})," for Postfix, Exim, Sendmail and HTTP options."]}),"\n",(0,a.jsxs)(s.li,{children:["Configure Redis and statistics: see ",(0,a.jsx)(s.a,{href:"/configuration/statistic",children:"Statistics settings"}),". Keep defaults unless you know what to change."]}),"\n",(0,a.jsxs)(s.li,{children:["Decide on SA rules migration:\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:"Prefer native Rspamd modules and rules out\u2011of\u2011the\u2011box."}),"\n",(0,a.jsxs)(s.li,{children:["If you rely on custom SA rules, use the ",(0,a.jsx)(s.a,{href:"/modules/spamassassin",children:"SpamAssassin rules module"}),"."]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(s.li,{children:"Train statistics with your corpora (ham/spam) and/or enable autolearn."}),"\n",(0,a.jsx)(s.li,{children:"Stage rollout: mirror traffic, test thresholds, then switch production."}),"\n"]}),"\n",(0,a.jsx)(s.h2,{id:"key-differences-from-spamassassin",children:"Key differences from SpamAssassin"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:"Engine: Rspamd is modular (Lua/C) with asynchronous I/O and Redis; SA is Perl\u2011based."}),"\n",(0,a.jsx)(s.li,{children:"Verdict: Rspamd provides actions for the MTA; SA typically marks as spam/ham."}),"\n",(0,a.jsx)(s.li,{children:"Policy: Rspamd combines multiple modules (DKIM, DMARC, SURBLs, fuzzy, Bayes, etc.) by default."}),"\n",(0,a.jsx)(s.li,{children:"Config: HCL\u2011style files and Lua; native WebUI for monitoring and control."}),"\n"]}),"\n",(0,a.jsx)(s.h2,{id:"integrating-rspamd",children:"Integrating Rspamd"}),"\n",(0,a.jsxs)(s.p,{children:["Use the guide at ",(0,a.jsx)(s.a,{href:"/tutorials/integration",children:"MTA integration"}),". Recommended patterns:"]}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:"Postfix/Sendmail: milter mode via Rspamd proxy worker."}),"\n",(0,a.jsx)(s.li,{children:"Exim and HTTP\u2011capable MTAs: HTTP JSON integration."}),"\n",(0,a.jsxs)(s.li,{children:["LDA mode: deliver via ",(0,a.jsx)(s.code,{children:"rspamc --mime --exec"})," to add headers and operate per\u2011user statistics."]}),"\n"]}),"\n",(0,a.jsx)(s.h2,{id:"migrating-rules-optional",children:"Migrating rules (optional)"}),"\n",(0,a.jsxs)(s.p,{children:["If you need SA rules compatibility, enable the ",(0,a.jsx)(s.code,{children:"spamassassin"})," module. Prefer native Rspamd features where possible for performance and quality."]}),"\n",(0,a.jsxs)(s.p,{children:["Example minimal configuration (see full options at ",(0,a.jsx)(s.a,{href:"/modules/spamassassin",children:"/modules/spamassassin"}),"):"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-hcl",children:'spamassassin {\n\t# One or more SA rules files or globs\n\truleset = "/path/to/rules/*.cf";\n\t# Optionally include baseline SA rules\n\tbase_ruleset = "/var/db/spamassassin/*/*.cf";\n\t# Optional tuning\n\tmatch_limit = 100k; # limit regex search window\n}\n'})}),"\n",(0,a.jsx)(s.p,{children:"Notes:"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:"Rspamd optimizes SA rules; some plugins/functions are not supported. See the module doc for limits and performance notes."}),"\n",(0,a.jsx)(s.li,{children:"Prefer keeping only the custom rules you truly need."}),"\n"]}),"\n",(0,a.jsx)(s.h2,{id:"statistics-and-training",children:"Statistics and training"}),"\n",(0,a.jsx)(s.p,{children:"Rspamd uses a different statistical algorithm and storage; SA Bayes cannot be imported. Configure and train as follows:"}),"\n",(0,a.jsxs)(s.ol,{children:["\n",(0,a.jsx)(s.li,{children:"Ensure Redis is available and reachable by Rspamd."}),"\n",(0,a.jsxs)(s.li,{children:["Use the default Bayes classifier in ",(0,a.jsx)(s.code,{children:"$CONFDIR/statistic.conf"})," (or ",(0,a.jsx)(s.code,{children:"classifier-bayes.conf"}),"). See ",(0,a.jsx)(s.a,{href:"/configuration/statistic",children:"Statistics settings"}),"."]}),"\n",(0,a.jsx)(s.li,{children:"Initial training from corpora (Maildir\u2011like directories):"}),"\n"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{children:"rspamc learn_ham /path/to/ham\nrspamc learn_spam /path/to/spam\n"})}),"\n",(0,a.jsxs)(s.ol,{start:"4",children:["\n",(0,a.jsxs)(s.li,{children:["Optionally enable autolearn in ",(0,a.jsx)(s.code,{children:"classifier-bayes.conf"}),":"]}),"\n"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-hcl",children:"autolearn {\n\tspam_threshold = 6.0;\n\tham_threshold = -0.5;\n\tcheck_balance = true;\n}\n"})}),"\n",(0,a.jsxs)(s.ol,{start:"5",children:["\n",(0,a.jsxs)(s.li,{children:["Maintain statistics expiry with the ",(0,a.jsxs)(s.a,{href:"/modules/bayes_expiry",children:[(0,a.jsx)(s.code,{children:"bayes_expiry"})," module"]}),"."]}),"\n"]}),"\n",(0,a.jsx)(s.h3,{id:"learning-by-email-optional",children:"Learning by email (optional)"}),"\n",(0,a.jsxs)(s.p,{children:["You can expose aliases to feed samples to ",(0,a.jsx)(s.code,{children:"rspamc"}),":"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{children:'learn-spam-<secret>: "| rspamc learn_spam"\nlearn-ham-<secret>:  "| rspamc learn_ham"\n'})}),"\n",(0,a.jsx)(s.p,{children:"Use unpredictable aliases to prevent abuse and pollution."}),"\n",(0,a.jsx)(s.h2,{id:"mapping-sa-concepts-to-rspamd",children:"Mapping SA concepts to Rspamd"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:"SA \u201cspam\u201d \u2248 Rspamd \u201cadd header\u201d by default. Consider your users\u2019 workflows when choosing action thresholds."}),"\n",(0,a.jsx)(s.li,{children:"SA network plugins like Razor/Pyzor/DCC are not used by Rspamd; similar functionality exists via native RBLs, fuzzy checks, reputation and URL checks."}),"\n",(0,a.jsx)(s.li,{children:"Meta rules are supported; some SA plugins are unsupported\u2014see module docs."}),"\n"]}),"\n",(0,a.jsx)(s.h2,{id:"rollout-strategy",children:"Rollout strategy"}),"\n",(0,a.jsxs)(s.ol,{children:["\n",(0,a.jsx)(s.li,{children:"Shadow run: run Rspamd alongside SA and compare headers/reports."}),"\n",(0,a.jsx)(s.li,{children:"Tune actions: adjust thresholds to meet your FP/FN targets."}),"\n",(0,a.jsx)(s.li,{children:"Cutover: switch the MTA content filter to Rspamd, keep SA disabled but available for fallback."}),"\n",(0,a.jsx)(s.li,{children:"Monitor: use WebUI, logs and metrics; review BAYES_* rates and autolearn balance."}),"\n"]}),"\n",(0,a.jsx)(s.h2,{id:"troubleshooting-and-pitfalls",children:"Troubleshooting and pitfalls"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:"Incompatible Bayes: do not attempt to import SA Bayes; retrain."}),"\n",(0,a.jsx)(s.li,{children:"Excess SA rule load: importing the entire SA ruleset can slow Rspamd\u2014migrate only necessary custom rules."}),"\n",(0,a.jsx)(s.li,{children:"Missing Redis: statistics and some features rely on Redis; ensure connectivity and authentication."}),"\n",(0,a.jsx)(s.li,{children:"Multi\u2011recipient mail with per\u2011user stats: prefer LDA mode to avoid attributing to the wrong user."}),"\n"]}),"\n",(0,a.jsx)(s.h2,{id:"see-also",children:"See also"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.a,{href:"/tutorials/integration",children:"MTA integration"})}),"\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.a,{href:"/configuration/statistic",children:"Statistics settings"})}),"\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.a,{href:"/modules/bayes_expiry",children:"Bayes expiry module"})}),"\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.a,{href:"/modules/spamassassin",children:"SpamAssassin rules module"})}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,a.jsx)(s,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>r,x:()=>l});var i=n(6540);const a={},t=i.createContext(a);function r(e){const s=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),i.createElement(t.Provider,{value:s},e.children)}}}]);