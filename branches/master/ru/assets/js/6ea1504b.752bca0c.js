"use strict";(self.webpackChunkrspamd_docs=self.webpackChunkrspamd_docs||[]).push([[8291],{2778:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>a,contentTitle:()=>i,default:()=>p,frontMatter:()=>c,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"modules/metric_exporter","title":"Metric exporter","description":"Metric exporter collects statistics from Rspamd and feeds them to external monitoring/graphing systems.","source":"@site/docs/modules/metric_exporter.md","sourceDirName":"modules","slug":"/modules/metric_exporter","permalink":"/docs.rspamd.com/branches/master/ru/modules/metric_exporter","draft":false,"unlisted":false,"editUrl":"https://github.com/rspamd/docs.rspamd.com/edit/master/docs/modules/metric_exporter.md","tags":[],"version":"current","frontMatter":{"title":"Metric exporter"},"sidebar":"docs","previous":{"title":"Metadata exporter","permalink":"/docs.rspamd.com/branches/master/ru/modules/metadata_exporter"},"next":{"title":"MID module","permalink":"/docs.rspamd.com/branches/master/ru/modules/mid"}}');var o=n(74848),s=n(28453);const c={title:"Metric exporter"},i="Metric exporter",a={},d=[{value:"Configuration",id:"configuration",level:3}];function l(e){const t={a:"a",code:"code",h1:"h1",h3:"h3",header:"header",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.header,{children:(0,o.jsx)(t.h1,{id:"metric-exporter",children:"Metric exporter"})}),"\n",(0,o.jsxs)(t.p,{children:["Metric exporter collects statistics from Rspamd and feeds them to external monitoring/graphing systems.\n",(0,o.jsx)(t.a,{href:"https://graphiteapp.org/",children:"Graphite"})," is the only supported backend for now."]}),"\n",(0,o.jsxs)(t.p,{children:["Besides, if you want to use ",(0,o.jsx)(t.code,{children:"pull"})," model to collect statistics from Rspamd, we provide support for ",(0,o.jsx)(t.a,{href:"https://prometheus.io/",children:"Prometheus"})," endpoint.\nPlease have a look at ",(0,o.jsx)(t.a,{href:"/workers/controller",children:"Controller worker"})," and ",(0,o.jsx)(t.a,{href:"/developers/protocol#controller-http-endpoints",children:"Controller HTTP endpoints"}),"\nfor further information."]}),"\n",(0,o.jsx)(t.h3,{id:"configuration",children:"Configuration"}),"\n",(0,o.jsxs)(t.p,{children:["Non-backend-specific settings are shown below. Configuration could be added to ",(0,o.jsx)(t.code,{children:"/etc/rspamd/local.d/metric_exporter.conf"}),":"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-hcl",children:'# Backend: just "graphite" for now - MUST be set\nbackend = "graphite";\n# List of metrics to export - MUST be set.\n# See next section for list of metrics\nmetrics = [\n  "ham_count",\n  "spam_count",\n];\n# Below settings are optional and values shown will be used as defaults if these are unset:\n# Statefile: Path to file at which to persist last run information\nstatefile = "$DBDIR/metric_exporter_last_push";\n# Timeout in seconds for pushing stats to backend\ntimeout = 15;\n# Interval in seconds at which stats should be pushed\ninterval = 120;\n'})}),"\n",(0,o.jsx)(t.p,{children:"Metrics which may be exported are as follows:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:'metrics = [\n  "actions.add header",\n  "actions.greylist",\n  "actions.no action",\n  "actions.reject",\n  "actions.rewrite subject",\n  "actions.soft reject",\n  "bytes_allocated",\n  "chunks_allocated",\n  "chunks_freed",\n  "chunks_oversized",\n  "connections",\n  "control_connections",\n  "ham_count",\n  "learned",\n  "pools_allocated",\n  "pools_freed",\n  "scanned",\n  "shared_chunks_allocated",\n  "spam_count"\n];\n'})}),"\n",(0,o.jsx)(t.p,{children:"Additionally, backend-specific settings may be set. Graphite-specific settings are shown below:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-hcl",children:'# Hostname for Carbon: "localhost" if unset\nhost = "localhost";\n# Port for Carbon: 2003 if unset\nport = 2003;\n# Prefix for metric names: "rspamd" if unset\nmetric_prefix = "rspamd";\n'})})]})}function p(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>c,x:()=>i});var r=n(96540);const o={},s=r.createContext(o);function c(e){const t=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:c(e.components),r.createElement(s.Provider,{value:t},e.children)}}}]);