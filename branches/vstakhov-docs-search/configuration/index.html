<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-configuration/index" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Rspamd configuration | Rspamd Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://rspamd.com/docs.rspamd.com/branches/vstakhov-docs-search/configuration/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="ru"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Rspamd configuration | Rspamd Documentation"><meta data-rh="true" name="description" content="{:.no_toc}"><meta data-rh="true" property="og:description" content="{:.no_toc}"><link data-rh="true" rel="icon" href="/docs.rspamd.com/branches/vstakhov-docs-search/img/favicon.png"><link data-rh="true" rel="canonical" href="https://rspamd.com/docs.rspamd.com/branches/vstakhov-docs-search/configuration/"><link data-rh="true" rel="alternate" href="https://rspamd.com/docs.rspamd.com/branches/vstakhov-docs-search/configuration/" hreflang="en"><link data-rh="true" rel="alternate" href="https://rspamd.com/docs.rspamd.com/branches/vstakhov-docs-search/ru/configuration/" hreflang="ru"><link data-rh="true" rel="alternate" href="https://rspamd.com/docs.rspamd.com/branches/vstakhov-docs-search/configuration/" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Configuration","item":"https://rspamd.com/docs.rspamd.com/branches/vstakhov-docs-search/configuration/"}]}</script><link rel="alternate" type="application/rss+xml" href="/docs.rspamd.com/branches/vstakhov-docs-search/blog/rss.xml" title="Rspamd Documentation RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/docs.rspamd.com/branches/vstakhov-docs-search/blog/atom.xml" title="Rspamd Documentation Atom Feed">




<script>window.SEARCH_BACKEND_CONFIG={endpoint:"/api"}</script><link rel="stylesheet" href="/docs.rspamd.com/branches/vstakhov-docs-search/assets/css/styles.121a41fd.css">
<script src="/docs.rspamd.com/branches/vstakhov-docs-search/assets/js/runtime~main.d53a0eba.js" defer="defer"></script>
<script src="/docs.rspamd.com/branches/vstakhov-docs-search/assets/js/main.64722b56.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/docs.rspamd.com/branches/vstakhov-docs-search/img/rspamd_logo_black.png"><link rel="preload" as="image" href="/docs.rspamd.com/branches/vstakhov-docs-search/img/rspamd_logo_navbar.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://www.rspamd.com" target="_self" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/docs.rspamd.com/branches/vstakhov-docs-search/img/rspamd_logo_black.png" alt="Rspamd Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/docs.rspamd.com/branches/vstakhov-docs-search/img/rspamd_logo_navbar.png" alt="Rspamd Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs.rspamd.com/branches/vstakhov-docs-search/">Documentation</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs.rspamd.com/branches/vstakhov-docs-search/about/">About</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs.rspamd.com/branches/vstakhov-docs-search/tutorials/">Tutorials</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/">Modules</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs.rspamd.com/branches/vstakhov-docs-search/other/usage_policy">Usage Policy</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs.rspamd.com/branches/vstakhov-docs-search/faq">FAQ</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs.rspamd.com/branches/vstakhov-docs-search/support">Support</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs.rspamd.com/branches/vstakhov-docs-search/downloads">Downloads</a><a class="navbar__item navbar__link" href="/docs.rspamd.com/branches/vstakhov-docs-search/blog">Blog</a><a class="navbar__item navbar__link" href="/docs.rspamd.com/branches/vstakhov-docs-search/changelog">Changelog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div><div class="elasticsearch-search-container"><form class="elasticsearch-search-form"><div class="elasticsearch-search-input-container"><input type="text" placeholder="Search documentation..." class="elasticsearch-search-input" aria-label="Search documentation" value=""><div class="elasticsearch-search-shortcut"><span>⌘K</span></div></div></form></div></div><div class="navbar__item"><div id="font-size-control-mount"></div></div><a href="https://github.com/rspamd/rspamd" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs.rspamd.com/branches/vstakhov-docs-search/">About Rspamd</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs.rspamd.com/branches/vstakhov-docs-search/faq">Frequently asked questions</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs.rspamd.com/branches/vstakhov-docs-search/about/">About</a><button aria-label="Expand sidebar category &#x27;About&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs.rspamd.com/branches/vstakhov-docs-search/support">Rspamd Support</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs.rspamd.com/branches/vstakhov-docs-search/downloads">Downloads</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible menu__list-item-collapsible--active"><a class="menu__link menu__link--sublist menu__link--active" aria-current="page" href="/docs.rspamd.com/branches/vstakhov-docs-search/configuration/">Configuration</a><button aria-label="Collapse sidebar category &#x27;Configuration&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/configuration/settings">User settings</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/configuration/metrics">Actions and scores</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/configuration/logging">Logging settings</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/configuration/options">Common options</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/configuration/composites">Composite symbols</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/configuration/maps">Rspamd maps</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/configuration/selectors">Selectors</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/configuration/statistic">Statistics settings</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/configuration/redis">Redis configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/configuration/upstream">Upstreams configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/configuration/ucl">Universal configuration language (UCL)</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs.rspamd.com/branches/vstakhov-docs-search/workers/">Workers</a><button aria-label="Expand sidebar category &#x27;Workers&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/">Modules</a><button aria-label="Expand sidebar category &#x27;Modules&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs.rspamd.com/branches/vstakhov-docs-search/lua/">Lua API</a><button aria-label="Expand sidebar category &#x27;Lua API&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs.rspamd.com/branches/vstakhov-docs-search/tutorials/">Tutorials</a><button aria-label="Expand sidebar category &#x27;Tutorials&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs.rspamd.com/branches/vstakhov-docs-search/developers/architecture">Developers</a><button aria-label="Expand sidebar category &#x27;Developers&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs.rspamd.com/branches/vstakhov-docs-search/other/rspamadm">Other</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs.rspamd.com/branches/vstakhov-docs-search/blog">Blog</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/docs.rspamd.com/branches/vstakhov-docs-search/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Configuration</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Rspamd configuration</h1></header>
<p>{:.no_toc}</p>
<p>Rspamd employs the Universal Configuration Language (UCL) for its configuration. You can find an extensive description of the UCL format in this <a href="/docs.rspamd.com/branches/vstakhov-docs-search/configuration/ucl">document</a>. Additionally, Rspamd introduces a range of variables and macros to enhance UCL&#x27;s functionality.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="ucl-sections-and-includes">UCL sections and includes<a href="#ucl-sections-and-includes" class="hash-link" aria-label="Direct link to UCL sections and includes" title="Direct link to UCL sections and includes">​</a></h2>
<p>UCL adopts the JSON data model, although Rspamd&#x27;s documentation frequently refers to <code>sections</code>. Consider these sections as straightforward sub-objects of the main object. For instance, the following two definitions are equivalent in both <code>UCL</code> and <code>JSON</code> syntax:</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">section &quot;foo&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    opt = 10;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>vs</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;section&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;foo&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;opt&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>UCL also offers support for the <code>.include</code> macro, a feature heavily utilized in Rspamd&#x27;s configuration. This macro allows the inclusion of other files, enabling the definition of override or merge strategies, establishment of new element priorities, and other beneficial operations. Throughout Rspamd&#x27;s configuration, nearly all sections are followed by two or three include directives. The following overview outlines how the include macro is employed in Rspamd, while further elaboration can be found in the <a href="/docs.rspamd.com/branches/vstakhov-docs-search/configuration/ucl#macros-support">Macros Support</a> section of the UCL documentation.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">.include(param=value,param=value) &quot;filename&quot;</span><br></span></code></pre></div></div>
<p>Param/value arguments represent options, often referred to as policies, that are applicable to the included file.</p>
<p>The &quot;priority&quot; policy dictates the hierarchy for overwriting values during the inclusion process. Elements with higher priority take precedence over those with lower priority.</p>
<p>The &quot;duplicate&quot; policy specifies the behavior when encountering two objects with the same name in both files. Employing the &quot;merge&quot; value for the &quot;duplicate&quot; policy results in key merging from the included file into the current file. (For additional values, consult the Macros Support notes.)</p>
<p>This is how included files are processed:</p>
<ul>
<li>Dynamic configuration include (priority=5)<br>
This is used to redefine elements from WebUI. This include can be omitted in some cases.</li>
<li>Override file (priority=10)<br>
This is used to define static overrides, which have the highest priority.</li>
<li>Local file (priority=1, duplicate=merge)<br>
This is used to add new configuration directives.</li>
</ul>
<p>Here is an example of how <code>.include</code> is used to achieve a desired configuration.</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># fileA.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obj {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    key = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    subobj {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        subkey = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.include(duplicate=merge,priority=1) &quot;fileB.conf&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># fileB.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obj {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    key = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nkey = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    subobj {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        subkey = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        nsub = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>will form the following configuration:</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">obj {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    key = 2; # fileB overrides fileA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nkey = 1; # added from fileB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    subobj {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        subkey = 3; # fileB overrides fileA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        nsub = 1; # added from fileB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>Typical <em>section</em> in Rspamd (where <em>section</em> is replaced with an actual section name):</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">section {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default_key = &quot;value&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  subsection {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      foo = &quot;bar&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  .include(try=true,priority=5) &quot;${DBDIR}/dynamic/section.conf&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  .include(try=true,priority=1,duplicate=merge) &quot;$LOCAL_CONFDIR/local.d/section.conf&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  .include(try=true,priority=10) &quot;$LOCAL_CONFDIR/override.d/section.conf&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>If you want to add or redefine some of those default values, you can use a <code>local.d/section</code> file:</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># local.d/section.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">new_key = &quot;new_value&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">subsection {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    foo = &quot;nobar&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>Note: If an include directive is situated within a <code>section {}</code> block, it&#x27;s essential that the included local.d/override.d files do not possess an identical <code>section {}</code> wrapper. This would inadvertently lead to nested blocks like <code>section { section{} }</code>. Conversely, files referred to by include directives outside of a section must explicitly delineate the sections they define, following a pattern like <code>section{} section{}</code> where the second section either overrides or merges with the first.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="rspamd-variables">Rspamd variables<a href="#rspamd-variables" class="hash-link" aria-label="Direct link to Rspamd variables" title="Direct link to Rspamd variables">​</a></h2>
<p>Rspamd introduces a range of valuable variables designed for use in configuration files, denoted as <code>${VAR}</code> or simply as <code>$VAR</code>. These variables are dynamically replaced with corresponding values during runtime. However, it&#x27;s important to note that nested variables such as <code>${ VAR1_${VAR2} }</code> are <strong>NOT</strong> supported.</p>
<ul>
<li><em>CONFDIR</em>: configuration directory for Rspamd, found in <code>$PREFIX/etc/rspamd/</code></li>
<li><em>LOCAL_CONFDIR</em>: site-local configuration directory for Rspamd (usually the same value as $CONFDIR, and not to be confused with local.d)</li>
<li><em>RUNDIR</em>: runtime directory to store pidfiles or UNIX sockets</li>
<li><em>DBDIR</em>: persistent databases directory (used for statistics or symbols cache)</li>
<li><em>LOGDIR</em>: a directory to store log files</li>
<li><em>PLUGINSDIR</em>: plugins directory for Lua plugins</li>
<li><em>RULESDIR</em>: directory in which rules are kept</li>
<li><em>PREFIX</em>: basic installation prefix (may be null, for example for /etc/rspamd compared to /prefix/etc/rspamd)</li>
<li><em>VERSION</em>: Rspamd version string (e.g. &quot;2.7&quot;)</li>
<li><em>WWWDIR</em>: root directory for web interface</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="rspamd-specific-macros">Rspamd specific macros<a href="#rspamd-specific-macros" class="hash-link" aria-label="Direct link to Rspamd specific macros" title="Direct link to Rspamd specific macros">​</a></h2>
<ul>
<li><em>.include_map</em>: defines a map that is dynamically reloaded and updated if its content has changed. This macro is intended to define dynamic configuration files.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="rspamd-basic-configuration">Rspamd basic configuration<a href="#rspamd-basic-configuration" class="hash-link" aria-label="Direct link to Rspamd basic configuration" title="Direct link to Rspamd basic configuration">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h3>
<p>Configuration files that are installed or updated with Rspamd are not meant to be modified directly by the user. Instead, these files should be overridden in site-specific configuration files. You can find more information on this process in the <a href="/docs.rspamd.com/branches/vstakhov-docs-search/tutorials/quickstart#configuring-rspamd">quickstart</a> page.</p>
<p>However, it&#x27;s important to note that packaging typically avoids overwriting configuration files during upgrades if they have been modified by the user. For a smooth transition when upgrading to a new version of Rspamd, be sure to carefully review the <a href="/docs.rspamd.com/branches/vstakhov-docs-search/tutorials/migration">migration notes</a> for any incompatible configuration changes.</p>
<p>The Rspamd configuration process begins with the file <code>$CONFDIR/rspamd.conf</code>. This file contains several settings and includes references to other files, which in turn might include additional files. The complete configuration is a compilation of all processed files, following the order in which they are encountered.</p>
<p>Each core Rspamd file incorporates an include to the <code>local.d</code> folder for local overrides, as well as another include to the <code>override.d</code> folder for final overrides. To better understand this architectural approach, you can refer to the <a href="/docs.rspamd.com/branches/vstakhov-docs-search/faq#what-are-local-and-override-config-files">related FAQ</a> and other resources on the topic.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="detail">Detail<a href="#detail" class="hash-link" aria-label="Direct link to Detail" title="Direct link to Detail">​</a></h3>
<p>The <code>rspamd.conf</code> file commences by incorporating <code>common.conf</code>:</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">.include &quot;$CONFDIR/common.conf&quot;</span><br></span></code></pre></div></div>
<p>Within <code>common.conf</code>, a Lua script that includes rules is specified as <code>$RULESDIR/rspamd.lua</code>. This Lua configuration file is pivotal in Rspamd, as it loads and runs numerous other Lua programs as <a href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/">modules</a>.</p>
<p>Note: The variable <code>$RULESDIR</code> typically corresponds to a path like <code>/usr/share/rspamd/rules</code>.</p>
<p>Subsequently, additional files are included to establish rules, set rule priorities, and define Rspamd actions.</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">lua = &quot;$RULESDIR/rspamd.lua&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.include &quot;$CONFDIR/metrics.conf&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.include &quot;$CONFDIR/actions.conf&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.include &quot;$CONFDIR/groups.conf&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.include &quot;$CONFDIR/composites.conf&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.include &quot;$CONFDIR/statistic.conf&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.include &quot;$CONFDIR/modules.conf&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.include &quot;$CONFDIR/settings.conf&quot;</span><br></span></code></pre></div></div>
<p>Each of these <code>.conf</code> files defines a specific section, along with corresponding <code>.include</code> files that permit local settings to override each section.</p>
<ul>
<li>The <a href="/docs.rspamd.com/branches/vstakhov-docs-search/configuration/metrics/">metrics.conf</a> file, formerly featured in this documentation, was deprecated in version 1.7. It was succeeded by <code>actions.conf</code> and <code>groups.conf</code>.</li>
<li><code>actions.conf</code> (without a separate document yet) delineates score thresholds for specific <a href="/docs.rspamd.com/branches/vstakhov-docs-search/faq#what-are-rspamd-actions">action</a> types.</li>
<li><code>groups.conf</code> (also without a separate document yet) introduces a singular &quot;group&quot; section housing multiple symbol groups. Each group incorporates <code>.include</code> directives pointing to files that detail symbols linked to those groups. (<a href="/docs.rspamd.com/branches/vstakhov-docs-search/faq#how-to-change-score-for-some-symbol">For more, see</a>)</li>
<li><a href="/docs.rspamd.com/branches/vstakhov-docs-search/configuration/composites">composites.conf</a> outlines composite symbols.</li>
<li>Statistical filters are defined within <a href="/docs.rspamd.com/branches/vstakhov-docs-search/configuration/statistic">statistic.conf</a>.</li>
<li>Rspamd manages module configurations (both for Lua and internal modules) through <code>.conf</code> files located in the <a href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/">modules.d</a> folder. For instance, configurations for the <a href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/rbl">RBL module</a> are specified in &quot;/modules.d/rbl.conf&quot;. The <code>modules.conf</code> file primarily serves to <code>.include</code> all of these module configuration files.</li>
<li>User settings receive thorough coverage in the <a href="/docs.rspamd.com/branches/vstakhov-docs-search/configuration/settings">settings.conf</a> documentation. Each setting can define a unique set of custom metric weights, symbols or action scores, as well as enable or disable specific checks.</li>
</ul>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">.include(try=true) &quot;$LOCAL_CONFDIR/rspamd.conf.local&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.include(try=true,priority=10) &quot;$LOCAL_CONFDIR/rspamd.conf.local.override&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.include(try=true,priority=10) &quot;$LOCAL_CONFDIR/rspamd.conf.override&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">modules {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  path = &quot;${PLUGINSDIR}&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fallback_path = &quot;${SHAREDIR}/lua&quot;; # Legacy path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  try_path = &quot;${LOCAL_CONFDIR}/plugins.d/&quot;; # User plugins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>The modules section establishes paths for directories or specific files. When a directory is specified, all files in that folder with a <code>.lua</code> suffix are loaded as Lua plugins. (The directory path is treated as a <code>*.lua</code> shell pattern).</p>
<p>Returning to <code>rspamd.conf</code>, it encompasses a global <a href="/docs.rspamd.com/branches/vstakhov-docs-search/configuration/options">options</a> section, followed by the configuration for <a href="/docs.rspamd.com/branches/vstakhov-docs-search/configuration/logging">logging</a>.</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">options {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pidfile = &quot;$RUNDIR/rspamd.pid&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .include &quot;$CONFDIR/options.inc&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .include(try=true; priority=1,duplicate=merge) &quot;$LOCAL_CONFDIR/local.d/options.inc&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .include(try=true; priority=10) &quot;$LOCAL_CONFDIR/override.d/options.inc&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.include(try=true; duplicate=merge) &quot;$CONFDIR/cgp.inc&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.include(try=true; priority=1,duplicate=merge) &quot;$LOCAL_CONFDIR/local.d/cgp.inc&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">logging {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    type = &quot;file&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    filename = &quot;$LOGDIR/rspamd.log&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .include &quot;$CONFDIR/logging.inc&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .include(try=true; priority=1,duplicate=merge) &quot;$LOCAL_CONFDIR/local.d/logging.inc&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .include(try=true; priority=10) &quot;$LOCAL_CONFDIR/override.d/logging.inc&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>Ultimately, a <a href="/docs.rspamd.com/branches/vstakhov-docs-search/workers/">workers</a> section (code not provided here) is outlined, utilizing the aforementioned <code>section &quot;foo&quot; {}</code> syntax, to define worker types such as normal, controller, rspamd_proxy, and fuzzy.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="jinja-templating">Jinja templating<a href="#jinja-templating" class="hash-link" aria-label="Direct link to Jinja templating" title="Direct link to Jinja templating">​</a></h2>
<p><a href="https://jinja.palletsprojects.com" target="_blank" rel="noopener noreferrer">Jinja</a> stands as a contemporary and design-friendly templating language for Python, modelled after Django’s templates.
<a href="https://github.com/orbitalquark/lupa" target="_blank" rel="noopener noreferrer">Lupa</a> is a Jinja2 template engine implementation written in Lua and supports Lua syntax within tags and variables.</p>
<p>Beginning with version 1.9.1, Rspamd introduces support for Jinja templates combined with Lua code within Rspamd UCL configuration files. This functionality extends beyond static assignments and <code>.include</code> directives, allowing the implementation of logic and data transformations. Notably, Rspamd employs a specific syntax for variable tags, namely <code>{=</code> and <code>=}</code>, to prevent conflicts with Lua&#x27;s use of ``, which might otherwise signify &quot;a table within a table&quot; in Lua.</p>
<p>Templating offers the advantage of concealing sensitive values from configuration files, achieved by placing them into environment variables. Rspamd automates the reading of environment variables that begin with the <code>RSPAMD_</code> prefix, subsequently pushing them onto the <code>env</code> variable. For instance, <code>RSPAMD_foo=bar</code> would translate to <code>env.foo=&quot;bar&quot;</code> in the templates.</p>
<p>The <code>env</code> variable also contains the following information:</p>
<ul>
<li><code>ver_major</code> - major version (e.g. <code>1</code>)</li>
<li><code>ver_minor</code> - minor version (e.g. <code>9</code>)</li>
<li><code>ver_patch</code> - patch version (e.g. <code>1</code>)</li>
<li><code>version</code> - full version as a string (e.g. <code>1.9.1</code>)</li>
<li><code>ver_num</code> - numeric version as a hex string (e.g. <code>0x1090100000000</code>)</li>
<li><code>ver_id</code> - git ID or <code>release</code> if not a git build</li>
<li><code>hostname</code> - local hostname</li>
</ul>
<p>You can also add values, not merely plain strings but any Lua objects, like tables, by specifying additional environment files with the <code>--lua-env</code> command line argument. The specified Lua program file will be read by the <code>root</code> user if the Rspamd main process starts as root and then drops privileges.</p>
<p>The Lua program file (or files) when specified multiple times should return a table as a single possible outcome. For example:</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:rgb(222, 71, 0)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  var1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;value&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  var2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    subvar1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;foo&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    subvar2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(222, 71, 0)">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>You can then use the variables as follows in config files:</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo = {= env.var1 =};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">baz = {= env.var2.subvar2 =};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>You can also use this for secure storage of passwords. This code sample would be used in a config file, and demonstrates many details for using Jinja.</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># local.d/controller.inc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">password = &quot;{= env.password|pbkdf =}&quot;; # Password is encrypted using `catena` PBKDF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>Please note that the pipe symbol <code>|</code> serves the purpose of conveying the password to a Jinja <a href="https://jinja.palletsprojects.com/en/2.11.x/templates/#filters" target="_blank" rel="noopener noreferrer">filter</a>, which facilitates further processing. Within Rspamd, the <code>pbkdf</code> filter is available and is utilized to encrypt the password using the <a href="https://en.wikipedia.org/wiki/PBKDF2" target="_blank" rel="noopener noreferrer">PBKDF</a> standard, specifically employing the <a href="https://github.com/bsdphk/PHC/tree/master/Catena" target="_blank" rel="noopener noreferrer">Catena</a> hashing scheme.</p>
<p>With this enhancement, as of version 1.9.1, your config files should be Jinja safe. However, this also implies that there should be no special sequences like ` anywhere in your configuration, other than for Jinja. If you do require these sequences for any reason, you can <a href="https://jinja.palletsprojects.com/en/2.11.x/templates/#escaping" target="_blank" rel="noopener noreferrer">escape</a> them using  raw %} and  endraw %} tags.</p>
<p>Keep in mind that the standard Jinja documentation primarily covers Python syntax and features, whereas Rspamd with Lupa introduces the usage of Lua syntax and features. For detailed information, refer to the Lupa documentation.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/rspamd/docs.rspamd.com/edit/master/docs/configuration/index.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs.rspamd.com/branches/vstakhov-docs-search/downloads"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Downloads</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs.rspamd.com/branches/vstakhov-docs-search/configuration/settings"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">User settings</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#ucl-sections-and-includes" class="table-of-contents__link toc-highlight">UCL sections and includes</a></li><li><a href="#rspamd-variables" class="table-of-contents__link toc-highlight">Rspamd variables</a></li><li><a href="#rspamd-specific-macros" class="table-of-contents__link toc-highlight">Rspamd specific macros</a></li><li><a href="#rspamd-basic-configuration" class="table-of-contents__link toc-highlight">Rspamd basic configuration</a><ul><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#detail" class="table-of-contents__link toc-highlight">Detail</a></li></ul></li><li><a href="#jinja-templating" class="table-of-contents__link toc-highlight">Jinja templating</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/vstakhov-docs-search/tutorials/quickstart">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/vstakhov-docs-search/configuration">Configuration</a></li><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules">Modules</a></li><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/vstakhov-docs-search/tutorials">Tutorials</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Resources</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/vstakhov-docs-search/downloads">Downloads</a></li><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/vstakhov-docs-search/faq">FAQ</a></li><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/vstakhov-docs-search/support">Support</a></li><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/vstakhov-docs-search/changelog">Changelog</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/rspamd/rspamd" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/vstakhov-docs-search/tutorials/site_contributing">Contributing</a></li><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/vstakhov-docs-search/blog">Blog</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Rspamd Project. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>