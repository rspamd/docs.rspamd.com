<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-modules/gpt" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">GPT Plugin | Rspamd Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://rspamd.com/docs.rspamd.com/branches/vstakhov-docs-search/modules/gpt"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="ru"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="GPT Plugin | Rspamd Documentation"><meta data-rh="true" name="description" content="The Rspamd GPT Plugin, introduced in Rspamd 3.9, integrates OpenAI&#x27;s GPT API to enhance spam filtering capabilities using advanced natural language processing techniques. Here are the basic ideas behind this plugin:"><meta data-rh="true" property="og:description" content="The Rspamd GPT Plugin, introduced in Rspamd 3.9, integrates OpenAI&#x27;s GPT API to enhance spam filtering capabilities using advanced natural language processing techniques. Here are the basic ideas behind this plugin:"><link data-rh="true" rel="icon" href="/docs.rspamd.com/branches/vstakhov-docs-search/img/favicon.png"><link data-rh="true" rel="canonical" href="https://rspamd.com/docs.rspamd.com/branches/vstakhov-docs-search/modules/gpt"><link data-rh="true" rel="alternate" href="https://rspamd.com/docs.rspamd.com/branches/vstakhov-docs-search/modules/gpt" hreflang="en"><link data-rh="true" rel="alternate" href="https://rspamd.com/docs.rspamd.com/branches/vstakhov-docs-search/ru/modules/gpt" hreflang="ru"><link data-rh="true" rel="alternate" href="https://rspamd.com/docs.rspamd.com/branches/vstakhov-docs-search/modules/gpt" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Modules","item":"https://rspamd.com/docs.rspamd.com/branches/vstakhov-docs-search/modules/"},{"@type":"ListItem","position":2,"name":"GPT Plugin","item":"https://rspamd.com/docs.rspamd.com/branches/vstakhov-docs-search/modules/gpt"}]}</script><link rel="alternate" type="application/rss+xml" href="/docs.rspamd.com/branches/vstakhov-docs-search/blog/rss.xml" title="Rspamd Documentation RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/docs.rspamd.com/branches/vstakhov-docs-search/blog/atom.xml" title="Rspamd Documentation Atom Feed">




<script>window.SEARCH_BACKEND_CONFIG={endpoint:"/api"}</script><link rel="stylesheet" href="/docs.rspamd.com/branches/vstakhov-docs-search/assets/css/styles.121a41fd.css">
<script src="/docs.rspamd.com/branches/vstakhov-docs-search/assets/js/runtime~main.d53a0eba.js" defer="defer"></script>
<script src="/docs.rspamd.com/branches/vstakhov-docs-search/assets/js/main.64722b56.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/docs.rspamd.com/branches/vstakhov-docs-search/img/rspamd_logo_black.png"><link rel="preload" as="image" href="/docs.rspamd.com/branches/vstakhov-docs-search/img/rspamd_logo_navbar.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://www.rspamd.com" target="_self" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/docs.rspamd.com/branches/vstakhov-docs-search/img/rspamd_logo_black.png" alt="Rspamd Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/docs.rspamd.com/branches/vstakhov-docs-search/img/rspamd_logo_navbar.png" alt="Rspamd Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs.rspamd.com/branches/vstakhov-docs-search/">Documentation</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs.rspamd.com/branches/vstakhov-docs-search/about/">About</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs.rspamd.com/branches/vstakhov-docs-search/tutorials/">Tutorials</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/">Modules</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs.rspamd.com/branches/vstakhov-docs-search/other/usage_policy">Usage Policy</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs.rspamd.com/branches/vstakhov-docs-search/faq">FAQ</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs.rspamd.com/branches/vstakhov-docs-search/support">Support</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs.rspamd.com/branches/vstakhov-docs-search/downloads">Downloads</a><a class="navbar__item navbar__link" href="/docs.rspamd.com/branches/vstakhov-docs-search/blog">Blog</a><a class="navbar__item navbar__link" href="/docs.rspamd.com/branches/vstakhov-docs-search/changelog">Changelog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div><div class="elasticsearch-search-container"><form class="elasticsearch-search-form"><div class="elasticsearch-search-input-container"><input type="text" placeholder="Search documentation..." class="elasticsearch-search-input" aria-label="Search documentation" value=""><div class="elasticsearch-search-shortcut"><span>⌘K</span></div></div></form></div></div><div class="navbar__item"><div id="font-size-control-mount"></div></div><a href="https://github.com/rspamd/rspamd" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs.rspamd.com/branches/vstakhov-docs-search/">About Rspamd</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs.rspamd.com/branches/vstakhov-docs-search/faq">Frequently asked questions</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs.rspamd.com/branches/vstakhov-docs-search/about/">About</a><button aria-label="Expand sidebar category &#x27;About&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs.rspamd.com/branches/vstakhov-docs-search/support">Rspamd Support</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs.rspamd.com/branches/vstakhov-docs-search/downloads">Downloads</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs.rspamd.com/branches/vstakhov-docs-search/configuration/">Configuration</a><button aria-label="Expand sidebar category &#x27;Configuration&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs.rspamd.com/branches/vstakhov-docs-search/workers/">Workers</a><button aria-label="Expand sidebar category &#x27;Workers&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/">Modules</a><button aria-label="Collapse sidebar category &#x27;Modules&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/antivirus">Antivirus module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/arc">ARC module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/asn">ASN module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/bayes_expiry">Bayes expiry module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/chartable">Chartable module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/clickhouse">Clickhouse module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/dcc">DCC module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/dkim">DKIM module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/dkim_signing">DKIM signing module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/dmarc">DMARC module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/elastic">Elasticsearch module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/emails">Emails module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/external_relay">External Relay module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/external_services">External Services module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/force_actions">Force Actions module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/fuzzy_check">Fuzzy check module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/gpt">GPT Plugin</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/greylisting">Greylisting module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/hfilter">Hfilter module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/history_redis">Redis history module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/ip_score">IP Score module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/known_senders">known_senders module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/maillist">Mailing lists module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/metadata_exporter">Metadata exporter</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/metric_exporter">Metric exporter</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/mid">MID module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/milter_headers">Milter headers module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/mime_types">Mime types modules</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/multimap">Multimap module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/mx_check">MX Check module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/neural">Neural network module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/once_received">Once received module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/phishing">Phishing module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/ratelimit">Ratelimit module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/rbl">RBL module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/regexp">Regexp module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/replies">Replies module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/reputation">Reputation module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/rspamd_update">Rspamd update module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/spamassassin">SpamAssassin rules module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/spamtrap">Spamtrap module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/spf">SPF module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/surbl">SURBL module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/trie">Trie module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/url_redirector">URL redirector module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/whitelist">Whitelist module</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs.rspamd.com/branches/vstakhov-docs-search/lua/">Lua API</a><button aria-label="Expand sidebar category &#x27;Lua API&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs.rspamd.com/branches/vstakhov-docs-search/tutorials/">Tutorials</a><button aria-label="Expand sidebar category &#x27;Tutorials&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs.rspamd.com/branches/vstakhov-docs-search/developers/architecture">Developers</a><button aria-label="Expand sidebar category &#x27;Developers&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs.rspamd.com/branches/vstakhov-docs-search/other/rspamadm">Other</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs.rspamd.com/branches/vstakhov-docs-search/blog">Blog</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/docs.rspamd.com/branches/vstakhov-docs-search/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/"><span>Modules</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">GPT Plugin</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Rspamd GPT Plugin</h1></header>
<p>The Rspamd GPT Plugin, introduced in Rspamd 3.9, integrates OpenAI&#x27;s GPT API to enhance spam filtering capabilities using advanced natural language processing techniques. Here are the basic ideas behind this plugin:</p>
<ul>
<li>The selected displayed text part is extracted and submitted to the GPT API for spam probability assessment</li>
<li>Additional message details such as Subject, displayed From, and URLs are also included in the assessment</li>
<li>Then, we ask GPT to provide results in JSON format since human-readable GPT output cannot be parsed (in general)</li>
<li>Some specific symbols (<code>BAYES_SPAM</code>, <code>FUZZY_DENIED</code>, <code>REPLY</code>, etc.) are excluded from the GPT scan</li>
<li>Obvious spam and ham are also excluded from the GPT evaluation</li>
</ul>
<p>The last two points reduce the GPT workload for something that is already known, where GPT cannot add any value in the evaluation. We also use GPT as one of the classifiers, meaning that we do not rely solely on GPT evaluation.</p>
<p>For detailed information about this plugin, refer to the <a href="/docs.rspamd.com/branches/vstakhov-docs-search/misc/2024/07/03/gpt.html">blog post</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="configuration-options">Configuration Options<a href="#configuration-options" class="hash-link" aria-label="Direct link to Configuration Options" title="Direct link to Configuration Options">​</a></h2>
<p><strong>By default, the GPT Plugin is disabled.</strong> To enable the plugin, add the following command in your Rspamd configuration:</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gpt {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  enabled = true; # Ensure this line is present to enable the GPT Plugin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>The full list of the plugin configuration options:</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gpt {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Enable the plugin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  enabled = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # LLM provider type: openai (remote) or ollama (local)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type = &quot;openai&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Your OpenAI API key (not required for ollama)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  api_key = &quot;xxx&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Model name (string or a list for ensemble requests)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  model = &quot;gpt-4o-mini&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Maximum number of tokens to request</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  max_tokens = 1000;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Temperature for sampling</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  temperature = 0.0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Timeout for requests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  timeout = 10s;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Prompt for the model (use default if not set)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  prompt = &quot;xxx&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Custom condition (Lua function)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  condition = &quot;xxx&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Autolearn if GPT classified</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  autolearn = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Custom Lua function to convert the model&#x27;s reply. Leave unset to use the</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # built-in parsers for OpenAI / Ollama replies.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  reply_conversion = &quot;xxx&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Header to add with the reason produced by GPT (set to null to disable)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  reason_header = &quot;X-GPT-Reason&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Skip GPT scan if **any** of these symbols are present (and their absolute</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # weight is equal or above the specified value)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  symbols_to_except = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    BAYES_SPAM = 0.9;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    WHITELIST_SPF = -1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Trigger GPT scan only when **all** of these symbols are present (and their</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # absolute weight is equal or above the specified value)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # symbols_to_trigger = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  #   URIBL_BLOCKED = 1.0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Check messages that resulted in a `passthrough` action</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  allow_passthrough = false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Check messages that already look like ham (negative score)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  allow_ham = false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Request / expect JSON reply from GPT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  json = false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Map of extra virtual symbols that could be set from GPT response categories</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # extra_symbols = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  #   GPT_MARKETING = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  #     score = 0.0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  #     description = &quot;GPT model detected marketing content&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  #     category = &quot;marketing&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  #   };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Prefix for Redis cache keys</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cache_prefix = &quot;rsllm&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Add `response_format = {type = &quot;json_object&quot;}` to requests (OpenAI only)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  include_response_format = false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # API endpoint</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  url = &quot;https://api.openai.com/v1/chat/completions&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="description-of-configuration-options">Description of Configuration Options<a href="#description-of-configuration-options" class="hash-link" aria-label="Direct link to Description of Configuration Options" title="Direct link to Description of Configuration Options">​</a></h3>
<ul>
<li><strong>enabled</strong>: Enables the GPT plugin.</li>
<li><strong>type</strong>: LLM provider. Accepts <code>openai</code> (default) or <code>ollama</code>.</li>
<li><strong>api_key</strong>: OpenAI API key. Not required for <code>ollama</code>.</li>
<li><strong>model</strong>: Model name (string) or a list of names to query in parallel.</li>
<li><strong>max_tokens</strong>: Maximum number of tokens returned by the model.</li>
<li><strong>temperature</strong>: Sampling temperature.</li>
<li><strong>timeout</strong>: Network timeout for LLM requests.</li>
<li><strong>prompt</strong>: Custom system prompt. If omitted, a sensible default is used.</li>
<li><strong>condition</strong>: A Lua function that decides whether a message should be sent to GPT.</li>
<li><strong>autolearn</strong>: When <code>true</code>, messages classified by GPT are added to Bayes learning (<code>learn_spam</code> / <code>learn_ham</code>).</li>
<li><strong>reply_conversion</strong>: Custom Lua function to convert the model&#x27;s reply. Leave unset to use the built-in parsers for OpenAI / Ollama replies.</li>
<li><strong>reason_header</strong>: Name of the header added with GPT explanation. Set to <code>null</code> to disable entirely.</li>
<li><strong>symbols_to_except</strong>: Table of symbols that <em>exclude</em> a message from GPT processing.</li>
<li><strong>symbols_to_trigger</strong>: Table of symbols that must all be present to <em>trigger</em> GPT processing.</li>
<li><strong>allow_passthrough</strong>: When <code>true</code>, messages with <code>passthrough</code> action are still evaluated by GPT.</li>
<li><strong>allow_ham</strong>: When <code>true</code>, messages that already look like ham (negative score) are still evaluated.</li>
<li><strong>json</strong>: When <code>true</code>, the plugin forces the LLM to return a JSON object and parses it. This can noticeably <em>reduce answer quality</em> and is generally <strong>not recommended</strong> unless you have a very deterministic prompt that the model might otherwise ignore.</li>
<li><strong>extra_symbols</strong>: Map that allows GPT to set additional virtual symbols based on returned categories.</li>
<li><strong>cache_prefix</strong>: Prefix used for Redis cache keys.</li>
<li><strong>include_response_format</strong>: Adds OpenAI <code>response_format = json_object</code> hint. Useful only together with <code>json = true</code>, otherwise unnecessary.</li>
<li><strong>url</strong>: API endpoint for the selected provider.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="example-configuration">Example Configuration<a href="#example-configuration" class="hash-link" aria-label="Direct link to Example Configuration" title="Direct link to Example Configuration">​</a></h2>
<p>Here is a minimal example configuration:</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gpt {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  enabled = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type = &quot;openai&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  api_key = &quot;your_api_key_here&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  model = &quot;gpt-4o-mini&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  max_tokens = 1000;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  temperature = 0.0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  timeout = 10s;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  reason_header = &quot;X-GPT-Reason&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="additional-notes">Additional Notes<a href="#additional-notes" class="hash-link" aria-label="Direct link to Additional Notes" title="Direct link to Additional Notes">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="json-vs-plain-text-responses">JSON vs. Plain-Text Responses<a href="#json-vs-plain-text-responses" class="hash-link" aria-label="Direct link to JSON vs. Plain-Text Responses" title="Direct link to JSON vs. Plain-Text Responses">​</a></h3>
<p>The plugin works best when the model can answer in plain text because it gives the language model more freedom and generally yields better reasoning. Enabling <code>json = true</code> (and optionally <code>include_response_format</code>) constrains the model to produce a strict JSON object. This often degrades the probability estimate or makes the reply longer than required, so turn it on only if your prompts really need JSON.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="reason_header"><code>reason_header</code><a href="#reason_header" class="hash-link" aria-label="Direct link to reason_header" title="Direct link to reason_header">​</a></h3>
<p>If <code>reason_header</code> is set to a non-empty string, the plugin injects a mail header with the explanation sentence produced by GPT (<code>X-GPT-Reason</code> in the examples). This is convenient for debugging or for downstream systems, but remember that the text is untrusted user input and might reveal information to message recipients. Set the option to <code>null</code> to disable the header entirely.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="multiple-model-ensemble">Multiple-Model Ensemble<a href="#multiple-model-ensemble" class="hash-link" aria-label="Direct link to Multiple-Model Ensemble" title="Direct link to Multiple-Model Ensemble">​</a></h3>
<p>The <code>model</code> option can be a list:</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">model = [&quot;gpt-4o-mini&quot;, &quot;gpt-3.5-turbo&quot;];</span><br></span></code></pre></div></div>
<p>In this case Rspamd queries all listed models in parallel and applies a <em>consensus</em> algorithm:</p>
<ul>
<li>Each model returns a spam probability.</li>
<li>If the majority classifies the message as spam with probability &gt; 0.75, the highest spam probability is used.</li>
<li>If the majority classifies it as ham with probability &lt; 0.25, the lowest ham probability is used.</li>
<li>Otherwise no GPT symbol is added (no consensus).</li>
</ul>
<p>This improves robustness and lets you mix cheap fast models with a slower high-quality one.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="caching-policies">Caching Policies<a href="#caching-policies" class="hash-link" aria-label="Direct link to Caching Policies" title="Direct link to Caching Policies">​</a></h3>
<p>To avoid repeated LLM calls, responses are cached in Redis (if configured). Key facts:</p>
<ul>
<li>Key: <code>&lt;cache_prefix&gt;_&lt;env&gt;_&lt;digest&gt;</code> where <code>env</code> depends on <code>prompt</code>, <code>model</code>, and <code>url</code>, and <code>digest</code> is the SHA256 of the examined text part (truncated).</li>
<li>Default TTL is one hour (<code>cache_ttl</code> option accepts seconds).</li>
<li>Workers coordinate using <em>pending</em> markers so that only one request per message is sent even in large clusters.</li>
<li>Changing the prompt, model list, or endpoint automatically invalidates the cache because they are part of the key.</li>
<li>You can tune <code>cache_prefix</code>, <code>cache_ttl</code>, and other cache options directly inside the <code>gpt {}</code> block.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2>
<p>The Rspamd GPT Plugin integrates OpenAI&#x27;s GPT models into Rspamd, enhancing its spam filtering capabilities with advanced text processing techniques. By configuring the options above, users can customize the plugin to meet specific requirements, thereby enhancing the efficiency and accuracy of spam filtering within Rspamd.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/rspamd/docs.rspamd.com/edit/master/docs/modules/gpt.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/fuzzy_check"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Fuzzy check module</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/greylisting"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Greylisting module</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#configuration-options" class="table-of-contents__link toc-highlight">Configuration Options</a><ul><li><a href="#description-of-configuration-options" class="table-of-contents__link toc-highlight">Description of Configuration Options</a></li></ul></li><li><a href="#example-configuration" class="table-of-contents__link toc-highlight">Example Configuration</a></li><li><a href="#additional-notes" class="table-of-contents__link toc-highlight">Additional Notes</a><ul><li><a href="#json-vs-plain-text-responses" class="table-of-contents__link toc-highlight">JSON vs. Plain-Text Responses</a></li><li><a href="#reason_header" class="table-of-contents__link toc-highlight"><code>reason_header</code></a></li><li><a href="#multiple-model-ensemble" class="table-of-contents__link toc-highlight">Multiple-Model Ensemble</a></li><li><a href="#caching-policies" class="table-of-contents__link toc-highlight">Caching Policies</a></li></ul></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/vstakhov-docs-search/tutorials/quickstart">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/vstakhov-docs-search/configuration">Configuration</a></li><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules">Modules</a></li><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/vstakhov-docs-search/tutorials">Tutorials</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Resources</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/vstakhov-docs-search/downloads">Downloads</a></li><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/vstakhov-docs-search/faq">FAQ</a></li><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/vstakhov-docs-search/support">Support</a></li><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/vstakhov-docs-search/changelog">Changelog</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/rspamd/rspamd" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/vstakhov-docs-search/tutorials/site_contributing">Contributing</a></li><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/vstakhov-docs-search/blog">Blog</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Rspamd Project. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>