<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-modules/dkim_signing" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">DKIM signing module | Rspamd Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://rspamd.com/docs.rspamd.com/branches/vstakhov-docs-search/modules/dkim_signing"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="ru"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="DKIM signing module | Rspamd Documentation"><meta data-rh="true" name="description" content="{:.no_toc}"><meta data-rh="true" property="og:description" content="{:.no_toc}"><link data-rh="true" rel="icon" href="/docs.rspamd.com/branches/vstakhov-docs-search/img/favicon.png"><link data-rh="true" rel="canonical" href="https://rspamd.com/docs.rspamd.com/branches/vstakhov-docs-search/modules/dkim_signing"><link data-rh="true" rel="alternate" href="https://rspamd.com/docs.rspamd.com/branches/vstakhov-docs-search/modules/dkim_signing" hreflang="en"><link data-rh="true" rel="alternate" href="https://rspamd.com/docs.rspamd.com/branches/vstakhov-docs-search/ru/modules/dkim_signing" hreflang="ru"><link data-rh="true" rel="alternate" href="https://rspamd.com/docs.rspamd.com/branches/vstakhov-docs-search/modules/dkim_signing" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Modules","item":"https://rspamd.com/docs.rspamd.com/branches/vstakhov-docs-search/modules/"},{"@type":"ListItem","position":2,"name":"DKIM signing module","item":"https://rspamd.com/docs.rspamd.com/branches/vstakhov-docs-search/modules/dkim_signing"}]}</script><link rel="alternate" type="application/rss+xml" href="/docs.rspamd.com/branches/vstakhov-docs-search/blog/rss.xml" title="Rspamd Documentation RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/docs.rspamd.com/branches/vstakhov-docs-search/blog/atom.xml" title="Rspamd Documentation Atom Feed">




<script>window.SEARCH_BACKEND_CONFIG={endpoint:"/api"}</script><link rel="stylesheet" href="/docs.rspamd.com/branches/vstakhov-docs-search/assets/css/styles.121a41fd.css">
<script src="/docs.rspamd.com/branches/vstakhov-docs-search/assets/js/runtime~main.d53a0eba.js" defer="defer"></script>
<script src="/docs.rspamd.com/branches/vstakhov-docs-search/assets/js/main.64722b56.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/docs.rspamd.com/branches/vstakhov-docs-search/img/rspamd_logo_black.png"><link rel="preload" as="image" href="/docs.rspamd.com/branches/vstakhov-docs-search/img/rspamd_logo_navbar.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://www.rspamd.com" target="_self" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/docs.rspamd.com/branches/vstakhov-docs-search/img/rspamd_logo_black.png" alt="Rspamd Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/docs.rspamd.com/branches/vstakhov-docs-search/img/rspamd_logo_navbar.png" alt="Rspamd Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs.rspamd.com/branches/vstakhov-docs-search/">Documentation</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs.rspamd.com/branches/vstakhov-docs-search/about/">About</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs.rspamd.com/branches/vstakhov-docs-search/tutorials/">Tutorials</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/">Modules</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs.rspamd.com/branches/vstakhov-docs-search/other/usage_policy">Usage Policy</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs.rspamd.com/branches/vstakhov-docs-search/faq">FAQ</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs.rspamd.com/branches/vstakhov-docs-search/support">Support</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs.rspamd.com/branches/vstakhov-docs-search/downloads">Downloads</a><a class="navbar__item navbar__link" href="/docs.rspamd.com/branches/vstakhov-docs-search/blog">Blog</a><a class="navbar__item navbar__link" href="/docs.rspamd.com/branches/vstakhov-docs-search/changelog">Changelog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div><div class="elasticsearch-search-container"><form class="elasticsearch-search-form"><div class="elasticsearch-search-input-container"><input type="text" placeholder="Search documentation..." class="elasticsearch-search-input" aria-label="Search documentation" value=""><div class="elasticsearch-search-shortcut"><span>âŒ˜K</span></div></div></form></div></div><div class="navbar__item"><div id="font-size-control-mount"></div></div><a href="https://github.com/rspamd/rspamd" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs.rspamd.com/branches/vstakhov-docs-search/">About Rspamd</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs.rspamd.com/branches/vstakhov-docs-search/faq">Frequently asked questions</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs.rspamd.com/branches/vstakhov-docs-search/about/">About</a><button aria-label="Expand sidebar category &#x27;About&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs.rspamd.com/branches/vstakhov-docs-search/support">Rspamd Support</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs.rspamd.com/branches/vstakhov-docs-search/downloads">Downloads</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs.rspamd.com/branches/vstakhov-docs-search/configuration/">Configuration</a><button aria-label="Expand sidebar category &#x27;Configuration&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs.rspamd.com/branches/vstakhov-docs-search/workers/">Workers</a><button aria-label="Expand sidebar category &#x27;Workers&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/">Modules</a><button aria-label="Collapse sidebar category &#x27;Modules&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/antivirus">Antivirus module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/arc">ARC module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/asn">ASN module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/bayes_expiry">Bayes expiry module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/chartable">Chartable module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/clickhouse">Clickhouse module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/dcc">DCC module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/dkim">DKIM module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/dkim_signing">DKIM signing module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/dmarc">DMARC module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/elastic">Elasticsearch module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/emails">Emails module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/external_relay">External Relay module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/external_services">External Services module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/force_actions">Force Actions module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/fuzzy_check">Fuzzy check module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/gpt">GPT Plugin</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/greylisting">Greylisting module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/hfilter">Hfilter module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/history_redis">Redis history module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/ip_score">IP Score module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/known_senders">known_senders module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/maillist">Mailing lists module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/metadata_exporter">Metadata exporter</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/metric_exporter">Metric exporter</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/mid">MID module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/milter_headers">Milter headers module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/mime_types">Mime types modules</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/multimap">Multimap module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/mx_check">MX Check module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/neural">Neural network module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/once_received">Once received module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/phishing">Phishing module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/ratelimit">Ratelimit module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/rbl">RBL module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/regexp">Regexp module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/replies">Replies module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/reputation">Reputation module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/rspamd_update">Rspamd update module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/spamassassin">SpamAssassin rules module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/spamtrap">Spamtrap module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/spf">SPF module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/surbl">SURBL module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/trie">Trie module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/url_redirector">URL redirector module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/whitelist">Whitelist module</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs.rspamd.com/branches/vstakhov-docs-search/lua/">Lua API</a><button aria-label="Expand sidebar category &#x27;Lua API&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs.rspamd.com/branches/vstakhov-docs-search/tutorials/">Tutorials</a><button aria-label="Expand sidebar category &#x27;Tutorials&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs.rspamd.com/branches/vstakhov-docs-search/developers/architecture">Developers</a><button aria-label="Expand sidebar category &#x27;Developers&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs.rspamd.com/branches/vstakhov-docs-search/other/rspamadm">Other</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs.rspamd.com/branches/vstakhov-docs-search/blog">Blog</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/docs.rspamd.com/branches/vstakhov-docs-search/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/"><span>Modules</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">DKIM signing module</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>DKIM signing module</h1></header>
<p>{:.no_toc}</p>
<p>The Rspamd 1.5 version has introduced a convenient method of configuring DKIM signing through the addition of the DKIM signing module. A more customizable option is available in the DKIM module through the <a href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/dkim#dkim-signatures">sign_condition</a>.</p>
<p>DKIM signing currently works with Milter based MTAs (Sendmail, Postfix), Haraka &amp; Communigate. For DKIM signing to work, you must <a href="/docs.rspamd.com/branches/vstakhov-docs-search/tutorials/scanning_outbound">scan outbound mail with rspamd</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="principles-of-operation">Principles of operation<a href="#principles-of-operation" class="hash-link" aria-label="Direct link to Principles of operation" title="Direct link to Principles of operation">â€‹</a></h2>
<p>The DKIM signing module uses a predefined policy to determine which domains and selectors to use for signing. This policy can be modified with various settings. Here is a description of the default policy:</p>
<ol>
<li>In order to be eligible for signing, an email must either be received from an authenticated user, a reserved (local) IP address, or an address in the sign_networks map (if defined).</li>
<li>If the envelope from address is not empty, the effective second-level domain must match the MIME header From.</li>
<li>If there is an authenticated user, it should be suffixed with @domain, where domain is what is seen in the envelope/header From address.</li>
<li>The selector and path to the key are selected from the domain-specific configuration, if present. If not, the global configuration is used as a fallback.</li>
</ol>
<p>The default global configuration (fallback mode) searches for keys at the defined path. This path is constructed using the eSLD normalized domain name of the header from and the default selector defined with selector (dkim). For example, the search path for <a href="mailto:user@test.example.com" target="_blank" rel="noopener noreferrer">user@test.example.com</a> would be /var/lib/rspamd/dkim/example.com.dkim.key. If a key is found, the message will be signed.</p>
<p><strong>Important notice</strong>: when using file-based DKIM private keys, ensure that the Rspamd scanner processes (e.g. normal worker, controller, or a proxy in self-scan mode) have at least read access to the signing keys. This requires the keys to be accessible by the user or group <code>_rspamd</code>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="configuration">Configuration<a href="#configuration" class="hash-link" aria-label="Direct link to Configuration" title="Direct link to Configuration">â€‹</a></h2>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># local.d/dkim_signing.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># If false, messages with empty envelope from are not signed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">allow_envfrom_empty = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># If true, envelope/header domain mismatch is ignored</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">allow_hdrfrom_mismatch = false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># If true, multiple from headers are allowed (but only first is used)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">allow_hdrfrom_multiple = false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># If true, username does not need to contain matching domain</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">allow_username_mismatch = false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Default path to key, can include &#x27;$domain&#x27; and &#x27;$selector&#x27; variables</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">path = &quot;/var/lib/rspamd/dkim/$domain.$selector.key&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Default selector to use</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">selector = &quot;dkim&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># If false, messages from authenticated users are not selected for signing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sign_authenticated = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># If false, messages from local networks are not selected for signing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sign_local = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Map file of IP addresses/subnets to consider for signing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># sign_networks = &quot;/some/file&quot;; # or url</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Symbol to add when message is signed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">symbol = &quot;DKIM_SIGNED&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Whether to fallback to global config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">try_fallback = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Domain to use for DKIM signing: can be &quot;header&quot; (MIME From), &quot;envelope&quot; (SMTP From), &quot;recipient&quot; (SMTP To), &quot;auth&quot; (SMTP username) or directly specified domain name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use_domain = &quot;header&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Domain to use for DKIM signing when sender is in sign_networks (&quot;header&quot;/&quot;envelope&quot;/&quot;auth&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#use_domain_sign_networks = &quot;header&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Domain to use for DKIM signing when sender is a local IP (&quot;header&quot;/&quot;envelope&quot;/&quot;auth&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#use_domain_sign_local = &quot;header&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Whether to normalise domains to eSLD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use_esld = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Whether to get keys from Redis</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use_redis = false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Hash for DKIM keys in Redis</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">key_prefix = &quot;DKIM_KEYS&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># map of domains -&gt; names of selectors (since rspamd 1.5.3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#selector_map = &quot;/etc/rspamd/dkim_selectors.map&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># map of domains -&gt; paths to keys (since rspamd 1.5.3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#path_map = &quot;/etc/rspamd/dkim_paths.map&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># If `true` get pubkey from DNS record and check if it matches private key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">check_pubkey = false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Set to `false` if you want to skip signing if public and private keys mismatch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">allow_pubkey_mismatch = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Domain specific settings</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">domain {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Domain name is used as key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  example.com {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Private key path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    path = &quot;/var/lib/rspamd/dkim/example.key&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Selector</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    selector = &quot;ds&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>To disable DKIM signing (i.e. you use OpenDKIM, or signing is done elsewhere)</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># local.d/dkim_signing.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enabled = false;</span><br></span></code></pre></div></div>
<p>or</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># override.d/dkim_signing.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enabled = false;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="dkim-key-management">DKIM key management<a href="#dkim-key-management" class="hash-link" aria-label="Direct link to DKIM key management" title="Direct link to DKIM key management">â€‹</a></h2>
<p>Rspamd always uses <code>relaxed/relaxed</code> encoding with the <code>rsa-sha256</code> signature algorithm, which is deemed to be the most suitable option for all cases. Upon successful signing, Rspamd adds a unique element, the <code>DKIM-Signature</code>, to the output.</p>
<p>To generate DKIM keys for your domain, utilize the in-built <code>rspamadm dkim_keygen</code> utility:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rspamadm dkim_keygen -s &#x27;test&#x27; -d example.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-----BEGIN PRIVATE KEY-----</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-----END PRIVATE KEY-----</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test._domainkey IN TXT ( &quot;v=DKIM1; k=rsa; &quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;p=MIGJAoGBALBrq9K6yxAXHwircsTnDTsd2Kg426z02AnoKTvyYNqwYT5Dxa02lyOiAXloXVIJsyfuGOOoSx543D7DGWw0plgElHXKStXy1TZ7fJfbEtuc5RASIKqOAT1iHGfGB1SZzjt3a3vJBhoStjvLulw4h8NC2jep96/QGuK8G/3b/SJNAgMBAAE=&quot; ) ;</span><br></span></code></pre></div></div>
<p>Between <code>-----BEGIN PRIVATE KEY-----</code> and <code>-----END PRIVATE KEY-----</code> is your DKIM private key (use the <code>-k</code> switch to save to file). The second part is the public DNS TXT record that you should place in your DNS zone file. This command can also save both private and public parts to files.</p>
<p>For an RSA key of 2048 bits:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rspamadm dkim_keygen -s &#x27;woosh&#x27; -b 2048 -d example.com -k example.private &gt; example.txt</span><br></span></code></pre></div></div>
<ul>
<li><code>&gt; example.txt</code> re-directs the DNS TXT record output to <code>example.txt</code></li>
<li><code>-k example.private</code> saves your private key to the file <code>example.private</code></li>
<li><code>-d example.com </code> specifies the domain as <code>example.com</code> (currently meaningless)</li>
<li><code>-b 2048</code> specifies a <code>2048</code> bit key size (the standard default 1024 bit size is weak)</li>
<li><code>-s &#x27;woosh&#x27;</code> names the selector <code>woosh</code> i.e. <code>woosh._domainkey</code></li>
</ul>
<p>Or for an Ed25519 key:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rspamadm dkim_keygen -s &#x27;woosh&#x27; -d example.com -t ed25519 -k woosh-ed25519.private &gt; woosh-ed25519.txt</span><br></span></code></pre></div></div>
<ul>
<li><code>-t ed25519</code> specifies key type Ed25519</li>
<li>Note: using <code>-b</code> together with Ed25519 has no effect. There is no variable key length with Ed25519.</li>
</ul>
<p>Please note that as of September 2019, Ed25519 keys are not widely supported in software, making it inadvisable to exclusively use this key type in a production environment, as this may result in rejected emails. If you choose to use Ed25519 keys, it is recommended to pair them with an RSA key, providing a fallback option in case a recipient domain is unable to parse Ed25519 keys or signatures.</p>
<p>Example:</p>
<div class="language-local.d/dkim_signing.conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-local.d/dkim_signing.conf codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">domain {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  alpha.example.org {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    selectors [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       path: &quot;.../configs/dkim.key&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       selector: &quot;dkim&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       path: &quot;.../configs/dkim-eddsa.key&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       selector: &quot;eddsa&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="verifying-your-private-keys">Verifying your private keys<a href="#verifying-your-private-keys" class="hash-link" aria-label="Direct link to Verifying your private keys" title="Direct link to Verifying your private keys">â€‹</a></h2>
<p>To verify any generated private RSA key with OpenSSL (and also Ed25519 keys if your OpenSSL &gt;= 1.1.1) you can use the following command:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ openssl pkey -text -noout -in example.private</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Private-Key: (2048 bit)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">modulus:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    00:...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">publicExponent: 65537 (0x10001)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">privateExponent:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    00:...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prime1:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    00:...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prime2:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    00:...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exponent1:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    00:...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exponent2:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    00:...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">coefficient:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    00:...</span><br></span></code></pre></div></div>
<p>You have the option to configure the <code>dkim_signing</code> module to verify that the published pubkey record matches the selected private key by setting the <code>check_pubkey</code> option to <code>true</code> (the default setting is <code>false</code>). Please be advised that this may result in an additional DNS request during the signing process.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="dkim-keys-in-redis">DKIM keys in Redis<a href="#dkim-keys-in-redis" class="hash-link" aria-label="Direct link to DKIM keys in Redis" title="Direct link to DKIM keys in Redis">â€‹</a></h2>
<p>To use DKIM keys stored in Redis, add the following to your configuration::</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># local.d/dkim_signing.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use_redis = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">key_prefix = &quot;DKIM_KEYS&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">selector = &quot;myselector&quot;;</span><br></span></code></pre></div></div>
<p>... and populate the named hash with DKIM keys; for example the following Lua script could be run with <code>redis-cli --eval</code>:</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:rgb(222, 71, 0)">local</span><span class="token plain"> key </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">[[-----BEGIN PRIVATE KEY-----</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">MIICdwIBADANBgkqhkiG9w0BAQEFAASCAmEwggJdAgEAAoGBANe3EETkiI1Exyrb</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">+VzbMSt90K8MXJA0GcyNs6MFCs9JPaTh90Zu2l7ki7m5LTUx6350AR/3hcvwjSHC</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">ZjD6fvQ8/zfjN8kaLZ6DAaqtqSlpawIM+8glkuTEkIkpBED/OtDrba4Rd29iLFVu</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">wQZXDtTjAAZKZPmtTZ5TXLrcCU6VAgMBAAECgYEA1BFvmBsIN8Gu/+6kNupya2xU</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">NVM0yLu/xT5lpNV3LBO325oejAq8+d87kkl/LTW3a2jGFlQ0ICuLw+2mo24QUWRy</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">v8if3oeBMlnLqHE+6wNjFVqo5sOjKzjO363xSXwXNUrBT7jDhnZcDN8w3/FecYKj</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">ifGTVtUs1SLsYwhlc8ECQQDuCRymLZQ/imPn5eFVIydwUzg8ptZlvoA7bfIxUL9B</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">QRX33s59kLCilA0tTed8Dd+GnxsT93XOj1ApIfBwmTSlAkEA5/63PDsN7fH+WInq</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">VD8nU07M9S8LcGDlPbVVBr2S2I78/iwrSDAYtbkU2vEbhFK/JuKNML2j8OkzV3v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">QulfMQJBALDzhx+l/HHr3+8RPhx7QKNIyiKUaAdEwbDsP8IXY8YPq1QThu9jM1v4</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">sX7/TdkzuvoppwiFykbe1NlvCH279p0CQCmTg4Ee0DtBcCSr6rvYaZLLf329RZ6J</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">LuwlMCy6ErQOxBZFEiiovfTrS2qFZToMnkc4uLbwdY36LQJTq7unGTECQCCok8Lz</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">BeZtAw+TJofpOM3F2Rlm2qXiBVBeubhRedsiljG0hpvvLJBMppnQ6r27p5Jk39Sm</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">aTRkxEKrxPWWLNM=</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">-----END PRIVATE KEY-----]]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">redis</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">call</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;HMSET&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;DKIM_KEYS&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;myselector.example.com&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>The selector will be chosen as per usual (a domain-specific selector will be used if configured, otherwise the global setting is used).</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="using-maps">Using maps<a href="#using-maps" class="hash-link" aria-label="Direct link to Using maps" title="Direct link to Using maps">â€‹</a></h2>
<p>Starting from Rspamd 1.5.3, the <code>selector_map</code> or <code>path_map</code> can be used to determine the selectors and paths to private keys, respectively, using the DKIM signing domain as the key. If entries are found, they will override the default settings.</p>
<p>The following configuration provides a templated path for the DKIM signing key, a default selector, and a map that can be used to override the default selector, which in turn affects the effective path to the signing key. Any eligible email will be signed if a key with the appropriate name exists on disk.</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># local.d/dkim_signing.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">try_fallback = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">path = &quot;/var/lib/rspamd/dkim/$domain.$selector.key&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">selector_map = &quot;/etc/rspamd/dkim_selectors.map&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">selector = &quot;dkim&quot;;</span><br></span></code></pre></div></div>
<p>In the following configuration, we attempt to sign only domains which are present in both <code>selector_map</code> and <code>path_map</code>:</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># local.d/dkim_signing.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">try_fallback = false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">selector_map = &quot;/etc/rspamd/dkim_selectors.map&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">path_map = &quot;/etc/rspamd/dkim_paths.map&quot;;</span><br></span></code></pre></div></div>
<p>Format of the maps should be as shown:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ head -1 /etc/rspamd/dkim_selectors.map</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">example.net dkim</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ head -1 /etc/rspamd/dkim_paths.map</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">example.net /var/lib/rspamd/dkim/example.net.$selector.key</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="use-of-signing_table">Use of <code>signing_table</code><a href="#use-of-signing_table" class="hash-link" aria-label="Direct link to use-of-signing_table" title="Direct link to use-of-signing_table">â€‹</a></h2>
<p>From the version 1.9.2, Rspamd supports OpenDKIM compatible settings:</p>
<ul>
<li><code>signing_table</code>:</li>
</ul>
<p>Defines a table used to select one or more signatures to apply to a message based on the address found in the <code>From:</code> header field. The keys in this table can vary based on the type of table used.
The values in this data set should include one field that contains a name found in the KeyTable (see above) that identifies which key should be used in generating the signature, and an optional second field naming the signer of the message that will be included in the <code>i=</code> tag in the generated signature.
Note that the <code>i=</code> value will not be included in the signature if it conflicts with the signing domain (the <code>d=</code> value).</p>
<p>If the first field in the data set contains only a <code>%</code> symbol, it will be replaced by the domain found in the <code>From:</code> header field. Similarly, the optional second field can include a <code>%</code> symbol that will be replaced by the domain found in the <code>From:</code> header field.</p>
<p>In Rspamd, this table is treated as <code>refile</code>! So you should use <strong>glob</strong> style regular expressions to do matching.</p>
<ul>
<li><code>key_table</code></li>
</ul>
<p>Gives the location of a file that maps key names to signing keys. This file, if present, overrides any KeyFile setting in the configuration file. The data set in this file associates each key name with three values: (a) the name of the domain to use in the signatureâ€™s &quot;d=&quot; value; (b) the name of the selector to use in the signatureâ€™s &quot;s=&quot; value; and (c) either a private key or a path to a file containing a private key.</p>
<p>If the first value consists solely of a percent sign (&quot;%&quot;) character, it will be replaced by the apparent domain of the sender when generating a signature. If the third value starts with a slash (&quot;/&quot;) character, or &quot;./&quot; or &quot;../&quot;, then it is presumed to refer to a file from which the private key should be read, otherwise it is itself a PEM-encoded private key or a base64-encoded DER private key; a &quot;%&quot; in the third value in this case will be replaced by the apparent domain name of the sender.</p>
<p>The SigningTable (see below) is used to select records from this table to be used to add signatures based on the message sender.</p>
<p>Rspamd also supports embedded tables as for all other maps in the config, e.g. here is a sample used for functional testing:</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># local.d/dkim_signing.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">signing_table = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;*@cacophony.za.org cacophony.za.org&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">key_table = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;cacophony.za.org %:eddsa:m5kGxtckRfsNe5EuYTe7bvkDjSh7LXaX3aXyIMPGLR0=&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">];</span><br></span></code></pre></div></div>
<p>When using these options, they <em>passthrough</em> all mismatch checks. The only meaningful setting is <code>sign_networks</code> in this mode as it corresponds with OpenDKIM behaviour. Otherwise, Rspamd will perform signing based on matching of the Mime <code>From</code> header with the entries in <code>signing_table</code></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="http-headers-based-dkim-signing">HTTP headers based DKIM signing<a href="#http-headers-based-dkim-signing" class="hash-link" aria-label="Direct link to HTTP headers based DKIM signing" title="Direct link to HTTP headers based DKIM signing">â€‹</a></h2>
<p>To simplify REST services integration, Rspamd offers the option of DKIM signing based solely on HTTP request headers. To utilize this feature, simply enable the <code>use_http_headers</code> setting. When this mode is activated, Rspamd disregards all other methods of signing messages and only looks for the designated <strong>request</strong> headers (not email headers!):</p>





























<table><thead><tr><th>Header</th><th>Definition</th></tr></thead><tbody><tr><td><code>PerformDkimSign</code></td><td>Switch DKIM signing on (if <code>Yes</code>)</td></tr><tr><td><code>SignOnAuthFailed</code></td><td>Sign messages with failed DKIM (dkim check must be performed before)</td></tr><tr><td><code>DkimDomain</code></td><td>Dkim signing domain</td></tr><tr><td><code>DkimSelector</code></td><td>Selector for signing</td></tr><tr><td><code>DkimPrivateKey</code></td><td>Private key encoded in Base64</td></tr></tbody></table>
<p>To ensure proper functionality, it&#x27;s crucial to follow the mandatory header requirements and enable the <code>DKIM_CHECK</code> in user settings. This will enable the automatic DKIM check dependency and allow for the use of the <code>Setting</code> header, which facilitates bypassing of other checks. For further information, refer to the (see <a href="/docs.rspamd.com/branches/vstakhov-docs-search/configuration/settings">Users settings</a>) documentation.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="dkim-signing-using-vault">DKIM signing using Vault<a href="#dkim-signing-using-vault" class="hash-link" aria-label="Direct link to DKIM signing using Vault" title="Direct link to DKIM signing using Vault">â€‹</a></h2>
<p>Starting from version 1.9.3, Rspamd has the capability to use <a href="https://www.vaultproject.io" target="_blank" rel="noopener noreferrer">Hashicorp Vault</a> to securely store and manage DKIM keys. Vault usage provides secure and flexible storage of the private keys that can scale and use various backends to store sensible data (secrets).</p>
<p>To store DKIM keys using Vault, you must create a KV storage version 1. For more information, see the Vault Secrets Engine <a href="https://learn.hashicorp.com/vault/getting-started/secrets-engines" target="_blank" rel="noopener noreferrer">guide</a>.</p>
<p>To integrate Vault-stored keys with Rspamd, simply add the following lines to your <code>local.d/dkim_signing.conf</code> (or <code>arc.conf</code> for <a href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/arc">ARC signing</a>):</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use_vault = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vault_domains = [&quot;example.com&quot;]; # or file/http map path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vault_url = &quot;http://127.0.0.1:8200&quot;; # or https url if using production vault</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vault_token = &quot;s.AhTThjWhKZAf97VowxG6blyu&quot;; # as generated by vault tokens</span><br></span></code></pre></div></div>
<p>To store the vault token securely, you can use JINJA templates and environment/lua variables:</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use_vault = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vault_domains = [&quot;example.com&quot;]; # or file/http map path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vault_url = &quot;http://127.0.0.1:8200&quot;; # or https url if using production vault</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vault_token = &quot;{= VAULT_TOKEN =}&quot;; # as generated by vault tokens</span><br></span></code></pre></div></div>
<p>And start Rspamd with the environment variable:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">RSPAMD_VAULT_TOKEN=&quot;s.AhTThjWhKZAf97VowxG6blyu&quot; rspamd ...</span><br></span></code></pre></div></div>
<p>Rspamd also provides keys management tools using <code>rspamadm</code> command. It can do the following things:</p>
<ul>
<li>Create new keys:</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rspamadm vault create example.com</span><br></span></code></pre></div></div>
<ul>
<li>Create or add new ed25519 keys:</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rspamadm vault create --algorithm eddsa example.com</span><br></span></code></pre></div></div>
<ul>
<li>Delete keys</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rspamadm vault del example.com</span><br></span></code></pre></div></div>
<ul>
<li>Perform safe keys rotation:</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rspamadm vault rotate example.com</span><br></span></code></pre></div></div>
<p>Rspamd generates a new set of keys for each algorithm stored in vault. The new selectors are determined based on the key type and current date, such as <code>rsa-20190501</code>. The previous keys are kept, but their expiration date is set to cease usage after the default ttl grace period of one day. During this grace period, Rspamd will sign messages using both the old and new selectors.</p>
<p>For example, if you have rsa-20190501 and ed25519-20190501 selectors and you want to roll them to 20190601, two new keys will be created: rsa-20190601 and ed25519-20190601. For the grace period, specifically until 20190602, Rspamd will produce four DKIM signatures to allow DNS rollover for the new key. This approach ensures a safe and secure key rotation process by providing ample time to address any DNS cache issues.</p>
<p>The rotate subcommand can also remove all expired keys from the vault.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="sign-headers">Sign headers<a href="#sign-headers" class="hash-link" aria-label="Direct link to Sign headers" title="Direct link to Sign headers">â€‹</a></h2>
<p>Rspamd allows you to change the headers that are required to be signed. From Rspamd 1.7.3, you can specify them using the sign_headers option. By default, Rspamd distinguishes between two types of headers:</p>
<ul>
<li>Normal headers: These headers are signed as many times as you specify them. <strong>Important security notice</strong>: An attacker can add arbitrary headers with the same name before the signed headers and will still get a valid signature. This option is recommended for headers that are not visible to users, such as transport headers.</li>
<li>Oversigned headers: These headers are signed <code>N + 1</code> times <strong>even if <code>N == 0</code></strong>. Oversigned headers cannot be appended to a message without signature breaking. Displayed or meaningful headers are usually oversigned.</li>
<li>Optionally oversigned headers (from 1.9.3): These headers are signed <code>N + 1</code> times <strong>if <code>N != 0</code> only.</strong> Optionally oversigned headers cannot be appended to a message without signature breaking, if at least one header with such a name is presented in the original message. Displayed but optional headers are usually oversigned in this way.</li>
</ul>
<p>Oversigned headers are prefixed with the (o) string. Optionally oversigned headers are prefixed with the (x) string.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="default-sign_headers-after-193">Default sign_headers (after 1.9.3)<a href="#default-sign_headers-after-193" class="hash-link" aria-label="Direct link to Default sign_headers (after 1.9.3)" title="Direct link to Default sign_headers (after 1.9.3)">â€‹</a></h3>
<p>For DKIM signing, Rspamd uses the following default list:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(o)from:(x)sender:(o)reply-to:(o)subject:(x)date:(x)message-id:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(o)to:(o)cc:(x)mime-version:(x)content-type:(x)content-transfer-encoding:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resent-to:resent-cc:resent-from:resent-sender:resent-message-id:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(x)in-reply-to:(x)references:list-id:list-help:list-owner:list-unsubscribe:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">list-unsubscribe-post:list-subscribe:list-post:(x)openpgp:(x)autocrypt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><br></span></code></pre></div></div>
<p>Here is the summary of the list above:</p>





















































































































<table><thead><tr><th style="text-align:left">Header</th><th style="text-align:left">Sign type</th></tr></thead><tbody><tr><td style="text-align:left"><code>From</code></td><td style="text-align:left">Strictly oversign</td></tr><tr><td style="text-align:left"><code>Sender</code></td><td style="text-align:left">Conditionally oversign</td></tr><tr><td style="text-align:left"><code>Reply-To</code></td><td style="text-align:left">Strictly oversign</td></tr><tr><td style="text-align:left"><code>Subject</code></td><td style="text-align:left">Strictly oversign</td></tr><tr><td style="text-align:left"><code>Date</code></td><td style="text-align:left">Conditionally oversign</td></tr><tr><td style="text-align:left"><code>Message-Id</code></td><td style="text-align:left">Conditionally oversign</td></tr><tr><td style="text-align:left"><code>To</code></td><td style="text-align:left">Strictly oversign</td></tr><tr><td style="text-align:left"><code>Cc</code></td><td style="text-align:left">Strictly oversign</td></tr><tr><td style="text-align:left"><code>Mime-Version</code></td><td style="text-align:left">Conditionally oversign</td></tr><tr><td style="text-align:left"><code>Content-Type</code></td><td style="text-align:left">Conditionally oversign</td></tr><tr><td style="text-align:left"><code>Content-Transfer-Encoding</code></td><td style="text-align:left">Conditionally oversign</td></tr><tr><td style="text-align:left"><code>Resent-To</code></td><td style="text-align:left">Do not oversign</td></tr><tr><td style="text-align:left"><code>Resent-Cc</code></td><td style="text-align:left">Do not oversign</td></tr><tr><td style="text-align:left"><code>Resent-From</code></td><td style="text-align:left">Do not oversign</td></tr><tr><td style="text-align:left"><code>Resent-Sender</code></td><td style="text-align:left">Do not oversign</td></tr><tr><td style="text-align:left"><code>Resent-Message-Id</code></td><td style="text-align:left">Do not oversign</td></tr><tr><td style="text-align:left"><code>In-Reply-To</code></td><td style="text-align:left">Conditionally oversign</td></tr><tr><td style="text-align:left"><code>References</code></td><td style="text-align:left">Conditionally oversign</td></tr><tr><td style="text-align:left"><code>List-Id</code></td><td style="text-align:left">Do not oversign</td></tr><tr><td style="text-align:left"><code>List-Help</code></td><td style="text-align:left">Do not oversign</td></tr><tr><td style="text-align:left"><code>List-Owner</code></td><td style="text-align:left">Do not oversign</td></tr><tr><td style="text-align:left"><code>List-Unsubscribe</code></td><td style="text-align:left">Do not oversign</td></tr><tr><td style="text-align:left"><code>List-Unsubscribe-Post</code></td><td style="text-align:left">Do not oversign</td></tr><tr><td style="text-align:left"><code>List-Subscribe</code></td><td style="text-align:left">Do not oversign</td></tr><tr><td style="text-align:left"><code>List-Post</code></td><td style="text-align:left">Do not oversign</td></tr><tr><td style="text-align:left"><code>Openpgp</code></td><td style="text-align:left">Conditionally oversign</td></tr><tr><td style="text-align:left"><code>Autocrypt</code></td><td style="text-align:left">Conditionally oversign</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="rules-of-headers-sign">Rules of headers sign<a href="#rules-of-headers-sign" class="hash-link" aria-label="Direct link to Rules of headers sign" title="Direct link to Rules of headers sign">â€‹</a></h3>
<p><code>sign_headers</code> lists headers that are:</p>
<ul>
<li>signed <code>n</code> times if they are present <code>n</code> times</li>
<li>for the <code>n = 0</code> case this would mean that headers are not signed if they are not present. Oversigned headers are still signed one time to prevent adding a header with this name. Optionally oversigned headers are excluded from that.</li>
<li>headers listed as oversigned are signed <code>n + 1</code> times</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="issues-using-sendmail-on-dkim-signing-and-verification">Issues using Sendmail on DKIM signing and verification<a href="#issues-using-sendmail-on-dkim-signing-and-verification" class="hash-link" aria-label="Direct link to Issues using Sendmail on DKIM signing and verification" title="Direct link to Issues using Sendmail on DKIM signing and verification">â€‹</a></h2>
<p>This part of the documentation has been contributed by Dilyan Palauzov.</p>
<p>When using the sendmail MTA in both signing and verifying mode, there are
a few issues of which to be aware that might cause operational problems
and deserve consideration.</p>
<ul>
<li>
<p>When the MTA will be used for relaying emails, e.g. delivering to other
hosts using the aliases mechanism, it is important not to break
signatures inserted by the original sender.  This is particularly sensitive
particular when the sending domain has published a &quot;reject&quot; DMARC policy.</p>
<p>By default, sendmail quotes to address header fields when there are no
quotes and the display part of the address contains a period or an
apostrophe.  However, Rspamd only observes the raw, unmodified form of
the header field, and so the content that gets verified and what gets
signed will not be the same, guaranteeing the attached signature is not
valid.</p>
<p>To direct sendmail not to modify the headers, add this to your sendmail.mc:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> conf(`confMUST_QUOTE_CHARS&#x27;, `&#x27;)</span><br></span></code></pre></div></div>
</li>
<li>
<p>As stated in sendmail&#x27;s KNOWNBUGS file, sendmail truncates header field
values longer than 256 characters, which could mean truncating the domain
of a long From: header field value and invalidating the signature.
You may wish to consider increasing MAXNAME in sendmail/conf.h to mitigate
changing the messages and invalidating their signatures.  This change
requires recompiling sendmail.</p>
</li>
<li>
<p>Similar to the first bullet above, sendmail may wrap very long single-line recipient
fields for presentation purposes; for example:</p>
</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    To: very long name &lt;a@example.org&gt;,anotherloo...ong name b &lt;b@example.org&gt;</span><br></span></code></pre></div></div>
<p>... might be rewritten as:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    To: very long name &lt;a@example.org&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    	anotherloo...ong name b &lt;b@example.org&gt;</span><br></span></code></pre></div></div>
<p>This rewrite is also done after Rspamd has seen the message, meaning
the signature Rspamd attaches to the message does not match the
content it signed.  There is not a known configuration change to
mitigate this mutation.</p>
<p>The only known mechanism for dealing with this is to have distinct
settings of Rspamd do the verifying (inbound) and signing (outbound)
so that the version that arrives at the signing instance is already
in the rewritten form, guaranteeing the input and output are the same
and thus the signature matches the payload. You can do such a split using <a href="/docs.rspamd.com/branches/vstakhov-docs-search/configuration/settings">user settings</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="optimize-signing-only-mode">Optimize signing only mode<a href="#optimize-signing-only-mode" class="hash-link" aria-label="Direct link to Optimize signing only mode" title="Direct link to Optimize signing only mode">â€‹</a></h2>
<p>If you intend to run Rspamd for DKIM signing only in certain conditions, then please use the <a href="/docs.rspamd.com/branches/vstakhov-docs-search/configuration/settings">user settings</a> as following:</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># local.d/settings.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dkim_signing {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ... # Add conditions to match this setting</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  apply {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    symbols_enabled = [&quot;DKIM_SIGNED&quot;];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    flags = [&quot;skip_process&quot;]; # Disable expensive MIME processing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/rspamd/docs.rspamd.com/edit/master/docs/modules/dkim_signing.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/dkim"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">DKIM module</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/dmarc"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">DMARC module</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#principles-of-operation" class="table-of-contents__link toc-highlight">Principles of operation</a></li><li><a href="#configuration" class="table-of-contents__link toc-highlight">Configuration</a></li><li><a href="#dkim-key-management" class="table-of-contents__link toc-highlight">DKIM key management</a></li><li><a href="#verifying-your-private-keys" class="table-of-contents__link toc-highlight">Verifying your private keys</a></li><li><a href="#dkim-keys-in-redis" class="table-of-contents__link toc-highlight">DKIM keys in Redis</a></li><li><a href="#using-maps" class="table-of-contents__link toc-highlight">Using maps</a></li><li><a href="#use-of-signing_table" class="table-of-contents__link toc-highlight">Use of <code>signing_table</code></a></li><li><a href="#http-headers-based-dkim-signing" class="table-of-contents__link toc-highlight">HTTP headers based DKIM signing</a></li><li><a href="#dkim-signing-using-vault" class="table-of-contents__link toc-highlight">DKIM signing using Vault</a></li><li><a href="#sign-headers" class="table-of-contents__link toc-highlight">Sign headers</a><ul><li><a href="#default-sign_headers-after-193" class="table-of-contents__link toc-highlight">Default sign_headers (after 1.9.3)</a></li><li><a href="#rules-of-headers-sign" class="table-of-contents__link toc-highlight">Rules of headers sign</a></li></ul></li><li><a href="#issues-using-sendmail-on-dkim-signing-and-verification" class="table-of-contents__link toc-highlight">Issues using Sendmail on DKIM signing and verification</a></li><li><a href="#optimize-signing-only-mode" class="table-of-contents__link toc-highlight">Optimize signing only mode</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/vstakhov-docs-search/tutorials/quickstart">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/vstakhov-docs-search/configuration">Configuration</a></li><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules">Modules</a></li><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/vstakhov-docs-search/tutorials">Tutorials</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Resources</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/vstakhov-docs-search/downloads">Downloads</a></li><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/vstakhov-docs-search/faq">FAQ</a></li><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/vstakhov-docs-search/support">Support</a></li><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/vstakhov-docs-search/changelog">Changelog</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/rspamd/rspamd" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/vstakhov-docs-search/tutorials/site_contributing">Contributing</a></li><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/vstakhov-docs-search/blog">Blog</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2025 Rspamd Project. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>