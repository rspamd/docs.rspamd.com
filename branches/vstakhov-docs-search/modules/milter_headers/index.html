<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-modules/milter_headers" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Milter headers module | Rspamd Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://rspamd.com/docs.rspamd.com/branches/vstakhov-docs-search/modules/milter_headers"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="ru"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Milter headers module | Rspamd Documentation"><meta data-rh="true" name="description" content="{:.no_toc}"><meta data-rh="true" property="og:description" content="{:.no_toc}"><link data-rh="true" rel="icon" href="/docs.rspamd.com/branches/vstakhov-docs-search/img/favicon.png"><link data-rh="true" rel="canonical" href="https://rspamd.com/docs.rspamd.com/branches/vstakhov-docs-search/modules/milter_headers"><link data-rh="true" rel="alternate" href="https://rspamd.com/docs.rspamd.com/branches/vstakhov-docs-search/modules/milter_headers" hreflang="en"><link data-rh="true" rel="alternate" href="https://rspamd.com/docs.rspamd.com/branches/vstakhov-docs-search/ru/modules/milter_headers" hreflang="ru"><link data-rh="true" rel="alternate" href="https://rspamd.com/docs.rspamd.com/branches/vstakhov-docs-search/modules/milter_headers" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Modules","item":"https://rspamd.com/docs.rspamd.com/branches/vstakhov-docs-search/modules/"},{"@type":"ListItem","position":2,"name":"Milter headers module","item":"https://rspamd.com/docs.rspamd.com/branches/vstakhov-docs-search/modules/milter_headers"}]}</script><link rel="alternate" type="application/rss+xml" href="/docs.rspamd.com/branches/vstakhov-docs-search/blog/rss.xml" title="Rspamd Documentation RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/docs.rspamd.com/branches/vstakhov-docs-search/blog/atom.xml" title="Rspamd Documentation Atom Feed">




<script>window.SEARCH_BACKEND_CONFIG={endpoint:"/api"}</script><link rel="stylesheet" href="/docs.rspamd.com/branches/vstakhov-docs-search/assets/css/styles.121a41fd.css">
<script src="/docs.rspamd.com/branches/vstakhov-docs-search/assets/js/runtime~main.d53a0eba.js" defer="defer"></script>
<script src="/docs.rspamd.com/branches/vstakhov-docs-search/assets/js/main.64722b56.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/docs.rspamd.com/branches/vstakhov-docs-search/img/rspamd_logo_black.png"><link rel="preload" as="image" href="/docs.rspamd.com/branches/vstakhov-docs-search/img/rspamd_logo_navbar.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://www.rspamd.com" target="_self" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/docs.rspamd.com/branches/vstakhov-docs-search/img/rspamd_logo_black.png" alt="Rspamd Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/docs.rspamd.com/branches/vstakhov-docs-search/img/rspamd_logo_navbar.png" alt="Rspamd Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs.rspamd.com/branches/vstakhov-docs-search/">Documentation</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs.rspamd.com/branches/vstakhov-docs-search/about/">About</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs.rspamd.com/branches/vstakhov-docs-search/tutorials/">Tutorials</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/">Modules</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs.rspamd.com/branches/vstakhov-docs-search/other/usage_policy">Usage Policy</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs.rspamd.com/branches/vstakhov-docs-search/faq">FAQ</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs.rspamd.com/branches/vstakhov-docs-search/support">Support</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs.rspamd.com/branches/vstakhov-docs-search/downloads">Downloads</a><a class="navbar__item navbar__link" href="/docs.rspamd.com/branches/vstakhov-docs-search/blog">Blog</a><a class="navbar__item navbar__link" href="/docs.rspamd.com/branches/vstakhov-docs-search/changelog">Changelog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div><div class="elasticsearch-search-container"><form class="elasticsearch-search-form"><div class="elasticsearch-search-input-container"><input type="text" placeholder="Search documentation..." class="elasticsearch-search-input" aria-label="Search documentation" value=""><div class="elasticsearch-search-shortcut"><span>⌘K</span></div></div></form></div></div><div class="navbar__item"><div id="font-size-control-mount"></div></div><a href="https://github.com/rspamd/rspamd" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs.rspamd.com/branches/vstakhov-docs-search/">About Rspamd</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs.rspamd.com/branches/vstakhov-docs-search/faq">Frequently asked questions</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs.rspamd.com/branches/vstakhov-docs-search/about/">About</a><button aria-label="Expand sidebar category &#x27;About&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs.rspamd.com/branches/vstakhov-docs-search/support">Rspamd Support</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs.rspamd.com/branches/vstakhov-docs-search/downloads">Downloads</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs.rspamd.com/branches/vstakhov-docs-search/configuration/">Configuration</a><button aria-label="Expand sidebar category &#x27;Configuration&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs.rspamd.com/branches/vstakhov-docs-search/workers/">Workers</a><button aria-label="Expand sidebar category &#x27;Workers&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/">Modules</a><button aria-label="Collapse sidebar category &#x27;Modules&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/antivirus">Antivirus module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/arc">ARC module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/asn">ASN module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/bayes_expiry">Bayes expiry module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/chartable">Chartable module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/clickhouse">Clickhouse module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/dcc">DCC module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/dkim">DKIM module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/dkim_signing">DKIM signing module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/dmarc">DMARC module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/elastic">Elasticsearch module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/emails">Emails module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/external_relay">External Relay module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/external_services">External Services module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/force_actions">Force Actions module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/fuzzy_check">Fuzzy check module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/gpt">GPT Plugin</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/greylisting">Greylisting module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/hfilter">Hfilter module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/history_redis">Redis history module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/ip_score">IP Score module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/known_senders">known_senders module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/maillist">Mailing lists module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/metadata_exporter">Metadata exporter</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/metric_exporter">Metric exporter</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/mid">MID module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/milter_headers">Milter headers module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/mime_types">Mime types modules</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/multimap">Multimap module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/mx_check">MX Check module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/neural">Neural network module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/once_received">Once received module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/phishing">Phishing module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/ratelimit">Ratelimit module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/rbl">RBL module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/regexp">Regexp module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/replies">Replies module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/reputation">Reputation module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/rspamd_update">Rspamd update module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/spamassassin">SpamAssassin rules module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/spamtrap">Spamtrap module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/spf">SPF module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/surbl">SURBL module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/trie">Trie module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/url_redirector">URL redirector module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/whitelist">Whitelist module</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs.rspamd.com/branches/vstakhov-docs-search/lua/">Lua API</a><button aria-label="Expand sidebar category &#x27;Lua API&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs.rspamd.com/branches/vstakhov-docs-search/tutorials/">Tutorials</a><button aria-label="Expand sidebar category &#x27;Tutorials&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs.rspamd.com/branches/vstakhov-docs-search/developers/architecture">Developers</a><button aria-label="Expand sidebar category &#x27;Developers&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs.rspamd.com/branches/vstakhov-docs-search/other/rspamadm">Other</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs.rspamd.com/branches/vstakhov-docs-search/blog">Blog</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/docs.rspamd.com/branches/vstakhov-docs-search/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/"><span>Modules</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Milter headers module</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Milter headers module</h1></header>
<p>{:.no_toc}</p>
<p>The <code>milter headers</code> module (formerly known as <code>rmilter headers</code>) has been added in Rspamd 1.5 to provide a relatively simple way to configure adding/removing of headers via Rmilter (the alternative being to use the <a href="/docs.rspamd.com/branches/vstakhov-docs-search/lua/rspamd_task#me7351">API</a>). Despite its name, it is not tied to the <code>milter</code> protocol and also works with supported mailservers that use the HTTP interface such as Haraka and OpenSMTPD.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="principles-of-operation">Principles of operation<a href="#principles-of-operation" class="hash-link" aria-label="Direct link to Principles of operation" title="Direct link to Principles of operation">​</a></h2>
<p>The <code>milter headers</code> module offers several routines for adding/removing common headers, which can be selectively enabled and configured according to specific needs. Additionally, users have the flexibility to add their own custom routines to the configuration or add them directly from <a href="/docs.rspamd.com/branches/vstakhov-docs-search/lua/rspamd_task#m70081">Lua</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="configuration">Configuration<a href="#configuration" class="hash-link" aria-label="Direct link to Configuration" title="Direct link to Configuration">​</a></h2>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># local.d/milter_headers.conf:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Options</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Add &quot;extended Rspamd headers&quot; (default false) (enables x-spamd-result, x-rspamd-server &amp; x-rspamd-queue-id routines)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># extended_spam_headers = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># List of routines to enable for authenticated users (default empty); see also `skip_authenticated`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># authenticated_headers = [&quot;authentication-results&quot;];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Set false to enable all used routines for authenticated users (default true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># skip_authenticated = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># List of routines to enable for local IPs (default empty); see also `skip_local`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># local_headers = [&quot;x-spamd-bar&quot;];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Set false to enable all used routines for local IPs (default true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># skip_local = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Routines to use- this is the only required setting (may be omitted if using extended_spam_headers)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use = [&quot;x-spamd-bar&quot;, &quot;authentication-results&quot;];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># this is where we may configure our selected routines</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">routines {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # settings for x-spamd-bar routine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  x-spamd-bar {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # effectively disables negative spambar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    negative = &quot;&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # other routines...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">custom {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # user-defined routines: more on these later</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="options">Options<a href="#options" class="hash-link" aria-label="Direct link to Options" title="Direct link to Options">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="extended_spam_headers">extended_spam_headers<a href="#extended_spam_headers" class="hash-link" aria-label="Direct link to extended_spam_headers" title="Direct link to extended_spam_headers">​</a></h3>
<p>Add &quot;extended Rspamd headers&quot; to messages <a href="#scan-results-exposure-prevention">NOT originated from authenticated users or <code>our_networks</code></a> (default <code>false</code>). Enables the following routines: <code>x-spamd-result</code>, <code>x-rspamd-server</code> and <code>x-rspamd-queue-id</code>.</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">extended_spam_headers = true;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="authenticated_headers-161">authenticated_headers (1.6.1+)<a href="#authenticated_headers-161" class="hash-link" aria-label="Direct link to authenticated_headers (1.6.1+)" title="Direct link to authenticated_headers (1.6.1+)">​</a></h3>
<p>List of routines to be enabled for authenticated users (default <code>empty</code>). See also <code>skip_authenticated</code>.</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">authenticated_headers = [&quot;authentication-results&quot;];</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="remove_upstream_spam_flag-171">remove_upstream_spam_flag (1.7.1+)<a href="#remove_upstream_spam_flag-171" class="hash-link" aria-label="Direct link to remove_upstream_spam_flag (1.7.1+)" title="Direct link to remove_upstream_spam_flag (1.7.1+)">​</a></h3>
<p>Set <code>false</code> to keep pre-existing spam flag added by an upstream spam filter (default <code>true</code>). This will enable the <code>remove-spam-flag</code> option.</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">remove_upstream_spam_flag = true;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="local_headers-161">local_headers (1.6.1+)<a href="#local_headers-161" class="hash-link" aria-label="Direct link to local_headers (1.6.1+)" title="Direct link to local_headers (1.6.1+)">​</a></h3>
<p>List of routines to enable for local IPs (default <code>empty</code>). See also <code>skip_local</code>.</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">local_headers = [&quot;x-spamd-bar&quot;];</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="skip_local-160">skip_local (1.6.0+)<a href="#skip_local-160" class="hash-link" aria-label="Direct link to skip_local (1.6.0+)" title="Direct link to skip_local (1.6.0+)">​</a></h3>
<p>Set false to always add headers for local IPs (default <code>true</code>).</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">skip_local = true;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="skip_all-280">skip_all (2.8.0+)<a href="#skip_all-280" class="hash-link" aria-label="Direct link to skip_all (2.8.0+)" title="Direct link to skip_all (2.8.0+)">​</a></h3>
<p>Do not add extended headers for any messages (except those matching extended_headers_rcpt) (default <code>false</code>)</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">skip_all = true;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="skip_authenticated-160">skip_authenticated (1.6.0+)<a href="#skip_authenticated-160" class="hash-link" aria-label="Direct link to skip_authenticated (1.6.0+)" title="Direct link to skip_authenticated (1.6.0+)">​</a></h3>
<p>Set false to always add headers for authenticated users (default <code>true</code>)</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">skip_authenticated = true;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="extended_headers_rcpt-162">extended_headers_rcpt (1.6.2+)<a href="#extended_headers_rcpt-162" class="hash-link" aria-label="Direct link to extended_headers_rcpt (1.6.2+)" title="Direct link to extended_headers_rcpt (1.6.2+)">​</a></h3>
<p>List of recipients (default <code>empty</code>).</p>
<p>When <a href="#extended_spam_headers"><code>extended_spam_headers</code></a> is enabled, also add extended Rspamd headers to messages if <strong>EVERY</strong> envelope recipient match this list (e.g. a list of domains mail server responsible for).</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">extended_headers_rcpt = [&quot;user1&quot;, &quot;@example1.com&quot;, &quot;user2@example2.com&quot;];</span><br></span></code></pre></div></div>
<p><code>extended_headers_rcpt</code> has higher precedence than <code>skip_local</code>, <code>skip_authenticated</code> and <code>skip_all</code>.<br>
<code>extended_headers_rcpt</code> paired with <code>skip_all = true</code> can be used to only add extended headers to a map of specific recipients.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="use">use<a href="#use" class="hash-link" aria-label="Direct link to use" title="Direct link to use">​</a></h3>
<p>Routines to use- this is the only required setting (may be omitted if using <code>extended_spam_headers</code>)</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use = [&quot;x-spamd-bar&quot;, &quot;authentication-results&quot;];</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="removing-headers">Removing headers<a href="#removing-headers" class="hash-link" aria-label="Direct link to Removing headers" title="Direct link to Removing headers">​</a></h2>
<p>Configuration dealing with removing headers commonly sets a numeric parameter which is typically set to <code>0</code>.</p>
<p><code>0</code> means all headers with a given name should be removed.
<code>1</code> means remove the first header with a given name, and so on
<code>-1</code> means remove the last header with a given name, and so on</p>
<p>From version 3.9.0, this can be set to <code>null</code> to indicate that foreign headers should not be removed.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="functions">Functions<a href="#functions" class="hash-link" aria-label="Direct link to Functions" title="Direct link to Functions">​</a></h2>
<p>Available routines and their settings are as below, default values are as indicated:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="authentication-results">authentication-results<a href="#authentication-results" class="hash-link" aria-label="Direct link to authentication-results" title="Direct link to authentication-results">​</a></h3>
<p>Add an <a href="https://tools.ietf.org/html/rfc7001" target="_blank" rel="noopener noreferrer">authentication-results</a> header.</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use = [&quot;authentication-results&quot;];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#authenticated_headers = [&quot;authentication-results&quot;]; # to add this header for authenticated users</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">routines {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  authentication-results {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Name of header</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    header = &quot;Authentication-Results&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Remove existing headers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    remove = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Set this false not to add SMTP usernames in authentication-results</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    add_smtp_user = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # SPF/DKIM/DMARC symbols in case these are redefined</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spf_symbols {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      pass = &quot;R_SPF_ALLOW&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      fail = &quot;R_SPF_FAIL&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      softfail = &quot;R_SPF_SOFTFAIL&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      neutral = &quot;R_SPF_NEUTRAL&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      temperror = &quot;R_SPF_DNSFAIL&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      none = &quot;R_SPF_NA&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      permerror = &quot;R_SPF_PERMFAIL&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dkim_symbols {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      pass = &quot;R_DKIM_ALLOW&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      fail = &quot;R_DKIM_REJECT&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      temperror = &quot;R_DKIM_TEMPFAIL&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      none = &quot;R_DKIM_NA&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      permerror = &quot;R_DKIM_PERMFAIL&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dmarc_symbols {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      pass = &quot;DMARC_POLICY_ALLOW&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      permerror = &quot;DMARC_BAD_POLICY&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      temperror = &quot;DMARC_DNSFAIL&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      none = &quot;DMARC_NA&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      reject = &quot;DMARC_POLICY_REJECT&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      softfail = &quot;DMARC_POLICY_SOFTFAIL&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      quarantine = &quot;DMARC_POLICY_QUARANTINE&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="fuzzy-hashes-175">fuzzy-hashes (1.7.5+)<a href="#fuzzy-hashes-175" class="hash-link" aria-label="Direct link to fuzzy-hashes (1.7.5+)" title="Direct link to fuzzy-hashes (1.7.5+)">​</a></h3>
<p>For each matched fuzzy hash adds a header containing the hash.</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use = [&quot;fuzzy-hashes&quot;];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">routines {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fuzzy-hashes {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    header = &quot;X-Rspamd-Fuzzy&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    remove = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="remove-header-162">remove-header (1.6.2+)<a href="#remove-header-162" class="hash-link" aria-label="Direct link to remove-header (1.6.2+)" title="Direct link to remove-header (1.6.2+)">​</a></h3>
<p>Removes a header with the specified name (<code>header</code> MUST be specified):</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use = [&quot;remove-header&quot;];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">routines {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  remove-header {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    header = &quot;Remove-This&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    remove = 0; # 0 means remove all, 1 means remove the first one , -1 remove the last and so on</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="remove-headers-163">remove-headers (1.6.3+)<a href="#remove-headers-163" class="hash-link" aria-label="Direct link to remove-headers (1.6.3+)" title="Direct link to remove-headers (1.6.3+)">​</a></h3>
<p>Removes multiple headers (<code>headers</code> MUST be specified):</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use = [&quot;remove-headers&quot;];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">routines {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  remove-headers {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    headers {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;Remove-This&quot; = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;This-Too&quot; = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="remove-spam-flag-171">remove-spam-flag (1.7.1+)<a href="#remove-spam-flag-171" class="hash-link" aria-label="Direct link to remove-spam-flag (1.7.1+)" title="Direct link to remove-spam-flag (1.7.1+)">​</a></h3>
<p>Removes pre-existing spam flag added by an upstream spam filter.</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use = [&quot;remove-spam-flag&quot;];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">routines {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  remove-spam-flag {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    header = &quot;X-Spam&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>Default name of the header to be removed is <code>X-Spam</code> which can be manipulated using the <code>header</code> setting.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="spam-header">spam-header<a href="#spam-header" class="hash-link" aria-label="Direct link to spam-header" title="Direct link to spam-header">​</a></h3>
<p>Adds a predefined header to mail identified as spam.</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use = [&quot;spam-header&quot;];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">routines {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  spam-header {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    header = &quot;Deliver-To&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    value = &quot;Junk&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    remove = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>Default name/value of the added header is <code>Deliver-To</code>/<code>Junk</code> which can be manipulated using the <code>header</code> and <code>value</code> settings.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="stat-signature-163">stat-signature (1.6.3+)<a href="#stat-signature-163" class="hash-link" aria-label="Direct link to stat-signature (1.6.3+)" title="Direct link to stat-signature (1.6.3+)">​</a></h3>
<p>Attaches the stat signature to the message.</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use = [&quot;stat-signature&quot;];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">routines {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  stat-signature {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    header = &#x27;X-Stat-Signature&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    remove = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="x-rspamd-queue-id-158">x-rspamd-queue-id (1.5.8+)<a href="#x-rspamd-queue-id-158" class="hash-link" aria-label="Direct link to x-rspamd-queue-id (1.5.8+)" title="Direct link to x-rspamd-queue-id (1.5.8+)">​</a></h3>
<p>Adds a header containing the Rspamd queue id of the message <a href="#scan-results-exposure-prevention">if it is NOT originated from authenticated users or <code>our_networks</code></a>.</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use = [&quot;x-rspamd-queue-id&quot;];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">routines {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  x-rspamd-queue-id {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    header = &#x27;X-Rspamd-Queue-Id&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    remove = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="x-spamd-result-158">x-spamd-result (1.5.8+)<a href="#x-spamd-result-158" class="hash-link" aria-label="Direct link to x-spamd-result (1.5.8+)" title="Direct link to x-spamd-result (1.5.8+)">​</a></h3>
<p>Adds a header containing the scan results <a href="#scan-results-exposure-prevention">if the message is NOT originated from authenticated users or <code>our_networks</code></a>.</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use = [&quot;x-spamd-result&quot;];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">routines {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  x-spamd-result {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    header = &#x27;X-Spamd-Result&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    remove = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="x-rspamd-server-158">x-rspamd-server (1.5.8+)<a href="#x-rspamd-server-158" class="hash-link" aria-label="Direct link to x-rspamd-server (1.5.8+)" title="Direct link to x-rspamd-server (1.5.8+)">​</a></h3>
<p>Adds a header containing the local computer host name of the Rspamd server that checked out the message <a href="#scan-results-exposure-prevention">if it is NOT originated from authenticated users or <code>our_networks</code></a>. Since Rspamd 2.4 the host name can be replaced with a user-defined string specified in the <code>hostname</code> setting.</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use = [&quot;x-rspamd-server&quot;];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">routines {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  x-rspamd-server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    header = &#x27;X-Rspamd-Server&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    remove = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #hostname = &quot;foo.com&quot;; -- Local computer host name if unspecified (2.4+)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="x-spamd-bar">x-spamd-bar<a href="#x-spamd-bar" class="hash-link" aria-label="Direct link to x-spamd-bar" title="Direct link to x-spamd-bar">​</a></h3>
<p>Adds a visual indicator of spam/ham level.</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use = [&quot;x-spamd-bar&quot;];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">routines {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  x-spamd-bar {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    header = &quot;X-Spamd-Bar&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    positive = &quot;+&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    negative = &quot;-&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    neutral = &quot;/&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    remove = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="x-spam-level">x-spam-level<a href="#x-spam-level" class="hash-link" aria-label="Direct link to x-spam-level" title="Direct link to x-spam-level">​</a></h3>
<p>Another visual indicator of spam level- SpamAssassin style.</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use = [&quot;x-spam-level&quot;];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">routines {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  x-spamd-level {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    header = &quot;X-Spam-Level&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    char = &quot;*&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    remove = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="x-spam-status">x-spam-status<a href="#x-spam-status" class="hash-link" aria-label="Direct link to x-spam-status" title="Direct link to x-spam-status">​</a></h3>
<p>SpamAssassin-style X-Spam-Status header indicating spam status.</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use = [&quot;x-spam-status&quot;];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">routines {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  x-spam-status {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    header = &quot;X-Spam-Status&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    remove = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="x-virus">x-virus<a href="#x-virus" class="hash-link" aria-label="Direct link to x-virus" title="Direct link to x-virus">​</a></h3>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use = [&quot;x-virus&quot;];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">routines {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  x-virus {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    header = &quot;X-Virus&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    remove = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # The following setting is an empty list by default and required to be set</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # These are user-defined symbols added by the antivirus module</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    symbols = [&quot;CLAM_VIRUS&quot;, &quot;FPROT_VIRUS&quot;];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>If the <a href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/antivirus">Antivirus module</a> detects any viruses in an email, the module adds a header that contains the names of the viruses detected by the configured scanners.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="custom-routines">Custom routines<a href="#custom-routines" class="hash-link" aria-label="Direct link to Custom routines" title="Direct link to Custom routines">​</a></h2>
<p>User-defined routines can be defined in configuration in the <code>custom</code> section, for example:</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use = [&quot;my_routine&quot;];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">custom {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  my_routine = &lt;&lt;EOD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return function(task, common_meta)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -- parameters are task and metadata from previous functions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return nil, -- no error</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {[&#x27;X-Foo&#x27;] = &#x27;Bar&#x27;}, -- add header: X-Foo: Bar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {[&#x27;X-Foo&#x27;] = 0 }, -- remove foreign X-Foo headers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {} -- metadata to return to other functions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOD;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>You can reference the key <code>my_routine</code> in the <code>use</code> setting, just like you would with other routines.</p>
<p>Here&#x27;s a more complex example: If a specific symbol is added, the module will add an additional header:</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use = [&quot;my_routine&quot;];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">custom {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  my_routine = &lt;&lt;EOD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return function(task, common_meta)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -- parameters are task and metadata from previous functions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if task:has_symbol(&#x27;SYMBOL&#x27;) then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      return nil, -- no error</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {[&#x27;X-Foo&#x27;] = &#x27;Bar&#x27;}, -- set extra header</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {[&#x27;X-Foo&#x27;] = 0}, -- remove foreign X-Foo headers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {} -- metadata to return to other functions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return nil, -- no error</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {}, -- need to fill the parameter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {[&#x27;X-Foo&#x27;] = 0}, -- remove foreign X-Foo headers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {} -- metadata to return to other functions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOD;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="scan-results-exposure-prevention">Scan results exposure prevention<a href="#scan-results-exposure-prevention" class="hash-link" aria-label="Direct link to Scan results exposure prevention" title="Direct link to Scan results exposure prevention">​</a></h2>
<p>To avoid exposing scan results in outbound email, the extended Rspamd headers routines (<code>x-spamd-result</code>, <code>x-rspamd-server</code> and <code>x-rspamd-queue-id</code>) only add headers if the message is <strong>NOT</strong> originated from authenticated users or <code>our_networks</code>.</p>
<p>If desired, the <a href="#extended_headers_rcpt-162"><code>extended_headers_rcpt</code></a> option can be used to include the extended Rspamd headers in messages sent to specific recipients or domains, such as a list of domains the mail server is responsible for.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="disabling-dsn">Disabling DSN<a href="#disabling-dsn" class="hash-link" aria-label="Direct link to Disabling DSN" title="Direct link to Disabling DSN">​</a></h3>
<p>Delivery status notification (DSN) reports for <em>successful</em> email deliveries can include the original message headers, including Rspamd headers. The only way to prevent this is to stop offering DSN to foreign servers.</p>
<p>Additionally, disabling DSN can prevent the generation of backscatter.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="postfix-example">Postfix example<a href="#postfix-example" class="hash-link" aria-label="Direct link to Postfix example" title="Direct link to Postfix example">​</a></h3>
<p>The following configuration example restricts DSN requests to local subnets and authenticated users only. Note that the <code>smtpd_discard_ehlo_keyword_address_maps</code> setting is applied to the <code>smtp</code> service only, and not to <code>smtps</code> or <code>submission</code>.</p>
<p>Make sure to modify the example below to match your subnet(s) accordingly.</p>
<p>esmtp_access:</p>
<div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Allow DSN requests from local subnets only</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">192.168.0.0/16  silent-discard</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10.10.0.0/16    silent-discard</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0.0.0.0/0       silent-discard, dsn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">::/0            silent-discard, dsn</span><br></span></code></pre></div></div>
<p>master.cf:</p>
<div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># ==========================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># service type  private unpriv  chroot  wakeup  maxproc command + args</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#               (yes)   (yes)   (no)    (never) (100)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ==========================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">smtp      inet  n       -       n       -       1       postscreen</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -o smtpd_discard_ehlo_keyword_address_maps=cidr:$config_directory/esmtp_access</span><br></span></code></pre></div></div>
<p>or globally
main.cf:</p>
<div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">smtpd_discard_ehlo_keyword_address_maps = </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cidr:$config_directory/esmtp_access</span><br></span></code></pre></div></div>
<p>DSN can also be disabled for everyone with a shorter configuration change:
main.cf:</p>
<div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># $config_directory/main.cf:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    smtpd_discard_ehlo_keywords = silent-discard, dsn</span><br></span></code></pre></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/rspamd/docs.rspamd.com/edit/master/docs/modules/milter_headers.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/mid"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">MID module</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/mime_types"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Mime types modules</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#principles-of-operation" class="table-of-contents__link toc-highlight">Principles of operation</a></li><li><a href="#configuration" class="table-of-contents__link toc-highlight">Configuration</a></li><li><a href="#options" class="table-of-contents__link toc-highlight">Options</a><ul><li><a href="#extended_spam_headers" class="table-of-contents__link toc-highlight">extended_spam_headers</a></li><li><a href="#authenticated_headers-161" class="table-of-contents__link toc-highlight">authenticated_headers (1.6.1+)</a></li><li><a href="#remove_upstream_spam_flag-171" class="table-of-contents__link toc-highlight">remove_upstream_spam_flag (1.7.1+)</a></li><li><a href="#local_headers-161" class="table-of-contents__link toc-highlight">local_headers (1.6.1+)</a></li><li><a href="#skip_local-160" class="table-of-contents__link toc-highlight">skip_local (1.6.0+)</a></li><li><a href="#skip_all-280" class="table-of-contents__link toc-highlight">skip_all (2.8.0+)</a></li><li><a href="#skip_authenticated-160" class="table-of-contents__link toc-highlight">skip_authenticated (1.6.0+)</a></li><li><a href="#extended_headers_rcpt-162" class="table-of-contents__link toc-highlight">extended_headers_rcpt (1.6.2+)</a></li><li><a href="#use" class="table-of-contents__link toc-highlight">use</a></li></ul></li><li><a href="#removing-headers" class="table-of-contents__link toc-highlight">Removing headers</a></li><li><a href="#functions" class="table-of-contents__link toc-highlight">Functions</a><ul><li><a href="#authentication-results" class="table-of-contents__link toc-highlight">authentication-results</a></li><li><a href="#fuzzy-hashes-175" class="table-of-contents__link toc-highlight">fuzzy-hashes (1.7.5+)</a></li><li><a href="#remove-header-162" class="table-of-contents__link toc-highlight">remove-header (1.6.2+)</a></li><li><a href="#remove-headers-163" class="table-of-contents__link toc-highlight">remove-headers (1.6.3+)</a></li><li><a href="#remove-spam-flag-171" class="table-of-contents__link toc-highlight">remove-spam-flag (1.7.1+)</a></li><li><a href="#spam-header" class="table-of-contents__link toc-highlight">spam-header</a></li><li><a href="#stat-signature-163" class="table-of-contents__link toc-highlight">stat-signature (1.6.3+)</a></li><li><a href="#x-rspamd-queue-id-158" class="table-of-contents__link toc-highlight">x-rspamd-queue-id (1.5.8+)</a></li><li><a href="#x-spamd-result-158" class="table-of-contents__link toc-highlight">x-spamd-result (1.5.8+)</a></li><li><a href="#x-rspamd-server-158" class="table-of-contents__link toc-highlight">x-rspamd-server (1.5.8+)</a></li><li><a href="#x-spamd-bar" class="table-of-contents__link toc-highlight">x-spamd-bar</a></li><li><a href="#x-spam-level" class="table-of-contents__link toc-highlight">x-spam-level</a></li><li><a href="#x-spam-status" class="table-of-contents__link toc-highlight">x-spam-status</a></li><li><a href="#x-virus" class="table-of-contents__link toc-highlight">x-virus</a></li></ul></li><li><a href="#custom-routines" class="table-of-contents__link toc-highlight">Custom routines</a></li><li><a href="#scan-results-exposure-prevention" class="table-of-contents__link toc-highlight">Scan results exposure prevention</a><ul><li><a href="#disabling-dsn" class="table-of-contents__link toc-highlight">Disabling DSN</a></li><li><a href="#postfix-example" class="table-of-contents__link toc-highlight">Postfix example</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/vstakhov-docs-search/tutorials/quickstart">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/vstakhov-docs-search/configuration">Configuration</a></li><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules">Modules</a></li><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/vstakhov-docs-search/tutorials">Tutorials</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Resources</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/vstakhov-docs-search/downloads">Downloads</a></li><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/vstakhov-docs-search/faq">FAQ</a></li><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/vstakhov-docs-search/support">Support</a></li><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/vstakhov-docs-search/changelog">Changelog</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/rspamd/rspamd" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/vstakhov-docs-search/tutorials/site_contributing">Contributing</a></li><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/vstakhov-docs-search/blog">Blog</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Rspamd Project. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>