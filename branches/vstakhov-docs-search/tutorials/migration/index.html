<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-tutorials/migration" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Upgrading | Rspamd Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://rspamd.com/docs.rspamd.com/branches/vstakhov-docs-search/tutorials/migration"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="ru"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Upgrading | Rspamd Documentation"><meta data-rh="true" name="description" content="This document outlines the modifications to Rspamd in recent versions, including any incompatible changes, and provides instructions for updating your rules and configuration accordingly."><meta data-rh="true" property="og:description" content="This document outlines the modifications to Rspamd in recent versions, including any incompatible changes, and provides instructions for updating your rules and configuration accordingly."><link data-rh="true" rel="icon" href="/docs.rspamd.com/branches/vstakhov-docs-search/img/favicon.png"><link data-rh="true" rel="canonical" href="https://rspamd.com/docs.rspamd.com/branches/vstakhov-docs-search/tutorials/migration"><link data-rh="true" rel="alternate" href="https://rspamd.com/docs.rspamd.com/branches/vstakhov-docs-search/tutorials/migration" hreflang="en"><link data-rh="true" rel="alternate" href="https://rspamd.com/docs.rspamd.com/branches/vstakhov-docs-search/ru/tutorials/migration" hreflang="ru"><link data-rh="true" rel="alternate" href="https://rspamd.com/docs.rspamd.com/branches/vstakhov-docs-search/tutorials/migration" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Tutorials","item":"https://rspamd.com/docs.rspamd.com/branches/vstakhov-docs-search/tutorials/"},{"@type":"ListItem","position":2,"name":"Upgrading","item":"https://rspamd.com/docs.rspamd.com/branches/vstakhov-docs-search/tutorials/migration"}]}</script><link rel="alternate" type="application/rss+xml" href="/docs.rspamd.com/branches/vstakhov-docs-search/blog/rss.xml" title="Rspamd Documentation RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/docs.rspamd.com/branches/vstakhov-docs-search/blog/atom.xml" title="Rspamd Documentation Atom Feed">




<script>window.SEARCH_BACKEND_CONFIG={endpoint:"/api"}</script><link rel="stylesheet" href="/docs.rspamd.com/branches/vstakhov-docs-search/assets/css/styles.121a41fd.css">
<script src="/docs.rspamd.com/branches/vstakhov-docs-search/assets/js/runtime~main.d53a0eba.js" defer="defer"></script>
<script src="/docs.rspamd.com/branches/vstakhov-docs-search/assets/js/main.64722b56.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/docs.rspamd.com/branches/vstakhov-docs-search/img/rspamd_logo_black.png"><link rel="preload" as="image" href="/docs.rspamd.com/branches/vstakhov-docs-search/img/rspamd_logo_navbar.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://www.rspamd.com" target="_self" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/docs.rspamd.com/branches/vstakhov-docs-search/img/rspamd_logo_black.png" alt="Rspamd Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/docs.rspamd.com/branches/vstakhov-docs-search/img/rspamd_logo_navbar.png" alt="Rspamd Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs.rspamd.com/branches/vstakhov-docs-search/">Documentation</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs.rspamd.com/branches/vstakhov-docs-search/about/">About</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs.rspamd.com/branches/vstakhov-docs-search/tutorials/">Tutorials</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/">Modules</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs.rspamd.com/branches/vstakhov-docs-search/other/usage_policy">Usage Policy</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs.rspamd.com/branches/vstakhov-docs-search/faq">FAQ</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs.rspamd.com/branches/vstakhov-docs-search/support">Support</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs.rspamd.com/branches/vstakhov-docs-search/downloads">Downloads</a><a class="navbar__item navbar__link" href="/docs.rspamd.com/branches/vstakhov-docs-search/blog">Blog</a><a class="navbar__item navbar__link" href="/docs.rspamd.com/branches/vstakhov-docs-search/changelog">Changelog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div><div class="elasticsearch-search-container"><form class="elasticsearch-search-form"><div class="elasticsearch-search-input-container"><input type="text" placeholder="Search documentation..." class="elasticsearch-search-input" aria-label="Search documentation" value=""><div class="elasticsearch-search-shortcut"><span>⌘K</span></div></div></form></div></div><div class="navbar__item"><div id="font-size-control-mount"></div></div><a href="https://github.com/rspamd/rspamd" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs.rspamd.com/branches/vstakhov-docs-search/">About Rspamd</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs.rspamd.com/branches/vstakhov-docs-search/faq">Frequently asked questions</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs.rspamd.com/branches/vstakhov-docs-search/about/">About</a><button aria-label="Expand sidebar category &#x27;About&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs.rspamd.com/branches/vstakhov-docs-search/support">Rspamd Support</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs.rspamd.com/branches/vstakhov-docs-search/downloads">Downloads</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs.rspamd.com/branches/vstakhov-docs-search/configuration/">Configuration</a><button aria-label="Expand sidebar category &#x27;Configuration&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs.rspamd.com/branches/vstakhov-docs-search/workers/">Workers</a><button aria-label="Expand sidebar category &#x27;Workers&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/">Modules</a><button aria-label="Expand sidebar category &#x27;Modules&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs.rspamd.com/branches/vstakhov-docs-search/lua/">Lua API</a><button aria-label="Expand sidebar category &#x27;Lua API&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs.rspamd.com/branches/vstakhov-docs-search/tutorials/">Tutorials</a><button aria-label="Collapse sidebar category &#x27;Tutorials&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/tutorials/quickstart">Quick start</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/tutorials/migration">Upgrading</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/tutorials/migrate_sa">Migrating from SpamAssassin</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/tutorials/scanning_outbound">Scanning outbound mail</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/tutorials/fuzzy_storage">Usage of fuzzy hashes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/tutorials/redis_replication">Multi-instance Redis replication</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/tutorials/stunnel_setup">Setup stunnel to protect Redis</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/tutorials/integration">MTA integration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/tutorials/feedback_from_users_with_IMAPSieve">Getting feedback from users with IMAPSieve</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/tutorials/site_contributing">Contributing to Rspamd Documentation</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs.rspamd.com/branches/vstakhov-docs-search/tutorials/multimap_guide">Module Guides</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs.rspamd.com/branches/vstakhov-docs-search/developers/architecture">Developers</a><button aria-label="Expand sidebar category &#x27;Developers&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs.rspamd.com/branches/vstakhov-docs-search/other/rspamadm">Other</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs.rspamd.com/branches/vstakhov-docs-search/blog">Blog</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/docs.rspamd.com/branches/vstakhov-docs-search/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs.rspamd.com/branches/vstakhov-docs-search/tutorials/"><span>Tutorials</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Upgrading</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Updating Rspamd</h1></header>
<p>This document outlines the modifications to Rspamd in recent versions, including any incompatible changes, and provides instructions for updating your rules and configuration accordingly.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="efficient-rspamd-cluster-upgrade-guide">Efficient Rspamd Cluster Upgrade Guide<a href="#efficient-rspamd-cluster-upgrade-guide" class="hash-link" aria-label="Direct link to Efficient Rspamd Cluster Upgrade Guide" title="Direct link to Efficient Rspamd Cluster Upgrade Guide">​</a></h2>
<p>Discover a reliable step-by-step process for upgrading your Rspamd cluster while maintaining stability and minimizing downtime. This guide emphasizes a cautious approach with extensive testing to ensure a seamless transition between versions.</p>
<ol>
<li>
<p>Ensure that you have a backup of the current stable configuration files, as well as any custom rules, maps, or other settings specific to your cluster.</p>
</li>
<li>
<p>Use stable packages on a stable cluster. Always use the latest stable release of Rspamd in your production environment.</p>
</li>
<li>
<p>Add a node or multiple nodes to an experimental cluster using the experimental repository. This will allow you to test the new version in a controlled environment without affecting the stable cluster.</p>
</li>
<li>
<p>Mirror traffic from the stable cluster to the experimental cluster using the <code>rspamd_proxy</code> module. This will help you identify any potential issues or differences between the two versions of Rspamd.</p>
</li>
<li>
<p>Monitor the experimental cluster for any discrepancies, crashes, or other issues. Address these problems as they arise.</p>
</li>
<li>
<p>When a new release is cut, update the experimental cluster to the stable version.</p>
</li>
<li>
<p>Repeat steps 4-5 one more time to ensure that any previously identified issues have been resolved.</p>
</li>
<li>
<p>Once you are confident that the new version is stable and compatible with your environment, update the stable cluster to the next version.</p>
</li>
<li>
<p>Continue to monitor the stable cluster to ensure smooth operation and resolve any issues that may arise after the upgrade.</p>
</li>
<li>
<p>Repeat the entire process starting from <code>step 1</code> for future updates. This approach ensures a smooth and controlled upgrade process that minimizes potential downtime and issues in your production environment.</p>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="migration-to-rspamd-390">Migration to Rspamd 3.9.0<a href="#migration-to-rspamd-390" class="hash-link" aria-label="Direct link to Migration to Rspamd 3.9.0" title="Direct link to Migration to Rspamd 3.9.0">​</a></h2>
<ul>
<li>
<p>The <code>ratelimit</code> module now operates in non-dynamic mode by default. This change does not affect any existing buckets, as dynamic rates and dynamic bursts will simply be unused in this mode. To retain the old behaviour, please either set the <code>dynamic_rate_limit</code> option to <code>true</code> (globally for all ratelimit rules) or configure the <code>ham_factor_rate</code>/<code>spam_factor_rate</code> and/or <code>ham_factor_burst</code>/<code>spam_factor_burst</code> multipliers for individual rules as needed.</p>
</li>
<li>
<p>Bayes statistics now use a reduced window size (2 words), which has proven to be faster and more space-efficient in our tests. Existing statistics can be used without any modifications or relearning. To restore the old behaviour, one can set the following to <code>local.d/classifier-bayes.conf</code>:</p>
</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">tokenizer {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name = &quot;osb&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  window = 5;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>However, it is recommended to use the default settings.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="migration-to-rspamd-374">Migration to Rspamd 3.7.4<a href="#migration-to-rspamd-374" class="hash-link" aria-label="Direct link to Migration to Rspamd 3.7.4" title="Direct link to Migration to Rspamd 3.7.4">​</a></h2>
<p>The <code>exclude_private_ips</code> setting in RBL module no longer exists in this release (and was broken in previous releases), it can be removed from configuration. This setting is equivalent to <code>exclude_local</code>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="migration-to-rspamd-372">Migration to Rspamd 3.7.2<a href="#migration-to-rspamd-372" class="hash-link" aria-label="Direct link to Migration to Rspamd 3.7.2" title="Direct link to Migration to Rspamd 3.7.2">​</a></h2>
<p>This release introduces <a href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/rbl#returncodes-matchers">returncodes matchers</a> in RBL module. Previously returncodes were always treated as Lua patterns, now this behaviour is enabled by setting <code>matcher = &quot;luapattern&quot;</code> on the rule. For backwards-compatibility this matcher may be enabled implicitly where Lua patterns are detected but they may not be correctly detected in all cases. If you use custom RBL module configuration that makes use of Lua patterns please review it and explicitly set matcher where necessary.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="migration-to-rspamd-33">Migration to Rspamd 3.3<a href="#migration-to-rspamd-33" class="hash-link" aria-label="Direct link to Migration to Rspamd 3.3" title="Direct link to Migration to Rspamd 3.3">​</a></h2>
<p>When migrating to Rspamd 3.3, exercise caution if you are utilizing custom passthrough rules, particularly those defined by plugins that utilize <code>action</code> rather than <code>least action</code>). In versions prior to 3.3, these rules would still allow for processing of additional rules. However, in Rspamd 3.3 and beyond, passthrough denotes a final action and skips directly to the idempotent stage.</p>
<p>Users of the <code>neural</code> plugin may experience a significant Redis storage leak in version 3.2. This issue is resolved in version 3.3 with <a href="https://github.com/rspamd/rspamd/commit/f9cfbba2c84e01f18e65618587e6854681843ff1" target="_blank" rel="noopener noreferrer">the following commit</a>, however, this fix will not remove any existing stale keys. These keys also do not have an expiration set. One solution to clean up the database is to remove all keys starting with the <code>rn_</code> prefix. There are various options available to accomplish this, such as exploring the <a href="https://stackoverflow.com/questions/4006324/how-to-atomically-delete-keys-matching-a-pattern-using-redis" target="_blank" rel="noopener noreferrer">following conversation</a> on Stackoverflow.</p>
<p>Starting from this version, building Rspamd requires a <strong>C++20</strong> compatible compiler and toolchain. For Ubuntu Bionic users, this means adding the LLVM repository for the compatible C++20 standard library runtime. The necessary steps are outlined on the <a href="/docs.rspamd.com/branches/vstakhov-docs-search/downloads">downloads page</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="migration-to-rspamd-30">Migration to Rspamd 3.0<a href="#migration-to-rspamd-30" class="hash-link" aria-label="Direct link to Migration to Rspamd 3.0" title="Direct link to Migration to Rspamd 3.0">​</a></h2>
<p>The functionality for DMARC reporting is no longer included in the DMARC module. To send DMARC reports, you must now run the <code>rspamadm dmarc_report</code> command on a regular basis, such as through a cron job. Additionally, the configuration for reporting has undergone incompatible changes, so please refer to the <a href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/dmarc">module documentation</a> for further information.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="migration-to-rspamd-26">Migration to Rspamd 2.6<a href="#migration-to-rspamd-26" class="hash-link" aria-label="Direct link to Migration to Rspamd 2.6" title="Direct link to Migration to Rspamd 2.6">​</a></h2>
<p>To ensure proper functionality of the GUI after upgrading to 2.6, it is necessary to clear the browser cache and restart the browser.</p>
<p>Additionally, the <code>Neural networks</code> plugin&#x27;s training data will be lost as the internal structure of the NN has been redesigned in an incompatible manner. However, training can continue as normal.</p>
<p>If you encounter complaints about <code>SENDER_REP_HAM</code> and <code>SENDER_REP_SPAM</code> symbols in Rspamd logs, you may need to define scores for these symbols. Refer to the <a href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/reputation">reputation module documentation</a>. This issue will be fixed in future Rspamd releases.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="migration-to-rspamd-20">Migration to Rspamd 2.0<a href="#migration-to-rspamd-20" class="hash-link" aria-label="Direct link to Migration to Rspamd 2.0" title="Direct link to Migration to Rspamd 2.0">​</a></h2>
<p>The RBL module has replaced both the <code>emails</code> and <code>surbl</code> modules, consolidating all Runtime Black Lists checks in a single location. The existing rules are typically automatically converted to the<code>rbl</code> syntax, including those defined in <code>local.d</code>. However, <code>override.d</code> rules will only act as overrides for <code>local.d</code> and not for RBL module. If you need to use overrides, consider converting them to <code>override.d/rbl.conf</code> rules.</p>
<p>Note that <code>emails</code> rules utilizing maps instead of DNS RBLs are <strong>NO LONGER SUPPORTED</strong>. Instead, use <code>multimap</code> with selectors.</p>
<p>In version 2.0, the default Bayes backend has been changed to Redis. The Sqlite backend is now considered deprecated and is not recommended for use. Therefore, if you were previously using the <code>sqlite</code> backend as default, you will need to specify its type manually or convert it to Redis (or even, start again and relearn Redis backend).</p>
<p>The <code>ip_score</code> module has been replaced by the <code>reputation</code> module, and the existing rules should be automatically converted to the new syntax. The symbol name has also been changed to two symbols: <code>SENDER_REP_SPAM</code> and <code>SENDER_REP_HAM</code>, and the scores for <code>IP_SCORE</code> should be automatically applied to these new symbols. However, it should be noted that any data collected by the <code>ip_score</code> plugin will be <strong>IRRECOVERABLY LOST</strong>. This change was necessary due to a significant flaw in the old plugin that caused the reputation to never expire.</p>
<p>The <code>neural</code> module has undergone a significant update. While no config incompatibilities have been identified, it should be noted that any existing network data will be <strong>IRRECOVERABLY LOST</strong>.</p>
<p>When building Rspamd from source, a <strong>C++11</strong> capable compiler is now required as there are bundled dependencies written in C++ (specifically, the replxx library). Additionally, the <code>libsodium</code> is also necessary. Rspamd now only supports the <code>clang</code> and <code>gcc</code> compilers. Other compilers may still work, but it is no longer guaranteed.</p>
<p>Additionally, Bayes expiry now always works in <code>lazy</code> mode and the default mode has been changed to <code>lazy</code> only.</p>
<p>Furthermore, the Log helper worker has been removed, although it is unlikely that it was being used by anyone.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="migration-to-rspamd-191">Migration to Rspamd 1.9.1<a href="#migration-to-rspamd-191" class="hash-link" aria-label="Direct link to Migration to Rspamd 1.9.1" title="Direct link to Migration to Rspamd 1.9.1">​</a></h2>
<p>From version 1.9.1, Rspamd supports <a href="https://jinja.palletsprojects.com" target="_blank" rel="noopener noreferrer">Jinja2 templates</a> provided by <a href="https://foicica.com/lupa/" target="_blank" rel="noopener noreferrer">Lupa Lua library</a>. You can learn more about the basic syntax and capabilities of these templating engines by following the links provided. Rspamd uses a specific syntax for variable tags: <code>{=</code> and <code>=}</code> instead of the traditional `` as these tags could represent, for example, a table within a table in Lua.</p>
<p>Therefore, in version 1.9.1 and above, your config files must be Jinja safe, meaning that there should be no special sequences such as `</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="migration-to-rspamd-190">Migration to Rspamd 1.9.0<a href="#migration-to-rspamd-190" class="hash-link" aria-label="Direct link to Migration to Rspamd 1.9.0" title="Direct link to Migration to Rspamd 1.9.0">​</a></h2>
<p>This version should not generally be incompatible with the previous one aside of the case if you build Rspamd from the sources or use a custom package. From the version 1.9, Rspamd has changed some of the default installation paths:</p>
<ul>
<li>There is a new <code>${LIBDIR}/rspamd/librspamd-server.so</code> library that contains common functions for <code>rspamd</code>, <code>rspamadm</code> and <code>rspamc</code> binaries</li>
<li><code>${PLUGINSDIR}</code> is now set to a specific path for Lua plugins and is <strong>no longer</strong> in the Lua path; it is suggested to use <code>${LUALIBDIR}</code> for all shared Lua code</li>
<li>Here are default values for the paths used by Rspamd:
<ul>
<li><code>CONFDIR</code> = <code>${PREFIX}/etc/rspamd</code> - main path for the configuration</li>
<li><code>LOCAL_CONFDIR</code> = <code>${PREFIX}/etc/rspamd</code> - path for the user&#x27;s defined configuration</li>
<li><code>RUNDIR</code> = OS specific (<code>/var/run/rspamd</code> on Linux) - used to store volatile runtime data (e.g. PIDs)</li>
<li><code>DBDIR</code> = OS specific (<code>/var/lib/rspamd</code> on Linux) - used to store static runtime data (e.g. databases or cached files)</li>
<li><code>SHAREDIR</code> = <code>${PREFIX}/share/rspamd</code> - used to store shared files</li>
<li><code>LOGDIR</code> = OS specific (<code>/var/log/rspamd</code> on Linux) - used to store Rspamd logs in file logging mode</li>
<li><code>LUALIBDIR</code> = <code>${SHAREDIR}/lualib</code> - used to store shared Lua files (included in Lua path)</li>
<li><code>PLUGINSDIR</code> = <code>${SHAREDIR}/plugins</code> - used to place Lua plugins</li>
<li><code>RULESDIR</code> = <code>${SHAREDIR}/rules</code> - used to place Lua rules</li>
<li><code>LIBDIR</code> = <code>${PREFIX}/lib/rspamd</code> - used to place shared libraries (included in RPATH and Lua CPATH)</li>
<li><code>WWWDIR</code> = <code>${SHAREDIR}/www</code> - used to store static WebUI files</li>
</ul>
</li>
</ul>
<p>For those who are using the default packages, there should be no changes. Even in the case if you are using old <code>${PLUGINSDIR}</code> to store your custom plugins, Rspamd will still check the old location as a fallback during the plugin loading process.</p>
<p>Additionally, an incompatible change has been introduced for users of the <strong><code>coroutines based</code></strong> Rspamd Lua API. Starting from this version, symbols utilizing coroutines must be registered with the <code>coro</code> lag to function properly, otherwise, they will cause Rspamd to crash. More information is available in the following <a href="https://github.com/rspamd/rspamd/issues/2789" target="_blank" rel="noopener noreferrer">issue</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="migration-to-rspamd-181">Migration to Rspamd 1.8.1<a href="#migration-to-rspamd-181" class="hash-link" aria-label="Direct link to Migration to Rspamd 1.8.1" title="Direct link to Migration to Rspamd 1.8.1">​</a></h2>
<p>This version introduces several incompatibilities that may affect your setup.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="general-configuration-change">General configuration change<a href="#general-configuration-change" class="hash-link" aria-label="Direct link to General configuration change" title="Direct link to General configuration change">​</a></h3>
<p><a href="https://github.com/vstakhov/libucl" target="_blank" rel="noopener noreferrer">Libucl</a> the library used to parse Rspamd&#x27;s configuration files, has been modified in a way that prevents loading incomplete chunks of data. This means that each include file <strong>MUST</strong> be a valid configuration snippet on its own. For example, consider the following artificial example:</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">.include &quot;top.conf&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var = &quot;bar&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.include &quot;bottom.conf&quot;</span><br></span></code></pre></div></div>
<p>Where top/bottom could have something like:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># top.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span></code></pre></div></div>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># bottom.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>The following will no longer be valid: libucl now requires that all braces are properly matched.</p>
<p>However, it still allows implicit braces on the top-level object. So the following file will still be <strong>valid</strong>:</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Some include</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">section &quot;foo&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  key = value;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">param = &quot;value&quot;;</span><br></span></code></pre></div></div>
<p>or this:</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Implicit object</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">param = &quot;value&quot;;</span><br></span></code></pre></div></div>
<p><code>rspamadm configtest</code> will show you if your local changes to the configuration files are incompatible with the new restrictions applied.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="fuzzy-and-bayes-misses-for-large-text-messages">Fuzzy and bayes misses for large text messages<a href="#fuzzy-and-bayes-misses-for-large-text-messages" class="hash-link" aria-label="Direct link to Fuzzy and bayes misses for large text messages" title="Direct link to Fuzzy and bayes misses for large text messages">​</a></h3>
<p>Due to a bug introduced in version 1.8.0, the algorithm used to deterministically skip words in large text parts was not functioning as intended, resulting in different words pipelines produced by different Rspamd instances. This could affect the accuracy of classification if the <code>words_limit</code> was reached (default: <code>words_decay = 200</code> words). For large text parts, it was possible to miss both fuzzy and Bayes classifications. While missing Bayes classification is not significant, missing fuzzy classification could be severe, potentially breaking fuzzy detection for large text parts.</p>
<p>In version 1.8.1, we have fixed this issue. Since we have already broken compatibility with version 1.7.9, we have decided to increase <code>words_decay</code>  to 600. Please ensure that you do not override this parameter in any local or override files, such as <code>local.d/options.inc</code> or <code>override.d/options.inc</code>, or else compatibility with Rspamd&#x27;s fuzzy storage will be lost for messages with more than <code>words_decay</code> threshold words.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="different-confdir-and-local_confdir-case">Different <code>CONFDIR</code> and <code>LOCAL_CONFDIR</code> case<a href="#different-confdir-and-local_confdir-case" class="hash-link" aria-label="Direct link to different-confdir-and-local_confdir-case" title="Direct link to different-confdir-and-local_confdir-case">​</a></h3>
<p>In an extremely unlikely scenario, if your custom build uses different values for the <code>CONFDIR</code> and <code>LOCAL_CONFDIR</code> build/startup variables, you may experience missing custom Lua rules that were previously loaded from <code>$CONFDIR/rspamd.local.lua</code>, as they are now loaded from <code>$LOCAL_CONFDIR/rspamd.local.lua</code>. To the best of our knowledge, this does not affect any official packages or officially supported operating systems, such as FreeBSD or OpenBSD.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="migration-to-rspamd-180">Migration to Rspamd 1.8.0<a href="#migration-to-rspamd-180" class="hash-link" aria-label="Direct link to Migration to Rspamd 1.8.0" title="Direct link to Migration to Rspamd 1.8.0">​</a></h2>
<p>There are several changes that may impact your setup, particularly if you use any of the following:</p>
<ul>
<li><strong>Clickhouse</strong> module</li>
<li><strong>User settings</strong></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="clickhouse-changes">Clickhouse changes<a href="#clickhouse-changes" class="hash-link" aria-label="Direct link to Clickhouse changes" title="Direct link to Clickhouse changes">​</a></h3>
<p>Starting from version 1.8, Rspamd has stopped using multiple tables and now uses a single table, <code>rspamd</code>, with all columns. This improves performance and eliminates the need for inefficient joins in Clickhouse. If you have used the Clickhouse module prior to version 1.8, your <strong>schemas</strong> will be automatically converted. However, <strong>the existing data</strong> will <strong>NOT</strong> be converted and will remain in the old tables. It may be necessary to use a command to enforce the new schema:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">OPTIMIZE rspamd FINAL</span><br></span></code></pre></div></div>
<p>Please note that this command may take a significant amount of time to complete if you have stored a large amount of historical data.</p>
<p>Additionally, you need to update your <strong>queries</strong> that use the additional Rspamd tables, such as <code>rspamd_urls</code>, <code>rspamd_asn</code>, <code>rspamd_attachments</code>, <code>rspamd_symbols</code>, and others. All corresponding fields are now located in the <code>rspamd</code> table. At this time, it is not possible to migrate old data from these tables.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="settings-changes">Settings changes<a href="#settings-changes" class="hash-link" aria-label="Direct link to Settings changes" title="Direct link to Settings changes">​</a></h3>
<p>Rspamd now includes a <code>settings.conf</code> file, which incorporates <code>local.d/settings.conf</code> and <code>override.d/settings.conf</code>. If you have used these files to store settings, please ensure that they do not conflict with the new configuration layout.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="migration-to-rspamd-174">Migration to Rspamd 1.7.4<a href="#migration-to-rspamd-174" class="hash-link" aria-label="Direct link to Migration to Rspamd 1.7.4" title="Direct link to Migration to Rspamd 1.7.4">​</a></h2>
<p>The only potential issue is that Rspamd now listens on <strong>localhost only</strong> by default. This could affect configurations that rely on the previous behavior of listening on all IP addresses (e.g. <code>*</code>).</p>
<p>However, we believe that it is important to keep the default settings as restrictive as possible to avoid potential security issues, which have occurred in other projects with &#x27;open to all&#x27; defaults.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="migration-to-rspamd-170">Migration to Rspamd 1.7.0<a href="#migration-to-rspamd-170" class="hash-link" aria-label="Direct link to Migration to Rspamd 1.7.0" title="Direct link to Migration to Rspamd 1.7.0">​</a></h2>
<p>It is recommended to run <code>rspamadm configwizard</code> to ensure that your configuration is compatible with version 1.7. This version no longer supports the <code>metrics</code> concept, which was never officially supported in the past. However, you may have come across instances of <code>metric &quot;default&quot;</code> in various parts of the Rspamd configuration and settings.</p>
<p>In version 1.7, we will continue to support the old <code>metric</code> keyword and scores defined under this section, such as in <code>rspamd.conf.local</code>. However, it is now recommended to define symbol scores in group settings (<code>local.d/group_*.conf</code>), which can be found in the <code>etc/rspamd/scores.d</code> folder.</p>
<p>There is no need to undertake any action if you have your custom scores defined in the legacy files. Rspamd will continue support of definitions in these files.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="migrating-to-rspamd-165">Migrating to Rspamd 1.6.5<a href="#migrating-to-rspamd-165" class="hash-link" aria-label="Direct link to Migrating to Rspamd 1.6.5" title="Direct link to Migrating to Rspamd 1.6.5">​</a></h2>
<p>As a result of several important fixes made to tokenization algorithms, it is possible that the statistics and fuzzy modules may lose some precision. In these cases, you may want to consider re-learning your databases to improve the accuracy of filtering.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="migrating-to-rspamd-160">Migrating to Rspamd 1.6.0<a href="#migrating-to-rspamd-160" class="hash-link" aria-label="Direct link to Migrating to Rspamd 1.6.0" title="Direct link to Migrating to Rspamd 1.6.0">​</a></h2>
<p>In this version, due to the implementation of the new milter interface, there is an important incompatible change that you may need to address if you use the <code>rmilter_headers</code> module. This module has been renamed to <code>milter_headers</code> and the corresponding protocol section is now named <code>milter</code> instead of <code>rmilter</code>. If you have configured this module inside <code>local.d/rmilter_headers.conf</code> or in <code>override.d/rmilter_headers.conf</code>, then no action is required, as these files will still be loaded by the renamed module. Otherwise, you will need to change the section name from <code>rmilter_headers</code> to <code>milter_headers</code>.</p>
<p>The <code>milter_headers</code> module now skips adding headers for local networks and authenticated users by default. This behavior can be re-enabled by setting <code>skip_local = false</code> and/or <code>skip_authenticated = false</code> in the module configuration. Alternatively, you can set <code>authenticated_headers</code> and/or <code>local_headers</code> to a list of headers that should not be skipped.</p>
<p>Additionally, a <a href="/docs.rspamd.com/branches/vstakhov-docs-search/workers/rspamd_proxy">proxy worker</a> has been added to the default configuration and listens on all interfaces on TCP port 11332. If you do not need it, you can set <code>enabled = false</code> in <code>local.d/worker-proxy.inc</code>.</p>
<p>This release also eliminates the configuration split for systemd/sysv platforms. To ensure proper functionality, custom init scripts should utilize <code>rspamd.conf</code> instead of <code>rspamd.sysvinit.conf</code>. For those utilizing systemd and prefer logging to the systemd journal, the following should be added to <code>local.d/logging.inc</code>:</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">systemd = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type = &quot;console&quot;;</span><br></span></code></pre></div></div>
<p>A significant overhaul of the Lua libraries has occurred in Rspamd 1.6. Some custom scripts may fail if they are loaded prior to <code>rspamd.lua</code> or if manual modifications have been made to <code>rspamd.lua</code>should be loaded before all custom scripts. This is the default behavior, however, in highly customized setups it may cause issues. In general, it is crucial to ensure that the following line is present in your code (found at the very beginning of <code>rspamd.lua</code>):</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">require </span><span class="token string" style="color:#e3116c">&quot;global_functions&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>The Rmilter tool is now deprecated in favor of milter protocol support in the <a href="/docs.rspamd.com/branches/vstakhov-docs-search/workers/rspamd_proxy">rspamd proxy</a>. Examples of some specific features previously implemented in Rmilter can be found in the <a href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/milter_headers">milter headers module</a>. It is recommended to migrate from Rmilter as soon as possible, as Rspamd 1.6 will be the last version to support the Rmilter tool. In future major releases (starting from 1.7), there will be <strong>no guarantees</strong> of compatibility with Rmilter.</p>
<p>For example, if you need the old behaviour for <code>extended_spam_headers</code> in Rmilter is desired, the following snippet can be added to <code>local.d/milter_headers.conf</code>:</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># local.d/milter_headers.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">extended_spam_headers = true;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="migrating-to-rspamd-153">Migrating to Rspamd 1.5.3<a href="#migrating-to-rspamd-153" class="hash-link" aria-label="Direct link to Migrating to Rspamd 1.5.3" title="Direct link to Migrating to Rspamd 1.5.3">​</a></h2>
<p>The rspamd_update module has been disabled by default; if you need it please set <code>enabled = true</code> in <code>local.d/rspamd_update.conf</code>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="migrating-to-rspamd-152">Migrating to Rspamd 1.5.2<a href="#migrating-to-rspamd-152" class="hash-link" aria-label="Direct link to Migrating to Rspamd 1.5.2" title="Direct link to Migrating to Rspamd 1.5.2">​</a></h2>
<p>New configuration files have been added for the following modules which previously missed them; if you have previously configured one of these modules in <code>rspamd.conf.local</code> please move your configuration to <code>rspamd.conf.override</code> to ensure that it is preserved verbatim or rework your configuration to use <code>local.d/[module_name].conf</code> instead.</p>
<ul>
<li>antivirus</li>
<li>dkim_signing</li>
<li>mx_check (set <code>enabled = true</code> if you use <code>local.d</code>)</li>
<li>replies</li>
<li>spamassassin</li>
<li>trie</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="migrating-to-rspamd-15">Migrating to Rspamd 1.5<a href="#migrating-to-rspamd-15" class="hash-link" aria-label="Direct link to Migrating to Rspamd 1.5" title="Direct link to Migrating to Rspamd 1.5">​</a></h2>
<p>New configuration files have been added for the following modules which previously lacked them: <code>greylist</code>, <code>metadata_exporter</code> and <code>metric_exporter.</code> If you have previously configured one of these modules in <code>rspamd.conf.local</code>, it is recommended to move your configuration to <code>rspamd.conf.override</code> to ensure that it is preserved verbatim, or to rework your configuration to use <code>local.d/[module_name].conf</code> instead.</p>
<p>Additionally, if composites have been defined in <code>local.d/composites.conf</code> or <code>override.d/composites.conf</code>, these should be moved to <code>rspamd.conf.local</code> or reworked to the new format. An example can be found in <code>/etc/rspamd/composites.conf</code>.</p>
<p>You are also suggested to disable outdated and no longer supported features of Rmilter and switch them to Rspamd:</p>
<ul>
<li>Greylisting - provided by <a href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/greylisting">greylisting module</a></li>
<li>Ratelimit - is done by <a href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/ratelimit">ratelimit module</a></li>
<li>Replies whitelisting - is implemented in <a href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/replies">replies module</a></li>
<li>Antivirus filtering - provided now by <a href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/antivirus">antivirus module</a></li>
<li>DCC checks - are now done in <a href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/dcc">dcc module</a></li>
<li>Dkim signing - can be done now by using of <a href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/dkim#dkim-signatures">dkim module</a> and also by a more simple <a href="/docs.rspamd.com/branches/vstakhov-docs-search/modules/dkim_signing">dkim signing module</a></li>
</ul>
<p>All duplicate features are still present in Rmilter for compatibility purposes. However, it is unlikely that any further development or bug fixes will be applied to them.</p>
<p>From version <code>1.9.1</code> it is possible to specify <code>enable</code> option in <code>greylisting</code> and <code>ratelimit</code> sections. It is also possible for <code>dkim</code> section since <code>1.9.2</code>. These options are <code>true</code> by default. Here is an example of configuration where greylisting and ratelimit are disabled:</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># /etc/rmilter.conf.local</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">limits {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    enable = false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">greylisting {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    enable = false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dkim {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    enable = false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>These options are enabled by default solely for compatibility reasons. In future Rmilter releases, they will be <strong>DISABLED</strong> by default.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="migrating-to-rmilter-1100-and-rspamd-140">Migrating to Rmilter 1.10.0 and Rspamd 1.4.0<a href="#migrating-to-rmilter-1100-and-rspamd-140" class="hash-link" aria-label="Direct link to Migrating to Rmilter 1.10.0 and Rspamd 1.4.0" title="Direct link to Migrating to Rmilter 1.10.0 and Rspamd 1.4.0">​</a></h2>
<p>TThe default passwords, specifically <code>q1</code> and <code>q2</code>, are no longer permitted for remote authentication. This change is a result of the widespread misuse of these <strong>example</strong> passwords and the potential security risks posed by some Rspamd users.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="migrating-to-rmilter-191-and-rspamd-131">Migrating to Rmilter 1.9.1 and Rspamd 1.3.1<a href="#migrating-to-rmilter-191-and-rspamd-131" class="hash-link" aria-label="Direct link to Migrating to Rmilter 1.9.1 and Rspamd 1.3.1" title="Direct link to Migrating to Rmilter 1.9.1 and Rspamd 1.3.1">​</a></h2>
<p>In these releases, systemd socket activation has been removed. Note that upon upgrading on Debian platforms, Rmilter may not restart correctly. To resolve this, please run <code>systemctl restart rmilter</code> after installing the package. On the other hand, Rspamd is expected to restart correctly upon upgrade. Additionally, both Rspamd and Rmilter should be configured to automatically run on reboot post-upgrade.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="migrating-from-rmilter-18-to-rmilter-19">Migrating from Rmilter 1.8 to Rmilter 1.9<a href="#migrating-from-rmilter-18-to-rmilter-19" class="hash-link" aria-label="Direct link to Migrating from Rmilter 1.8 to Rmilter 1.9" title="Direct link to Migrating from Rmilter 1.8 to Rmilter 1.9">​</a></h2>
<p>Please note that there are a few changes to the supported features in this release:</p>
<ul>
<li>beanstalk support has been removed from Rmilter in honor of Redis <a href="https://redis.io/docs/interact/pubsub/" target="_blank" rel="noopener noreferrer">pub/sub</a>, you must remove the whole <code>beanstalk</code> section from the configuration file</li>
<li>auto whitelist for greylisting is no longer supported as it has been broken from the very beginning, you must remove all <code>awl</code> options from the greylisting section</li>
</ul>
<p>If you have been using Beanstalk for certain purposes, you can transition to using Redis <a href="https://redis.io/docs/interact/pubsub/" target="_blank" rel="noopener noreferrer">pub/sub</a>. The <code>redis</code> section includes settings such as <code>spam_servers</code> and <code>spam_channel</code> for sending spam, and <code>copy_servers</code>, <code>copy_prob</code>, and <code>copy_channel</code> for sending message copies, which can help you reproduce Beanstalk functions using Redis.</p>
<p>Rmilter now provides additional options for configuring your local settings. You can now use <code>rmilter.conf.local</code> and <code>rmilter.conf.d/*.conf</code> files to override the default configuration.</p>
<p>Additionally, Rmilter no longer includes several SpamAssassin-compatible headers such as <code>X-Spam-Status</code>, <code>X-Spam-Level</code>, and <code>X-Spamd-Bar</code>. Instead, Rmilter now supports adding and removing custom headers as instructed by Rspamd (version 1.3.0 or higher). To restore the removed headers, you can use the example script provided below, which should be added to <code>/etc/rspamd/rspamd.local.lua</code>:</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rspamd_config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">register_symbol</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;RMILTER_HEADERS&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;postfilter&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  priority </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  callback </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(222, 71, 0)">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">task</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:rgb(222, 71, 0)">local</span><span class="token plain"> metric_score </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> task</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">get_metric_score</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;default&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:rgb(222, 71, 0)">local</span><span class="token plain"> score </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> metric_score</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:rgb(222, 71, 0)">local</span><span class="token plain"> required_score </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> metric_score</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">-- X-Spamd-Bar &amp; X-Spam-Level</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:rgb(222, 71, 0)">local</span><span class="token plain"> spambar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:rgb(222, 71, 0)">local</span><span class="token plain"> spamlevel </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:rgb(222, 71, 0)">if</span><span class="token plain"> score </span><span class="token operator" style="color:#393A34">&lt;=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(222, 71, 0)">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      spambar </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> string</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">rep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;-&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> score</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:rgb(222, 71, 0)">elseif</span><span class="token plain"> score </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(222, 71, 0)">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      spambar </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> string</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">rep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;+&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> score</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      spamlevel </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> string</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">rep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;*&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> score</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:rgb(222, 71, 0)">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      spambar </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:rgb(222, 71, 0)">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">-- X-Spam-Status</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:rgb(222, 71, 0)">local</span><span class="token plain"> is_spam</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:rgb(222, 71, 0)">local</span><span class="token plain"> spamstatus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:rgb(222, 71, 0)">local</span><span class="token plain"> action </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> task</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">get_metric_action</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;default&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:rgb(222, 71, 0)">if</span><span class="token plain"> action </span><span class="token operator" style="color:#393A34">~=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;no action&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(222, 71, 0)">and</span><span class="token plain"> action </span><span class="token operator" style="color:#393A34">~=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;greylist&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(222, 71, 0)">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      is_spam </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Yes&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:rgb(222, 71, 0)">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      is_spam </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;No&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:rgb(222, 71, 0)">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spamstatus </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> is_spam </span><span class="token operator" style="color:#393A34">..</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;, score=&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">..</span><span class="token plain"> string</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;%.2f&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> score</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">-- Add headers</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    task</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">set_rmilter_reply</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      add_headers </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;X-Spamd-Bar&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> spambar</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;X-Spam-Level&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> spamlevel</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;X-Spam-Status&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> spamstatus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      remove_headers </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;X-Spamd-Bar&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;X-Spam-Level&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;X-Spam-Status&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:rgb(222, 71, 0)">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="migrating-from-rspamd-12-to-rspamd-13">Migrating from Rspamd 1.2 to Rspamd 1.3<a href="#migrating-from-rspamd-12-to-rspamd-13" class="hash-link" aria-label="Direct link to Migrating from Rspamd 1.2 to Rspamd 1.3" title="Direct link to Migrating from Rspamd 1.2 to Rspamd 1.3">​</a></h2>
<p>Rspamd version 1.3 does not introduce any incompatible changes</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="migrating-from-rspamd-11-to-rspamd-12">Migrating from Rspamd 1.1 to Rspamd 1.2<a href="#migrating-from-rspamd-11-to-rspamd-12" class="hash-link" aria-label="Direct link to Migrating from Rspamd 1.1 to Rspamd 1.2" title="Direct link to Migrating from Rspamd 1.1 to Rspamd 1.2">​</a></h2>
<p>Rspamd version 1.2 does not introduce any incompatible changes</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="migrating-from-rspamd-10-to-rspamd-11">Migrating from Rspamd 1.0 to Rspamd 1.1<a href="#migrating-from-rspamd-10-to-rspamd-11" class="hash-link" aria-label="Direct link to Migrating from Rspamd 1.0 to Rspamd 1.1" title="Direct link to Migrating from Rspamd 1.0 to Rspamd 1.1">​</a></h2>
<p>Please note that there is an incompatible change in the per-user statistics behavior for users with per-user statistics enabled.</p>
<p>Both <code>redis</code> and <code>sqlite3</code> now follow a consistent approach for per-user statistics:</p>
<ul>
<li>If per-user statistics is enabled check per-user tokens <strong>ONLY</strong></li>
<li>If per-user statistics is not enabled then check common tokens <strong>ONLY</strong></li>
</ul>
<p>If the previous behavior is desired, a separate classifier for per-user statistics must be implemented, for example:</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    classifier {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        tokenizer {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            name = &quot;osb&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name = &quot;bayes_user&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        min_tokens = 11;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        backend = &quot;sqlite3&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        per_language = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        per_user = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        statfile {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            path = &quot;/tmp/bayes.spam.sqlite&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            symbol = &quot;BAYES_SPAM_USER&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        statfile {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            path = &quot;/tmp/bayes.ham.sqlite&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            symbol = &quot;BAYES_HAM_USER&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    classifier {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        tokenizer {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            name = &quot;osb&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name = &quot;bayes&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        min_tokens = 11;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        backend = &quot;sqlite3&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        per_language = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        statfile {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            path = &quot;/tmp/bayes.spam.sqlite&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            symbol = &quot;BAYES_SPAM&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        statfile {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            path = &quot;/tmp/bayes.ham.sqlite&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            symbol = &quot;BAYES_HAM&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="migrating-from-rspamd-09-to-rspamd-10">Migrating from Rspamd 0.9 to Rspamd 1.0<a href="#migrating-from-rspamd-09-to-rspamd-10" class="hash-link" aria-label="Direct link to Migrating from Rspamd 0.9 to Rspamd 1.0" title="Direct link to Migrating from Rspamd 0.9 to Rspamd 1.0">​</a></h2>
<p>Rspamd 1.0 has introduced changes to the default settings for statistics tokenization. The new default setting is <code>modern</code>, which generates tokens from normalized words and includes various improvements. However, these changes are not compatible with the statistics model used in pre-1.0 versions. To use these new features you should either <strong>relearn</strong> your statistics or continue using your old statistics <strong>without</strong> new features by adding a <code>compat</code> parameter:</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">classifier {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tokenizer {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        compat = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>The recommended way to store statistics now is the <code>sqlite3</code> backend (which is incompatible with the old mmap backend):</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">classifier {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    type = &quot;bayes&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tokenizer {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name = &quot;osb&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cache {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        path = &quot;${DBDIR}/learn_cache.sqlite&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    min_tokens = 11;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    backend = &quot;sqlite3&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    languages_enabled = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    statfile {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        symbol = &quot;BAYES_HAM&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        path = &quot;${DBDIR}/bayes.ham.sqlite&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        spam = false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    statfile {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        symbol = &quot;BAYES_SPAM&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        path = &quot;${DBDIR}/bayes.spam.sqlite&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        spam = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="migrating-from-rspamd-06-to-rspamd-07">Migrating from Rspamd 0.6 to Rspamd 0.7<a href="#migrating-from-rspamd-06-to-rspamd-07" class="hash-link" aria-label="Direct link to Migrating from Rspamd 0.6 to Rspamd 0.7" title="Direct link to Migrating from Rspamd 0.6 to Rspamd 0.7">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="webui-changes">WebUI changes<a href="#webui-changes" class="hash-link" aria-label="Direct link to WebUI changes" title="Direct link to WebUI changes">​</a></h3>
<p>The Rspamd web interface is now a part of the Rspamd distribution. Additionally, Rspamd itself now serves all static files, eliminating the need for a separate web server. As a result, the WebUI worker has been removed, and the controller now acts as both a web browser and the rspamc client. However, it is still recommended to set up a full-featured HTTP server in front of Rspamd for added security features such as TLS and access controls.</p>
<p>Furthermore, there are now two levels of password protection for Rspamd: <code>password</code> for read-only commands and <code>enable_password</code> for commands that change data. If <code>enable_password</code> is not specified, <code>password</code> is used for both types of commands.</p>
<p>Here is an example of the full configuration of the Rspamd controller worker to serve the WebUI:</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">worker {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	type = &quot;controller&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	bind_socket = &quot;localhost:11334&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	count = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	password = &quot;q1&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	enable_password = &quot;q2&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	secure_ip = &quot;127.0.0.1&quot;; # Allows to use *all* commands from this IP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	static_dir = &quot;${WWWDIR}&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="settings-changes-1">Settings changes<a href="#settings-changes-1" class="hash-link" aria-label="Direct link to Settings changes" title="Direct link to Settings changes">​</a></h3>
<p>The settings system in Rspamd has undergone a complete overhaul. It is now implemented as a Lua plugin that registers pre-filters and assigns settings based on dynamic maps or a static configuration. To use the new settings system, please refer to the updated <a href="/docs.rspamd.com/branches/vstakhov-docs-search/configuration/settings">documentation</a>. The previous settings system has been entirely removed from Rspamd.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="lua-changes">Lua changes<a href="#lua-changes" class="hash-link" aria-label="Direct link to Lua changes" title="Direct link to Lua changes">​</a></h3>
<p>Please be aware that there have been significant changes to the Lua API in this release, some of which may result in compatibility issues.</p>
<ul>
<li>many superglobals are removed: now Rspamd modules need to be loaded explicitly,
the only global remaining is <code>rspamd_config</code>. This affects the following modules:
<ul>
<li><code>rspamd_logger</code></li>
<li><code>rspamd_ip</code></li>
<li><code>rspamd_http</code></li>
<li><code>rspamd_cdb</code></li>
<li><code>rspamd_regexp</code></li>
<li><code>rspamd_trie</code></li>
</ul>
</li>
</ul>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:rgb(222, 71, 0)">local</span><span class="token plain"> rspamd_logger </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> require </span><span class="token string" style="color:#e3116c">&quot;rspamd_logger&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:rgb(222, 71, 0)">local</span><span class="token plain"> rspamd_trie </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> require </span><span class="token string" style="color:#e3116c">&quot;rspamd_trie&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:rgb(222, 71, 0)">local</span><span class="token plain"> rspamd_cdb </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> require </span><span class="token string" style="color:#e3116c">&quot;rspamd_cdb&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:rgb(222, 71, 0)">local</span><span class="token plain"> rspamd_ip </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> require </span><span class="token string" style="color:#e3116c">&quot;rspamd_ip&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:rgb(222, 71, 0)">local</span><span class="token plain"> rspamd_regexp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> require </span><span class="token string" style="color:#e3116c">&quot;rspamd_regexp&quot;</span><br></span></code></pre></div></div>
<ul>
<li>new system of symbols registration: now symbols can be registered by adding new indices to <code>rspamd_config</code> object. Old version:</li>
</ul>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:rgb(222, 71, 0)">local</span><span class="token plain"> reconf </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> config</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;regexp&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reconf</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;SYMBOL&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(222, 71, 0)">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">task</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:rgb(222, 71, 0)">end</span><br></span></code></pre></div></div>
<p>new one:</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rspamd_config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">SYMBOL </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(222, 71, 0)">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">task</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:rgb(222, 71, 0)">end</span><br></span></code></pre></div></div>
<p><code>rspamd_message</code> has been <strong>removed</strong> completely. Instead, task methods should be used to access message data. This includes methods such as:</p>
<ul>
<li><code>get_date</code> - this method now returns a date for the task and message based on the provided arguments:</li>
</ul>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:rgb(222, 71, 0)">local</span><span class="token plain"> dm </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> task</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">get_date</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">format </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;message&#x27;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- MIME message date</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:rgb(222, 71, 0)">local</span><span class="token plain"> dt </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> task</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">get_date</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">format </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;connect&#x27;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- check date</span><br></span></code></pre></div></div>
<ul>
<li><code>get_header</code> - this function has undergone significant changes. The new version of <code>get_header</code> returns a decoded string, <code>get_header_raw</code> returns an undecoded string, and <code>get_header_full</code> returns a full list of tables. For more information, please refer to the updated <a href="/docs.rspamd.com/branches/vstakhov-docs-search/lua/rspamd_task">documentation</a>. You may need to update your existing code that uses the <code>task:get_header</code> method.
Old version:</li>
</ul>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:rgb(222, 71, 0)">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">kmail_msgid</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">task</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:rgb(222, 71, 0)">local</span><span class="token plain"> msg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> task</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">get_message</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:rgb(222, 71, 0)">local</span><span class="token plain"> header_msgid </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">get_header</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Message-Id&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:rgb(222, 71, 0)">if</span><span class="token plain"> header_msgid </span><span class="token keyword" style="color:rgb(222, 71, 0)">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token comment" style="color:#999988;font-style:italic">-- header_from and header_msgid are tables</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token keyword" style="color:rgb(222, 71, 0)">for</span><span class="token plain"> _</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">header_from </span><span class="token keyword" style="color:rgb(222, 71, 0)">in</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ipairs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">get_header</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;From&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(222, 71, 0)">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	    	</span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token keyword" style="color:rgb(222, 71, 0)">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:rgb(222, 71, 0)">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:rgb(222, 71, 0)">return</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(222, 71, 0)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:rgb(222, 71, 0)">end</span><br></span></code></pre></div></div>
<p>new one:</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:rgb(222, 71, 0)">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">kmail_msgid</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">task</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:rgb(222, 71, 0)">local</span><span class="token plain"> header_msgid </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> task</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">get_header</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Message-Id&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:rgb(222, 71, 0)">if</span><span class="token plain"> header_msgid </span><span class="token keyword" style="color:rgb(222, 71, 0)">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token keyword" style="color:rgb(222, 71, 0)">local</span><span class="token plain"> header_from </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> task</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">get_header</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;From&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token comment" style="color:#999988;font-style:italic">-- header_from and header_msgid are strings</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:rgb(222, 71, 0)">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:rgb(222, 71, 0)">return</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(222, 71, 0)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:rgb(222, 71, 0)">end</span><br></span></code></pre></div></div>
<p>or with the full version:</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rspamd_config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">FORGED_GENERIC_RECEIVED5 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(222, 71, 0)">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">task</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:rgb(222, 71, 0)">local</span><span class="token plain"> headers_recv </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> task</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">get_header_full</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Received&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:rgb(222, 71, 0)">if</span><span class="token plain"> headers_recv </span><span class="token keyword" style="color:rgb(222, 71, 0)">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token comment" style="color:#999988;font-style:italic">-- headers_recv is now the list of tables</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token keyword" style="color:rgb(222, 71, 0)">for</span><span class="token plain"> _</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">header_r </span><span class="token keyword" style="color:rgb(222, 71, 0)">in</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ipairs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">headers_recv</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(222, 71, 0)">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token keyword" style="color:rgb(222, 71, 0)">if</span><span class="token plain"> re</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">match</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">header_r</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;value&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(222, 71, 0)">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token keyword" style="color:rgb(222, 71, 0)">return</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(222, 71, 0)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token keyword" style="color:rgb(222, 71, 0)">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token keyword" style="color:rgb(222, 71, 0)">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:rgb(222, 71, 0)">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:rgb(222, 71, 0)">return</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(222, 71, 0)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:rgb(222, 71, 0)">end</span><br></span></code></pre></div></div>
<ul>
<li><code>get_from</code> and <code>get_recipients</code> now accept optional numeric arguments that determine where to retrieve the sender and recipients for a message. By default, this argument is set to <code>0</code>, which means that data is initially checked in the SMTP envelope (i.e., <code>MAIL FROM</code> and <code>RCPT TO</code> SMTP commands) and if the envelope data is not available, it is then obtained from MIME headers. A value of <code>1</code> means that data is checked in the envelope only, while <code>2</code> switches the mode to MIME headers. Here is an example from the <code>forged_recipients</code> module:</li>
</ul>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- Check sender</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:rgb(222, 71, 0)">local</span><span class="token plain"> smtp_from </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> task</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">get_from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:rgb(222, 71, 0)">if</span><span class="token plain"> smtp_from </span><span class="token keyword" style="color:rgb(222, 71, 0)">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:rgb(222, 71, 0)">local</span><span class="token plain"> mime_from </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> task</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">get_from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:rgb(222, 71, 0)">if</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(222, 71, 0)">not</span><span class="token plain"> mime_from </span><span class="token keyword" style="color:rgb(222, 71, 0)">or</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token keyword" style="color:rgb(222, 71, 0)">not</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">string</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">lower</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">mime_from</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;addr&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			string</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">lower</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">smtp_from</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;addr&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(222, 71, 0)">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		task</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">insert_result</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">symbol_sender</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:rgb(222, 71, 0)">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:rgb(222, 71, 0)">end</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="protocol-changes">Protocol changes<a href="#protocol-changes" class="hash-link" aria-label="Direct link to Protocol changes" title="Direct link to Protocol changes">​</a></h3>
<p>Rspamd now exclusively uses the HTTP protocol for all operations, making the use of additional client libraries unnecessary. Additionally, the fallback to the older <code>spamc</code> protocol has been implemented to ensure automatic compatibility with software such as <code>rmilter</code> and other programs that use the <code>rspamc</code> protocol.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/rspamd/docs.rspamd.com/edit/master/docs/tutorials/migration.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs.rspamd.com/branches/vstakhov-docs-search/tutorials/quickstart"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Quick start</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs.rspamd.com/branches/vstakhov-docs-search/tutorials/migrate_sa"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Migrating from SpamAssassin</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#efficient-rspamd-cluster-upgrade-guide" class="table-of-contents__link toc-highlight">Efficient Rspamd Cluster Upgrade Guide</a></li><li><a href="#migration-to-rspamd-390" class="table-of-contents__link toc-highlight">Migration to Rspamd 3.9.0</a></li><li><a href="#migration-to-rspamd-374" class="table-of-contents__link toc-highlight">Migration to Rspamd 3.7.4</a></li><li><a href="#migration-to-rspamd-372" class="table-of-contents__link toc-highlight">Migration to Rspamd 3.7.2</a></li><li><a href="#migration-to-rspamd-33" class="table-of-contents__link toc-highlight">Migration to Rspamd 3.3</a></li><li><a href="#migration-to-rspamd-30" class="table-of-contents__link toc-highlight">Migration to Rspamd 3.0</a></li><li><a href="#migration-to-rspamd-26" class="table-of-contents__link toc-highlight">Migration to Rspamd 2.6</a></li><li><a href="#migration-to-rspamd-20" class="table-of-contents__link toc-highlight">Migration to Rspamd 2.0</a></li><li><a href="#migration-to-rspamd-191" class="table-of-contents__link toc-highlight">Migration to Rspamd 1.9.1</a></li><li><a href="#migration-to-rspamd-190" class="table-of-contents__link toc-highlight">Migration to Rspamd 1.9.0</a></li><li><a href="#migration-to-rspamd-181" class="table-of-contents__link toc-highlight">Migration to Rspamd 1.8.1</a><ul><li><a href="#general-configuration-change" class="table-of-contents__link toc-highlight">General configuration change</a></li><li><a href="#fuzzy-and-bayes-misses-for-large-text-messages" class="table-of-contents__link toc-highlight">Fuzzy and bayes misses for large text messages</a></li><li><a href="#different-confdir-and-local_confdir-case" class="table-of-contents__link toc-highlight">Different <code>CONFDIR</code> and <code>LOCAL_CONFDIR</code> case</a></li></ul></li><li><a href="#migration-to-rspamd-180" class="table-of-contents__link toc-highlight">Migration to Rspamd 1.8.0</a><ul><li><a href="#clickhouse-changes" class="table-of-contents__link toc-highlight">Clickhouse changes</a></li><li><a href="#settings-changes" class="table-of-contents__link toc-highlight">Settings changes</a></li></ul></li><li><a href="#migration-to-rspamd-174" class="table-of-contents__link toc-highlight">Migration to Rspamd 1.7.4</a></li><li><a href="#migration-to-rspamd-170" class="table-of-contents__link toc-highlight">Migration to Rspamd 1.7.0</a></li><li><a href="#migrating-to-rspamd-165" class="table-of-contents__link toc-highlight">Migrating to Rspamd 1.6.5</a></li><li><a href="#migrating-to-rspamd-160" class="table-of-contents__link toc-highlight">Migrating to Rspamd 1.6.0</a></li><li><a href="#migrating-to-rspamd-153" class="table-of-contents__link toc-highlight">Migrating to Rspamd 1.5.3</a></li><li><a href="#migrating-to-rspamd-152" class="table-of-contents__link toc-highlight">Migrating to Rspamd 1.5.2</a></li><li><a href="#migrating-to-rspamd-15" class="table-of-contents__link toc-highlight">Migrating to Rspamd 1.5</a></li><li><a href="#migrating-to-rmilter-1100-and-rspamd-140" class="table-of-contents__link toc-highlight">Migrating to Rmilter 1.10.0 and Rspamd 1.4.0</a></li><li><a href="#migrating-to-rmilter-191-and-rspamd-131" class="table-of-contents__link toc-highlight">Migrating to Rmilter 1.9.1 and Rspamd 1.3.1</a></li><li><a href="#migrating-from-rmilter-18-to-rmilter-19" class="table-of-contents__link toc-highlight">Migrating from Rmilter 1.8 to Rmilter 1.9</a></li><li><a href="#migrating-from-rspamd-12-to-rspamd-13" class="table-of-contents__link toc-highlight">Migrating from Rspamd 1.2 to Rspamd 1.3</a></li><li><a href="#migrating-from-rspamd-11-to-rspamd-12" class="table-of-contents__link toc-highlight">Migrating from Rspamd 1.1 to Rspamd 1.2</a></li><li><a href="#migrating-from-rspamd-10-to-rspamd-11" class="table-of-contents__link toc-highlight">Migrating from Rspamd 1.0 to Rspamd 1.1</a></li><li><a href="#migrating-from-rspamd-09-to-rspamd-10" class="table-of-contents__link toc-highlight">Migrating from Rspamd 0.9 to Rspamd 1.0</a></li><li><a href="#migrating-from-rspamd-06-to-rspamd-07" class="table-of-contents__link toc-highlight">Migrating from Rspamd 0.6 to Rspamd 0.7</a><ul><li><a href="#webui-changes" class="table-of-contents__link toc-highlight">WebUI changes</a></li><li><a href="#settings-changes-1" class="table-of-contents__link toc-highlight">Settings changes</a></li><li><a href="#lua-changes" class="table-of-contents__link toc-highlight">Lua changes</a></li><li><a href="#protocol-changes" class="table-of-contents__link toc-highlight">Protocol changes</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/vstakhov-docs-search/tutorials/quickstart">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/vstakhov-docs-search/configuration">Configuration</a></li><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/vstakhov-docs-search/modules">Modules</a></li><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/vstakhov-docs-search/tutorials">Tutorials</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Resources</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/vstakhov-docs-search/downloads">Downloads</a></li><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/vstakhov-docs-search/faq">FAQ</a></li><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/vstakhov-docs-search/support">Support</a></li><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/vstakhov-docs-search/changelog">Changelog</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/rspamd/rspamd" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/vstakhov-docs-search/tutorials/site_contributing">Contributing</a></li><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/vstakhov-docs-search/blog">Blog</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Rspamd Project. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>