"use strict";(self.webpackChunkrspamd_docs=self.webpackChunkrspamd_docs||[]).push([[295],{28453:(e,s,n)=>{n.d(s,{R:()=>r,x:()=>l});var a=n(96540);const i={},t=a.createContext(i);function r(e){const s=a.useContext(t);return a.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),a.createElement(t.Provider,{value:s},e.children)}},55029:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>l,default:()=>m,frontMatter:()=>r,metadata:()=>a,toc:()=>o});const a=JSON.parse('{"id":"administration/rspamadm/statistics-ml","title":"Statistics & Machine Learning","description":"These commands help manage statistical classifiers (Bayes) and machine learning models (neural networks), including backup, migration, and performance evaluation.","source":"@site/docs/administration/rspamadm/statistics-ml.md","sourceDirName":"administration/rspamadm","slug":"/administration/rspamadm/statistics-ml","permalink":"/docs.rspamd.com/branches/docs/arc-update/ru/administration/rspamadm/statistics-ml","draft":false,"unlisted":false,"editUrl":"https://github.com/rspamd/docs.rspamd.com/edit/master/docs/administration/rspamadm/statistics-ml.md","tags":[],"version":"current","frontMatter":{"title":"Statistics & Machine Learning"},"sidebar":"docs","previous":{"title":"Cryptography & Security","permalink":"/docs.rspamd.com/branches/docs/arc-update/ru/administration/rspamadm/cryptography"},"next":{"title":"Operations & Monitoring","permalink":"/docs.rspamd.com/branches/docs/arc-update/ru/administration/rspamadm/operations"}}');var i=n(74848),t=n(28453);const r={title:"Statistics & Machine Learning"},l="Statistics & Machine Learning",c={},o=[{value:"statistics_dump",id:"statistics_dump",level:2},{value:"Purpose",id:"purpose",level:3},{value:"Common Scenarios",id:"common-scenarios",level:3},{value:"Dump Statistics",id:"dump-statistics",level:4},{value:"Restore Statistics",id:"restore-statistics",level:4},{value:"Options",id:"options",level:3},{value:"Use Cases",id:"use-cases",level:3},{value:"Regular Backups",id:"regular-backups",level:4},{value:"Migration Between Servers",id:"migration-between-servers",level:4},{value:"Disaster Recovery",id:"disaster-recovery",level:4},{value:"statconvert",id:"statconvert",level:2},{value:"Purpose",id:"purpose-1",level:3},{value:"Common Scenarios",id:"common-scenarios-1",level:3},{value:"Convert Bayes Databases",id:"convert-bayes-databases",level:4},{value:"Convert Learn Cache",id:"convert-learn-cache",level:4},{value:"Reset Redis Before Import",id:"reset-redis-before-import",level:4},{value:"Set Expiration Time",id:"set-expiration-time",level:4},{value:"Options",id:"options-1",level:3},{value:"Complete Migration Example",id:"complete-migration-example",level:3},{value:"classifiertest",id:"classifiertest",level:2},{value:"Purpose",id:"purpose-2",level:3},{value:"Common Scenarios",id:"common-scenarios-2",level:3},{value:"Basic Performance Test",id:"basic-performance-test",level:4},{value:"Custom Cross-Validation Split",id:"custom-cross-validation-split",level:4},{value:"Test Without Learning",id:"test-without-learning",level:4},{value:"Connect to Remote Rspamd",id:"connect-to-remote-rspamd",level:4},{value:"Options",id:"options-2",level:3},{value:"Example Output",id:"example-output",level:3},{value:"Use Cases",id:"use-cases-1",level:3},{value:"Validate Bayes Effectiveness",id:"validate-bayes-effectiveness",level:4},{value:"neuraltest",id:"neuraltest",level:2},{value:"Purpose",id:"purpose-3",level:3},{value:"Common Scenarios",id:"common-scenarios-3",level:3},{value:"Test Neural Network",id:"test-neural-network",level:4},{value:"Options",id:"options-3",level:3},{value:"Use Cases",id:"use-cases-2",level:3},{value:"clickhouse neural_profile",id:"clickhouse-neural_profile",level:2},{value:"Purpose",id:"purpose-4",level:3},{value:"Common Scenarios",id:"common-scenarios-4",level:3},{value:"Generate Profile",id:"generate-profile",level:4},{value:"Filter by Settings ID",id:"filter-by-settings-id",level:4},{value:"Custom SQL Conditions",id:"custom-sql-conditions",level:4},{value:"Options",id:"options-4",level:3},{value:"Use Cases",id:"use-cases-3",level:3},{value:"Practical Examples",id:"practical-examples",level:2},{value:"Complete Backup and Migration Workflow",id:"complete-backup-and-migration-workflow",level:3},{value:"Automated Classifier Performance Monitoring",id:"automated-classifier-performance-monitoring",level:3},{value:"Tips and Best Practices",id:"tips-and-best-practices",level:2},{value:"Statistics Management",id:"statistics-management",level:3},{value:"Performance Testing",id:"performance-testing",level:3},{value:"Neural Networks",id:"neural-networks",level:3},{value:"Related Documentation",id:"related-documentation",level:2}];function d(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"statistics--machine-learning",children:"Statistics & Machine Learning"})}),"\n",(0,i.jsx)(s.p,{children:"These commands help manage statistical classifiers (Bayes) and machine learning models (neural networks), including backup, migration, and performance evaluation."}),"\n",(0,i.jsx)(s.h2,{id:"statistics_dump",children:"statistics_dump"}),"\n",(0,i.jsx)(s.p,{children:"Backup and restore Bayes statistics."}),"\n",(0,i.jsx)(s.h3,{id:"purpose",children:"Purpose"}),"\n",(0,i.jsx)(s.p,{children:"Export and import Bayes statistics for backup, migration, or disaster recovery. Works with both Redis and SQLite backends."}),"\n",(0,i.jsx)(s.h3,{id:"common-scenarios",children:"Common Scenarios"}),"\n",(0,i.jsx)(s.h4,{id:"dump-statistics",children:"Dump Statistics"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"# Dump Bayes statistics\nrspamadm statistics_dump dump\n\n# Dump with custom config\nrspamadm statistics_dump -c /path/to/rspamd.conf dump\n\n# Dump with smaller batch size (less memory)\nrspamadm statistics_dump -b 1000 dump\n"})}),"\n",(0,i.jsx)(s.p,{children:"Output is in structured format (JSON-like) that includes:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Token frequencies"}),"\n",(0,i.jsx)(s.li,{children:"Spam/ham counters"}),"\n",(0,i.jsx)(s.li,{children:"Metadata"}),"\n"]}),"\n",(0,i.jsx)(s.h4,{id:"restore-statistics",children:"Restore Statistics"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"# Restore from dump\nrspamadm statistics_dump restore < backup.dump\n\n# Restore with custom config\nrspamadm statistics_dump -c /path/to/rspamd.conf restore < backup.dump\n"})}),"\n",(0,i.jsx)(s.h3,{id:"options",children:"Options"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"-c, --config <cfg>      Path to config file\n-b, --batch-size <N>    Process N entries at once (default: 1000)\n\nSubcommands:\ndump, d                 Dump statistics\nrestore, r              Restore statistics\n"})}),"\n",(0,i.jsx)(s.h3,{id:"use-cases",children:"Use Cases"}),"\n",(0,i.jsx)(s.h4,{id:"regular-backups",children:"Regular Backups"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:'#!/bin/bash\n# Daily Bayes backup\n\nBACKUP_DIR="/var/backups/rspamd"\nDATE=$(date +%Y%m%d)\n\nmkdir -p "$BACKUP_DIR"\n\n# Dump statistics\nrspamadm statistics_dump dump | \\\n  gzip > "$BACKUP_DIR/bayes-$DATE.dump.gz"\n\n# Keep only last 30 days\nfind "$BACKUP_DIR" -name "bayes-*.dump.gz" -mtime +30 -delete\n\necho "Backup completed: bayes-$DATE.dump.gz"\n'})}),"\n",(0,i.jsx)(s.h4,{id:"migration-between-servers",children:"Migration Between Servers"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"# On source server\nrspamadm statistics_dump dump | gzip > bayes-export.dump.gz\n\n# Transfer to destination\nscp bayes-export.dump.gz new-server:/tmp/\n\n# On destination server\nzcat /tmp/bayes-export.dump.gz | rspamadm statistics_dump restore\n\n# Restart Rspamd\nsystemctl restart rspamd\n"})}),"\n",(0,i.jsx)(s.h4,{id:"disaster-recovery",children:"Disaster Recovery"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:'# Restore from backup\nzcat /var/backups/rspamd/bayes-20251120.dump.gz | \\\n  rspamadm statistics_dump restore\n\n# Verify restoration\nrspamadm control stat | grep -A5 "Bayes"\n'})}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"statconvert",children:"statconvert"}),"\n",(0,i.jsx)(s.p,{children:"Convert statistics from SQLite to Redis."}),"\n",(0,i.jsx)(s.h3,{id:"purpose-1",children:"Purpose"}),"\n",(0,i.jsx)(s.p,{children:"Migrate Bayes statistics and learn cache from SQLite3 databases to Redis backend."}),"\n",(0,i.jsx)(s.h3,{id:"common-scenarios-1",children:"Common Scenarios"}),"\n",(0,i.jsx)(s.h4,{id:"convert-bayes-databases",children:"Convert Bayes Databases"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"# Convert spam and ham databases\nrspamadm statconvert \\\n  --spam-db /var/lib/rspamd/bayes.spam.sqlite \\\n  --ham-db /var/lib/rspamd/bayes.ham.sqlite \\\n  --symbol-spam BAYES_SPAM \\\n  --symbol-ham BAYES_HAM \\\n  -h localhost:6379\n\n# With Redis authentication\nrspamadm statconvert \\\n  --spam-db /var/lib/rspamd/bayes.spam.sqlite \\\n  --ham-db /var/lib/rspamd/bayes.ham.sqlite \\\n  -h localhost:6379 \\\n  -p redis-password \\\n  -d 0\n"})}),"\n",(0,i.jsx)(s.h4,{id:"convert-learn-cache",children:"Convert Learn Cache"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"# Convert learn cache\nrspamadm statconvert \\\n  --cache /var/lib/rspamd/learn_cache.sqlite \\\n  -h localhost:6379\n"})}),"\n",(0,i.jsx)(s.h4,{id:"reset-redis-before-import",children:"Reset Redis Before Import"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"# Reset existing data\nrspamadm statconvert \\\n  --spam-db bayes.spam.sqlite \\\n  --ham-db bayes.ham.sqlite \\\n  -h localhost:6379 \\\n  --reset\n"})}),"\n",(0,i.jsx)(s.h4,{id:"set-expiration-time",children:"Set Expiration Time"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"# Set 90-day expiration on tokens\nrspamadm statconvert \\\n  --spam-db bayes.spam.sqlite \\\n  --ham-db bayes.ham.sqlite \\\n  -h localhost:6379 \\\n  --expire 7776000  # 90 days in seconds\n"})}),"\n",(0,i.jsx)(s.h3,{id:"options-1",children:"Options"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"-c, --config <file>         Config file\n-r, --reset                 Reset existing data\n-e, --expire <seconds>      Set expiration time\n--symbol-spam <symbol>      Spam symbol (default: BAYES_SPAM)\n--symbol-ham <symbol>       Ham symbol (default: BAYES_HAM)\n--spam-db <file>           Spam SQLite database\n--ham-db <file>            Ham SQLite database\n--cache <file>             Learn cache SQLite database\n-h, --redis-host <addr>    Redis address (ip:port)\n-p, --redis-password <pw>  Redis password\n-d, --redis-db <num>       Redis database number\n"})}),"\n",(0,i.jsx)(s.h3,{id:"complete-migration-example",children:"Complete Migration Example"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:'#!/bin/bash\n# Migrate from SQLite to Redis\n\nSQLITE_DIR="/var/lib/rspamd"\nREDIS_HOST="localhost:6379"\nREDIS_DB="0"\n\necho "=== Starting migration ==="\n\n# 1. Stop Rspamd\nsystemctl stop rspamd\n\n# 2. Backup SQLite databases\ntar czf rspamd-sqlite-backup-$(date +%Y%m%d).tar.gz \\\n  "$SQLITE_DIR"/*.sqlite\n\n# 3. Convert Bayes data\necho "Converting Bayes databases..."\nrspamadm statconvert \\\n  --spam-db "$SQLITE_DIR/bayes.spam.sqlite" \\\n  --ham-db "$SQLITE_DIR/bayes.ham.sqlite" \\\n  --symbol-spam BAYES_SPAM \\\n  --symbol-ham BAYES_HAM \\\n  -h "$REDIS_HOST" \\\n  -d "$REDIS_DB" \\\n  --expire 7776000\n\n# 4. Convert learn cache\necho "Converting learn cache..."\nrspamadm statconvert \\\n  --cache "$SQLITE_DIR/learn_cache.sqlite" \\\n  -h "$REDIS_HOST" \\\n  -d "$REDIS_DB"\n\n# 5. Update configuration to use Redis\ncat > /etc/rspamd/local.d/classifier-bayes.conf << EOF\nbackend = "redis";\nservers = "$REDIS_HOST";\ndatabase = $REDIS_DB;\nEOF\n\n# 6. Start Rspamd\nsystemctl start rspamd\n\n# 7. Verify\nrspamadm control stat | grep -A10 "Bayes"\n\necho "=== Migration complete ==="\n'})}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"classifiertest",children:"classifiertest"}),"\n",(0,i.jsx)(s.p,{children:"Evaluate Bayes classifier performance."}),"\n",(0,i.jsx)(s.h3,{id:"purpose-2",children:"Purpose"}),"\n",(0,i.jsx)(s.p,{children:"Train and test Bayes classifier using labeled ham and spam corpuses, measuring accuracy through cross-validation."}),"\n",(0,i.jsx)(s.h3,{id:"common-scenarios-2",children:"Common Scenarios"}),"\n",(0,i.jsx)(s.h4,{id:"basic-performance-test",children:"Basic Performance Test"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"# Test classifier with ham and spam directories\nrspamadm classifiertest \\\n  -H /path/to/ham-corpus \\\n  -S /path/to/spam-corpus\n"})}),"\n",(0,i.jsx)(s.p,{children:"This:"}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsx)(s.li,{children:"Splits corpus (70% training, 30% testing by default)"}),"\n",(0,i.jsx)(s.li,{children:"Learns from training set"}),"\n",(0,i.jsx)(s.li,{children:"Tests against test set"}),"\n",(0,i.jsx)(s.li,{children:"Reports accuracy, false positives, false negatives"}),"\n"]}),"\n",(0,i.jsx)(s.h4,{id:"custom-cross-validation-split",children:"Custom Cross-Validation Split"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"# Use 80% for training, 20% for testing\nrspamadm classifiertest \\\n  -H /path/to/ham \\\n  -S /path/to/spam \\\n  --cv-fraction 0.8\n"})}),"\n",(0,i.jsx)(s.h4,{id:"test-without-learning",children:"Test Without Learning"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"# Test against existing classifier (no new learning)\nrspamadm classifiertest \\\n  -H /path/to/ham \\\n  -S /path/to/spam \\\n  --no-learning\n"})}),"\n",(0,i.jsx)(s.h4,{id:"connect-to-remote-rspamd",children:"Connect to Remote Rspamd"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"# Test against remote instance\nrspamadm classifiertest \\\n  -H /path/to/ham \\\n  -S /path/to/spam \\\n  -c rspamd.example.com:11333\n"})}),"\n",(0,i.jsx)(s.h3,{id:"options-2",children:"Options"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"-H, --ham <dir>             Ham messages directory\n-S, --spam <dir>            Spam messages directory\n-n, --no-learning           Don't learn, only test\n--nconns <N>                Parallel connections (default: 10)\n-t, --timeout <sec>         Connection timeout\n-c, --connect <host>        Rspamd host (default: localhost:11334)\n-r, --rspamc <path>         Path to rspamc\n--cv-fraction <fraction>    Cross-validation split (default: 0.7)\n--spam-symbol <symbol>      Spam symbol (default: BAYES_SPAM)\n--ham-symbol <symbol>       Ham symbol (default: BAYES_HAM)\n"})}),"\n",(0,i.jsx)(s.h3,{id:"example-output",children:"Example Output"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"Learning phase: 1000 spam, 1000 ham messages\nTesting phase: 300 spam, 300 ham messages\n\nResults:\n  True Positives:  295 (98.3%)\n  False Positives: 8 (2.7%)\n  True Negatives:  292 (97.3%)\n  False Negatives: 5 (1.7%)\n  \n  Accuracy: 97.8%\n  Precision: 97.4%\n  Recall: 98.3%\n"})}),"\n",(0,i.jsx)(s.h3,{id:"use-cases-1",children:"Use Cases"}),"\n",(0,i.jsx)(s.h4,{id:"validate-bayes-effectiveness",children:"Validate Bayes Effectiveness"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:'#!/bin/bash\n# Test classifier before production deployment\n\nHAM_DIR="/data/corpus/ham"\nSPAM_DIR="/data/corpus/spam"\n\necho "Testing Bayes classifier..."\nrspamadm classifiertest -H "$HAM_DIR" -S "$SPAM_DIR" > test-results.txt\n\n# Check if accuracy is acceptable\nACCURACY=$(grep "Accuracy:" test-results.txt | awk \'{print $2}\' | tr -d \'%\')\n\nif (( $(echo "$ACCURACY > 95" | bc -l) )); then\n  echo "Classifier performs well ($ACCURACY%)"\n  exit 0\nelse\n  echo "Classifier needs more training ($ACCURACY%)"\n  exit 1\nfi\n'})}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"neuraltest",children:"neuraltest"}),"\n",(0,i.jsx)(s.p,{children:"Test neural network performance with labeled datasets."}),"\n",(0,i.jsx)(s.h3,{id:"purpose-3",children:"Purpose"}),"\n",(0,i.jsx)(s.p,{children:"Evaluate neural network module performance using spam/ham corpus."}),"\n",(0,i.jsx)(s.h3,{id:"common-scenarios-3",children:"Common Scenarios"}),"\n",(0,i.jsx)(s.h4,{id:"test-neural-network",children:"Test Neural Network"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"# Test with ham and spam directories\nrspamadm neuraltest \\\n  -H /path/to/ham \\\n  -S /path/to/spam\n\n# Test specific neural rule\nrspamadm neuraltest \\\n  -H /path/to/ham \\\n  -S /path/to/spam \\\n  --rule NEURAL_SPAM\n"})}),"\n",(0,i.jsx)(s.h3,{id:"options-3",children:"Options"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"-c, --config <cfg>          Config file\n-H, --hamdir <dir>          Ham directory\n-S, --spamdir <dir>         Spam directory\n-t, --timeout <sec>         Timeout\n-n, --conns <N>            Parallel connections\n-c, --connect <host>        Rspamd host\n-r, --rspamc <path>         rspamc path\n--rule <rule>               Specific neural rule to test\n"})}),"\n",(0,i.jsx)(s.h3,{id:"use-cases-2",children:"Use Cases"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"# Test neural network after training\nrspamadm neuraltest \\\n  -H /data/ham-2024 \\\n  -S /data/spam-2024 \\\n  --rule NEURAL_SPAM_SHORT\n"})}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"clickhouse-neural_profile",children:"clickhouse neural_profile"}),"\n",(0,i.jsx)(s.p,{children:"Generate symbol profiles for neural network training."}),"\n",(0,i.jsx)(s.h3,{id:"purpose-4",children:"Purpose"}),"\n",(0,i.jsx)(s.p,{children:"Analyze Clickhouse data to create optimal symbol sets for neural networks."}),"\n",(0,i.jsx)(s.h3,{id:"common-scenarios-4",children:"Common Scenarios"}),"\n",(0,i.jsx)(s.h4,{id:"generate-profile",children:"Generate Profile"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"# Generate 7-day profile\nrspamadm clickhouse neural_profile\n\n# Custom time period\nrspamadm clickhouse neural_profile --days 30\n\n# Limit results per day\nrspamadm clickhouse neural_profile --days 7 --limit 10000\n\n# JSON output\nrspamadm clickhouse neural_profile --days 7 -j\n"})}),"\n",(0,i.jsx)(s.h4,{id:"filter-by-settings-id",children:"Filter by Settings ID"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"# Profile for specific settings\nrspamadm clickhouse neural_profile \\\n  --settings-id inbound \\\n  --days 14\n"})}),"\n",(0,i.jsx)(s.h4,{id:"custom-sql-conditions",children:"Custom SQL Conditions"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:'# Add WHERE clause\nrspamadm clickhouse neural_profile \\\n  -w "Score > 10" \\\n  --days 7\n'})}),"\n",(0,i.jsx)(s.h3,{id:"options-4",children:"Options"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"-h, --help                  Show help\n-c, --config <cfg>         Config file\n-d, --database <db>        Clickhouse database\n-s, --server <addr>        Clickhouse server\n-u, --user <user>          Username\n-p, --password <pw>        Password\n-a, --ask-password         Ask password interactively\n--use-https                Use HTTPS\n--use-gzip                 Use Gzip compression\n--no-ssl-verify            Disable SSL verification\n\nneural_profile options:\n-w, --where <clause>       SQL WHERE clause\n-j, --json                 JSON output\n--days <N>                 Days to analyze (default: 7)\n--limit <N>               Max rows per day\n--settings-id <id>        Settings ID filter\n"})}),"\n",(0,i.jsx)(s.h3,{id:"use-cases-3",children:"Use Cases"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"#!/bin/bash\n# Monthly neural network optimization\n\n# Generate fresh profile\nrspamadm clickhouse neural_profile \\\n  --days 30 \\\n  -j > neural-profile.json\n\n# Analyze results\njq '.symbols | length' neural-profile.json\necho \"Generated profile with $(jq '.symbols | length' neural-profile.json) symbols\"\n\n# Apply to neural configuration (manual step)\n"})}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"practical-examples",children:"Practical Examples"}),"\n",(0,i.jsx)(s.h3,{id:"complete-backup-and-migration-workflow",children:"Complete Backup and Migration Workflow"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:'#!/bin/bash\n# Backup SQLite, migrate to Redis, verify\n\nSOURCE="/var/lib/rspamd"\nBACKUP="/var/backups/rspamd/$(date +%Y%m%d)"\nREDIS="localhost:6379"\n\nmkdir -p "$BACKUP"\n\n# 1. Dump current statistics\necho "Backing up current statistics..."\nrspamadm statistics_dump dump | gzip > "$BACKUP/statistics.dump.gz"\n\n# 2. Backup SQLite files\necho "Backing up SQLite databases..."\ncp "$SOURCE"/*.sqlite "$BACKUP/"\n\n# 3. Test Bayes classifier before migration\necho "Testing classifier performance..."\nrspamadm classifiertest -H /data/ham -S /data/spam > "$BACKUP/pre-migration-test.txt"\n\n# 4. Migrate to Redis\necho "Migrating to Redis..."\nsystemctl stop rspamd\n\nrspamadm statconvert \\\n  --spam-db "$SOURCE/bayes.spam.sqlite" \\\n  --ham-db "$SOURCE/bayes.ham.sqlite" \\\n  --cache "$SOURCE/learn_cache.sqlite" \\\n  -h "$REDIS" \\\n  --expire 7776000\n\n# 5. Update config for Redis\ncat > /etc/rspamd/local.d/classifier-bayes.conf << EOF\nbackend = "redis";\nservers = "$REDIS";\nEOF\n\nsystemctl start rspamd\nsleep 5\n\n# 6. Test after migration\necho "Testing after migration..."\nrspamadm classifiertest -H /data/ham -S /data/spam -n > "$BACKUP/post-migration-test.txt"\n\n# 7. Compare results\necho "=== Results ==="\necho "Before migration:"\ngrep "Accuracy:" "$BACKUP/pre-migration-test.txt"\necho "After migration:"\ngrep "Accuracy:" "$BACKUP/post-migration-test.txt"\n'})}),"\n",(0,i.jsx)(s.h3,{id:"automated-classifier-performance-monitoring",children:"Automated Classifier Performance Monitoring"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:'#!/bin/bash\n# Weekly classifier performance check\n\nCORPUS_HAM="/data/corpus/ham"\nCORPUS_SPAM="/data/corpus/spam"\nREPORT_DIR="/var/log/rspamd/classifier-reports"\nWEEK=$(date +%Y-W%V)\n\nmkdir -p "$REPORT_DIR"\n\n# Run test\necho "Testing classifier for week $WEEK..."\nrspamadm classifiertest \\\n  -H "$CORPUS_HAM" \\\n  -S "$CORPUS_SPAM" \\\n  > "$REPORT_DIR/classifier-$WEEK.txt"\n\n# Extract metrics\nACCURACY=$(grep "Accuracy:" "$REPORT_DIR/classifier-$WEEK.txt" | \\\n  awk \'{print $2}\' | tr -d \'%\')\nFP_RATE=$(grep "False Positives:" "$REPORT_DIR/classifier-$WEEK.txt" | \\\n  awk \'{print $4}\' | tr -d \'%\' | tr -d \'()\')\n\n# Alert if performance degrades\nif (( $(echo "$ACCURACY < 95" | bc -l) )); then\n  echo "WARNING: Classifier accuracy dropped to $ACCURACY%" | \\\n    mail -s "Rspamd Classifier Alert" admin@example.com\nfi\n\nif (( $(echo "$FP_RATE > 5" | bc -l) )); then\n  echo "WARNING: False positive rate increased to $FP_RATE%" | \\\n    mail -s "Rspamd False Positive Alert" admin@example.com\nfi\n'})}),"\n",(0,i.jsx)(s.h2,{id:"tips-and-best-practices",children:"Tips and Best Practices"}),"\n",(0,i.jsx)(s.h3,{id:"statistics-management",children:"Statistics Management"}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Regular backups"})," - Daily dumps of Bayes data"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Test before migration"})," - Verify classifier performance"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Monitor after migration"})," - Check accuracy didn't degrade"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Set expiration"})," - Use ",(0,i.jsx)(s.code,{children:"--expire"})," to prevent unbounded growth"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Incremental backups"})," - Keep multiple backup versions"]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"performance-testing",children:"Performance Testing"}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Representative corpus"})," - Use real-world emails for testing"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Large datasets"})," - At least 1000 of each (spam/ham)"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Recent data"})," - Test with current spam tactics"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Balanced corpus"})," - Equal amounts of spam and ham"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Regular testing"})," - Monthly performance checks"]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"neural-networks",children:"Neural Networks"}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Generate profiles regularly"})," - Monthly or quarterly"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Sufficient data"})," - At least 30 days of Clickhouse data"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Monitor training"})," - Check neural network logs"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Validate results"})," - Test with neuraltest command"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Incremental updates"})," - Don't retrain too frequently"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.a,{href:"/docs.rspamd.com/branches/docs/arc-update/ru/administration/rspamadm/email-analysis",children:"Email Analysis"})," - Extract statistical data from messages"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.a,{href:"/docs.rspamd.com/branches/docs/arc-update/ru/administration/rspamadm/operations",children:"Operations"})," - Control statistics operations"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.a,{href:"/docs.rspamd.com/branches/docs/arc-update/ru/administration/rspamadm/configuration",children:"Configuration"})," - Configure Bayes and neural modules"]}),"\n"]})]})}function m(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}}}]);