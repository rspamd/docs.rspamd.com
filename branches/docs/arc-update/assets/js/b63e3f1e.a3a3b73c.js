"use strict";(self.webpackChunkrspamd_docs=self.webpackChunkrspamd_docs||[]).push([[3382],{28453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>d});var r=s(96540);const a={},i=r.createContext(a);function l(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:l(e.components),r.createElement(i.Provider,{value:n},e.children)}},32329:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>d,default:()=>p,frontMatter:()=>l,metadata:()=>r,toc:()=>t});const r=JSON.parse('{"id":"administration/rspamadm/operations","title":"Operations & Monitoring","description":"These commands provide operational capabilities for monitoring, log analysis, and managing running Rspamd instances.","source":"@site/docs/administration/rspamadm/operations.md","sourceDirName":"administration/rspamadm","slug":"/administration/rspamadm/operations","permalink":"/docs.rspamd.com/branches/docs/arc-update/administration/rspamadm/operations","draft":false,"unlisted":false,"editUrl":"https://github.com/rspamd/docs.rspamd.com/edit/master/docs/administration/rspamadm/operations.md","tags":[],"version":"current","frontMatter":{"title":"Operations & Monitoring"},"sidebar":"docs","previous":{"title":"Statistics & Machine Learning","permalink":"/docs.rspamd.com/branches/docs/arc-update/administration/rspamadm/statistics-ml"},"next":{"title":"Configuration Management","permalink":"/docs.rspamd.com/branches/docs/arc-update/administration/rspamadm/configuration"}}');var a=s(74848),i=s(28453);const l={title:"Operations & Monitoring"},d="Operations & Monitoring",o={},t=[{value:"grep",id:"grep",level:2},{value:"Purpose",id:"purpose",level:3},{value:"Common Scenarios",id:"common-scenarios",level:3},{value:"Search by String",id:"search-by-string",level:4},{value:"Search by Regular Expression",id:"search-by-regular-expression",level:4},{value:"Lua Patterns",id:"lua-patterns",level:4},{value:"Read from stdin",id:"read-from-stdin",level:4},{value:"Include Orphaned Logs",id:"include-orphaned-logs",level:4},{value:"Options",id:"options",level:3},{value:"Important Note",id:"important-note",level:3},{value:"Use Cases",id:"use-cases",level:3},{value:"Debug Specific Message",id:"debug-specific-message",level:4},{value:"Find False Positives",id:"find-false-positives",level:4},{value:"Monitor Specific Domain",id:"monitor-specific-domain",level:4},{value:"Track Symbol Occurrences",id:"track-symbol-occurrences",level:4},{value:"control",id:"control",level:2},{value:"Purpose",id:"purpose-1",level:3},{value:"Prerequisites",id:"prerequisites",level:3},{value:"Common Scenarios",id:"common-scenarios-1",level:3},{value:"View Statistics",id:"view-statistics",level:4},{value:"Fuzzy Storage Statistics",id:"fuzzy-storage-statistics",level:4},{value:"Sync Fuzzy Database",id:"sync-fuzzy-database",level:4},{value:"Reload Configuration",id:"reload-configuration",level:4},{value:"Recompile Hyperscan",id:"recompile-hyperscan",level:4},{value:"Reresolve DNS",id:"reresolve-dns",level:4},{value:"Options",id:"options-1",level:3},{value:"Available Commands",id:"available-commands",level:3},{value:"Use Cases",id:"use-cases-1",level:3},{value:"Pre-Backup Routine",id:"pre-backup-routine",level:4},{value:"Health Check Script",id:"health-check-script",level:4},{value:"fuzzy_ping",id:"fuzzy_ping",level:2},{value:"Purpose",id:"purpose-2",level:3},{value:"Common Scenarios",id:"common-scenarios-2",level:3},{value:"Basic Ping",id:"basic-ping",level:4},{value:"List Configured Storages",id:"list-configured-storages",level:4},{value:"Flood Test",id:"flood-test",level:4},{value:"Custom Server",id:"custom-server",level:4},{value:"Options",id:"options-2",level:3},{value:"Use Cases",id:"use-cases-2",level:3},{value:"Verify Fuzzy Setup",id:"verify-fuzzy-setup",level:4},{value:"Measure Latency",id:"measure-latency",level:4},{value:"ratelimit",id:"ratelimit",level:2},{value:"Purpose",id:"purpose-3",level:3},{value:"Common Scenarios",id:"common-scenarios-3",level:3},{value:"Track Top Offenders",id:"track-top-offenders",level:4},{value:"Upgrade Bucket Limits",id:"upgrade-bucket-limits",level:4},{value:"Unblock Buckets",id:"unblock-buckets",level:4},{value:"Options",id:"options-3",level:3},{value:"Use Cases",id:"use-cases-3",level:3},{value:"Whitelist Legitimate Sender",id:"whitelist-legitimate-sender",level:4},{value:"Emergency Unblock",id:"emergency-unblock",level:4},{value:"dmarc_report",id:"dmarc_report",level:2},{value:"Purpose",id:"purpose-4",level:3},{value:"Common Scenarios",id:"common-scenarios-4",level:3},{value:"Send Today&#39;s Reports",id:"send-todays-reports",level:4},{value:"Send Reports for Specific Date",id:"send-reports-for-specific-date",level:4},{value:"Dry Run (No Sending)",id:"dry-run-no-sending",level:4},{value:"Batch Processing",id:"batch-processing",level:4},{value:"Verbose Logging",id:"verbose-logging",level:4},{value:"Options",id:"options-4",level:3},{value:"Use Cases",id:"use-cases-4",level:3},{value:"Daily Cron Job",id:"daily-cron-job",level:4},{value:"Manual Report Review",id:"manual-report-review",level:4},{value:"fuzzyconvert",id:"fuzzyconvert",level:2},{value:"Purpose",id:"purpose-5",level:3},{value:"Common Scenarios",id:"common-scenarios-5",level:3},{value:"Basic Conversion",id:"basic-conversion",level:4},{value:"With Redis Authentication",id:"with-redis-authentication",level:4},{value:"Options",id:"options-5",level:3},{value:"Use Cases",id:"use-cases-5",level:3},{value:"Practical Examples",id:"practical-examples",level:2},{value:"Complete Monitoring Script",id:"complete-monitoring-script",level:3},{value:"Log Analysis Report",id:"log-analysis-report",level:3},{value:"Tips and Best Practices",id:"tips-and-best-practices",level:2},{value:"Related Documentation",id:"related-documentation",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"operations--monitoring",children:"Operations & Monitoring"})}),"\n",(0,a.jsx)(n.p,{children:"These commands provide operational capabilities for monitoring, log analysis, and managing running Rspamd instances."}),"\n",(0,a.jsx)(n.h2,{id:"grep",children:"grep"}),"\n",(0,a.jsx)(n.p,{children:"Search and collate Rspamd logs by pattern."}),"\n",(0,a.jsx)(n.h3,{id:"purpose",children:"Purpose"}),"\n",(0,a.jsx)(n.p,{children:"Search logs for specific patterns and display complete related log entries. Unlike regular grep, this understands Rspamd's log format and groups entries by task ID."}),"\n",(0,a.jsx)(n.h3,{id:"common-scenarios",children:"Common Scenarios"}),"\n",(0,a.jsx)(n.h4,{id:"search-by-string",children:"Search by String"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'# Case-insensitive string search\nrspamadm grep -s "DMARC_POLICY_REJECT" /var/log/rspamd/rspamd.log\n\n# Case-sensitive search\nrspamadm grep -s "DMARC_POLICY_REJECT" -S /var/log/rspamd/rspamd.log\n\n# Search across multiple log files\nrspamadm grep -s "spf fail" -i /var/log/rspamd/rspamd.log -i /var/log/rspamd/rspamd.log.1\n'})}),"\n",(0,a.jsx)(n.h4,{id:"search-by-regular-expression",children:"Search by Regular Expression"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'# Regex pattern search\nrspamadm grep -p "BAYES_[HS]" /var/log/rspamd/rspamd.log\n\n# Find failed authentications\nrspamadm grep -p "authentication.*failed" /var/log/rspamd/rspamd.log\n\n# Find high-scored messages\nrspamadm grep -p "score=\\d{2,}" /var/log/rspamd/rspamd.log\n'})}),"\n",(0,a.jsx)(n.h4,{id:"lua-patterns",children:"Lua Patterns"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'# Use Lua pattern matching\nrspamadm grep -l -s "score=[%d]+%." /var/log/rspamd/rspamd.log\n'})}),"\n",(0,a.jsx)(n.h4,{id:"read-from-stdin",children:"Read from stdin"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'# Pipe logs to grep\nzcat /var/log/rspamd/rspamd.log.gz | rspamadm grep -s "quarantine"\n\n# Search recent logs\njournalctl -u rspamd -n 1000 | rspamadm grep -s "VIRUS_FOUND"\n'})}),"\n",(0,a.jsx)(n.h4,{id:"include-orphaned-logs",children:"Include Orphaned Logs"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'# Show logs without task ID\nrspamadm grep -s "error" -o /var/log/rspamd/rspamd.log\n\n# Show partial log groups\nrspamadm grep -s "timeout" -P /var/log/rspamd/rspamd.log\n'})}),"\n",(0,a.jsx)(n.h3,{id:"options",children:"Options"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"-s, --string <str>          Plain string search (case-insensitive)\n-l, --lua                   Use Lua patterns in string search\n-p, --pattern <regex>       Regular expression pattern\n-i, --input <file>          Input file (can be specified multiple times)\n-S, --sensitive             Enable case-sensitivity\n-o, --orphans               Print orphaned logs (no task ID)\n-P, --partial               Print partial log groups\n"})}),"\n",(0,a.jsx)(n.h3,{id:"important-note",children:"Important Note"}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"log_re_cache"})," option must be set to ",(0,a.jsx)(n.code,{children:"true"})," (default) in logging configuration for ",(0,a.jsx)(n.code,{children:"grep"})," to work correctly."]}),"\n",(0,a.jsx)(n.h3,{id:"use-cases",children:"Use Cases"}),"\n",(0,a.jsx)(n.h4,{id:"debug-specific-message",children:"Debug Specific Message"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'# Find by Message-ID\nrspamadm grep -s "Message-ID: <specific-id@example.com>" \\\n  /var/log/rspamd/rspamd.log\n'})}),"\n",(0,a.jsx)(n.p,{children:"Output shows all log lines related to that message processing."}),"\n",(0,a.jsx)(n.h4,{id:"find-false-positives",children:"Find False Positives"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'# Find legitimate mail marked as spam\nrspamadm grep -p "score=[2-9]\\d\\." /var/log/rspamd/rspamd.log | \\\n  grep -A5 "from=<known-sender@"\n'})}),"\n",(0,a.jsx)(n.h4,{id:"monitor-specific-domain",children:"Monitor Specific Domain"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'# Track all mail from domain\nrspamadm grep -s "@example.com" /var/log/rspamd/rspamd.log.* | less\n'})}),"\n",(0,a.jsx)(n.h4,{id:"track-symbol-occurrences",children:"Track Symbol Occurrences"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'# Find when specific symbol triggered\nrspamadm grep -s "SUSPICIOUS_SYMBOL" /var/log/rspamd/rspamd.log | \\\n  grep -o "score=[0-9.]*" | sort | uniq -c\n'})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"control",children:"control"}),"\n",(0,a.jsx)(n.p,{children:"Send control commands to running Rspamd instance."}),"\n",(0,a.jsx)(n.h3,{id:"purpose-1",children:"Purpose"}),"\n",(0,a.jsx)(n.p,{children:"Communicate with Rspamd's control socket to query statistics, trigger reloads, and manage runtime operations."}),"\n",(0,a.jsx)(n.h3,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Must run as root or rspamd user"}),"\n",(0,a.jsx)(n.li,{children:"Control worker must be enabled in configuration"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"common-scenarios-1",children:"Common Scenarios"}),"\n",(0,a.jsx)(n.h4,{id:"view-statistics",children:"View Statistics"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Get worker statistics\nrspamadm control stat\n\n# JSON output\nrspamadm control stat -j\n\n# Compact JSON\nrspamadm control stat -j -c\n"})}),"\n",(0,a.jsx)(n.p,{children:"Shows:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Messages scanned"}),"\n",(0,a.jsx)(n.li,{children:"Messages learned"}),"\n",(0,a.jsx)(n.li,{children:"Connections"}),"\n",(0,a.jsx)(n.li,{children:"Control connections"}),"\n",(0,a.jsx)(n.li,{children:"Uptime"}),"\n"]}),"\n",(0,a.jsx)(n.h4,{id:"fuzzy-storage-statistics",children:"Fuzzy Storage Statistics"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Show fuzzy hashes statistics\nrspamadm control fuzzystat\n\n# Detailed output\nrspamadm control fuzzystat -j | jq '.'\n"})}),"\n",(0,a.jsx)(n.h4,{id:"sync-fuzzy-database",children:"Sync Fuzzy Database"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Force immediate sync to disk\nrspamadm control fuzzysync\n"})}),"\n",(0,a.jsx)(n.p,{children:"Use before backup or maintenance."}),"\n",(0,a.jsx)(n.h4,{id:"reload-configuration",children:"Reload Configuration"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Reload workers' dynamic data\nrspamadm control reload\n"})}),"\n",(0,a.jsx)(n.p,{children:"Reloads:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Maps"}),"\n",(0,a.jsx)(n.li,{children:"Dynamic configuration"}),"\n",(0,a.jsx)(n.li,{children:"Statistics"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Does NOT reload:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Core configuration (requires restart)"}),"\n",(0,a.jsx)(n.li,{children:"Lua modules"}),"\n"]}),"\n",(0,a.jsx)(n.h4,{id:"recompile-hyperscan",children:"Recompile Hyperscan"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Recompile hyperscan regexes\nrspamadm control recompile\n"})}),"\n",(0,a.jsx)(n.p,{children:"Use after updating regex rules or on new CPU architecture."}),"\n",(0,a.jsx)(n.h4,{id:"reresolve-dns",children:"Reresolve DNS"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Reresolve upstream servers\nrspamadm control reresolve\n"})}),"\n",(0,a.jsx)(n.p,{children:"Forces DNS resolution of upstream servers (Redis, Clickhouse, etc.)."}),"\n",(0,a.jsx)(n.h3,{id:"options-1",children:"Options"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"-j, --json              JSON output\n-c, --compact           Compact format\n-u, --ucl               UCL output (default)\n-s, --socket <path>     Control socket path\n-t, --timeout <sec>     I/O timeout (default: 1s)\n"})}),"\n",(0,a.jsx)(n.h3,{id:"available-commands",children:"Available Commands"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Command"}),(0,a.jsx)(n.th,{children:"Purpose"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"stat"})}),(0,a.jsx)(n.td,{children:"Worker statistics"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"fuzzystat"})}),(0,a.jsx)(n.td,{children:"Fuzzy storage statistics"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"fuzzysync"})}),(0,a.jsx)(n.td,{children:"Sync fuzzy database to disk"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"reload"})}),(0,a.jsx)(n.td,{children:"Reload dynamic data"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"recompile"})}),(0,a.jsx)(n.td,{children:"Recompile hyperscan regexes"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"reresolve"})}),(0,a.jsx)(n.td,{children:"Reresolve upstream DNS"})]})]})]}),"\n",(0,a.jsx)(n.h3,{id:"use-cases-1",children:"Use Cases"}),"\n",(0,a.jsx)(n.h4,{id:"pre-backup-routine",children:"Pre-Backup Routine"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n# Ensure data is synced before backup\n\necho "Syncing fuzzy database..."\nrspamadm control fuzzysync\n\necho "Waiting for sync..."\nsleep 2\n\necho "Creating backup..."\ntar czf rspamd-backup-$(date +%Y%m%d).tar.gz /var/lib/rspamd/\n'})}),"\n",(0,a.jsx)(n.h4,{id:"health-check-script",children:"Health Check Script"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n# Check Rspamd health\n\nSTATS=$(rspamadm control stat -j 2>/dev/null)\n\nif [ $? -ne 0 ]; then\n  echo "ERROR: Cannot connect to Rspamd control socket"\n  exit 1\nfi\n\n# Extract metrics\nSCANNED=$(echo "$STATS" | jq \'.scanned\')\nLEARNED=$(echo "$STATS" | jq \'.learned\')\n\necho "Messages scanned: $SCANNED"\necho "Messages learned: $LEARNED"\n\n# Check if processing messages\nif [ "$SCANNED" -eq 0 ]; then\n  echo "WARNING: No messages processed"\nfi\n'})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"fuzzy_ping",children:"fuzzy_ping"}),"\n",(0,a.jsx)(n.p,{children:"Test fuzzy storage connectivity."}),"\n",(0,a.jsx)(n.h3,{id:"purpose-2",children:"Purpose"}),"\n",(0,a.jsx)(n.p,{children:"Ping fuzzy storage servers to verify connectivity and measure latency."}),"\n",(0,a.jsx)(n.h3,{id:"common-scenarios-2",children:"Common Scenarios"}),"\n",(0,a.jsx)(n.h4,{id:"basic-ping",children:"Basic Ping"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Ping default fuzzy storage\nrspamadm fuzzy_ping\n\n# Ping specific storage\nrspamadm fuzzy_ping -r local-fuzzy\n"})}),"\n",(0,a.jsx)(n.h4,{id:"list-configured-storages",children:"List Configured Storages"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# List all configured fuzzy storages\nrspamadm fuzzy_ping -l\n"})}),"\n",(0,a.jsx)(n.h4,{id:"flood-test",children:"Flood Test"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Stress test fuzzy storage\nrspamadm fuzzy_ping -f -n 1000\n\n# Silent mode (statistics only)\nrspamadm fuzzy_ping -f -S -n 10000\n"})}),"\n",(0,a.jsx)(n.h4,{id:"custom-server",children:"Custom Server"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Ping specific server\nrspamadm fuzzy_ping -s fuzzy.example.com:11335\n"})}),"\n",(0,a.jsx)(n.h3,{id:"options-2",children:"Options"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"-r, --rule <name>           Fuzzy rule name\n-f, --flood                 Flood mode (no wait)\n-S, --silent                Silent mode (stats only)\n-t, --timeout <sec>         Request timeout\n-s, --server <addr>         Override server address\n-n, --number <N>           Number of pings\n-l, --list                  List configured storages\n"})}),"\n",(0,a.jsx)(n.h3,{id:"use-cases-2",children:"Use Cases"}),"\n",(0,a.jsx)(n.h4,{id:"verify-fuzzy-setup",children:"Verify Fuzzy Setup"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'# Test all configured storages\nfor storage in $(rspamadm fuzzy_ping -l); do\n  echo "Testing $storage..."\n  rspamadm fuzzy_ping -r "$storage"\ndone\n'})}),"\n",(0,a.jsx)(n.h4,{id:"measure-latency",children:"Measure Latency"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Benchmark fuzzy storage\nrspamadm fuzzy_ping -n 100 | tail -1\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"ratelimit",children:"ratelimit"}),"\n",(0,a.jsx)(n.p,{children:"Manage rate limit buckets."}),"\n",(0,a.jsx)(n.h3,{id:"purpose-3",children:"Purpose"}),"\n",(0,a.jsx)(n.p,{children:"Track, modify, and unblock rate limit buckets in Redis."}),"\n",(0,a.jsx)(n.h3,{id:"common-scenarios-3",children:"Common Scenarios"}),"\n",(0,a.jsx)(n.h4,{id:"track-top-offenders",children:"Track Top Offenders"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Show last triggered limit\nrspamadm ratelimit track\n\n# Show top 10 limits\nrspamadm ratelimit track -q 10\n"})}),"\n",(0,a.jsx)(n.p,{children:"Output shows:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Bucket prefix"}),"\n",(0,a.jsx)(n.li,{children:"Last update time"}),"\n",(0,a.jsx)(n.li,{children:"Current burst"}),"\n",(0,a.jsx)(n.li,{children:"Rate limits"}),"\n",(0,a.jsx)(n.li,{children:"Dynamic values"}),"\n"]}),"\n",(0,a.jsx)(n.h4,{id:"upgrade-bucket-limits",children:"Upgrade Bucket Limits"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'# Increase rate for specific bucket\nrspamadm ratelimit upgrade "user:john@example.com" \\\n  --rate 100 --burst 200\n\n# Set symbol\nrspamadm ratelimit upgrade "ip:192.0.2.50" \\\n  --symbol "RATELIMIT_UPDATE"\n'})}),"\n",(0,a.jsx)(n.h4,{id:"unblock-buckets",children:"Unblock Buckets"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'# Unblock specific sender\nrspamadm ratelimit unblock "user:sender@example.com"\n\n# Unblock top N rate-limited buckets\nrspamadm ratelimit unblock 5\n'})}),"\n",(0,a.jsx)(n.h3,{id:"options-3",children:"Options"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"-c, --config <cfg>          Config file\n-q, --quantity <N>         Number of limits to show/unblock\n\nupgrade options:\n-b, --burst <N>            Set burst\n-r, --rate <N>             Set rate\n-s, --symbol <name>        Set symbol\n-B, --dynamic_burst <N>    Set dynamic burst\n-R, --dynamic_rate <N>     Set dynamic rate\n"})}),"\n",(0,a.jsx)(n.h3,{id:"use-cases-3",children:"Use Cases"}),"\n",(0,a.jsx)(n.h4,{id:"whitelist-legitimate-sender",children:"Whitelist Legitimate Sender"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'# Give high limits to known sender\nrspamadm ratelimit upgrade "user:newsletter@example.com" \\\n  --rate 1000 \\\n  --burst 2000 \\\n  --dynamic_rate 500\n'})}),"\n",(0,a.jsx)(n.h4,{id:"emergency-unblock",children:"Emergency Unblock"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n# Unblock all rate-limited senders\n\nCOUNT=$(rspamadm ratelimit track -q 100 | wc -l)\n\necho "Unblocking $COUNT rate-limited senders..."\nrspamadm ratelimit unblock "$COUNT"\n'})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"dmarc_report",children:"dmarc_report"}),"\n",(0,a.jsx)(n.p,{children:"Send DMARC aggregate reports."}),"\n",(0,a.jsx)(n.h3,{id:"purpose-4",children:"Purpose"}),"\n",(0,a.jsx)(n.p,{children:"Process DMARC data and send aggregate reports to domain owners."}),"\n",(0,a.jsx)(n.h3,{id:"common-scenarios-4",children:"Common Scenarios"}),"\n",(0,a.jsx)(n.h4,{id:"send-todays-reports",children:"Send Today's Reports"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Process and send reports for today\nrspamadm dmarc_report\n"})}),"\n",(0,a.jsx)(n.h4,{id:"send-reports-for-specific-date",children:"Send Reports for Specific Date"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Send reports for specific date (YYYYMMDD format)\nrspamadm dmarc_report 20251120\n\n# Send for yesterday\nrspamadm dmarc_report $(date -d yesterday +%Y%m%d)\n"})}),"\n",(0,a.jsx)(n.h4,{id:"dry-run-no-sending",children:"Dry Run (No Sending)"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Process but don't send or clear data\nrspamadm dmarc_report -n\n"})}),"\n",(0,a.jsx)(n.h4,{id:"batch-processing",children:"Batch Processing"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Send reports in larger batches\nrspamadm dmarc_report -b 50\n"})}),"\n",(0,a.jsx)(n.h4,{id:"verbose-logging",children:"Verbose Logging"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Enable detailed DMARC logging\nrspamadm dmarc_report -v\n"})}),"\n",(0,a.jsx)(n.h3,{id:"options-4",children:"Options"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"-c, --config <cfg>          Config file\n-v, --verbose               Verbose logging\n-n, --no-opt                Don't reset data or send\n-b, --batch-size <N>       Batch size (default: 10)\ndate                        Date to process (YYYYMMDD)\n"})}),"\n",(0,a.jsx)(n.h3,{id:"use-cases-4",children:"Use Cases"}),"\n",(0,a.jsx)(n.h4,{id:"daily-cron-job",children:"Daily Cron Job"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n# /etc/cron.daily/rspamd-dmarc-reports\n\n# Send yesterday\'s reports\nDATE=$(date -d yesterday +%Y%m%d)\n\nrspamadm dmarc_report "$DATE" -v 2>&1 | \\\n  logger -t rspamd-dmarc\n\n# Check for errors\nif [ ${PIPESTATUS[0]} -ne 0 ]; then\n  echo "DMARC report sending failed" | \\\n    mail -s "DMARC Report Error" admin@example.com\nfi\n'})}),"\n",(0,a.jsx)(n.h4,{id:"manual-report-review",children:"Manual Report Review"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Review what would be sent (dry run)\nrspamadm dmarc_report -n -v > dmarc-review.txt\n\n# Review and approve\nless dmarc-review.txt\n\n# Send for real\nrspamadm dmarc_report\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"fuzzyconvert",children:"fuzzyconvert"}),"\n",(0,a.jsx)(n.p,{children:"Convert fuzzy hashes from SQLite to Redis."}),"\n",(0,a.jsx)(n.h3,{id:"purpose-5",children:"Purpose"}),"\n",(0,a.jsx)(n.p,{children:"Migrate fuzzy hash database from SQLite3 to Redis backend."}),"\n",(0,a.jsx)(n.h3,{id:"common-scenarios-5",children:"Common Scenarios"}),"\n",(0,a.jsx)(n.h4,{id:"basic-conversion",children:"Basic Conversion"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Convert fuzzy database\nrspamadm fuzzyconvert \\\n  -d /var/lib/rspamd/fuzzy.db \\\n  -h 127.0.0.1:6379 \\\n  -e 7776000  # 90 day expiry\n"})}),"\n",(0,a.jsx)(n.h4,{id:"with-redis-authentication",children:"With Redis Authentication"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Convert with Redis password\nrspamadm fuzzyconvert \\\n  -d /var/lib/rspamd/fuzzy.db \\\n  -h 127.0.0.1:6379 \\\n  -p redis-password \\\n  -D 2  # Redis database 2\n  -e 2592000  # 30 day expiry\n"})}),"\n",(0,a.jsx)(n.h3,{id:"options-5",children:"Options"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"-d, --database <file>       Input SQLite database\n-e, --expiry <seconds>      Expiration time\n-h, --host <addr>          Redis host (ip:port)\n-D, --dbname <num>         Redis database number\n-p, --password <pw>        Redis password\n"})}),"\n",(0,a.jsx)(n.h3,{id:"use-cases-5",children:"Use Cases"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n# Complete fuzzy migration\n\nSQLITE_DB="/var/lib/rspamd/fuzzy.db"\nREDIS_HOST="localhost:6379"\nEXPIRY=7776000  # 90 days\n\n# Stop fuzzy worker\nsystemctl stop rspamd-fuzzy\n\n# Backup SQLite\ncp "$SQLITE_DB" "$SQLITE_DB.backup"\n\n# Convert to Redis\nrspamadm fuzzyconvert \\\n  -d "$SQLITE_DB" \\\n  -h "$REDIS_HOST" \\\n  -e "$EXPIRY"\n\n# Update config for Redis\ncat > /etc/rspamd/local.d/worker-fuzzy.inc << EOF\nbackend = "redis";\nservers = "$REDIS_HOST";\nEOF\n\n# Start fuzzy worker\nsystemctl start rspamd-fuzzy\n'})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"practical-examples",children:"Practical Examples"}),"\n",(0,a.jsx)(n.h3,{id:"complete-monitoring-script",children:"Complete Monitoring Script"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n# Comprehensive Rspamd monitoring\n\nLOG_FILE="/var/log/rspamd/rspamd.log"\nALERT_EMAIL="admin@example.com"\n\n# Check if Rspamd is responding\nif ! rspamadm control stat -j >/dev/null 2>&1; then\n  echo "Rspamd not responding" | mail -s "Rspamd Down" "$ALERT_EMAIL"\n  exit 1\nfi\n\n# Get statistics\nSTATS=$(rspamadm control stat -j)\nSCANNED=$(echo "$STATS" | jq \'.scanned\')\n\n# Check for errors in logs\nERRORS=$(rspamadm grep -s "error" -i "$LOG_FILE" | tail -20)\nif [ -n "$ERRORS" ]; then\n  echo "$ERRORS" | mail -s "Rspamd Errors Detected" "$ALERT_EMAIL"\nfi\n\n# Check rate limits\nRATELIMITED=$(rspamadm ratelimit track -q 10)\nif [ -n "$RATELIMITED" ]; then\n  echo "Top rate-limited senders:" > /tmp/ratelimit-report.txt\n  echo "$RATELIMITED" >> /tmp/ratelimit-report.txt\n  mail -s "Rspamd Rate Limits" "$ALERT_EMAIL" < /tmp/ratelimit-report.txt\nfi\n\n# Test fuzzy storage\nif ! rspamadm fuzzy_ping -S 2>/dev/null; then\n  echo "Fuzzy storage unreachable" | mail -s "Fuzzy Storage Alert" "$ALERT_EMAIL"\nfi\n\necho "Monitoring complete: $SCANNED messages processed"\n'})}),"\n",(0,a.jsx)(n.h3,{id:"log-analysis-report",children:"Log Analysis Report"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n# Generate daily log analysis\n\nDATE=$(date +%Y-%m-%d)\nLOG="/var/log/rspamd/rspamd.log"\nREPORT="/var/log/rspamd/daily-report-$DATE.txt"\n\n{\n  echo "Rspamd Daily Report - $DATE"\n  echo "================================"\n  echo\n  \n  echo "Top Symbols:"\n  rspamadm grep -p "symbol.*=" "$LOG" | \\\n    grep -o \'symbol=[A-Z_]*\' | sort | uniq -c | sort -rn | head -20\n  echo\n  \n  echo "Top Senders:"\n  rspamadm grep -p "from=<" "$LOG" | \\\n    grep -o \'from=<[^>]*>\' | sort | uniq -c | sort -rn | head -20\n  echo\n  \n  echo "Rejected Messages:"\n  rspamadm grep -s "reject" "$LOG" | wc -l\n  echo\n  \n  echo "Greylisted:"\n  rspamadm grep -s "greylist" "$LOG" | wc -l\n  echo\n  \n} > "$REPORT"\n\nmail -s "Rspamd Daily Report" admin@example.com < "$REPORT"\n'})}),"\n",(0,a.jsx)(n.h2,{id:"tips-and-best-practices",children:"Tips and Best Practices"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Use grep for debugging"})," - Much better than regular grep for Rspamd logs"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Regular control stat"})," - Monitor message processing rates"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Automate DMARC reports"})," - Set up daily cron job"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Monitor fuzzy storage"})," - Check connectivity regularly"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Track rate limits"})," - Review top offenders daily"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Backup before conversions"})," - Always backup before fuzzyconvert/statconvert"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Test commands first"})," - Use ",(0,a.jsx)(n.code,{children:"-n"})," or dry-run modes when available"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/docs.rspamd.com/branches/docs/arc-update/administration/rspamadm/configuration",children:"Configuration"})," - Configure workers and modules"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/docs.rspamd.com/branches/docs/arc-update/administration/rspamadm/statistics-ml",children:"Statistics & ML"})," - Manage statistical data"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/docs.rspamd.com/branches/docs/arc-update/administration/rspamadm/email-analysis",children:"Email Analysis"})," - Analyze message content"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}}}]);