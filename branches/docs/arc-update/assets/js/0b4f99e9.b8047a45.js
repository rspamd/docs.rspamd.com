"use strict";(self.webpackChunkrspamd_docs=self.webpackChunkrspamd_docs||[]).push([[4159],{28453:(e,s,n)=>{n.d(s,{R:()=>r,x:()=>l});var a=n(96540);const i={},t=a.createContext(i);function r(e){const s=a.useContext(t);return a.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),a.createElement(t.Provider,{value:s},e.children)}},55699:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>m,contentTitle:()=>l,default:()=>c,frontMatter:()=>r,metadata:()=>a,toc:()=>o});const a=JSON.parse('{"id":"administration/rspamadm/email-analysis","title":"Email Analysis & Debugging","description":"These commands help you inspect and analyze email messages to understand how Rspamd processes them.","source":"@site/docs/administration/rspamadm/email-analysis.md","sourceDirName":"administration/rspamadm","slug":"/administration/rspamadm/email-analysis","permalink":"/docs.rspamd.com/branches/docs/arc-update/administration/rspamadm/email-analysis","draft":false,"unlisted":false,"editUrl":"https://github.com/rspamd/docs.rspamd.com/edit/master/docs/administration/rspamadm/email-analysis.md","tags":[],"version":"current","frontMatter":{"title":"Email Analysis & Debugging"},"sidebar":"docs","previous":{"title":"Rspamadm Administration Utility","permalink":"/docs.rspamd.com/branches/docs/arc-update/administration/rspamadm/"},"next":{"title":"Email Manipulation","permalink":"/docs.rspamd.com/branches/docs/arc-update/administration/rspamadm/email-manipulation"}}');var i=n(74848),t=n(28453);const r={title:"Email Analysis & Debugging"},l="Email Analysis & Debugging",m={},o=[{value:"mime extract",id:"mime-extract",level:2},{value:"Purpose",id:"purpose",level:3},{value:"Common Scenarios",id:"common-scenarios",level:3},{value:"Debug Text Extraction Issues",id:"debug-text-extraction-issues",level:4},{value:"Analyze Word Extraction",id:"analyze-word-extraction",level:4},{value:"Inspect Message Structure",id:"inspect-message-structure",level:4},{value:"Options",id:"options",level:3},{value:"Related Commands",id:"related-commands",level:3},{value:"mime stat",id:"mime-stat",level:2},{value:"Purpose",id:"purpose-1",level:3},{value:"Common Scenarios",id:"common-scenarios-1",level:3},{value:"Debug Bayes Classification",id:"debug-bayes-classification",level:4},{value:"Generate Fuzzy Hashes",id:"generate-fuzzy-hashes",level:4},{value:"Extract Lua Metatokens",id:"extract-lua-metatokens",level:4},{value:"Options",id:"options-1",level:3},{value:"Use Cases",id:"use-cases",level:3},{value:"mime urls",id:"mime-urls",level:2},{value:"Purpose",id:"purpose-2",level:3},{value:"Common Scenarios",id:"common-scenarios-2",level:3},{value:"Extract All URLs",id:"extract-all-urls",level:4},{value:"Get Unique Hosts",id:"get-unique-hosts",level:4},{value:"Check TLD Distribution",id:"check-tld-distribution",level:4},{value:"Analyze Most Common Domains",id:"analyze-most-common-domains",level:4},{value:"Options",id:"options-2",level:3},{value:"Use Cases",id:"use-cases-1",level:3},{value:"mime dump",id:"mime-dump",level:2},{value:"Purpose",id:"purpose-3",level:3},{value:"Common Scenarios",id:"common-scenarios-3",level:3},{value:"Export for External Processing",id:"export-for-external-processing",level:4},{value:"Process Multiple Messages",id:"process-multiple-messages",level:4},{value:"Options",id:"options-3",level:3},{value:"Use Cases",id:"use-cases-2",level:3},{value:"Practical Examples",id:"practical-examples",level:2},{value:"Complete Message Analysis",id:"complete-message-analysis",level:3},{value:"Compare Word Extraction Methods",id:"compare-word-extraction-methods",level:3},{value:"URL Analysis for Phishing Detection",id:"url-analysis-for-phishing-detection",level:3},{value:"Tips and Best Practices",id:"tips-and-best-practices",level:2},{value:"Related Documentation",id:"related-documentation",level:2}];function d(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"email-analysis--debugging",children:"Email Analysis & Debugging"})}),"\n",(0,i.jsx)(s.p,{children:"These commands help you inspect and analyze email messages to understand how Rspamd processes them."}),"\n",(0,i.jsx)(s.h2,{id:"mime-extract",children:"mime extract"}),"\n",(0,i.jsx)(s.p,{children:"Extract content from MIME messages for analysis."}),"\n",(0,i.jsx)(s.h3,{id:"purpose",children:"Purpose"}),"\n",(0,i.jsx)(s.p,{children:"Extract plain text, HTML, words, or structural information from email messages to understand what content Rspamd sees and processes."}),"\n",(0,i.jsx)(s.h3,{id:"common-scenarios",children:"Common Scenarios"}),"\n",(0,i.jsx)(s.h4,{id:"debug-text-extraction-issues",children:"Debug Text Extraction Issues"}),"\n",(0,i.jsx)(s.p,{children:"When investigating why certain text isn't being analyzed:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"# Extract plain text content\nrspamadm mime extract -t message.eml\n\n# Extract HTML content\nrspamadm mime extract -H message.eml\n\n# Extract in different formats\nrspamadm mime extract -t -o decoded message.eml    # Decoded with charset\nrspamadm mime extract -t -o decoded_utf message.eml # UTF-8 normalized\nrspamadm mime extract -t -o oneline message.eml     # Single line\n"})}),"\n",(0,i.jsx)(s.h4,{id:"analyze-word-extraction",children:"Analyze Word Extraction"}),"\n",(0,i.jsx)(s.p,{children:"To see exactly what words/tokens are extracted:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"# Extract stemmed words (as used by Bayes)\nrspamadm mime extract -w message.eml\n\n# Extract normalized words\nrspamadm mime extract -w -F norm message.eml\n\n# Extract raw words (no processing)\nrspamadm mime extract -w -F raw message.eml\n\n# Extract full word information\nrspamadm mime extract -w -F full message.eml\n"})}),"\n",(0,i.jsx)(s.h4,{id:"inspect-message-structure",children:"Inspect Message Structure"}),"\n",(0,i.jsx)(s.p,{children:"View part information and HTML structure:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"# Show part information\nrspamadm mime extract -p message.eml\n\n# Show HTML structure (tags, attributes)\nrspamadm mime extract -H -s message.eml\n\n# Show invisible HTML content\nrspamadm mime extract -H -i message.eml\n"})}),"\n",(0,i.jsx)(s.h3,{id:"options",children:"Options"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"-t, --text              Extract plain text\n-H, --html              Extract HTML\n-o, --output <type>     Output format: raw, content, oneline, decoded, decoded_utf\n-w, --words             Extract words\n-F, --words-format      Word format: stem, norm, raw, full\n-p, --part              Show part information\n-s, --structure         Show HTML structure\n-i, --invisible         Show invisible HTML content\n"})}),"\n",(0,i.jsx)(s.h3,{id:"related-commands",children:"Related Commands"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.a,{href:"#mime-stat",children:"mime stat"})," - Extract statistical tokens"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.a,{href:"#mime-urls",children:"mime urls"})," - Extract URLs only"]}),"\n"]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"mime-stat",children:"mime stat"}),"\n",(0,i.jsx)(s.p,{children:"Extract statistical data from messages."}),"\n",(0,i.jsx)(s.h3,{id:"purpose-1",children:"Purpose"}),"\n",(0,i.jsx)(s.p,{children:"Extract the same tokens and hashes that Rspamd uses for Bayes classification and fuzzy matching."}),"\n",(0,i.jsx)(s.h3,{id:"common-scenarios-1",children:"Common Scenarios"}),"\n",(0,i.jsx)(s.h4,{id:"debug-bayes-classification",children:"Debug Bayes Classification"}),"\n",(0,i.jsx)(s.p,{children:"See what tokens would be used for Bayes:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"# Extract Bayes tokens\nrspamadm mime stat -b message.eml\n"})}),"\n",(0,i.jsx)(s.p,{children:"This shows the exact tokens that would be checked against the Bayes database, helping you understand why a message is classified as spam or ham."}),"\n",(0,i.jsx)(s.h4,{id:"generate-fuzzy-hashes",children:"Generate Fuzzy Hashes"}),"\n",(0,i.jsx)(s.p,{children:"Extract fuzzy hashes for debugging fuzzy matching:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"# Extract fuzzy hashes\nrspamadm mime stat -F message.eml\n\n# Include shingles (detailed hash information)\nrspamadm mime stat -F -s message.eml\n"})}),"\n",(0,i.jsx)(s.h4,{id:"extract-lua-metatokens",children:"Extract Lua Metatokens"}),"\n",(0,i.jsx)(s.p,{children:"View metatokens generated by Lua code:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"rspamadm mime stat -m message.eml\n"})}),"\n",(0,i.jsx)(s.h3,{id:"options-1",children:"Options"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"-m, --meta              Lua metatokens\n-b, --bayes             Bayes tokens\n-F, --fuzzy             Fuzzy hashes\n-s, --shingles          Show shingles for fuzzy hashes\n"})}),"\n",(0,i.jsx)(s.h3,{id:"use-cases",children:"Use Cases"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Debug why Bayes is not working as expected"}),"\n",(0,i.jsx)(s.li,{children:"Generate fuzzy hashes for manual comparison"}),"\n",(0,i.jsx)(s.li,{children:"Understand what statistical features are extracted"}),"\n"]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"mime-urls",children:"mime urls"}),"\n",(0,i.jsx)(s.p,{children:"Extract and analyze URLs from messages."}),"\n",(0,i.jsx)(s.h3,{id:"purpose-2",children:"Purpose"}),"\n",(0,i.jsx)(s.p,{children:"Extract URLs as Rspamd sees them, useful for debugging URL-based rules and understanding how URLs are processed."}),"\n",(0,i.jsx)(s.h3,{id:"common-scenarios-2",children:"Common Scenarios"}),"\n",(0,i.jsx)(s.h4,{id:"extract-all-urls",children:"Extract All URLs"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"# Show full URL information\nrspamadm mime urls -f message.eml\n"})}),"\n",(0,i.jsx)(s.p,{children:"This shows URLs as processed by Rspamd, including normalized forms and components."}),"\n",(0,i.jsx)(s.h4,{id:"get-unique-hosts",children:"Get Unique Hosts"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"# Extract unique hostnames\nrspamadm mime urls -H -u message.eml\n\n# Sort by frequency\nrspamadm mime urls -H -u --count -s message.eml\n"})}),"\n",(0,i.jsx)(s.h4,{id:"check-tld-distribution",children:"Check TLD Distribution"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"# Extract TLDs only\nrspamadm mime urls -t -u message.eml\n\n# Count TLD occurrences\nrspamadm mime urls -t --count -s message.eml\n"})}),"\n",(0,i.jsx)(s.h4,{id:"analyze-most-common-domains",children:"Analyze Most Common Domains"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"# Show host counts in reverse order (most common first)\nrspamadm mime urls -H -u --count -s -r message.eml\n"})}),"\n",(0,i.jsx)(s.h3,{id:"options-2",children:"Options"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"-t, --tld               Get TLDs only\n-H, --host              Get hosts only  \n-f, --full              Show piecewise URLs as processed\n-u, --unique            Print only unique URLs\n-s, --sort              Sort output\n--count                 Print count of each element\n-r, --reverse           Reverse sort order\n"})}),"\n",(0,i.jsx)(s.h3,{id:"use-cases-1",children:"Use Cases"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Debug why a URL rule isn't matching"}),"\n",(0,i.jsx)(s.li,{children:"Analyze phishing emails to find URL patterns"}),"\n",(0,i.jsx)(s.li,{children:"Check if URL redirects are being followed"}),"\n",(0,i.jsx)(s.li,{children:"Verify URL normalization"}),"\n"]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"mime-dump",children:"mime dump"}),"\n",(0,i.jsx)(s.p,{children:"Dump messages in various formats."}),"\n",(0,i.jsx)(s.h3,{id:"purpose-3",children:"Purpose"}),"\n",(0,i.jsx)(s.p,{children:"Export message content in different structured formats for further processing or analysis."}),"\n",(0,i.jsx)(s.h3,{id:"common-scenarios-3",children:"Common Scenarios"}),"\n",(0,i.jsx)(s.h4,{id:"export-for-external-processing",children:"Export for External Processing"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"# Dump as JSON\nrspamadm mime dump -j message.eml\n\n# Dump as UCL\nrspamadm mime dump -U message.eml\n\n# Dump as MessagePack\nrspamadm mime dump -M message.eml\n\n# Compact output\nrspamadm mime dump -j -C message.eml\n"})}),"\n",(0,i.jsx)(s.h4,{id:"process-multiple-messages",children:"Process Multiple Messages"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"# Don't print filenames (for piping)\nrspamadm mime dump -j --no-file message1.eml message2.eml > output.json\n"})}),"\n",(0,i.jsx)(s.h3,{id:"options-3",children:"Options"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"-j, --json              JSON output\n-U, --ucl               UCL output\n-M, --messagepack       MessagePack output\n-C, --compact           Compact format\n--no-file               Don't print filename\n"})}),"\n",(0,i.jsx)(s.h3,{id:"use-cases-2",children:"Use Cases"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Export message data for analysis in other tools"}),"\n",(0,i.jsx)(s.li,{children:"Generate structured data for machine learning"}),"\n",(0,i.jsx)(s.li,{children:"Debug message parsing issues"}),"\n"]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"practical-examples",children:"Practical Examples"}),"\n",(0,i.jsx)(s.h3,{id:"complete-message-analysis",children:"Complete Message Analysis"}),"\n",(0,i.jsx)(s.p,{children:"To fully understand how Rspamd processes a message:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:'#!/bin/bash\nMESSAGE="suspicious.eml"\n\necho "=== Text Content ==="\nrspamadm mime extract -t "$MESSAGE"\n\necho -e "\\n=== URLs ==="\nrspamadm mime urls -f "$MESSAGE"\n\necho -e "\\n=== Bayes Tokens ==="\nrspamadm mime stat -b "$MESSAGE"\n\necho -e "\\n=== Fuzzy Hashes ==="\nrspamadm mime stat -F "$MESSAGE"\n\necho -e "\\n=== Message Structure ==="\nrspamadm mime extract -p "$MESSAGE"\n'})}),"\n",(0,i.jsx)(s.h3,{id:"compare-word-extraction-methods",children:"Compare Word Extraction Methods"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:'MESSAGE="test.eml"\n\necho "Stemmed words (Bayes):"\nrspamadm mime extract -w -F stem "$MESSAGE" | head -20\n\necho -e "\\nNormalized words:"\nrspamadm mime extract -w -F norm "$MESSAGE" | head -20\n\necho -e "\\nRaw words:"\nrspamadm mime extract -w -F raw "$MESSAGE" | head -20\n'})}),"\n",(0,i.jsx)(s.h3,{id:"url-analysis-for-phishing-detection",children:"URL Analysis for Phishing Detection"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:'# Find all unique domains in a phishing email\nrspamadm mime urls -H -u phishing.eml\n\n# Check if legitimate brand is being spoofed\nrspamadm mime urls -f phishing.eml | grep -i "paypal\\|bank\\|amazon"\n\n# Count total URLs\nrspamadm mime urls phishing.eml | wc -l\n'})}),"\n",(0,i.jsx)(s.h2,{id:"tips-and-best-practices",children:"Tips and Best Practices"}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsxs)(s.strong,{children:["Use ",(0,i.jsx)(s.code,{children:"-o decoded_utf"})," for internationalized content"]})," - Ensures proper UTF-8 handling"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Combine with grep"})," - Pipe output to grep for specific patterns"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Check both text and HTML"})," - Some content may only appear in HTML parts"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsxs)(s.strong,{children:["Use ",(0,i.jsx)(s.code,{children:"--count"})," for frequency analysis"]})," - Helps identify patterns in bulk analysis"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Export as JSON"})," - For programmatic processing, JSON format is most versatile"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.a,{href:"/docs.rspamd.com/branches/docs/arc-update/administration/rspamadm/email-manipulation",children:"Email Manipulation"})," - Modify message content"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.a,{href:"/docs.rspamd.com/branches/docs/arc-update/administration/rspamadm/operations",children:"Operations"})," - Log searching with ",(0,i.jsx)(s.code,{children:"grep"})]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.a,{href:"/docs.rspamd.com/branches/docs/arc-update/administration/rspamadm/development",children:"Development"})," - Corpus testing"]}),"\n"]})]})}function c(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}}}]);