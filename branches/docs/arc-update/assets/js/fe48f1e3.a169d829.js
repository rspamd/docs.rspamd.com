"use strict";(self.webpackChunkrspamd_docs=self.webpackChunkrspamd_docs||[]).push([[5255],{12374:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>t,default:()=>m,frontMatter:()=>r,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"administration/rspamadm/configuration","title":"Configuration Management","description":"These commands help validate, inspect, and manipulate Rspamd configuration files.","source":"@site/docs/administration/rspamadm/configuration.md","sourceDirName":"administration/rspamadm","slug":"/administration/rspamadm/configuration","permalink":"/docs.rspamd.com/branches/docs/arc-update/administration/rspamadm/configuration","draft":false,"unlisted":false,"editUrl":"https://github.com/rspamd/docs.rspamd.com/edit/master/docs/administration/rspamadm/configuration.md","tags":[],"version":"current","frontMatter":{"title":"Configuration Management"},"sidebar":"docs","previous":{"title":"Operations & Monitoring","permalink":"/docs.rspamd.com/branches/docs/arc-update/administration/rspamadm/operations"},"next":{"title":"Development & Testing","permalink":"/docs.rspamd.com/branches/docs/arc-update/administration/rspamadm/development"}}');var a=i(74848),o=i(28453);const r={title:"Configuration Management"},t="Configuration Management",l={},c=[{value:"configtest",id:"configtest",level:2},{value:"Purpose",id:"purpose",level:3},{value:"Common Scenarios",id:"common-scenarios",level:3},{value:"Basic Validation",id:"basic-validation",level:4},{value:"Quiet Mode",id:"quiet-mode",level:4},{value:"Strict Mode",id:"strict-mode",level:4},{value:"Skip Jinja Templates",id:"skip-jinja-templates",level:4},{value:"Options",id:"options",level:3},{value:"Use Cases",id:"use-cases",level:3},{value:"Pre-Restart Validation",id:"pre-restart-validation",level:4},{value:"Continuous Integration",id:"continuous-integration",level:4},{value:"configdump",id:"configdump",level:2},{value:"Purpose",id:"purpose-1",level:3},{value:"Common Scenarios",id:"common-scenarios-1",level:3},{value:"Dump Full Configuration",id:"dump-full-configuration",level:4},{value:"Dump Specific Module",id:"dump-specific-module",level:4},{value:"Show Help Comments",id:"show-help-comments",level:4},{value:"Show Modules State",id:"show-modules-state",level:4},{value:"Show Symbol Groups",id:"show-symbol-groups",level:4},{value:"Options",id:"options-1",level:3},{value:"Use Cases",id:"use-cases-1",level:3},{value:"Debug Configuration Merging",id:"debug-configuration-merging",level:4},{value:"Document Current Configuration",id:"document-current-configuration",level:4},{value:"Verify Module Status",id:"verify-module-status",level:4},{value:"Extract Specific Settings",id:"extract-specific-settings",level:4},{value:"confighelp",id:"confighelp",level:2},{value:"Purpose",id:"purpose-2",level:3},{value:"Common Scenarios",id:"common-scenarios-2",level:3},{value:"List All Options",id:"list-all-options",level:4},{value:"Show Module Options",id:"show-module-options",level:4},{value:"Show Specific Option",id:"show-specific-option",level:4},{value:"Use Cases",id:"use-cases-2",level:3},{value:"Find Available Options",id:"find-available-options",level:4},{value:"Configuration Writing",id:"configuration-writing",level:4},{value:"configgraph",id:"configgraph",level:2},{value:"Purpose",id:"purpose-3",level:3},{value:"Common Scenarios",id:"common-scenarios-3",level:3},{value:"Generate Graph",id:"generate-graph",level:4},{value:"Use Cases",id:"use-cases-3",level:3},{value:"Document Configuration Structure",id:"document-configuration-structure",level:4},{value:"Debug Circular Includes",id:"debug-circular-includes",level:4},{value:"configwizard",id:"configwizard",level:2},{value:"Purpose",id:"purpose-4",level:3},{value:"Common Scenarios",id:"common-scenarios-4",level:3},{value:"Run Setup Wizard",id:"run-setup-wizard",level:4},{value:"Use Cases",id:"use-cases-4",level:3},{value:"Initial Setup",id:"initial-setup",level:4},{value:"Quick Configuration",id:"quick-configuration",level:4},{value:"template",id:"template",level:2},{value:"Purpose",id:"purpose-5",level:3},{value:"Common Scenarios",id:"common-scenarios-5",level:3},{value:"Process Template",id:"process-template",level:4},{value:"With Custom Variables",id:"with-custom-variables",level:4},{value:"Save with Suffix",id:"save-with-suffix",level:4},{value:"In-Place Replacement",id:"in-place-replacement",level:4},{value:"Without Rspamd Variables",id:"without-rspamd-variables",level:4},{value:"Options",id:"options-2",level:3},{value:"Use Cases",id:"use-cases-5",level:3},{value:"Configuration Generation",id:"configuration-generation",level:4},{value:"Multi-Environment Deployment",id:"multi-environment-deployment",level:4},{value:"Dynamic Configuration",id:"dynamic-configuration",level:4},{value:"Practical Examples",id:"practical-examples",level:2},{value:"Complete Configuration Validation Pipeline",id:"complete-configuration-validation-pipeline",level:3},{value:"Configuration Template System",id:"configuration-template-system",level:3},{value:"Configuration Audit Script",id:"configuration-audit-script",level:3},{value:"Tips and Best Practices",id:"tips-and-best-practices",level:2},{value:"Configuration Testing",id:"configuration-testing",level:3},{value:"Configuration Inspection",id:"configuration-inspection",level:3},{value:"Template Usage",id:"template-usage",level:3},{value:"Best Practices",id:"best-practices",level:3},{value:"Related Documentation",id:"related-documentation",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"configuration-management",children:"Configuration Management"})}),"\n",(0,a.jsx)(n.p,{children:"These commands help validate, inspect, and manipulate Rspamd configuration files."}),"\n",(0,a.jsx)(n.h2,{id:"configtest",children:"configtest"}),"\n",(0,a.jsx)(n.p,{children:"Validate configuration syntax and load ability."}),"\n",(0,a.jsx)(n.h3,{id:"purpose",children:"Purpose"}),"\n",(0,a.jsx)(n.p,{children:"Test that configuration files are syntactically correct and can be loaded without errors."}),"\n",(0,a.jsx)(n.h3,{id:"common-scenarios",children:"Common Scenarios"}),"\n",(0,a.jsx)(n.h4,{id:"basic-validation",children:"Basic Validation"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Test default configuration\nrspamadm configtest\n\n# Test specific config file\nrspamadm configtest -c /path/to/rspamd.conf\n"})}),"\n",(0,a.jsx)(n.p,{children:"Exit codes:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"0"})," - Configuration is valid"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"1"})," - Configuration has errors"]}),"\n"]}),"\n",(0,a.jsx)(n.h4,{id:"quiet-mode",children:"Quiet Mode"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'# Only show errors (for scripts)\nrspamadm configtest -q\n\n# Use in scripts\nif rspamadm configtest -q; then\n  systemctl restart rspamd\nelse\n  echo "Configuration errors detected"\n  exit 1\nfi\n'})}),"\n",(0,a.jsx)(n.h4,{id:"strict-mode",children:"Strict Mode"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Stop on any error (even warnings)\nrspamadm configtest -s\n"})}),"\n",(0,a.jsx)(n.h4,{id:"skip-jinja-templates",children:"Skip Jinja Templates"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Don't process Jinja templates\nrspamadm configtest -T\n"})}),"\n",(0,a.jsx)(n.h3,{id:"options",children:"Options"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"-q, --quiet             Suppress output\n-c, --config <file>     Config file to test\n-s, --strict            Stop on any error\n-T, --skip-template     Don't apply Jinja templates\n"})}),"\n",(0,a.jsx)(n.h3,{id:"use-cases",children:"Use Cases"}),"\n",(0,a.jsx)(n.h4,{id:"pre-restart-validation",children:"Pre-Restart Validation"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n# Safe Rspamd restart\n\necho "Validating configuration..."\nif rspamadm configtest; then\n  echo "Configuration valid, restarting..."\n  systemctl restart rspamd\n  sleep 2\n  \n  # Verify it started\n  if systemctl is-active rspamd >/dev/null; then\n    echo "Rspamd restarted successfully"\n  else\n    echo "Rspamd failed to start, check logs"\n    systemctl status rspamd\n    exit 1\n  fi\nelse\n  echo "Configuration errors detected, not restarting"\n  exit 1\nfi\n'})}),"\n",(0,a.jsx)(n.h4,{id:"continuous-integration",children:"Continuous Integration"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"# .gitlab-ci.yml\ntest-config:\n  script:\n    - rspamadm configtest -c rspamd.conf -s\n  only:\n    - merge_requests\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"configdump",children:"configdump"}),"\n",(0,a.jsx)(n.p,{children:"Display effective configuration."}),"\n",(0,a.jsx)(n.h3,{id:"purpose-1",children:"Purpose"}),"\n",(0,a.jsx)(n.p,{children:"Show the final merged configuration after processing all includes and overrides."}),"\n",(0,a.jsx)(n.h3,{id:"common-scenarios-1",children:"Common Scenarios"}),"\n",(0,a.jsx)(n.h4,{id:"dump-full-configuration",children:"Dump Full Configuration"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Show complete effective config\nrspamadm configdump | less\n\n# JSON format (pretty printed)\nrspamadm configdump -j | jq '.' | less\n\n# Compact JSON\nrspamadm configdump -C\n\n# Show as UCL\nrspamadm configdump\n"})}),"\n",(0,a.jsx)(n.h4,{id:"dump-specific-module",children:"Dump Specific Module"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Show specific module config\nrspamadm configdump dkim_signing\n\n# Show classifier config\nrspamadm configdump classifier\n\n# Show worker config\nrspamadm configdump worker-normal\n"})}),"\n",(0,a.jsx)(n.h4,{id:"show-help-comments",children:"Show Help Comments"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Include help text for options\nrspamadm configdump -h\n\n# Show saved comments\nrspamadm configdump -s\n"})}),"\n",(0,a.jsx)(n.h4,{id:"show-modules-state",children:"Show Modules State"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Show only module states (enabled/disabled)\nrspamadm configdump -m\n"})}),"\n",(0,a.jsx)(n.h4,{id:"show-symbol-groups",children:"Show Symbol Groups"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Show symbol group configuration\nrspamadm configdump -g\n"})}),"\n",(0,a.jsx)(n.h3,{id:"options-1",children:"Options"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"-j, --json              JSON output (pretty)\n-C, --compact           Compact JSON\n-c, --config <file>     Config file\n-h, --show-help         Show help comments\n-s, --show-comments     Show saved comments\n-m, --modules-state     Show modules state only\n-g, --groups            Show symbols groups only\n-T, --skip-template     Don't apply Jinja templates\n"})}),"\n",(0,a.jsx)(n.h3,{id:"use-cases-1",children:"Use Cases"}),"\n",(0,a.jsx)(n.h4,{id:"debug-configuration-merging",children:"Debug Configuration Merging"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Check what's actually being used\nrspamadm configdump redis\n\n# Compare with what you expect\ndiff <(rspamadm configdump redis) expected-redis.conf\n"})}),"\n",(0,a.jsx)(n.h4,{id:"document-current-configuration",children:"Document Current Configuration"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Export current config for documentation\nrspamadm configdump -j > current-config-$(date +%Y%m%d).json\n\n# With comments\nrspamadm configdump -h -s > documented-config.txt\n"})}),"\n",(0,a.jsx)(n.h4,{id:"verify-module-status",children:"Verify Module Status"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'# Check which modules are enabled\nrspamadm configdump -m | grep -v "^#"\n\n# List disabled modules\nrspamadm configdump -m | grep "enabled = false"\n'})}),"\n",(0,a.jsx)(n.h4,{id:"extract-specific-settings",children:"Extract Specific Settings"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Get Redis configuration\nrspamadm configdump redis -j | jq '.redis'\n\n# Get all DKIM selectors\nrspamadm configdump dkim_signing -j | jq '.dkim_signing.domain'\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"confighelp",children:"confighelp"}),"\n",(0,a.jsx)(n.p,{children:"Show documentation for configuration options."}),"\n",(0,a.jsx)(n.h3,{id:"purpose-2",children:"Purpose"}),"\n",(0,a.jsx)(n.p,{children:"Display help text and available options for configuration elements."}),"\n",(0,a.jsx)(n.h3,{id:"common-scenarios-2",children:"Common Scenarios"}),"\n",(0,a.jsx)(n.h4,{id:"list-all-options",children:"List All Options"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Show all configuration options\nrspamadm confighelp | less\n"})}),"\n",(0,a.jsx)(n.h4,{id:"show-module-options",children:"Show Module Options"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Show options for specific module\nrspamadm confighelp dkim_signing\n\n# Show worker options\nrspamadm confighelp worker\n\n# Show classifier options\nrspamadm confighelp classifier\n"})}),"\n",(0,a.jsx)(n.h4,{id:"show-specific-option",children:"Show Specific Option"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Show details about specific option\nrspamadm confighelp dkim_signing.selector\n\n# Show nested option\nrspamadm confighelp surbl.rule\n\n# Show worker-specific option\nrspamadm confighelp worker-controller.password\n"})}),"\n",(0,a.jsx)(n.h3,{id:"use-cases-2",children:"Use Cases"}),"\n",(0,a.jsx)(n.h4,{id:"find-available-options",children:"Find Available Options"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'# What can I configure in this module?\nrspamadm confighelp multimap | grep "^\\s*[a-z]"\n\n# Show all Redis options\nrspamadm confighelp redis\n'})}),"\n",(0,a.jsx)(n.h4,{id:"configuration-writing",children:"Configuration Writing"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# While editing config, check available options\nvim /etc/rspamd/local.d/dkim_signing.conf\n\n# In another terminal:\nrspamadm confighelp dkim_signing\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"configgraph",children:"configgraph"}),"\n",(0,a.jsx)(n.p,{children:"Visualize configuration include hierarchy."}),"\n",(0,a.jsx)(n.h3,{id:"purpose-3",children:"Purpose"}),"\n",(0,a.jsx)(n.p,{children:"Generate a graph showing how configuration files include each other."}),"\n",(0,a.jsx)(n.h3,{id:"common-scenarios-3",children:"Common Scenarios"}),"\n",(0,a.jsx)(n.h4,{id:"generate-graph",children:"Generate Graph"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Generate Graphviz DOT format\nrspamadm configgraph > config-graph.dot\n\n# Convert to image\ndot -Tpng config-graph.dot -o config-graph.png\n\n# Convert to SVG\ndot -Tsvg config-graph.dot -o config-graph.svg\n\n# Interactive view (if you have xdot)\nrspamadm configgraph | xdot -\n"})}),"\n",(0,a.jsx)(n.h3,{id:"use-cases-3",children:"Use Cases"}),"\n",(0,a.jsx)(n.h4,{id:"document-configuration-structure",children:"Document Configuration Structure"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n# Generate configuration documentation\n\nDATE=$(date +%Y-%m-%d)\nOUTPUT="/var/www/docs/rspamd"\n\n# Generate graph\nrspamadm configgraph | \\\n  dot -Tsvg -o "$OUTPUT/config-includes-$DATE.svg"\n\n# Generate HTML page\ncat > "$OUTPUT/index.html" << EOF\n<html>\n<head><title>Rspamd Configuration Structure</title></head>\n<body>\n  <h1>Configuration Include Hierarchy ($DATE)</h1>\n  <img src="config-includes-$DATE.svg" alt="Config Graph">\n</body>\n</html>\nEOF\n'})}),"\n",(0,a.jsx)(n.h4,{id:"debug-circular-includes",children:"Debug Circular Includes"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'# Find circular includes\nrspamadm configgraph | grep -i "cycle"\n'})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"configwizard",children:"configwizard"}),"\n",(0,a.jsx)(n.p,{children:"Interactive configuration setup wizard."}),"\n",(0,a.jsx)(n.h3,{id:"purpose-4",children:"Purpose"}),"\n",(0,a.jsx)(n.p,{children:"Guided configuration for Rspamd daemon with interactive prompts."}),"\n",(0,a.jsx)(n.h3,{id:"common-scenarios-4",children:"Common Scenarios"}),"\n",(0,a.jsx)(n.h4,{id:"run-setup-wizard",children:"Run Setup Wizard"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Start interactive wizard\nrspamadm configwizard\n"})}),"\n",(0,a.jsx)(n.p,{children:"The wizard will guide you through:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Redis configuration"}),"\n",(0,a.jsx)(n.li,{children:"Controller password"}),"\n",(0,a.jsx)(n.li,{children:"DKIM setup"}),"\n",(0,a.jsx)(n.li,{children:"Logging options"}),"\n",(0,a.jsx)(n.li,{children:"Workers configuration"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"use-cases-4",children:"Use Cases"}),"\n",(0,a.jsx)(n.h4,{id:"initial-setup",children:"Initial Setup"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# After fresh install\nrspamadm configwizard\n\n# Follow prompts to configure basic settings\n"})}),"\n",(0,a.jsx)(n.h4,{id:"quick-configuration",children:"Quick Configuration"}),"\n",(0,a.jsx)(n.p,{children:"When you need to quickly set up a new instance with standard settings."}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"template",children:"template"}),"\n",(0,a.jsx)(n.p,{children:"Apply Jinja templates to files."}),"\n",(0,a.jsx)(n.h3,{id:"purpose-5",children:"Purpose"}),"\n",(0,a.jsx)(n.p,{children:"Process files with Jinja template syntax, useful for generating configuration from templates."}),"\n",(0,a.jsx)(n.h3,{id:"common-scenarios-5",children:"Common Scenarios"}),"\n",(0,a.jsx)(n.h4,{id:"process-template",children:"Process Template"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Apply template to file\nrspamadm template config.template > config.conf\n\n# Process multiple files\nrspamadm template template1 template2 template3\n"})}),"\n",(0,a.jsx)(n.h4,{id:"with-custom-variables",children:"With Custom Variables"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Load variables from file (name=value format)\nrspamadm template -e vars.env config.template > config.conf\n\n# Load variables from Lua file\nrspamadm template -l vars.lua config.template > config.conf\n"})}),"\n",(0,a.jsx)(n.h4,{id:"save-with-suffix",children:"Save with Suffix"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Process and save with suffix\nrspamadm template -s .conf config.template\n\n# Creates: config.template.conf\n"})}),"\n",(0,a.jsx)(n.h4,{id:"in-place-replacement",children:"In-Place Replacement"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Replace original file\nrspamadm template -i config.template\n"})}),"\n",(0,a.jsx)(n.h4,{id:"without-rspamd-variables",children:"Without Rspamd Variables"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Don't add internal Rspamd variables\nrspamadm template -n config.template\n"})}),"\n",(0,a.jsx)(n.h3,{id:"options-2",children:"Options"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"-n, --no-vars               Don't add Rspamd variables\n-e, --env <file>           Load environment from file (name=value)\n-l, --lua-env <file>       Load environment from Lua file\n-s, --suffix <suffix>      Save with suffix\n-i, --inplace              Replace original file\n"})}),"\n",(0,a.jsx)(n.h3,{id:"use-cases-5",children:"Use Cases"}),"\n",(0,a.jsx)(n.h4,{id:"configuration-generation",children:"Configuration Generation"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'# vars.env\nREDIS_HOST=redis.example.com\nREDIS_PORT=6379\nCLICKHOUSE_HOST=clickhouse.example.com\n\n# redis.template\nredis {\n  servers = "{{ REDIS_HOST }}:{{ REDIS_PORT }}";\n}\n'})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Generate config\nrspamadm template -e vars.env redis.template > redis.conf\n"})}),"\n",(0,a.jsx)(n.h4,{id:"multi-environment-deployment",children:"Multi-Environment Deployment"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n# Generate configs for different environments\n\nfor env in dev staging prod; do\n  echo "Generating config for $env..."\n  \n  rspamadm template \\\n    -e "vars-$env.env" \\\n    -s "-$env.conf" \\\n    config.template\ndone\n'})}),"\n",(0,a.jsx)(n.h4,{id:"dynamic-configuration",children:"Dynamic Configuration"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-lua",children:'-- vars.lua\nreturn {\n  redis_host = "redis.local",\n  redis_port = 6379,\n  debug_enabled = true,\n  workers = 4\n}\n'})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"rspamadm template -l vars.lua rspamd.template > rspamd.conf\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"practical-examples",children:"Practical Examples"}),"\n",(0,a.jsx)(n.h3,{id:"complete-configuration-validation-pipeline",children:"Complete Configuration Validation Pipeline"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n# Validate and deploy configuration\n\nCONFIG_DIR="/etc/rspamd"\nBACKUP_DIR="/var/backups/rspamd/config"\nDATE=$(date +%Y%m%d-%H%M%S)\n\n# 1. Backup current config\necho "=== Backing up current configuration ==="\nmkdir -p "$BACKUP_DIR"\ntar czf "$BACKUP_DIR/config-$DATE.tar.gz" "$CONFIG_DIR"\n\n# 2. Test syntax\necho "=== Testing configuration syntax ==="\nif ! rspamadm configtest -s; then\n  echo "ERROR: Configuration validation failed"\n  exit 1\nfi\n\n# 3. Compare with previous\necho "=== Checking for changes ==="\nCURRENT=$(rspamadm configdump -C)\nPREVIOUS=$(cat /tmp/last-config.json 2>/dev/null || echo "{}")\n\nif [ "$CURRENT" != "$PREVIOUS" ]; then\n  echo "Configuration changes detected"\n  echo "$CURRENT" | jq \'.\' > /tmp/config-changes.json\nfi\n\n# 4. Document current state\necho "=== Documenting configuration ==="\nrspamadm configdump -j > "$BACKUP_DIR/config-dump-$DATE.json"\nrspamadm configdump -m > "$BACKUP_DIR/modules-state-$DATE.txt"\nrspamadm configdump -g > "$BACKUP_DIR/symbol-groups-$DATE.txt"\n\n# 5. Generate graph\necho "=== Generating configuration graph ==="\nrspamadm configgraph | dot -Tpng -o "$BACKUP_DIR/config-graph-$DATE.png"\n\n# 6. Restart if needed\nif systemctl is-active rspamd >/dev/null; then\n  echo "=== Restarting Rspamd ==="\n  systemctl restart rspamd\n  sleep 2\n  \n  if ! systemctl is-active rspamd >/dev/null; then\n    echo "ERROR: Rspamd failed to start!"\n    echo "Restoring backup..."\n    systemctl stop rspamd\n    rm -rf "$CONFIG_DIR"/*\n    tar xzf "$BACKUP_DIR/config-$DATE.tar.gz" -C /\n    systemctl start rspamd\n    exit 1\n  fi\nfi\n\n# 7. Save for next comparison\necho "$CURRENT" > /tmp/last-config.json\n\necho "=== Configuration deployed successfully ==="\n'})}),"\n",(0,a.jsx)(n.h3,{id:"configuration-template-system",children:"Configuration Template System"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n# Template-based configuration management\n\nTEMPLATE_DIR="/etc/rspamd/templates"\nENV_DIR="/etc/rspamd/environments"\nOUTPUT_DIR="/etc/rspamd"\n\nENVIRONMENT=${1:-production}\n\nif [ ! -f "$ENV_DIR/$ENVIRONMENT.env" ]; then\n  echo "Environment $ENVIRONMENT not found"\n  exit 1\nfi\n\necho "Generating configuration for $ENVIRONMENT environment..."\n\n# Process all templates\nfor template in "$TEMPLATE_DIR"/*.template; do\n  basename=$(basename "$template" .template)\n  output="$OUTPUT_DIR/$basename.conf"\n  \n  echo "Processing $basename..."\n  \n  rspamadm template \\\n    -e "$ENV_DIR/$ENVIRONMENT.env" \\\n    "$template" > "$output"\n  \n  if [ $? -ne 0 ]; then\n    echo "Error processing $template"\n    exit 1\n  fi\ndone\n\n# Validate\necho "Validating generated configuration..."\nif rspamadm configtest -s; then\n  echo "Configuration valid"\nelse\n  echo "Configuration invalid, rolling back"\n  exit 1\nfi\n'})}),"\n",(0,a.jsx)(n.h3,{id:"configuration-audit-script",children:"Configuration Audit Script"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n# Audit Rspamd configuration\n\nREPORT_FILE="/var/log/rspamd/config-audit-$(date +%Y%m%d).txt"\n\n{\n  echo "Rspamd Configuration Audit"\n  echo "=========================="\n  echo "Date: $(date)"\n  echo\n  \n  echo "=== Configuration Validity ==="\n  if rspamadm configtest -q; then\n    echo "\u2713 Configuration is valid"\n  else\n    echo "\u2717 Configuration has errors:"\n    rspamadm configtest\n  fi\n  echo\n  \n  echo "=== Module Status ==="\n  rspamadm configdump -m | grep -E "(module|enabled)"\n  echo\n  \n  echo "=== Enabled Workers ==="\n  rspamadm configdump worker | grep -E "type.*worker"\n  echo\n  \n  echo "=== Redis Configuration ==="\n  rspamadm configdump redis -j | jq -r \'.redis | {servers, password: "***"}\'\n  echo\n  \n  echo "=== DKIM Domains ==="\n  rspamadm configdump dkim_signing -j | jq -r \'.dkim_signing.domain | keys[]\' 2>/dev/null || echo "None configured"\n  echo\n  \n  echo "=== Symbol Groups ==="\n  rspamadm configdump -g | grep "group =" | wc -l\n  echo "total groups"\n  echo\n  \n} | tee "$REPORT_FILE"\n\necho "Report saved to $REPORT_FILE"\n'})}),"\n",(0,a.jsx)(n.h2,{id:"tips-and-best-practices",children:"Tips and Best Practices"}),"\n",(0,a.jsx)(n.h3,{id:"configuration-testing",children:"Configuration Testing"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Always test before restart"})," - Use ",(0,a.jsx)(n.code,{children:"configtest"})," before restarting Rspamd"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Use strict mode"})," - ",(0,a.jsx)(n.code,{children:"-s"})," flag catches more issues"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Test in CI/CD"})," - Validate configs in your deployment pipeline"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Automated testing"})," - Script configuration validation"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Keep backups"})," - Backup config before changes"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"configuration-inspection",children:"Configuration Inspection"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Use configdump to debug"})," - See actual merged configuration"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Check module states"})," - Verify modules are enabled as expected"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Document with graphs"})," - Generate configuration diagrams"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Export regularly"})," - Keep dumps of known-good configurations"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Compare environments"})," - Diff configs between environments"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"template-usage",children:"Template Usage"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Version templates"})," - Keep templates in version control"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Environment-specific vars"})," - Separate environment variables"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Validate after templating"})," - Always run configtest"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Use descriptive variables"})," - Make templates readable"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Document variables"})," - Explain what each variable does"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"best-practices",children:"Best Practices"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Modular configuration"})," - Use local.d/ and override.d/"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Comment your changes"})," - Explain why, not what"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Test incrementally"})," - Small changes, test frequently"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Keep defaults"})," - Don't override unless necessary"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Use confighelp"})," - Check available options before guessing"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/docs.rspamd.com/branches/docs/arc-update/administration/rspamadm/cryptography",children:"Cryptography"})," - Encrypt sensitive config values"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/docs.rspamd.com/branches/docs/arc-update/administration/rspamadm/operations",children:"Operations"})," - Reload configuration without restart"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/configuration/index",children:"Configuration Guide"})," - Rspamd configuration documentation"]}),"\n"]})]})}function m(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>t});var s=i(96540);const a={},o=s.createContext(a);function r(e){const n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);