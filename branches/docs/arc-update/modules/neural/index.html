<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-modules/neural" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Neural network module | Rspamd Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://rspamd.com/docs.rspamd.com/branches/docs/arc-update/modules/neural"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="ru"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Neural network module | Rspamd Documentation"><meta data-rh="true" name="description" content="The neural network module performs post-classification of messages using a small neural network trained on features extracted from messages. It learns patterns from spam and ham samples and adjusts its scoring based on observed symbol combinations and message metadata."><meta data-rh="true" property="og:description" content="The neural network module performs post-classification of messages using a small neural network trained on features extracted from messages. It learns patterns from spam and ham samples and adjusts its scoring based on observed symbol combinations and message metadata."><link data-rh="true" rel="icon" href="/docs.rspamd.com/branches/docs/arc-update/img/favicon.png"><link data-rh="true" rel="canonical" href="https://rspamd.com/docs.rspamd.com/branches/docs/arc-update/modules/neural"><link data-rh="true" rel="alternate" href="https://rspamd.com/docs.rspamd.com/branches/docs/arc-update/modules/neural" hreflang="en"><link data-rh="true" rel="alternate" href="https://rspamd.com/docs.rspamd.com/branches/docs/arc-update/ru/modules/neural" hreflang="ru"><link data-rh="true" rel="alternate" href="https://rspamd.com/docs.rspamd.com/branches/docs/arc-update/modules/neural" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Modules","item":"https://rspamd.com/docs.rspamd.com/branches/docs/arc-update/modules/"},{"@type":"ListItem","position":2,"name":"Neural network module","item":"https://rspamd.com/docs.rspamd.com/branches/docs/arc-update/modules/neural"}]}</script><link rel="alternate" type="application/rss+xml" href="/docs.rspamd.com/branches/docs/arc-update/blog/rss.xml" title="Rspamd Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/docs.rspamd.com/branches/docs/arc-update/blog/atom.xml" title="Rspamd Blog Atom Feed">




<script>window.SEARCH_BACKEND_CONFIG={endpoint:"/api"}</script>

<link rel="alternate" type="application/rss+xml" title="Rspamd Changelog RSS" href="/rss/changelog.xml">
<link rel="alternate" type="application/rss+xml" title="Rspamd Blog RSS" href="/blog/rss.xml">
<link rel="alternate" type="application/atom+xml" title="Rspamd Blog Atom" href="/blog/atom.xml"><link rel="stylesheet" href="/docs.rspamd.com/branches/docs/arc-update/assets/css/styles.10e2e935.css">
<script src="/docs.rspamd.com/branches/docs/arc-update/assets/js/runtime~main.407686a6.js" defer="defer"></script>
<script src="/docs.rspamd.com/branches/docs/arc-update/assets/js/main.a05e7519.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/docs.rspamd.com/branches/docs/arc-update/img/rspamd_logo_black.png"><link rel="preload" as="image" href="/docs.rspamd.com/branches/docs/arc-update/img/rspamd_logo_navbar.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://www.rspamd.com" target="_self" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/docs.rspamd.com/branches/docs/arc-update/img/rspamd_logo_black.png" alt="Rspamd Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/docs.rspamd.com/branches/docs/arc-update/img/rspamd_logo_navbar.png" alt="Rspamd Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs.rspamd.com/branches/docs/arc-update/">Documentation</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs.rspamd.com/branches/docs/arc-update/about/">About</a><a class="navbar__item navbar__link" href="/docs.rspamd.com/branches/docs/arc-update/tutorials/">Tutorials</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs.rspamd.com/branches/docs/arc-update/modules/">Modules</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs.rspamd.com/branches/docs/arc-update/other/usage_policy">Usage Policy</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs.rspamd.com/branches/docs/arc-update/faq">FAQ</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs.rspamd.com/branches/docs/arc-update/support">Support</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs.rspamd.com/branches/docs/arc-update/downloads">Downloads</a><a class="navbar__item navbar__link" href="/docs.rspamd.com/branches/docs/arc-update/blog">Blog</a><a class="navbar__item navbar__link" href="/docs.rspamd.com/branches/docs/arc-update/changelog">Changelog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div><div class="elasticsearch-search-container"><form class="elasticsearch-search-form"><div class="elasticsearch-search-input-container"><input type="text" placeholder="Search documentation..." class="elasticsearch-search-input" aria-label="Search documentation" value=""><div class="elasticsearch-search-shortcut"><span>⌘K</span></div></div></form></div></div><div class="navbar__item"><div id="font-size-control-mount"></div></div><a href="https://github.com/rspamd/rspamd" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs.rspamd.com/branches/docs/arc-update/"><span title="About Rspamd" class="linkLabel_WmDU">About Rspamd</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs.rspamd.com/branches/docs/arc-update/getting-started/"><span title="Getting Started" class="categoryLinkLabel_W154">Getting Started</span></a><button aria-label="Expand sidebar category &#x27;Getting Started&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs.rspamd.com/branches/docs/arc-update/tutorials/migration"><span title="How-To Guides" class="categoryLinkLabel_W154">How-To Guides</span></a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs.rspamd.com/branches/docs/arc-update/faq"><span title="Frequently asked questions" class="linkLabel_WmDU">Frequently asked questions</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs.rspamd.com/branches/docs/arc-update/about/"><span title="About" class="categoryLinkLabel_W154">About</span></a><button aria-label="Expand sidebar category &#x27;About&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs.rspamd.com/branches/docs/arc-update/support"><span title="Rspamd Support" class="linkLabel_WmDU">Rspamd Support</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs.rspamd.com/branches/docs/arc-update/downloads"><span title="Downloads" class="linkLabel_WmDU">Downloads</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs.rspamd.com/branches/docs/arc-update/configuration/"><span title="Configuration" class="categoryLinkLabel_W154">Configuration</span></a><button aria-label="Expand sidebar category &#x27;Configuration&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs.rspamd.com/branches/docs/arc-update/workers/"><span title="Workers" class="categoryLinkLabel_W154">Workers</span></a><button aria-label="Expand sidebar category &#x27;Workers&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" href="/docs.rspamd.com/branches/docs/arc-update/modules/"><span title="Modules" class="categoryLinkLabel_W154">Modules</span></a><button aria-label="Collapse sidebar category &#x27;Modules&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/docs/arc-update/modules/antivirus"><span title="Antivirus module" class="linkLabel_WmDU">Antivirus module</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/docs/arc-update/modules/arc"><span title="ARC module" class="linkLabel_WmDU">ARC module</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/docs/arc-update/modules/asn"><span title="ASN module" class="linkLabel_WmDU">ASN module</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/docs/arc-update/modules/bayes_expiry"><span title="Bayes expiry module" class="linkLabel_WmDU">Bayes expiry module</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/docs/arc-update/modules/chartable"><span title="Chartable module" class="linkLabel_WmDU">Chartable module</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/docs/arc-update/modules/clickhouse"><span title="Clickhouse module" class="linkLabel_WmDU">Clickhouse module</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/docs/arc-update/modules/dcc"><span title="DCC module" class="linkLabel_WmDU">DCC module</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/docs/arc-update/modules/dkim"><span title="DKIM module" class="linkLabel_WmDU">DKIM module</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/docs/arc-update/modules/dkim_signing"><span title="DKIM signing module" class="linkLabel_WmDU">DKIM signing module</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/docs/arc-update/modules/dmarc"><span title="DMARC module" class="linkLabel_WmDU">DMARC module</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/docs/arc-update/modules/elastic"><span title="Elasticsearch module" class="linkLabel_WmDU">Elasticsearch module</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/docs/arc-update/modules/emails"><span title="Emails module" class="linkLabel_WmDU">Emails module</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/docs/arc-update/modules/external_relay"><span title="External Relay module" class="linkLabel_WmDU">External Relay module</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/docs/arc-update/modules/external_services"><span title="External Services module" class="linkLabel_WmDU">External Services module</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/docs/arc-update/modules/force_actions"><span title="Force Actions module" class="linkLabel_WmDU">Force Actions module</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/docs/arc-update/modules/fuzzy_check"><span title="Fuzzy check module" class="linkLabel_WmDU">Fuzzy check module</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/docs/arc-update/modules/gpt"><span title="GPT Plugin" class="linkLabel_WmDU">GPT Plugin</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/docs/arc-update/modules/greylisting"><span title="Greylisting module" class="linkLabel_WmDU">Greylisting module</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/docs/arc-update/modules/hfilter"><span title="Hfilter module" class="linkLabel_WmDU">Hfilter module</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/docs/arc-update/modules/history_redis"><span title="Redis history module" class="linkLabel_WmDU">Redis history module</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/docs/arc-update/modules/ip_score"><span title="IP Score module" class="linkLabel_WmDU">IP Score module</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/docs/arc-update/modules/known_senders"><span title="Known senders module" class="linkLabel_WmDU">Known senders module</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/docs/arc-update/modules/maillist"><span title="Mailing lists module" class="linkLabel_WmDU">Mailing lists module</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/docs/arc-update/modules/metadata_exporter"><span title="Metadata exporter" class="linkLabel_WmDU">Metadata exporter</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/docs/arc-update/modules/metric_exporter"><span title="Metric exporter" class="linkLabel_WmDU">Metric exporter</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/docs/arc-update/modules/mid"><span title="MID module" class="linkLabel_WmDU">MID module</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/docs/arc-update/modules/milter_headers"><span title="Milter headers module" class="linkLabel_WmDU">Milter headers module</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/docs/arc-update/modules/mime_types"><span title="Mime types modules" class="linkLabel_WmDU">Mime types modules</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/docs/arc-update/modules/multimap"><span title="Multimap module" class="linkLabel_WmDU">Multimap module</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/docs/arc-update/modules/mx_check"><span title="MX Check module" class="linkLabel_WmDU">MX Check module</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs.rspamd.com/branches/docs/arc-update/modules/neural"><span title="Neural network module" class="linkLabel_WmDU">Neural network module</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/docs/arc-update/modules/once_received"><span title="Once received module" class="linkLabel_WmDU">Once received module</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/docs/arc-update/modules/phishing"><span title="Phishing module" class="linkLabel_WmDU">Phishing module</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/docs/arc-update/modules/ratelimit"><span title="Ratelimit module" class="linkLabel_WmDU">Ratelimit module</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/docs/arc-update/modules/rbl"><span title="RBL module" class="linkLabel_WmDU">RBL module</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/docs/arc-update/modules/regexp"><span title="Regexp module" class="linkLabel_WmDU">Regexp module</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/docs/arc-update/modules/replies"><span title="Replies module" class="linkLabel_WmDU">Replies module</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/docs/arc-update/modules/reputation"><span title="Reputation module" class="linkLabel_WmDU">Reputation module</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/docs/arc-update/modules/rspamd_update"><span title="Rspamd update module" class="linkLabel_WmDU">Rspamd update module</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/docs/arc-update/modules/spamassassin"><span title="SpamAssassin rules module" class="linkLabel_WmDU">SpamAssassin rules module</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/docs/arc-update/modules/spamtrap"><span title="Spamtrap module" class="linkLabel_WmDU">Spamtrap module</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/docs/arc-update/modules/spf"><span title="SPF module" class="linkLabel_WmDU">SPF module</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/docs/arc-update/modules/surbl"><span title="SURBL module" class="linkLabel_WmDU">SURBL module</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/docs/arc-update/modules/trie"><span title="Trie module" class="linkLabel_WmDU">Trie module</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/docs/arc-update/modules/url_redirector"><span title="URL redirector module" class="linkLabel_WmDU">URL redirector module</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs.rspamd.com/branches/docs/arc-update/modules/whitelist"><span title="Whitelist module" class="linkLabel_WmDU">Whitelist module</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs.rspamd.com/branches/docs/arc-update/lua/"><span title="Lua API" class="categoryLinkLabel_W154">Lua API</span></a><button aria-label="Expand sidebar category &#x27;Lua API&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs.rspamd.com/branches/docs/arc-update/developers/architecture"><span title="Developers" class="categoryLinkLabel_W154">Developers</span></a><button aria-label="Expand sidebar category &#x27;Developers&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs.rspamd.com/branches/docs/arc-update/administration/rspamadm/"><span title="Administration Tools" class="categoryLinkLabel_W154">Administration Tools</span></a><button aria-label="Expand sidebar category &#x27;Administration Tools&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs.rspamd.com/branches/docs/arc-update/other/gtube_patterns"><span title="Other" class="categoryLinkLabel_W154">Other</span></a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs.rspamd.com/branches/docs/arc-update/blog"><span title="Blog" class="linkLabel_WmDU">Blog</span></a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/docs.rspamd.com/branches/docs/arc-update/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs.rspamd.com/branches/docs/arc-update/modules/"><span>Modules</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Neural network module</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Neural network module</h1></header>
<p>The neural network module performs post-classification of messages using a small neural network trained on features extracted from messages. It learns patterns from spam and ham samples and adjusts its scoring based on observed symbol combinations and message metadata.</p>
<p>Since Rspamd 2.0, the module uses <a href="https://github.com/attractivechaos/kann" target="_blank" rel="noopener noreferrer" class="">kann</a>, a lightweight neural network library compiled into Rspamd. Earlier versions (1.7-2.0) used <code>libfann</code>, which is no longer supported.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="architecture-overview">Architecture overview<a href="#architecture-overview" class="hash-link" aria-label="Direct link to Architecture overview" title="Direct link to Architecture overview" translate="no">​</a></h2>
<p>The neural module operates as a distributed system where multiple Rspamd instances share neural network data through Redis:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Scanner Worker │     │  Scanner Worker │     │ Primary Controller │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  (inference)    │     │  (inference)    │     │ (training)         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└────────┬────────┘     └────────┬────────┘     └─────────┬──────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         │                       │                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         │  load ANN             │  load ANN              │ train ANN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         │  store vectors        │  store vectors         │ cleanup old ANNs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         │                       │                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         └───────────────────────┴────────────────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          ┌──────┴──────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          │    Redis    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          │  (storage)  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          └─────────────┘</span><br></span></code></pre></div></div>
<p><strong>Scanner workers</strong> periodically check Redis for updated neural networks and load them for inference. They also store training vectors when messages meet training criteria.</p>
<p><strong>Primary controller worker</strong> periodically checks if enough training vectors have accumulated and spawns training processes. It also cleans up old ANN profiles.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="feature-extraction">Feature extraction<a href="#feature-extraction" class="hash-link" aria-label="Direct link to Feature extraction" title="Direct link to Feature extraction" translate="no">​</a></h2>
<p>The neural network input is a numeric vector constructed from two sources:</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-symbol-scores">1. Symbol scores<a href="#1-symbol-scores" class="hash-link" aria-label="Direct link to 1. Symbol scores" title="Direct link to 1. Symbol scores" translate="no">​</a></h3>
<p>Each symbol in the current Rspamd configuration produces one input value. The value is typically the symbol&#x27;s score normalized to a 0-1 range. Symbols marked with <code>nostat</code>, <code>idempotent</code>, <code>skip</code>, or <code>composite</code> flags are excluded, as are any symbols listed in <code>blacklisted_symbols</code>.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="2-metatokens">2. Metatokens<a href="#2-metatokens" class="hash-link" aria-label="Direct link to 2. Metatokens" title="Direct link to 2. Metatokens" translate="no">​</a></h3>
<p>Metatokens are 39+ numeric features extracted from message structure and content:</p>

























































<table><thead><tr><th>Category</th><th>Features</th></tr></thead><tbody><tr><td><strong>Size</strong></td><td>Message size (bucketed)</td></tr><tr><td><strong>Images</strong></td><td>Total count, PNG ratio, JPEG ratio, large images, small images</td></tr><tr><td><strong>Parts</strong></td><td>Text parts ratio, attachments ratio</td></tr><tr><td><strong>Encoding</strong></td><td>UTF-8 parts ratio, ASCII parts ratio</td></tr><tr><td><strong>Recipients</strong></td><td>MIME recipients count, SMTP recipients count</td></tr><tr><td><strong>Received</strong></td><td>Header count, invalid headers, time skew, secure relays</td></tr><tr><td><strong>URLs</strong></td><td>URL count</td></tr><tr><td><strong>Words</strong></td><td>Average length, short words, spaces rate, double spaces, non-spaces, ASCII rate, non-ASCII rate, capitals rate, numerics rate</td></tr><tr><td><strong>HTML links</strong></td><td>Link count, HTTP ratio, query ratio, same eTLD+1 ratio, domains per link, max links per domain</td></tr><tr><td><strong>HTML forms</strong></td><td>Form count, unaffiliated POST ratio, affiliated POST ratio</td></tr><tr><td><strong>CTA</strong></td><td>Affiliated flag, weight, affiliated links ratio, trackerish ratio</td></tr><tr><td><strong>Visibility</strong></td><td>Hidden text ratio, transparent ratio, hidden blocks, transparent blocks, offscreen blocks, meta refresh count</td></tr></tbody></table>
<p>The metatoken schema has a version number (currently 3) that is included in the ANN key prefix. When metatokens change, new ANNs are automatically created.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="dimensionality-reduction-with-pca">Dimensionality reduction with PCA<a href="#dimensionality-reduction-with-pca" class="hash-link" aria-label="Direct link to Dimensionality reduction with PCA" title="Direct link to Dimensionality reduction with PCA" translate="no">​</a></h2>
<p>When <code>max_inputs</code> is configured, the module uses Principal Component Analysis (PCA) to reduce the input vector size. This is useful for large symbol configurations where the full vector would be too large for efficient training.</p>
<p>PCA is computed during training by:</p>
<ol>
<li class="">Building a scatter matrix from all training vectors</li>
<li class="">Computing eigenvalues and eigenvectors</li>
<li class="">Selecting the top <code>max_inputs</code> eigenvectors as the projection matrix</li>
</ol>
<p>The PCA matrix is stored alongside the ANN in Redis and applied during both training and inference.</p>
<p><strong>Note</strong>: PCA requires Rspamd to be compiled with BLAS support. Check with <code>rspamd --version</code>.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="feature-providers">Feature providers<a href="#feature-providers" class="hash-link" aria-label="Direct link to Feature providers" title="Direct link to Feature providers" translate="no">​</a></h2>
<p>Starting from recent versions, the neural module supports pluggable feature providers that can supply additional input features beyond symbols and metatokens.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="built-in-providers">Built-in providers<a href="#built-in-providers" class="hash-link" aria-label="Direct link to Built-in providers" title="Direct link to Built-in providers" translate="no">​</a></h3>





















<table><thead><tr><th>Provider</th><th>Description</th></tr></thead><tbody><tr><td><code>symbols</code></td><td>Traditional symbols + metatokens vector (default)</td></tr><tr><td><code>metatokens</code></td><td>Metatokens only, without symbol scores</td></tr><tr><td><code>llm</code></td><td>LLM-based embeddings from OpenAI or Ollama APIs</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="llm-provider">LLM provider<a href="#llm-provider" class="hash-link" aria-label="Direct link to LLM provider" title="Direct link to LLM provider" translate="no">​</a></h3>
<p>The LLM provider requests text embeddings from an external API:</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># local.d/neural.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rules {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    providers = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        type = &quot;llm&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        llm_type = &quot;openai&quot;;  # or &quot;ollama&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        model = &quot;text-embedding-3-small&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        url = &quot;https://api.openai.com/v1/embeddings&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        api_key = &quot;sk-...&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        weight = 1.0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cache_ttl = 86400;  # Cache embeddings for 1 day</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # When using LLM, autotrain is disabled; use manual training</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    train {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      autotrain = false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>When LLM providers are configured, automatic training is suppressed unless manual training is explicitly requested via the <code>ANN-Train</code> header.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="fusion-options">Fusion options<a href="#fusion-options" class="hash-link" aria-label="Direct link to Fusion options" title="Direct link to Fusion options" translate="no">​</a></h3>
<p>When multiple providers are used, their outputs are concatenated into a single vector:</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fusion {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  normalization = &quot;zscore&quot;;  # none, unit, or zscore</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  include_meta = true;       # Include metatokens provider</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  meta_weight = 1.0;         # Weight for metatokens</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="configuration">Configuration<a href="#configuration" class="hash-link" aria-label="Direct link to Configuration" title="Direct link to Configuration" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="basic-setup">Basic setup<a href="#basic-setup" class="hash-link" aria-label="Direct link to Basic setup" title="Direct link to Basic setup" translate="no">​</a></h3>
<p>The module requires Redis and is disabled by default:</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># local.d/neural.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">servers = &quot;127.0.0.1:6379&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enabled = true;</span><br></span></code></pre></div></div>
<p>Define symbol scores in <code>local.d/neural_group.conf</code>:</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># local.d/neural_group.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">symbols = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;NEURAL_SPAM&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    weight = 3.0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    description = &quot;Neural network spam&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;NEURAL_HAM&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    weight = -3.0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    description = &quot;Neural network ham&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="configuration-options">Configuration options<a href="#configuration-options" class="hash-link" aria-label="Direct link to Configuration options" title="Direct link to Configuration options" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="training-options-train-section">Training options (<code>train</code> section)<a href="#training-options-train-section" class="hash-link" aria-label="Direct link to training-options-train-section" title="Direct link to training-options-train-section" translate="no">​</a></h4>


























































































<table><thead><tr><th>Option</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>max_trains</code></td><td>1000</td><td>Number of spam+ham samples needed to start training</td></tr><tr><td><code>max_usages</code></td><td>10</td><td>How many times an ANN can be retrained before creating new one</td></tr><tr><td><code>max_iterations</code></td><td>25</td><td>Maximum training epochs</td></tr><tr><td><code>learning_rate</code></td><td>0.01</td><td>Neural network learning rate</td></tr><tr><td><code>max_epoch</code></td><td>1000</td><td>Alternative name for max_iterations</td></tr><tr><td><code>mse</code></td><td>0.001</td><td>Target mean squared error</td></tr><tr><td><code>autotrain</code></td><td>true</td><td>Enable automatic training based on verdicts</td></tr><tr><td><code>train_prob</code></td><td>1.0</td><td>Probability of storing a training sample (0-1)</td></tr><tr><td><code>learn_threads</code></td><td>1</td><td>Training threads (currently unused)</td></tr><tr><td><code>learn_mode</code></td><td>&quot;balanced&quot;</td><td>Training mode: <code>balanced</code> or <code>proportional</code></td></tr><tr><td><code>classes_bias</code></td><td>0.0</td><td>Allowed class imbalance in balanced mode (0-1)</td></tr><tr><td><code>spam_skip_prob</code></td><td>0.0</td><td>Spam skip probability in proportional mode</td></tr><tr><td><code>ham_skip_prob</code></td><td>0.0</td><td>Ham skip probability in proportional mode</td></tr><tr><td><code>spam_score</code></td><td>nil</td><td>Score threshold for spam (overrides verdict)</td></tr><tr><td><code>ham_score</code></td><td>nil</td><td>Score threshold for ham (overrides verdict)</td></tr><tr><td><code>store_pool_only</code></td><td>false</td><td>Store vectors without training (for external training)</td></tr></tbody></table>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="network-architecture-options">Network architecture options<a href="#network-architecture-options" class="hash-link" aria-label="Direct link to Network architecture options" title="Direct link to Network architecture options" translate="no">​</a></h4>




















<table><thead><tr><th>Option</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>hidden_layer_mult</code></td><td>1.5</td><td>Hidden layer size = inputs × this multiplier</td></tr><tr><td><code>max_inputs</code></td><td>nil</td><td>Enable PCA to reduce inputs to this size</td></tr></tbody></table>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="scoring-options">Scoring options<a href="#scoring-options" class="hash-link" aria-label="Direct link to Scoring options" title="Direct link to Scoring options" translate="no">​</a></h4>













































<table><thead><tr><th>Option</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>symbol_spam</code></td><td>&quot;NEURAL_SPAM&quot;</td><td>Symbol inserted for spam classification</td></tr><tr><td><code>symbol_ham</code></td><td>&quot;NEURAL_HAM&quot;</td><td>Symbol inserted for ham classification</td></tr><tr><td><code>spam_score_threshold</code></td><td>nil</td><td>ANN output threshold for spam (0-1)</td></tr><tr><td><code>ham_score_threshold</code></td><td>nil</td><td>ANN output threshold for ham (0-1)</td></tr><tr><td><code>flat_threshold_curve</code></td><td>false</td><td>Use binary 0/1 scores instead of ANN output</td></tr><tr><td><code>roc_enabled</code></td><td>false</td><td>Compute optimal thresholds using ROC analysis</td></tr><tr><td><code>roc_misclassification_cost</code></td><td>0.5</td><td>Cost weight for ROC threshold computation</td></tr></tbody></table>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="storage-options">Storage options<a href="#storage-options" class="hash-link" aria-label="Direct link to Storage options" title="Direct link to Storage options" translate="no">​</a></h4>

























<table><thead><tr><th>Option</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>ann_expire</code></td><td>172800</td><td>ANN expiration time in seconds (2 days)</td></tr><tr><td><code>watch_interval</code></td><td>60.0</td><td>How often to check Redis for updates</td></tr><tr><td><code>lock_expire</code></td><td>600</td><td>Training lock timeout in seconds</td></tr></tbody></table>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="other-options">Other options<a href="#other-options" class="hash-link" aria-label="Direct link to Other options" title="Direct link to Other options" translate="no">​</a></h4>

























<table><thead><tr><th>Option</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>blacklisted_symbols</code></td><td>[]</td><td>Symbols to exclude from input vector</td></tr><tr><td><code>allowed_settings</code></td><td>nil</td><td>Settings IDs that can train this rule</td></tr><tr><td><code>profile</code></td><td>{}</td><td>Static symbol profiles per settings</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="training-modes">Training modes<a href="#training-modes" class="hash-link" aria-label="Direct link to Training modes" title="Direct link to Training modes" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="balanced-mode-default">Balanced mode (default)<a href="#balanced-mode-default" class="hash-link" aria-label="Direct link to Balanced mode (default)" title="Direct link to Balanced mode (default)" translate="no">​</a></h4>
<p>Maintains equal proportions of spam and ham samples. The <code>classes_bias</code> parameter allows some imbalance:</p>
<ul>
<li class=""><code>classes_bias = 0.0</code>: Strict 1:1 ratio</li>
<li class=""><code>classes_bias = 0.25</code>: Allows up to 75%/25% imbalance</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="proportional-mode">Proportional mode<a href="#proportional-mode" class="hash-link" aria-label="Direct link to Proportional mode" title="Direct link to Proportional mode" translate="no">​</a></h4>
<p>Uses <code>spam_skip_prob</code> and <code>ham_skip_prob</code> to probabilistically skip samples, allowing natural class distribution.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="multiple-rules">Multiple rules<a href="#multiple-rules" class="hash-link" aria-label="Direct link to Multiple rules" title="Direct link to Multiple rules" translate="no">​</a></h3>
<p>You can define multiple neural networks with different training parameters:</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># local.d/neural.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rules {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;LONG&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    train {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      max_trains = 5000;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      max_usages = 200;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    symbol_spam = &quot;NEURAL_SPAM_LONG&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    symbol_ham = &quot;NEURAL_HAM_LONG&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ann_expire = 8640000;  # 100 days</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;SHORT&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    train {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      max_trains = 100;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      max_usages = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    symbol_spam = &quot;NEURAL_SPAM_SHORT&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    symbol_ham = &quot;NEURAL_HAM_SHORT&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ann_expire = 86400;  # 1 day</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="settings-integration">Settings integration<a href="#settings-integration" class="hash-link" aria-label="Direct link to Settings integration" title="Direct link to Settings integration" translate="no">​</a></h3>
<p>The module automatically creates separate ANNs for different <a class="" href="/docs.rspamd.com/branches/docs/arc-update/configuration/settings">settings</a> IDs:</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rules {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    allowed_settings = [&quot;inbound&quot;, &quot;outbound&quot;];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # or: allowed_settings = &quot;all&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>Messages with different settings IDs train and use separate neural networks, which is useful for separating inbound and outbound mail processing.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="manual-training">Manual training<a href="#manual-training" class="hash-link" aria-label="Direct link to Manual training" title="Direct link to Manual training" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="via-http-header">Via HTTP header<a href="#via-http-header" class="hash-link" aria-label="Direct link to Via HTTP header" title="Direct link to Via HTTP header" translate="no">​</a></h3>
<p>Add <code>ANN-Train: spam</code> or <code>ANN-Train: ham</code> header to force training:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rspamc --header &quot;ANN-Train: spam&quot; &lt; spam_message.eml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rspamc --header &quot;ANN-Train: ham&quot; &lt; ham_message.eml</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="via-controller-endpoint">Via controller endpoint<a href="#via-controller-endpoint" class="hash-link" aria-label="Direct link to Via controller endpoint" title="Direct link to Via controller endpoint" translate="no">​</a></h3>
<p>The <code>/plugins/neural/learn</code> endpoint accepts JSON POST:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl -X POST http://localhost:11334/plugins/neural/learn \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -H &quot;Content-Type: application/json&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -d &#x27;{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;rule&quot;: &quot;default&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;spam_vec&quot;: [[0.1, 0.2, ...], [0.3, 0.4, ...]],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;ham_vec&quot;: [[0.5, 0.6, ...], [0.7, 0.8, ...]]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }&#x27;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="store-pool-only-mode">Store pool only mode<a href="#store-pool-only-mode" class="hash-link" aria-label="Direct link to Store pool only mode" title="Direct link to Store pool only mode" translate="no">​</a></h3>
<p>For external training pipelines, enable <code>store_pool_only</code>:</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">train {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  store_pool_only = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>This stores training vectors in the task cache as MessagePack, which can be exported to ClickHouse:</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># local.d/clickhouse.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">extra_columns = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Neural_Vec = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    selector = &quot;task_cache(&#x27;neural_vec_mpack&#x27;)&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    type = &quot;String&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    comment = &quot;Training vector for neural&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Neural_Digest = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    selector = &quot;task_cache(&#x27;neural_profile_digest&#x27;)&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    type = &quot;String&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    comment = &quot;Digest of neural profile&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="redis-key-structure">Redis key structure<a href="#redis-key-structure" class="hash-link" aria-label="Direct link to Redis key structure" title="Direct link to Redis key structure" translate="no">​</a></h2>
<p>The neural module uses several Redis key patterns:</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="profile-index-sorted-set">Profile index (Sorted Set)<a href="#profile-index-sorted-set" class="hash-link" aria-label="Direct link to Profile index (Sorted Set)" title="Direct link to Profile index (Sorted Set)" translate="no">​</a></h3>
<p><strong>Key</strong>: <code>rn{plugin_ver}_{rule_prefix}_{metatoken_ver}_{settings_name}</code></p>
<p><strong>Example</strong>: <code>rn3_default_3_default</code></p>
<p>Stores JSON-serialized profiles ranked by timestamp. Each profile contains:</p>
<ul>
<li class=""><code>digest</code>: Symbol configuration hash</li>
<li class=""><code>symbols</code>: Array of symbol names</li>
<li class=""><code>version</code>: Profile version number</li>
<li class=""><code>redis_key</code>: Key where ANN data is stored</li>
<li class=""><code>providers_digest</code>: Hash of provider configuration (if providers used)</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="ann-storage-hash">ANN storage (Hash)<a href="#ann-storage-hash" class="hash-link" aria-label="Direct link to ANN storage (Hash)" title="Direct link to ANN storage (Hash)" translate="no">​</a></h3>
<p><strong>Key</strong>: <code>{prefix}_{rule}_{settings}_{digest}_{version}</code></p>
<p><strong>Example</strong>: <code>rn_default_default_a1b2c3d4_1</code></p>
<p>Hash fields:</p>













































<table><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>ann</code></td><td>string</td><td>Zstd-compressed neural network data</td></tr><tr><td><code>pca</code></td><td>string</td><td>Zstd-compressed PCA matrix (if <code>max_inputs</code> set)</td></tr><tr><td><code>roc_thresholds</code></td><td>JSON</td><td>Spam and ham thresholds from ROC analysis</td></tr><tr><td><code>providers_meta</code></td><td>JSON</td><td>Provider metadata (dimensions, weights)</td></tr><tr><td><code>norm_stats</code></td><td>JSON</td><td>Normalization statistics (mean, std for zscore)</td></tr><tr><td><code>lock</code></td><td>string</td><td>Unix timestamp when training lock was acquired</td></tr><tr><td><code>hostname</code></td><td>string</td><td>Hostname holding the training lock</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="training-sets-sets">Training sets (Sets)<a href="#training-sets-sets" class="hash-link" aria-label="Direct link to Training sets (Sets)" title="Direct link to Training sets (Sets)" translate="no">​</a></h3>
<p><strong>Keys</strong>:</p>
<ul>
<li class=""><code>{ann_key}_spam_set</code> - Set of zstd-compressed spam training vectors</li>
<li class=""><code>{ann_key}_ham_set</code> - Set of zstd-compressed ham training vectors</li>
</ul>
<p>Each vector is semicolon-separated numeric values, compressed with zstd.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="troubleshooting">Troubleshooting<a href="#troubleshooting" class="hash-link" aria-label="Direct link to Troubleshooting" title="Direct link to Troubleshooting" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="check-ann-status">Check ANN status<a href="#check-ann-status" class="hash-link" aria-label="Direct link to Check ANN status" title="Direct link to Check ANN status" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">redis-cli ZRANGE &quot;rn3_default_3_default&quot; 0 -1 WITHSCORES</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="check-training-vector-counts">Check training vector counts<a href="#check-training-vector-counts" class="hash-link" aria-label="Direct link to Check training vector counts" title="Direct link to Check training vector counts" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">redis-cli SCARD &quot;rn_default_default_a1b2c3d4_1_spam_set&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">redis-cli SCARD &quot;rn_default_default_a1b2c3d4_1_ham_set&quot;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="debug-logging">Debug logging<a href="#debug-logging" class="hash-link" aria-label="Direct link to Debug logging" title="Direct link to Debug logging" translate="no">​</a></h3>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># local.d/logging.inc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug_modules = [&quot;neural&quot;];</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="common-issues">Common issues<a href="#common-issues" class="hash-link" aria-label="Direct link to Common issues" title="Direct link to Common issues" translate="no">​</a></h3>
<ol>
<li class="">
<p><strong>ANN not loading</strong>: Check that symbols digest matches between workers. Different plugin configurations create incompatible ANNs.</p>
</li>
<li class="">
<p><strong>Training not starting</strong>: Verify both spam and ham sets have enough samples (<code>max_trains</code>). Check for training locks.</p>
</li>
<li class="">
<p><strong>Poor accuracy</strong>: Ensure balanced training data. Consider adjusting <code>classes_bias</code> or using <code>roc_enabled</code> for automatic threshold tuning.</p>
</li>
<li class="">
<p><strong>High memory usage</strong>: Use <code>max_inputs</code> with PCA to reduce vector size for large symbol configurations.</p>
</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="symbol-registration">Symbol registration<a href="#symbol-registration" class="hash-link" aria-label="Direct link to Symbol registration" title="Direct link to Symbol registration" translate="no">​</a></h2>
<p>The module registers the following symbols:</p>






























<table><thead><tr><th>Symbol</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>NEURAL_CHECK</code></td><td>postfilter</td><td>Main scoring callback</td></tr><tr><td><code>NEURAL_LEARN</code></td><td>idempotent</td><td>Training vector storage callback</td></tr><tr><td><code>NEURAL_SPAM</code></td><td>virtual</td><td>Inserted when ANN classifies as spam</td></tr><tr><td><code>NEURAL_HAM</code></td><td>virtual</td><td>Inserted when ANN classifies as ham</td></tr></tbody></table>
<p>Custom symbol names can be configured per rule using <code>symbol_spam</code> and <code>symbol_ham</code> options.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/rspamd/docs.rspamd.com/edit/master/docs/modules/neural.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs.rspamd.com/branches/docs/arc-update/modules/mx_check"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">MX Check module</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs.rspamd.com/branches/docs/arc-update/modules/once_received"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Once received module</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#architecture-overview" class="table-of-contents__link toc-highlight">Architecture overview</a></li><li><a href="#feature-extraction" class="table-of-contents__link toc-highlight">Feature extraction</a><ul><li><a href="#1-symbol-scores" class="table-of-contents__link toc-highlight">1. Symbol scores</a></li><li><a href="#2-metatokens" class="table-of-contents__link toc-highlight">2. Metatokens</a></li></ul></li><li><a href="#dimensionality-reduction-with-pca" class="table-of-contents__link toc-highlight">Dimensionality reduction with PCA</a></li><li><a href="#feature-providers" class="table-of-contents__link toc-highlight">Feature providers</a><ul><li><a href="#built-in-providers" class="table-of-contents__link toc-highlight">Built-in providers</a></li><li><a href="#llm-provider" class="table-of-contents__link toc-highlight">LLM provider</a></li><li><a href="#fusion-options" class="table-of-contents__link toc-highlight">Fusion options</a></li></ul></li><li><a href="#configuration" class="table-of-contents__link toc-highlight">Configuration</a><ul><li><a href="#basic-setup" class="table-of-contents__link toc-highlight">Basic setup</a></li><li><a href="#configuration-options" class="table-of-contents__link toc-highlight">Configuration options</a></li><li><a href="#training-modes" class="table-of-contents__link toc-highlight">Training modes</a></li><li><a href="#multiple-rules" class="table-of-contents__link toc-highlight">Multiple rules</a></li><li><a href="#settings-integration" class="table-of-contents__link toc-highlight">Settings integration</a></li></ul></li><li><a href="#manual-training" class="table-of-contents__link toc-highlight">Manual training</a><ul><li><a href="#via-http-header" class="table-of-contents__link toc-highlight">Via HTTP header</a></li><li><a href="#via-controller-endpoint" class="table-of-contents__link toc-highlight">Via controller endpoint</a></li><li><a href="#store-pool-only-mode" class="table-of-contents__link toc-highlight">Store pool only mode</a></li></ul></li><li><a href="#redis-key-structure" class="table-of-contents__link toc-highlight">Redis key structure</a><ul><li><a href="#profile-index-sorted-set" class="table-of-contents__link toc-highlight">Profile index (Sorted Set)</a></li><li><a href="#ann-storage-hash" class="table-of-contents__link toc-highlight">ANN storage (Hash)</a></li><li><a href="#training-sets-sets" class="table-of-contents__link toc-highlight">Training sets (Sets)</a></li></ul></li><li><a href="#troubleshooting" class="table-of-contents__link toc-highlight">Troubleshooting</a><ul><li><a href="#check-ann-status" class="table-of-contents__link toc-highlight">Check ANN status</a></li><li><a href="#check-training-vector-counts" class="table-of-contents__link toc-highlight">Check training vector counts</a></li><li><a href="#debug-logging" class="table-of-contents__link toc-highlight">Debug logging</a></li><li><a href="#common-issues" class="table-of-contents__link toc-highlight">Common issues</a></li></ul></li><li><a href="#symbol-registration" class="table-of-contents__link toc-highlight">Symbol registration</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/docs/arc-update/tutorials/quickstart">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/docs/arc-update/configuration">Configuration</a></li><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/docs/arc-update/modules">Modules</a></li><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/docs/arc-update/tutorials">Tutorials</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Resources</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/docs/arc-update/downloads">Downloads</a></li><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/docs/arc-update/faq">FAQ</a></li><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/docs/arc-update/support">Support</a></li><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/docs/arc-update/changelog">Changelog</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/rspamd/rspamd" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/docs/arc-update/tutorials/site_contributing">Contributing</a></li><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/docs/arc-update/blog">Blog</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Subscribe</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/docs/arc-update/rss/changelog.xml">Changelog RSS</a></li><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/docs/arc-update/blog/rss.xml">Blog RSS</a></li><li class="footer__item"><a class="footer__link-item" href="/docs.rspamd.com/branches/docs/arc-update/blog/atom.xml">Blog Atom</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Rspamd Project. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>