"use strict";(self.webpackChunkrspamd_docs=self.webpackChunkrspamd_docs||[]).push([[8464],{28453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>o});var i=s(96540);const l={},a=i.createContext(l);function r(e){const n=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:r(e.components),i.createElement(a.Provider,{value:n},e.children)}},51853:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>t,contentTitle:()=>o,default:()=>m,frontMatter:()=>r,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"administration/rspamadm/dns-tools","title":"DNS & SPF Management","description":"These commands provide DNS querying capabilities and powerful SPF record management, including automatic flattening to avoid the 10-lookup limit.","source":"@site/docs/administration/rspamadm/dns-tools.md","sourceDirName":"administration/rspamadm","slug":"/administration/rspamadm/dns-tools","permalink":"/docs.rspamd.com/branches/docs/antivirus-update/ru/administration/rspamadm/dns-tools","draft":false,"unlisted":false,"editUrl":"https://github.com/rspamd/docs.rspamd.com/edit/master/docs/administration/rspamadm/dns-tools.md","tags":[],"version":"current","frontMatter":{"title":"DNS & SPF Management"},"sidebar":"docs","previous":{"title":"Email Manipulation","permalink":"/docs.rspamd.com/branches/docs/antivirus-update/ru/administration/rspamadm/email-manipulation"},"next":{"title":"DKIM Key Management","permalink":"/docs.rspamd.com/branches/docs/antivirus-update/ru/administration/rspamadm/dkim-management"}}');var l=s(74848),a=s(28453);const r={title:"DNS & SPF Management"},o="DNS & SPF Management",t={},d=[{value:"dnstool spf",id:"dnstool-spf",level:2},{value:"Purpose",id:"purpose",level:3},{value:"Common Scenarios",id:"common-scenarios",level:3},{value:"Query SPF Record",id:"query-spf-record",level:4},{value:"Test IP Against SPF",id:"test-ip-against-spf",level:4},{value:"Show All SPF Mechanisms",id:"show-all-spf-mechanisms",level:4},{value:"Options",id:"options",level:3},{value:"Example Output",id:"example-output",level:3},{value:"dnstool spf-flatten",id:"dnstool-spf-flatten",level:2},{value:"Purpose",id:"purpose-1",level:3},{value:"The SPF Lookup Problem",id:"the-spf-lookup-problem",level:3},{value:"Common Scenarios",id:"common-scenarios-1",level:3},{value:"Basic Flattening",id:"basic-flattening",level:4},{value:"Example Output",id:"example-output-1",level:4},{value:"JSON Output for Automation",id:"json-output-for-automation",level:4},{value:"DNS Zone Format",id:"dns-zone-format",level:4},{value:"Handling Oversized Records",id:"handling-oversized-records",level:3},{value:"Options",id:"options-1",level:3},{value:"Real-World Example: Google Workspace + Microsoft 365",id:"real-world-example-google-workspace--microsoft-365",level:3},{value:"Workflow for SPF Optimization",id:"workflow-for-spf-optimization",level:3},{value:"Important Considerations",id:"important-considerations",level:3},{value:"Maintenance Required",id:"maintenance-required",level:4},{value:"Preserving Dynamic Mechanisms",id:"preserving-dynamic-mechanisms",level:4},{value:"Testing Before Deployment",id:"testing-before-deployment",level:4},{value:"Use Cases",id:"use-cases",level:3},{value:"Limitations",id:"limitations",level:3},{value:"Automation Example",id:"automation-example",level:3},{value:"Practical Examples",id:"practical-examples",level:2},{value:"Debugging SPF Failures",id:"debugging-spf-failures",level:3},{value:"Before and After Flattening",id:"before-and-after-flattening",level:3},{value:"Multi-Domain SPF Management",id:"multi-domain-spf-management",level:3},{value:"Tips and Best Practices",id:"tips-and-best-practices",level:2},{value:"Related Documentation",id:"related-documentation",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"dns--spf-management",children:"DNS & SPF Management"})}),"\n",(0,l.jsx)(n.p,{children:"These commands provide DNS querying capabilities and powerful SPF record management, including automatic flattening to avoid the 10-lookup limit."}),"\n",(0,l.jsx)(n.h2,{id:"dnstool-spf",children:"dnstool spf"}),"\n",(0,l.jsx)(n.p,{children:"Query and analyze SPF records."}),"\n",(0,l.jsx)(n.h3,{id:"purpose",children:"Purpose"}),"\n",(0,l.jsx)(n.p,{children:"Query SPF records for domains and test IP addresses against SPF policies."}),"\n",(0,l.jsx)(n.h3,{id:"common-scenarios",children:"Common Scenarios"}),"\n",(0,l.jsx)(n.h4,{id:"query-spf-record",children:"Query SPF Record"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Query SPF for a domain\nrspamadm dnstool spf -d example.com\n\n# Query SPF from an email address\nrspamadm dnstool spf -f sender@example.com\n"})}),"\n",(0,l.jsx)(n.p,{children:"Output shows:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"SPF record digest"}),"\n",(0,l.jsx)(n.li,{children:"All SPF mechanisms"}),"\n",(0,l.jsx)(n.li,{children:"Policy for each mechanism (pass, fail, neutral, soft fail)"}),"\n",(0,l.jsx)(n.li,{children:"IP networks covered"}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"test-ip-against-spf",children:"Test IP Against SPF"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Check if IP is allowed by SPF\nrspamadm dnstool spf -d example.com -i 192.0.2.1\n\n# Check with email address\nrspamadm dnstool spf -f sender@example.com -i 192.0.2.1\n"})}),"\n",(0,l.jsx)(n.p,{children:"This shows whether the IP would pass, fail, or soft-fail SPF validation."}),"\n",(0,l.jsx)(n.h4,{id:"show-all-spf-mechanisms",children:"Show All SPF Mechanisms"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Display complete SPF record breakdown\nrspamadm dnstool spf -d example.com -a\n"})}),"\n",(0,l.jsxs)(n.p,{children:["Use ",(0,l.jsx)(n.code,{children:"-a"})," to show all mechanisms even without testing a specific IP."]}),"\n",(0,l.jsx)(n.h3,{id:"options",children:"Options"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"-d, --domain <domain>    Query SPF for domain\n-f, --from <email>       Query SPF from email address\n-i, --ip <ip>           Test specific IP address\n-a, --all               Show all SPF mechanisms\n"})}),"\n",(0,l.jsx)(n.h3,{id:"example-output",children:"Example Output"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"SPF record for example.com; digest: abc123def456\n\nPolicy: pass\nNetwork: 192.0.2.0/24\nOriginal: ip4:192.0.2.0/24\n------\nPolicy: pass\nNetwork: 2001:db8::/32\nOriginal: ip6:2001:db8::/32\n------\nPolicy: neutral\nNetwork: any\nOriginal: include:_spf.example.com\n------\n"})}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"dnstool-spf-flatten",children:"dnstool spf-flatten"}),"\n",(0,l.jsx)(n.p,{children:"Flatten SPF records to avoid DNS lookup limits."}),"\n",(0,l.jsx)(n.h3,{id:"purpose-1",children:"Purpose"}),"\n",(0,l.jsxs)(n.p,{children:["SPF has a 10 DNS lookup limit. Complex SPF records with multiple ",(0,l.jsx)(n.code,{children:"include:"})," statements often hit this limit, causing SPF validation to fail. This tool resolves all includes and flattens the SPF record into IP addresses, optimizing and splitting records if needed."]}),"\n",(0,l.jsx)(n.h3,{id:"the-spf-lookup-problem",children:"The SPF Lookup Problem"}),"\n",(0,l.jsx)(n.p,{children:"Standard SPF record with includes:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"v=spf1 include:_spf.google.com include:spf.protection.outlook.com include:_spf.salesforce.com ip4:192.0.2.0/24 ~all\n"})}),"\n",(0,l.jsxs)(n.p,{children:["Each ",(0,l.jsx)(n.code,{children:"include:"})," counts as a lookup. If those includes have more includes, you quickly hit the 10-lookup limit, causing SPF to fail with ",(0,l.jsx)(n.code,{children:"permerror"}),"."]}),"\n",(0,l.jsx)(n.h3,{id:"common-scenarios-1",children:"Common Scenarios"}),"\n",(0,l.jsx)(n.h4,{id:"basic-flattening",children:"Basic Flattening"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Flatten SPF record\nrspamadm dnstool spf-flatten example.com\n"})}),"\n",(0,l.jsx)(n.p,{children:"This resolves all includes and displays:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Number of IPv4/IPv6 networks found"}),"\n",(0,l.jsx)(n.li,{children:"Number of dynamic mechanisms (macros)"}),"\n",(0,l.jsx)(n.li,{children:"Other mechanisms (redirects, etc.)"}),"\n",(0,l.jsx)(n.li,{children:"Flattened SPF record"}),"\n",(0,l.jsx)(n.li,{children:"Whether splitting is needed"}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"example-output-1",children:"Example Output"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"Flattened SPF record for example.com:\n\nFound 45 IPv4 networks, 12 IPv6 networks, 0 dynamic mechanisms, 1 other mechanisms\n\nResult: Single record (length: 387)\n\nv=spf1 ip4:192.0.2.0/24 ip4:198.51.100.0/24 ip4:203.0.113.0/24 [... more IPs ...] ~all\n"})}),"\n",(0,l.jsx)(n.h4,{id:"json-output-for-automation",children:"JSON Output for Automation"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"rspamadm dnstool spf-flatten example.com --format json\n"})}),"\n",(0,l.jsx)(n.p,{children:"Returns structured JSON:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "domain": "example.com",\n  "ipv4_count": 45,\n  "ipv6_count": 12,\n  "dynamic_mechanisms": [],\n  "other_mechanisms": ["~all"],\n  "needs_split": false,\n  "record": "v=spf1 ip4:192.0.2.0/24 ... ~all"\n}\n'})}),"\n",(0,l.jsx)(n.h4,{id:"dns-zone-format",children:"DNS Zone Format"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Output in BIND zone file format\nrspamadm dnstool spf-flatten example.com --format compact\n"})}),"\n",(0,l.jsx)(n.p,{children:"Output:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:'example.com. IN TXT "v=spf1 ip4:192.0.2.0/24 ip4:198.51.100.0/24 ... ~all"\n'})}),"\n",(0,l.jsx)(n.p,{children:"Copy-paste directly into your DNS zone file."}),"\n",(0,l.jsx)(n.h3,{id:"handling-oversized-records",children:"Handling Oversized Records"}),"\n",(0,l.jsx)(n.p,{children:"If the flattened record exceeds 450 characters (safe DNS TXT limit), the tool automatically splits it:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"rspamadm dnstool spf-flatten large-example.com --format compact\n"})}),"\n",(0,l.jsx)(n.p,{children:"Output:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:'large-example.com. IN TXT "v=spf1 include:1._spf.large-example.com include:2._spf.large-example.com ~all"\n1._spf.large-example.com. IN TXT "v=spf1 ip4:192.0.2.0/24 ip4:198.51.100.0/24 ... -all"\n2._spf.large-example.com. IN TXT "v=spf1 ip4:203.0.113.0/24 ip4:198.18.0.0/15 ... -all"\n'})}),"\n",(0,l.jsx)(n.p,{children:"The tool creates helper records and updates your main SPF to include them."}),"\n",(0,l.jsx)(n.h3,{id:"options-1",children:"Options"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"--format <format>    Output format: default, json, compact\n"})}),"\n",(0,l.jsx)(n.p,{children:"Format options:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"default"})," - Human-readable with statistics"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"json"})," - Structured JSON for scripting"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"compact"})," - DNS zone file format"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"real-world-example-google-workspace--microsoft-365",children:"Real-World Example: Google Workspace + Microsoft 365"}),"\n",(0,l.jsx)(n.p,{children:"Many organizations use both Google and Microsoft, leading to:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"v=spf1 include:_spf.google.com include:spf.protection.outlook.com include:_spf.salesforce.com include:servers.mcsv.net ip4:192.0.2.0/24 ~all\n"})}),"\n",(0,l.jsx)(n.p,{children:"This easily exceeds 10 lookups. Flatten it:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"rspamadm dnstool spf-flatten mycompany.com --format compact > spf-new.txt\n"})}),"\n",(0,l.jsx)(n.p,{children:"Review the output, then update your DNS."}),"\n",(0,l.jsx)(n.h3,{id:"workflow-for-spf-optimization",children:"Workflow for SPF Optimization"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Check current SPF"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"rspamadm dnstool spf -d example.com -a\n"})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Count includes manually"})," or use a validator to see if you're hitting limits"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Flatten the record"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"rspamadm dnstool spf-flatten example.com --format json > flattened.json\n"})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Review the output"})," - Check ",(0,l.jsx)(n.code,{children:"needs_split"})," and IP counts"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Generate DNS records"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"rspamadm dnstool spf-flatten example.com --format compact\n"})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Update DNS"})," with the new records"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Test"})," with ",(0,l.jsx)(n.code,{children:"rspamadm dnstool spf -d example.com -i [your-mail-server-ip]"})]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Monitor"})," - Remember to re-flatten periodically as cloud providers change IPs"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"important-considerations",children:"Important Considerations"}),"\n",(0,l.jsx)(n.h4,{id:"maintenance-required",children:"Maintenance Required"}),"\n",(0,l.jsx)(n.p,{children:"Flattened SPF records contain static IPs. When your email providers change their IPs (which happens regularly), your flattened SPF becomes outdated."}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Best practices:"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Re-flatten quarterly or when providers announce IP changes"}),"\n",(0,l.jsx)(n.li,{children:"Monitor SPF failures in DMARC reports"}),"\n",(0,l.jsx)(n.li,{children:"Consider using SPF macros for your own servers"}),"\n",(0,l.jsx)(n.li,{children:"Keep the original unflatted record documented"}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"preserving-dynamic-mechanisms",children:"Preserving Dynamic Mechanisms"}),"\n",(0,l.jsx)(n.p,{children:"The tool preserves:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["SPF macros (like ",(0,l.jsx)(n.code,{children:"%{i}"}),", ",(0,l.jsx)(n.code,{children:"%{d}"}),")"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"redirect="})," modifiers"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"exists:"})," mechanisms"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"These remain in the flattened record as they require runtime evaluation."}),"\n",(0,l.jsx)(n.h4,{id:"testing-before-deployment",children:"Testing Before Deployment"}),"\n",(0,l.jsxs)(n.p,{children:["Always test with ",(0,l.jsx)(n.code,{children:"-i"})," before deploying:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Test that your mail servers still pass\nrspamadm dnstool spf -d example.com -i 192.0.2.50\n"})}),"\n",(0,l.jsx)(n.h3,{id:"use-cases",children:"Use Cases"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:'Fix "permerror"'})," - When SPF validation fails due to too many lookups"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Optimize delivery"})," - Reduce DNS queries during email validation"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Audit SPF"})," - Understand exactly which IPs are authorized"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Multi-vendor environments"})," - Combine Google, Microsoft, Salesforce, etc."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Compliance"})," - Document exact IP ranges authorized to send email"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"limitations",children:"Limitations"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Static snapshots"})," - Requires periodic updates"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Not suitable for dynamic IPs"})," - Don't use for DHCP or frequently changing IPs"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Loss of semantics"})," - Doesn't show which IPs belong to which service"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"DNS limits"})," - Very large organizations may need multiple domains"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"automation-example",children:"Automation Example"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n# Monthly SPF flattening automation\n\nDOMAIN="example.com"\nZONE_FILE="/var/named/example.com.zone"\nBACKUP_DIR="/var/backups/dns"\n\n# Backup current zone\ncp "$ZONE_FILE" "$BACKUP_DIR/example.com.zone.$(date +%Y%m%d)"\n\n# Generate new SPF records\nrspamadm dnstool spf-flatten "$DOMAIN" --format compact > /tmp/new-spf.txt\n\n# Review and approve (in real automation, add validation)\necho "New SPF records:"\ncat /tmp/new-spf.txt\n\n# Manual step: update zone file and reload\necho "Update $ZONE_FILE with the above records and run: rndc reload"\n'})}),"\n",(0,l.jsx)(n.h2,{id:"practical-examples",children:"Practical Examples"}),"\n",(0,l.jsx)(n.h3,{id:"debugging-spf-failures",children:"Debugging SPF Failures"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# Check current SPF\nrspamadm dnstool spf -d example.com -a\n\n# Test specific IP that\'s failing\nrspamadm dnstool spf -d example.com -i 203.0.113.50\n\n# If showing neutral or fail, flatten and check if IP is included\nrspamadm dnstool spf-flatten example.com | grep "203.0.113"\n'})}),"\n",(0,l.jsx)(n.h3,{id:"before-and-after-flattening",children:"Before and After Flattening"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# Before: Show all includes\necho "Current SPF with includes:"\ndig +short TXT example.com | grep spf1\n\n# Flatten\necho -e "\\nFlattened SPF:"\nrspamadm dnstool spf-flatten example.com\n\n# After: Update DNS and verify\necho -e "\\nVerifying flattened SPF:"\nrspamadm dnstool spf -d example.com -i 192.0.2.1\n'})}),"\n",(0,l.jsx)(n.h3,{id:"multi-domain-spf-management",children:"Multi-Domain SPF Management"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n# Flatten SPF for all company domains\n\nDOMAINS="example.com example.org example.net"\n\nfor domain in $DOMAINS; do\n  echo "=== $domain ==="\n  rspamadm dnstool spf-flatten "$domain" --format compact\n  echo\ndone\n'})}),"\n",(0,l.jsx)(n.h2,{id:"tips-and-best-practices",children:"Tips and Best Practices"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Test before deploying"})," - Always validate with ",(0,l.jsx)(n.code,{children:"-i"})," using your actual mail server IPs"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Document the source"})," - Keep notes on which includes were flattened"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Set calendar reminders"})," - Re-flatten quarterly"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Monitor DMARC reports"})," - Watch for SPF failures indicating stale records"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Use compact format for DNS"})," - Easier to copy into zone files"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Consider partial flattening"})," - Keep stable includes, flatten problematic ones"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Backup before changes"})," - Keep the original SPF record"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Check length limits"})," - DNS TXT records should be under 512 bytes ideally"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"/docs.rspamd.com/branches/docs/antivirus-update/ru/administration/rspamadm/dkim-management",children:"DKIM Management"})," - Complete email authentication"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"/docs.rspamd.com/branches/docs/antivirus-update/ru/administration/rspamadm/operations",children:"Operations"})," - DMARC report sending"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"/docs.rspamd.com/branches/docs/antivirus-update/ru/administration/rspamadm/configuration",children:"Configuration"})," - Configure SPF checking in Rspamd"]}),"\n"]})]})}function m(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(c,{...e})}):c(e)}}}]);